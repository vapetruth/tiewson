/*! For license information please see main.bcd40b6c.js.LICENSE.txt */
(()=>{var e={49(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var w=b.prototype=new y;w.constructor=b,m(w,v.prototype),w.isPureReactComponent=!0;var x=Array.isArray,E=Object.prototype.hasOwnProperty,_={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,r){var o,i={},a=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)E.call(t,o)&&!C.hasOwnProperty(o)&&(i[o]=t[o]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(o in u=e.defaultProps)void 0===i[o]&&(i[o]=u[o]);return{$$typeof:n,type:e,key:a,ref:s,props:i,_owner:_.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,o,i,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return a=a(u=e),e=""===i?"."+T(u,0):i,x(a)?(o="",null!=e&&(o=e.replace(I,"$&/")+"/"),N(a,t,o,"",function(e){return e})):null!=a&&(S(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,o+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(u=0,i=""===i?".":i+":",x(e))for(var c=0;c<e.length;c++){var l=i+T(s=e[c],c);u+=N(s,t,o,l,a)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=N(s=s.value,t,o,l=i+T(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function R(e,t,n){if(null==e)return e;var r=[],o=0;return N(e,r,"","",function(e){return t.call(n,e,o++)}),r}function A(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},O={transition:null},P={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:O,ReactCurrentOwner:_};function F(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:R,forEach:function(e,t,n){R(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return R(e,function(){t++}),t},toArray:function(e){return R(e,function(e){return e})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=o,t.Profiler=a,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.act=F,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),i=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=_.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)E.call(t,c)&&!C.hasOwnProperty(c)&&(o[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}return{$$typeof:n,type:e.type,key:i,ref:a,props:o,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=F,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},82(){},119(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(345)},318(){},340(e,t,n){"use strict";e.exports=n(761)},345(e,t,n){"use strict";var r=n(950),o=n(340);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,r,o,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var o=g.hasOwnProperty(t)?g[t]:null;(null!==o?0!==o.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,r)&&(n=null),r||null===o?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,r=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),E=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),I=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function F(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var M,L=Object.assign;function B(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var U=!1;function z(e,t){if(!e||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var o=c.stack.split("\n"),i=r.stack.split("\n"),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==i[s]){var u="\n"+o[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=a&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?B(e):""}function V(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function j(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case E:return"Portal";case k:return"Profiler";case C:return"StrictMode";case N:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case S:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case A:return null!==(t=e.displayName||null)?t:j(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return j(e(t))}catch(n){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return L({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){$(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(r&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return L({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function oe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ie(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,he=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return le(e,t)})}:le);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ve=L({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ee=null,_e=null,Ce=null;function ke(e){if(e=wo(e)){if("function"!==typeof Ee)throw Error(i(280));var t=e.stateNode;t&&(t=Eo(t),Ee(e.stateNode,e.type,t))}}function Se(e){_e?Ce?Ce.push(e):Ce=[e]:_e=e}function Ie(){if(_e){var e=_e,t=Ce;if(Ce=_e=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Te(e,t){return e(t)}function Ne(){}var Re=!1;function Ae(e,t,n){if(Re)return e(t,n);Re=!0;try{return Te(e,t,n)}finally{Re=!1,(null!==_e||null!==Ce)&&(Ne(),Ie())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=Eo(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var Oe=!1;if(l)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(le){Oe=!1}function Fe(e,t,n,r,o,i,a,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Me=!1,Le=null,Be=!1,Ue=null,ze={onError:function(e){Me=!0,Le=e}};function Ve(e,t,n,r,o,i,a,s,u){Me=!1,Le=null,Fe.apply(ze,arguments)}function je(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function We(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(je(e)!==e)throw Error(i(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=je(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return Ge(o),e;if(a===r)return Ge(o),t;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=o.unstable_scheduleCallback,Xe=o.unstable_cancelCallback,Qe=o.unstable_shouldYield,Ye=o.unstable_requestPaint,$e=o.unstable_now,Je=o.unstable_getCurrentPriorityLevel,Ze=o.unstable_ImmediatePriority,et=o.unstable_UserBlockingPriority,tt=o.unstable_NormalPriority,nt=o.unstable_LowPriority,rt=o.unstable_IdlePriority,ot=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~o;0!==s?r=ht(s):0!==(i&=a)&&(r=ht(i))}else 0!==(a=n&~o)?r=ht(a):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&o)&&((o=r&-r)>=(i=t&-t)||16===o&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)o=1<<(n=31-at(t)),r|=e[n],t&=~o;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,Et,_t,Ct,kt,St=!1,It=[],Tt=null,Nt=null,Rt=null,At=new Map,Dt=new Map,Ot=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ft(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":At.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Mt(e,t,n,r,o,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},null!==t&&(null!==(t=wo(t))&&Et(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function Lt(e){var t=bo(e.target);if(null!==t){var n=je(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=We(n)))return e.blockedOn=t,void kt(e.priority,function(){_t(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wo(n))&&Et(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Ut(e,t,n){Bt(e)&&n.delete(t)}function zt(){St=!1,null!==Tt&&Bt(Tt)&&(Tt=null),null!==Nt&&Bt(Nt)&&(Nt=null),null!==Rt&&Bt(Rt)&&(Rt=null),At.forEach(Ut),Dt.forEach(Ut)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,zt)))}function jt(e){function t(t){return Vt(t,e)}if(0<It.length){Vt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Vt(Tt,e),null!==Nt&&Vt(Nt,e),null!==Rt&&Vt(Rt,e),At.forEach(t),Dt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Lt(n),null===n.blockedOn&&Ot.shift()}var Wt=w.ReactCurrentBatchConfig,Gt=!0;function Ht(e,t,n,r){var o=bt,i=Wt.transition;Wt.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=o,Wt.transition=i}}function qt(e,t,n,r){var o=bt,i=Wt.transition;Wt.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=o,Wt.transition=i}}function Kt(e,t,n,r){if(Gt){var o=Qt(e,t,n,r);if(null===o)Gr(e,t,r,Xt,n),Ft(e,r);else if(function(e,t,n,r,o){switch(t){case"focusin":return Tt=Mt(Tt,e,t,n,r,o),!0;case"dragenter":return Nt=Mt(Nt,e,t,n,r,o),!0;case"mouseover":return Rt=Mt(Rt,e,t,n,r,o),!0;case"pointerover":var i=o.pointerId;return At.set(i,Mt(At.get(i)||null,e,t,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Dt.set(i,Mt(Dt.get(i)||null,e,t,n,r,o)),!0}return!1}(o,e,t,n,r))r.stopPropagation();else if(Ft(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==o;){var i=wo(o);if(null!==i&&xt(i),null===(i=Qt(e,t,n,r))&&Gr(e,t,r,Xt,n),i===o)break;o=i}null!==o&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var Xt=null;function Qt(e,t,n,r){if(Xt=null,null!==(e=bo(e=xe(r))))if(null===(t=je(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=We(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,r=n.length,o="value"in $t?$t.value:$t.textContent,i=o.length;for(e=0;e<r&&n[e]===o[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===o[i-t];t++);return Zt=o.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,o,i){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return L(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(cn),hn=L({},cn,{view:0,detail:0}),dn=on(hn),fn=L({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(fn),mn=on(L({},fn,{dataTransfer:0})),gn=on(L({},hn,{relatedTarget:0})),vn=on(L({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=L({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(yn),wn=on(L({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function kn(){return Cn}var Sn=L({},hn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?En[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(Sn),Tn=on(L({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=on(L({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Rn=on(L({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),An=L({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(An),On=[9,13,27,32],Pn=l&&"CompositionEvent"in window,Fn=null;l&&"documentMode"in document&&(Fn=document.documentMode);var Mn=l&&"TextEvent"in window&&!Fn,Ln=l&&(!Pn||Fn&&8<Fn&&11>=Fn),Bn=String.fromCharCode(32),Un=!1;function zn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jn=!1;var Wn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Wn[e.type]:"textarea"===t}function Hn(e,t,n,r){Se(r),0<(t=qr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function Xn(e){Br(e,0)}function Qn(e){if(K(xo(e)))return e}function Yn(e,t){if("change"===e)return t}var $n=!1;if(l){var Jn;if(l){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Jn=Zn}else Jn=!1;$n=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&Qn(Kn)){var t=[];Hn(t,Kn,e,xe(e)),Ae(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function or(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Kn)}function ir(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!h.call(t,o)||!sr(e[o],t[o]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=void 0===r.end?i:Math.min(r.end,o),!e.extend&&i>r&&(o=r,r=i,i=o),o=lr(n,i);var a=lr(n,r);o&&a&&(1!==e.rangeCount||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(o.node,o.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,yr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==X(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=qr(vr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Er={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},_r={},Cr={};function kr(e){if(_r[e])return _r[e];if(!Er[e])return e;var t,n=Er[e];for(t in n)if(n.hasOwnProperty(t)&&t in Cr)return _r[e]=n[t];return e}l&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);var Sr=kr("animationend"),Ir=kr("animationiteration"),Tr=kr("animationstart"),Nr=kr("transitionend"),Rr=new Map,Ar="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Rr.set(e,t),u(t,[e])}for(var Or=0;Or<Ar.length;Or++){var Pr=Ar[Or];Dr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}Dr(Sr,"onAnimationEnd"),Dr(Ir,"onAnimationIteration"),Dr(Tr,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Nr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Lr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,o,a,s,u,c){if(Ve.apply(this,arguments),Me){if(!Me)throw Error(i(198));var l=Le;Me=!1,Le=null,Be||(Be=!0,Ue=l)}}(r,t,void 0,e),e.currentTarget=null}function Br(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&o.isPropagationStopped())break e;Lr(o,s,c),i=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,c=s.currentTarget,s=s.listener,u!==i&&o.isPropagationStopped())break e;Lr(o,s,c),i=u}}}if(Be)throw e=Ue,Be=!1,Ue=null,e}function Ur(e,t){var n=t[go];void 0===n&&(n=t[go]=new Set);var r=e+"__bubble";n.has(r)||(Wr(t,e,2,!1),n.add(r))}function zr(e,t,n){var r=0;t&&(r|=4),Wr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function jr(e){if(!e[Vr]){e[Vr]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||zr(t,!1,e),zr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,zr("selectionchange",!1,t))}}function Wr(e,t,n,r){switch(Yt(t)){case 1:var o=Ht;break;case 4:o=qt;break;default:o=Kt}n=o.bind(null,t,n,e),o=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),r?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,o){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===o||8===u.nodeType&&u.parentNode===o))return;a=a.return}for(;null!==s;){if(null===(a=bo(s)))return;if(5===(u=a.tag)||6===u){r=i=a;continue e}s=s.parentNode}}r=r.return}Ae(function(){var r=i,o=xe(n),a=[];e:{var s=Rr.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=In;break;case"focusin":c="focus",u=gn;break;case"focusout":c="blur",u=gn;break;case"beforeblur":case"afterblur":u=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Nn;break;case Sr:case Ir:case Tr:u=vn;break;case Nr:u=Rn;break;case"scroll":u=dn;break;case"wheel":u=Dn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Tn}var l=0!==(4&t),h=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var f,p=r;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=De(p,d))&&l.push(Hr(p,m,f)))),h)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,o),a.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[mo])&&(u||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(h=je(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,m="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=Tn,m="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:xo(u),f=null==c?s:xo(c),(s=new l(m,p+"leave",u,n,o)).target=h,s.relatedTarget=f,m=null,bo(o)===r&&((l=new l(d,p+"enter",c,n,o)).target=f,l.relatedTarget=h,m=l),h=m,u&&c)e:{for(d=c,p=0,f=l=u;f;f=Kr(f))p++;for(f=0,m=d;m;m=Kr(m))f++;for(;0<p-f;)l=Kr(l),p--;for(;0<f-p;)d=Kr(d),f--;for(;p--;){if(l===d||null!==d&&l===d.alternate)break e;l=Kr(l),d=Kr(d)}l=null}else l=null;null!==u&&Xr(a,s,u,l,!1),null!==c&&null!==h&&Xr(a,h,c,l,!0)}if("select"===(u=(s=r?xo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var g=Yn;else if(Gn(s))if($n)g=ar;else{g=or;var v=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=ir);switch(g&&(g=g(e,r))?Hn(a,g,n,o):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&ee(s,"number",s.value)),v=r?xo(r):window,e){case"focusin":(Gn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,yr=null);break;case"focusout":yr=vr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(a,n,o);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":wr(a,n,o)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else jn?zn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Ln&&"ko"!==n.locale&&(jn||"onCompositionStart"!==b?"onCompositionEnd"===b&&jn&&(y=en()):(Jt="value"in($t=o)?$t.value:$t.textContent,jn=!0)),0<(v=qr(r,b)).length&&(b=new wn(b,e,null,n,o),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=Vn(n))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Un=!0,Bn);case"textInput":return(e=t.data)===Bn&&Un?null:e;default:return null}}(e,n):function(e,t){if(jn)return"compositionend"===e||!Pn&&zn(e,t)?(e=en(),Zt=Jt=$t=null,jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(o=new wn("onBeforeInput","beforeinput",null,n,o),a.push({event:o,listeners:r}),o.data=y))}Br(a,t)})}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var o=e,i=o.stateNode;5===o.tag&&null!==i&&(o=i,null!=(i=De(e,n))&&r.unshift(Hr(e,i,o)),null!=(i=De(e,t))&&r.push(Hr(e,i,o))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,o){for(var i=t._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,o?null!=(u=De(n,i))&&a.unshift(Hr(n,u,s)):o||null!=(u=De(n,i))&&a.push(Hr(n,u,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function $r(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Yr,"")}function Jr(e,t,n){if(t=$r(t),$r(e)!==t&&n)throw Error(i(425))}function Zr(){}var eo=null,to=null;function no(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ro="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,io="function"===typeof Promise?Promise:void 0,ao="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof io?function(e){return io.resolve(null).then(e).catch(so)}:ro;function so(e){setTimeout(function(){throw e})}function uo(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return e.removeChild(o),void jt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);jt(t)}function co(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function lo(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ho=Math.random().toString(36).slice(2),fo="__reactFiber$"+ho,po="__reactProps$"+ho,mo="__reactContainer$"+ho,go="__reactEvents$"+ho,vo="__reactListeners$"+ho,yo="__reactHandles$"+ho;function bo(e){var t=e[fo];if(t)return t;for(var n=e.parentNode;n;){if(t=n[mo]||n[fo]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=lo(e);null!==e;){if(n=e[fo])return n;e=lo(e)}return t}n=(e=n).parentNode}return null}function wo(e){return!(e=e[fo]||e[mo])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xo(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Eo(e){return e[po]||null}var _o=[],Co=-1;function ko(e){return{current:e}}function So(e){0>Co||(e.current=_o[Co],_o[Co]=null,Co--)}function Io(e,t){Co++,_o[Co]=e.current,e.current=t}var To={},No=ko(To),Ro=ko(!1),Ao=To;function Do(e,t){var n=e.type.contextTypes;if(!n)return To;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o,i={};for(o in n)i[o]=t[o];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Oo(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Po(){So(Ro),So(No)}function Fo(e,t,n){if(No.current!==To)throw Error(i(168));Io(No,t),Io(Ro,n)}function Mo(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in t))throw Error(i(108,W(e)||"Unknown",o));return L({},n,r)}function Lo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||To,Ao=No.current,Io(No,e),Io(Ro,Ro.current),!0}function Bo(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Mo(e,t,Ao),r.__reactInternalMemoizedMergedChildContext=e,So(Ro),So(No),Io(No,e)):So(Ro),Io(Ro,n)}var Uo=null,zo=!1,Vo=!1;function jo(e){null===Uo?Uo=[e]:Uo.push(e)}function Wo(){if(!Vo&&null!==Uo){Vo=!0;var e=0,t=bt;try{var n=Uo;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Uo=null,zo=!1}catch(o){throw null!==Uo&&(Uo=Uo.slice(e+1)),Ke(Ze,Wo),o}finally{bt=t,Vo=!1}}return null}var Go=[],Ho=0,qo=null,Ko=0,Xo=[],Qo=0,Yo=null,$o=1,Jo="";function Zo(e,t){Go[Ho++]=Ko,Go[Ho++]=qo,qo=e,Ko=t}function ei(e,t,n){Xo[Qo++]=$o,Xo[Qo++]=Jo,Xo[Qo++]=Yo,Yo=e;var r=$o;e=Jo;var o=32-at(r)-1;r&=~(1<<o),n+=1;var i=32-at(t)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,$o=1<<32-at(t)+o|n<<o|r,Jo=i+e}else $o=1<<i|n<<o|r,Jo=e}function ti(e){null!==e.return&&(Zo(e,1),ei(e,1,0))}function ni(e){for(;e===qo;)qo=Go[--Ho],Go[Ho]=null,Ko=Go[--Ho],Go[Ho]=null;for(;e===Yo;)Yo=Xo[--Qo],Xo[Qo]=null,Jo=Xo[--Qo],Xo[Qo]=null,$o=Xo[--Qo],Xo[Qo]=null}var ri=null,oi=null,ii=!1,ai=null;function si(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ui(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ri=e,oi=co(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ri=e,oi=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yo?{id:$o,overflow:Jo}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ri=e,oi=null,!0);default:return!1}}function ci(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function li(e){if(ii){var t=oi;if(t){var n=t;if(!ui(e,t)){if(ci(e))throw Error(i(418));t=co(n.nextSibling);var r=ri;t&&ui(e,t)?si(r,n):(e.flags=-4097&e.flags|2,ii=!1,ri=e)}}else{if(ci(e))throw Error(i(418));e.flags=-4097&e.flags|2,ii=!1,ri=e}}}function hi(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ri=e}function di(e){if(e!==ri)return!1;if(!ii)return hi(e),ii=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!no(e.type,e.memoizedProps)),t&&(t=oi)){if(ci(e))throw fi(),Error(i(418));for(;t;)si(e,t),t=co(t.nextSibling)}if(hi(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){oi=co(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}oi=null}}else oi=ri?co(e.stateNode.nextSibling):null;return!0}function fi(){for(var e=oi;e;)e=co(e.nextSibling)}function pi(){oi=ri=null,ii=!1}function mi(e){null===ai?ai=[e]:ai.push(e)}var gi=w.ReactCurrentBatchConfig;function vi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var o=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=o.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function yi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bi(e){return(0,e._init)(e._payload)}function wi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Mc(n,e.mode,r)).return=e,t):((t=o(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===D&&bi(i)===t.type)?((r=o(t,n.props)).ref=vi(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=vi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lc(n,e.mode,r)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Pc(n,e.mode,r,i)).return=e,t):((t=o(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=vi(e,null,t),n.return=e,n;case E:return(t=Lc(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||F(t))return(t=Pc(t,e.mode,n,null)).return=e,t;yi(e,t)}return null}function f(e,t,n,r){var o=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===o?c(e,t,n,r):null;case E:return n.key===o?l(e,t,n,r):null;case D:return f(e,t,(o=n._init)(n._payload),r)}if(te(n)||F(n))return null!==o?null:h(e,t,n,r,null);yi(e,n)}return null}function p(e,t,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,o);case E:return l(t,e=e.get(null===r.key?n:r.key)||null,r,o);case D:return p(e,t,n,(0,r._init)(r._payload),o)}if(te(r)||F(r))return h(t,e=e.get(n)||null,r,o,null);yi(t,r)}return null}function m(o,i,s,u){for(var c=null,l=null,h=i,m=i=0,g=null;null!==h&&m<s.length;m++){h.index>m?(g=h,h=null):g=h.sibling;var v=f(o,h,s[m],u);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(o,h),i=a(v,i,m),null===l?c=v:l.sibling=v,l=v,h=g}if(m===s.length)return n(o,h),ii&&Zo(o,m),c;if(null===h){for(;m<s.length;m++)null!==(h=d(o,s[m],u))&&(i=a(h,i,m),null===l?c=h:l.sibling=h,l=h);return ii&&Zo(o,m),c}for(h=r(o,h);m<s.length;m++)null!==(g=p(h,o,m,s[m],u))&&(e&&null!==g.alternate&&h.delete(null===g.key?m:g.key),i=a(g,i,m),null===l?c=g:l.sibling=g,l=g);return e&&h.forEach(function(e){return t(o,e)}),ii&&Zo(o,m),c}function g(o,s,u,c){var l=F(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var h=l=null,m=s,g=s=0,v=null,y=u.next();null!==m&&!y.done;g++,y=u.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=f(o,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(o,m),s=a(b,s,g),null===h?l=b:h.sibling=b,h=b,m=v}if(y.done)return n(o,m),ii&&Zo(o,g),l;if(null===m){for(;!y.done;g++,y=u.next())null!==(y=d(o,y.value,c))&&(s=a(y,s,g),null===h?l=y:h.sibling=y,h=y);return ii&&Zo(o,g),l}for(m=r(o,m);!y.done;g++,y=u.next())null!==(y=p(m,o,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=a(y,s,g),null===h?l=y:h.sibling=y,h=y);return e&&m.forEach(function(e){return t(o,e)}),ii&&Zo(o,g),l}return function e(r,i,a,u){if("object"===typeof a&&null!==a&&a.type===_&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case x:e:{for(var c=a.key,l=i;null!==l;){if(l.key===c){if((c=a.type)===_){if(7===l.tag){n(r,l.sibling),(i=o(l,a.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&bi(c)===l.type){n(r,l.sibling),(i=o(l,a.props)).ref=vi(r,l,a),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}a.type===_?((i=Pc(a.props.children,r.mode,u,a.key)).return=r,r=i):((u=Oc(a.type,a.key,a.props,null,r.mode,u)).ref=vi(r,i,a),u.return=r,r=u)}return s(r);case E:e:{for(l=a.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(r,i.sibling),(i=o(i,a.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Lc(a,r.mode,u)).return=r,r=i}return s(r);case D:return e(r,i,(l=a._init)(a._payload),u)}if(te(a))return m(r,i,a,u);if(F(a))return g(r,i,a,u);yi(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(r,i.sibling),(i=o(i,a)).return=r,r=i):(n(r,i),(i=Mc(a,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var xi=wi(!0),Ei=wi(!1),_i=ko(null),Ci=null,ki=null,Si=null;function Ii(){Si=ki=Ci=null}function Ti(e){var t=_i.current;So(_i),e._currentValue=t}function Ni(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ri(e,t){Ci=e,Si=ki=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bs=!0),e.firstContext=null)}function Ai(e){var t=e._currentValue;if(Si!==e)if(e={context:e,memoizedValue:t,next:null},null===ki){if(null===Ci)throw Error(i(308));ki=e,Ci.dependencies={lanes:0,firstContext:e}}else ki=ki.next=e;return t}var Di=null;function Oi(e){null===Di?Di=[e]:Di.push(e)}function Pi(e,t,n,r){var o=t.interleaved;return null===o?(n.next=n,Oi(t)):(n.next=o.next,o.next=n),t.interleaved=n,Fi(e,r)}function Fi(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mi=!1;function Li(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ui(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Iu)){var o=r.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Fi(e,n)}return null===(o=r.interleaved)?(t.next=t,Oi(r)):(t.next=o.next,o.next=t),r.interleaved=t,Fi(e,n)}function Vi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function ji(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?o=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?o=i=t:i=i.next=t}else o=i=t;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Wi(e,t,n,r){var o=e.updateQueue;Mi=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,c=u.next;u.next=null,null===a?i=c:a.next=c,a=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var h=o.baseState;for(a=0,l=c=u=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,m=s;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=m.payload)?p.call(f,h,d):p)||void 0===d)break e;h=L({},h,d);break e;case 2:Mi=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=o.effects)?o.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=h):l=l.next=f,a|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(d=s).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===l&&(u=h),o.baseState=u,o.firstBaseUpdate=c,o.lastBaseUpdate=l,null!==(t=o.shared.interleaved)){o=t;do{a|=o.lane,o=o.next}while(o!==t)}else null===i&&(o.shared.lanes=0);Fu|=a,e.lanes=a,e.memoizedState=h}}function Gi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!==typeof o)throw Error(i(191,o));o.call(r)}}}var Hi={},qi=ko(Hi),Ki=ko(Hi),Xi=ko(Hi);function Qi(e){if(e===Hi)throw Error(i(174));return e}function Yi(e,t){switch(Io(Xi,t),Io(Ki,e),Io(qi,Hi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}So(qi),Io(qi,t)}function $i(){So(qi),So(Ki),So(Xi)}function Ji(e){Qi(Xi.current);var t=Qi(qi.current),n=ue(t,e.type);t!==n&&(Io(Ki,e),Io(qi,n))}function Zi(e){Ki.current===e&&(So(qi),So(Ki))}var ea=ko(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var na=[];function ra(){for(var e=0;e<na.length;e++)na[e]._workInProgressVersionPrimary=null;na.length=0}var oa=w.ReactCurrentDispatcher,ia=w.ReactCurrentBatchConfig,aa=0,sa=null,ua=null,ca=null,la=!1,ha=!1,da=0,fa=0;function pa(){throw Error(i(321))}function ma(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function ga(e,t,n,r,o,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oa.current=null===e||null===e.memoizedState?Za:es,e=n(r,o),ha){a=0;do{if(ha=!1,da=0,25<=a)throw Error(i(301));a+=1,ca=ua=null,t.updateQueue=null,oa.current=ts,e=n(r,o)}while(ha)}if(oa.current=Ja,t=null!==ua&&null!==ua.next,aa=0,ca=ua=sa=null,la=!1,t)throw Error(i(300));return e}function va(){var e=0!==da;return da=0,e}function ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?sa.memoizedState=ca=e:ca=ca.next=e,ca}function ba(){if(null===ua){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=ua.next;var t=null===ca?sa.memoizedState:ca.next;if(null!==t)ca=t,ua=e;else{if(null===e)throw Error(i(310));e={memoizedState:(ua=e).memoizedState,baseState:ua.baseState,baseQueue:ua.baseQueue,queue:ua.queue,next:null},null===ca?sa.memoizedState=ca=e:ca=ca.next=e}return ca}function wa(e,t){return"function"===typeof t?t(e):t}function xa(e){var t=ba(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=ua,o=r.baseQueue,a=n.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}r.baseQueue=o=a,n.pending=null}if(null!==o){a=o.next,r=r.baseState;var u=s=null,c=null,l=a;do{var h=l.lane;if((aa&h)===h)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=d,s=r):c=c.next=d,sa.lanes|=h,Fu|=h}l=l.next}while(null!==l&&l!==a);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(bs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){o=e;do{a=o.lane,sa.lanes|=a,Fu|=a,o=o.next}while(o!==e)}else null===o&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ea(e){var t=ba(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,a=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=e(a,s.action),s=s.next}while(s!==o);sr(a,t.memoizedState)||(bs=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function _a(){}function Ca(e,t){var n=sa,r=ba(),o=t(),a=!sr(r.memoizedState,o);if(a&&(r.memoizedState=o,bs=!0),r=r.queue,Ma(Ia.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ca&&1&ca.memoizedState.tag){if(n.flags|=2048,Aa(9,Sa.bind(null,n,r,o,t),void 0,null),null===Tu)throw Error(i(349));0!==(30&aa)||ka(n,t,o)}return o}function ka(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Sa(e,t,n,r){t.value=n,t.getSnapshot=r,Ta(t)&&Na(e)}function Ia(e,t,n){return n(function(){Ta(t)&&Na(e)})}function Ta(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Na(e){var t=Fi(e,1);null!==t&&tc(t,e,1,-1)}function Ra(e){var t=ya();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wa,lastRenderedState:e},t.queue=e,e=e.dispatch=Xa.bind(null,sa,e),[t.memoizedState,e]}function Aa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Da(){return ba().memoizedState}function Oa(e,t,n,r){var o=ya();sa.flags|=e,o.memoizedState=Aa(1|t,n,void 0,void 0===r?null:r)}function Pa(e,t,n,r){var o=ba();r=void 0===r?null:r;var i=void 0;if(null!==ua){var a=ua.memoizedState;if(i=a.destroy,null!==r&&ma(r,a.deps))return void(o.memoizedState=Aa(t,n,i,r))}sa.flags|=e,o.memoizedState=Aa(1|t,n,i,r)}function Fa(e,t){return Oa(8390656,8,e,t)}function Ma(e,t){return Pa(2048,8,e,t)}function La(e,t){return Pa(4,2,e,t)}function Ba(e,t){return Pa(4,4,e,t)}function Ua(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function za(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4,4,Ua.bind(null,t,e),n)}function Va(){}function ja(e,t){var n=ba();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ma(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Wa(e,t){var n=ba();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ma(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ga(e,t,n){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,bs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),sa.lanes|=n,Fu|=n,e.baseState=!0),t)}function Ha(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=ia.transition;ia.transition={};try{e(!1),t()}finally{bt=n,ia.transition=r}}function qa(){return ba().memoizedState}function Ka(e,t,n){var r=ec(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qa(e))Ya(t,n);else if(null!==(n=Pi(e,t,n,r))){tc(n,e,r,Zu()),$a(n,t,r)}}function Xa(e,t,n){var r=ec(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qa(e))Ya(t,o);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,a)){var u=t.interleaved;return null===u?(o.next=o,Oi(t)):(o.next=u.next,u.next=o),void(t.interleaved=o)}}catch(c){}null!==(n=Pi(e,t,o,r))&&(tc(n,e,r,o=Zu()),$a(n,t,r))}}function Qa(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function Ya(e,t){ha=la=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function $a(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Ja={readContext:Ai,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Za={readContext:Ai,useCallback:function(e,t){return ya().memoizedState=[e,void 0===t?null:t],e},useContext:Ai,useEffect:Fa,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Oa(4194308,4,Ua.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Oa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Oa(4,2,e,t)},useMemo:function(e,t){var n=ya();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ya();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ka.bind(null,sa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},ya().memoizedState=e},useState:Ra,useDebugValue:Va,useDeferredValue:function(e){return ya().memoizedState=e},useTransition:function(){var e=Ra(!1),t=e[0];return e=Ha.bind(null,e[1]),ya().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=sa,o=ya();if(ii){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Tu)throw Error(i(349));0!==(30&aa)||ka(r,t,n)}o.memoizedState=n;var a={value:n,getSnapshot:t};return o.queue=a,Fa(Ia.bind(null,r,a,e),[e]),r.flags|=2048,Aa(9,Sa.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=ya(),t=Tu.identifierPrefix;if(ii){var n=Jo;t=":"+t+"R"+(n=($o&~(1<<32-at($o)-1)).toString(32)+n),0<(n=da++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Ai,useCallback:ja,useContext:Ai,useEffect:Ma,useImperativeHandle:za,useInsertionEffect:La,useLayoutEffect:Ba,useMemo:Wa,useReducer:xa,useRef:Da,useState:function(){return xa(wa)},useDebugValue:Va,useDeferredValue:function(e){return Ga(ba(),ua.memoizedState,e)},useTransition:function(){return[xa(wa)[0],ba().memoizedState]},useMutableSource:_a,useSyncExternalStore:Ca,useId:qa,unstable_isNewReconciler:!1},ts={readContext:Ai,useCallback:ja,useContext:Ai,useEffect:Ma,useImperativeHandle:za,useInsertionEffect:La,useLayoutEffect:Ba,useMemo:Wa,useReducer:Ea,useRef:Da,useState:function(){return Ea(wa)},useDebugValue:Va,useDeferredValue:function(e){var t=ba();return null===ua?t.memoizedState=e:Ga(t,ua.memoizedState,e)},useTransition:function(){return[Ea(wa)[0],ba().memoizedState]},useMutableSource:_a,useSyncExternalStore:Ca,useId:qa,unstable_isNewReconciler:!1};function ns(e,t){if(e&&e.defaultProps){for(var n in t=L({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function rs(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:L({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&je(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Zu(),o=ec(e),i=Ui(r,o);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=zi(e,i,o))&&(tc(t,e,o,r),Vi(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Zu(),o=ec(e),i=Ui(r,o);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=zi(e,i,o))&&(tc(t,e,o,r),Vi(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zu(),r=ec(e),o=Ui(n,r);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=zi(e,o,r))&&(tc(t,e,r,n),Vi(t,e,r))}};function is(e,t,n,r,o,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(o,i))}function as(e,t,n){var r=!1,o=To,i=t.contextType;return"object"===typeof i&&null!==i?i=Ai(i):(o=Oo(t)?Ao:No.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Do(e,o):To),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function ss(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function us(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Li(e);var i=t.contextType;"object"===typeof i&&null!==i?o.context=Ai(i):(i=Oo(t)?Ao:No.current,o.context=Do(e,i)),o.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(rs(e,t,i,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&os.enqueueReplaceState(o,o.state,null),Wi(e,n,o,r),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var o=n}catch(i){o="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:o,digest:null}}function ls(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Ui(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wu||(Wu=!0,Gu=r),hs(0,t)},n}function ps(e,t,n){(n=Ui(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){hs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===Hu?Hu=new Set([this]):Hu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var o=new Set;r.set(t,o)}else void 0===(o=r.get(t))&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,o){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ui(-1,1)).tag=2,zi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=o,e)}var ys=w.ReactCurrentOwner,bs=!1;function ws(e,t,n,r){t.child=null===e?Ei(t,null,n,r):xi(t,e.child,n,r)}function xs(e,t,n,r,o){n=n.render;var i=t.ref;return Ri(t,o),r=ga(e,t,n,r,i,o),n=va(),null===e||bs?(ii&&n&&ti(t),t.flags|=1,ws(e,t,r,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ws(e,t,o))}function Es(e,t,n,r,o){if(null===e){var i=n.type;return"function"!==typeof i||Ac(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,_s(e,t,i,r,o))}if(i=e.child,0===(e.lanes&o)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(a,r)&&e.ref===t.ref)return Ws(e,t,o)}return t.flags|=1,(e=Dc(i,r)).ref=t.ref,e.return=t,t.child=e}function _s(e,t,n,r,o){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(bs=!1,t.pendingProps=r=i,0===(e.lanes&o))return t.lanes=e.lanes,Ws(e,t,o);0!==(131072&e.flags)&&(bs=!0)}}return Ss(e,t,n,r,o)}function Cs(e,t,n){var r=t.pendingProps,o=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Io(Du,Au),Au|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Io(Du,Au),Au|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Io(Du,Au),Au|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Io(Du,Au),Au|=r;return ws(e,t,o,n),t.child}function ks(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ss(e,t,n,r,o){var i=Oo(n)?Ao:No.current;return i=Do(t,i),Ri(t,o),n=ga(e,t,n,r,i,o),r=va(),null===e||bs?(ii&&r&&ti(t),t.flags|=1,ws(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Ws(e,t,o))}function Is(e,t,n,r,o){if(Oo(n)){var i=!0;Lo(t)}else i=!1;if(Ri(t,o),null===t.stateNode)js(e,t),as(t,n,r),us(t,n,r,o),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ai(c):c=Do(t,c=Oo(n)?Ao:No.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||u!==c)&&ss(t,a,r,c),Mi=!1;var d=t.memoizedState;a.state=d,Wi(t,r,a,o),u=t.memoizedState,s!==r||d!==u||Ro.current||Mi?("function"===typeof l&&(rs(t,n,l,r),u=t.memoizedState),(s=Mi||is(t,n,s,r,d,u,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=c,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Bi(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:ns(t.type,s),a.props=c,h=t.pendingProps,d=a.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ai(u):u=Do(t,u=Oo(n)?Ao:No.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==u)&&ss(t,a,r,u),Mi=!1,d=t.memoizedState,a.state=d,Wi(t,r,a,o);var p=t.memoizedState;s!==h||d!==p||Ro.current||Mi?("function"===typeof f&&(rs(t,n,f,r),p=t.memoizedState),(c=Mi||is(t,n,c,r,d,p,u)||!1)?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ts(e,t,n,r,i,o)}function Ts(e,t,n,r,o,i){ks(e,t);var a=0!==(128&t.flags);if(!r&&!a)return o&&Bo(t,n,!1),Ws(e,t,i);r=t.stateNode,ys.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=xi(t,e.child,null,i),t.child=xi(t,null,s,i)):ws(e,t,s,i),t.memoizedState=r.state,o&&Bo(t,n,!0),t.child}function Ns(e){var t=e.stateNode;t.pendingContext?Fo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fo(0,t.context,!1),Yi(e,t.containerInfo)}function Rs(e,t,n,r,o){return pi(),mi(o),t.flags|=256,ws(e,t,n,r),t.child}var As,Ds,Os,Ps={dehydrated:null,treeContext:null,retryLane:0};function Fs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var r,o=t.pendingProps,a=ea.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Io(ea,1&a),null===e)return li(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=o.children,e=o.fallback,s?(o=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Fc(u,o,0,null),e=Pc(e,o,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Fs(n),t.memoizedState=Ps,e):Ls(t,u));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,o,a,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=ls(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,o=t.mode,r=Fc({mode:"visible",children:r.children},o,0,null),(a=Pc(a,o,s,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&xi(t,e.child,null,s),t.child.memoizedState=Fs(s),t.memoizedState=Ps,a);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var u=r.dgst;return r=u,Bs(e,t,s,r=ls(a=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),bs||u){if(null!==(r=Tu)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|s))?0:o)&&o!==a.retryLane&&(a.retryLane=o,Fi(e,o),tc(r,e,o,-1))}return pc(),Bs(e,t,s,r=ls(Error(i(421))))}return"$?"===o.data?(t.flags|=128,t.child=e.child,t=Sc.bind(null,e),o._reactRetry=t,null):(e=a.treeContext,oi=co(o.nextSibling),ri=t,ii=!0,ai=null,null!==e&&(Xo[Qo++]=$o,Xo[Qo++]=Jo,Xo[Qo++]=Yo,$o=e.id,Jo=e.overflow,Yo=t),t=Ls(t,r.children),t.flags|=4096,t)}(e,t,u,o,r,a,n);if(s){s=o.fallback,u=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:o.children};return 0===(1&u)&&t.child!==a?((o=t.child).childLanes=0,o.pendingProps=c,t.deletions=null):(o=Dc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?s=Dc(r,s):(s=Pc(s,u,n,null)).flags|=2,s.return=t,o.return=t,o.sibling=s,t.child=o,o=s,s=t.child,u=null===(u=e.child.memoizedState)?Fs(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ps,o}return e=(s=e.child).sibling,o=Dc(s,{mode:"visible",children:o.children}),0===(1&t.mode)&&(o.lanes=n),o.return=t,o.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function Ls(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&mi(r),xi(t,e.child,null,n),(e=Ls(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ni(e.return,t,n)}function zs(e,t,n,r,o){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function Vs(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(ws(e,t,r.children,n),0!==(2&(r=ea.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Io(ea,r),0===(1&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===ta(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),zs(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===ta(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}zs(t,!0,n,null,i);break;case"together":zs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function js(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ws(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!ii)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=e,o=o.sibling;else for(o=e.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qs(e,t,n){var r=t.pendingProps;switch(ni(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Oo(t.type)&&Po(),Hs(t),null;case 3:return r=t.stateNode,$i(),So(Ro),So(No),ra(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(di(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ai&&(ic(ai),ai=null))),Hs(t),null;case 5:Zi(t);var o=Qi(Xi.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Hs(t),null}if(e=Qi(qi.current),di(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[fo]=t,r[po]=a,e=0!==(1&t.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(o=0;o<Fr.length;o++)Ur(Fr[o],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":Y(r,a),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Ur("invalid",r);break;case"textarea":oe(r,a),Ur("invalid",r)}for(var u in ye(n,a),o=null,a)if(a.hasOwnProperty(u)){var c=a[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jr(r.textContent,c,e),o=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Ur("scroll",r)}switch(n){case"input":q(r),Z(r,a,!0);break;case"textarea":q(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=Zr)}r=o,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[fo]=t,e[po]=r,As(e,t),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Ur("cancel",e),Ur("close",e),o=r;break;case"iframe":case"object":case"embed":Ur("load",e),o=r;break;case"video":case"audio":for(o=0;o<Fr.length;o++)Ur(Fr[o],e);o=r;break;case"source":Ur("error",e),o=r;break;case"img":case"image":case"link":Ur("error",e),Ur("load",e),o=r;break;case"details":Ur("toggle",e),o=r;break;case"input":Y(e,r),o=Q(e,r),Ur("invalid",e);break;case"option":default:o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=L({},r,{value:void 0}),Ur("invalid",e);break;case"textarea":oe(e,r),o=re(e,r),Ur("invalid",e)}for(a in ye(n,o),c=o)if(c.hasOwnProperty(a)){var l=c[a];"style"===a?ge(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&he(e,l):"children"===a?"string"===typeof l?("textarea"!==n||""!==l)&&de(e,l):"number"===typeof l&&de(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=l&&"onScroll"===a&&Ur("scroll",e):null!=l&&b(e,a,l,u))}switch(n){case"input":q(e),Z(e,r,!1);break;case"textarea":q(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Os(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=Qi(Xi.current),Qi(qi.current),di(t)){if(r=t.stateNode,n=t.memoizedProps,r[fo]=t,(a=r.nodeValue!==n)&&null!==(e=ri))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fo]=t,t.stateNode=r}return Hs(t),null;case 13:if(So(ea),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ii&&null!==oi&&0!==(1&t.mode)&&0===(128&t.flags))fi(),pi(),t.flags|=98560,a=!1;else if(a=di(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(i(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(i(317));a[fo]=t}else pi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),a=!1}else null!==ai&&(ic(ai),ai=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Ou&&(Ou=3):pc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return $i(),null===e&&jr(t.stateNode.containerInfo),Hs(t),null;case 10:return Ti(t.type._context),Hs(t),null;case 19:if(So(ea),null===(a=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(u=a.rendering))if(r)Gs(a,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=ta(e))){for(t.flags|=128,Gs(a,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(u=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,e=u.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Io(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&$e()>Vu&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ta(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!u.alternate&&!ii)return Hs(t),null}else 2*$e()-a.renderingStartTime>Vu&&1073741824!==n&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304);a.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=a.last)?n.sibling=u:t.child=u,a.last=u)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=$e(),t.sibling=null,n=ea.current,Io(ea,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return lc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Au)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ks(e,t){switch(ni(t),t.tag){case 1:return Oo(t.type)&&Po(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $i(),So(Ro),So(No),ra(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zi(t),null;case 13:if(So(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));pi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return So(ea),null;case 4:return $i(),null;case 10:return Ti(t.type._context),null;case 22:case 23:return lc(),null;default:return null}}As=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,Qi(qi.current);var i,a=null;switch(n){case"input":o=Q(e,o),r=Q(e,r),a=[];break;case"select":o=L({},o,{value:void 0}),r=L({},r,{value:void 0}),a=[];break;case"textarea":o=re(e,o),r=re(e,r),a=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(l in ye(n,r),n=null,o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&null!=o[l])if("style"===l){var u=o[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=o?o[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(a=a||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Ur("scroll",e),a||u===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(t.updateQueue=l)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Qs=!1,Ys="function"===typeof WeakSet?WeakSet:Set,$s=null;function Js(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){_c(e,t,r)}else n.current=null}function Zs(e,t,n){try{n()}catch(r){_c(e,t,r)}}var eu=!1;function tu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,void 0!==i&&Zs(t,n,i)}o=o.next}while(o!==r)}}function nu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ru(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fo],delete t[po],delete t[go],delete t[vo],delete t[yo])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function iu(e){return 5===e.tag||3===e.tag||4===e.tag}function au(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||iu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function su(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(su(e,t,n),e=e.sibling;null!==e;)su(e,t,n),e=e.sibling}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}var cu=null,lu=!1;function hu(e,t,n){for(n=n.child;null!==n;)du(e,t,n),n=n.sibling}function du(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(ot,n)}catch(s){}switch(n.tag){case 5:Qs||Js(n,t);case 6:var r=cu,o=lu;cu=null,hu(e,t,n),lu=o,null!==(cu=r)&&(lu?(e=cu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):cu.removeChild(n.stateNode));break;case 18:null!==cu&&(lu?(e=cu,n=n.stateNode,8===e.nodeType?uo(e.parentNode,n):1===e.nodeType&&uo(e,n),jt(e)):uo(cu,n.stateNode));break;case 4:r=cu,o=lu,cu=n.stateNode.containerInfo,lu=!0,hu(e,t,n),cu=r,lu=o;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var i=o,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&Zs(n,t,a),o=o.next}while(o!==r)}hu(e,t,n);break;case 1:if(!Qs&&(Js(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){_c(n,t,s)}hu(e,t,n);break;case 21:hu(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,hu(e,t,n),Qs=r):hu(e,t,n);break;default:hu(e,t,n)}}function fu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach(function(t){var r=Ic.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function pu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var a=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:cu=u.stateNode,lu=!1;break e;case 3:case 4:cu=u.stateNode.containerInfo,lu=!0;break e}u=u.return}if(null===cu)throw Error(i(160));du(a,s,o),cu=null,lu=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(l){_c(o,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(pu(t,e),gu(e),4&r){try{tu(3,e,e.return),nu(3,e)}catch(g){_c(e,e.return,g)}try{tu(5,e,e.return)}catch(g){_c(e,e.return,g)}}break;case 1:pu(t,e),gu(e),512&r&&null!==n&&Js(n,n.return);break;case 5:if(pu(t,e),gu(e),512&r&&null!==n&&Js(n,n.return),32&e.flags){var o=e.stateNode;try{de(o,"")}catch(g){_c(e,e.return,g)}}if(4&r&&null!=(o=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===a.type&&null!=a.name&&$(o,a),be(u,s);var l=be(u,a);for(s=0;s<c.length;s+=2){var h=c[s],d=c[s+1];"style"===h?ge(o,d):"dangerouslySetInnerHTML"===h?he(o,d):"children"===h?de(o,d):b(o,h,d,l)}switch(u){case"input":J(o,a);break;case"textarea":ie(o,a);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(o,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(o,!!a.multiple,a.defaultValue,!0):ne(o,!!a.multiple,a.multiple?[]:"",!1))}o[po]=a}catch(g){_c(e,e.return,g)}}break;case 6:if(pu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(i(162));o=e.stateNode,a=e.memoizedProps;try{o.nodeValue=a}catch(g){_c(e,e.return,g)}}break;case 3:if(pu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{jt(t.containerInfo)}catch(g){_c(e,e.return,g)}break;case 4:default:pu(t,e),gu(e);break;case 13:pu(t,e),gu(e),8192&(o=e.child).flags&&(a=null!==o.memoizedState,o.stateNode.isHidden=a,!a||null!==o.alternate&&null!==o.alternate.memoizedState||(zu=$e())),4&r&&fu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||h,pu(t,e),Qs=l):pu(t,e),gu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!h&&0!==(1&e.mode))for($s=e,h=e.child;null!==h;){for(d=$s=h;null!==$s;){switch(p=(f=$s).child,f.tag){case 0:case 11:case 14:case 15:tu(4,f,f.return);break;case 1:Js(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){_c(r,n,g)}}break;case 5:Js(f,f.return);break;case 22:if(null!==f.memoizedState){wu(d);continue}}null!==p?(p.return=f,$s=p):wu(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{o=d.stateNode,l?"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none":(u=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=me("display",s))}catch(g){_c(e,e.return,g)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(g){_c(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:pu(t,e),gu(e),4&r&&fu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(iu(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(de(o,""),r.flags&=-33),uu(e,au(e),o);break;case 3:case 4:var a=r.stateNode.containerInfo;su(e,au(e),a);break;default:throw Error(i(161))}}catch(s){_c(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vu(e,t,n){$s=e,yu(e,t,n)}function yu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var o=$s,i=o.child;if(22===o.tag&&r){var a=null!==o.memoizedState||Xs;if(!a){var s=o.alternate,u=null!==s&&null!==s.memoizedState||Qs;s=Xs;var c=Qs;if(Xs=a,(Qs=u)&&!c)for($s=o;null!==$s;)u=(a=$s).child,22===a.tag&&null!==a.memoizedState?xu(o):null!==u?(u.return=a,$s=u):xu(o);for(;null!==i;)$s=i,yu(i,t,n),i=i.sibling;$s=o,Xs=s,Qs=c}bu(e)}else 0!==(8772&o.subtreeFlags)&&null!==i?(i.return=o,$s=i):bu(e)}}function bu(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||nu(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:ns(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Gi(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Gi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var h=l.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&jt(d)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&ru(t)}catch(f){_c(t,t.return,f)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wu(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function xu(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nu(4,t)}catch(u){_c(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var o=t.return;try{r.componentDidMount()}catch(u){_c(t,o,u)}}var i=t.return;try{ru(t)}catch(u){_c(t,i,u)}break;case 5:var a=t.return;try{ru(t)}catch(u){_c(t,a,u)}}}catch(u){_c(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Eu,_u=Math.ceil,Cu=w.ReactCurrentDispatcher,ku=w.ReactCurrentOwner,Su=w.ReactCurrentBatchConfig,Iu=0,Tu=null,Nu=null,Ru=0,Au=0,Du=ko(0),Ou=0,Pu=null,Fu=0,Mu=0,Lu=0,Bu=null,Uu=null,zu=0,Vu=1/0,ju=null,Wu=!1,Gu=null,Hu=null,qu=!1,Ku=null,Xu=0,Qu=0,Yu=null,$u=-1,Ju=0;function Zu(){return 0!==(6&Iu)?$e():-1!==$u?$u:$u=$e()}function ec(e){return 0===(1&e.mode)?1:0!==(2&Iu)&&0!==Ru?Ru&-Ru:null!==gi.transition?(0===Ju&&(Ju=mt()),Ju):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function tc(e,t,n,r){if(50<Qu)throw Qu=0,Yu=null,Error(i(185));vt(e,n,r),0!==(2&Iu)&&e===Tu||(e===Tu&&(0===(2&Iu)&&(Mu|=n),4===Ou&&ac(e,Ru)),nc(e,r),1===n&&0===Iu&&0===(1&t.mode)&&(Vu=$e()+500,zo&&Wo()))}function nc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-at(i),s=1<<a,u=o[a];-1===u?0!==(s&n)&&0===(s&r)||(o[a]=ft(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===Tu?Ru:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){zo=!0,jo(e)}(sc.bind(null,e)):jo(sc.bind(null,e)),ao(function(){0===(6&Iu)&&Wo()}),n=null;else{switch(wt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if($u=-1,Ju=0,0!==(6&Iu))throw Error(i(327));var n=e.callbackNode;if(xc()&&e.callbackNode!==n)return null;var r=dt(e,e===Tu?Ru:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var o=Iu;Iu|=2;var a=fc();for(Tu===e&&Ru===t||(ju=null,Vu=$e()+500,hc(e,t));;)try{vc();break}catch(u){dc(e,u)}Ii(),Cu.current=a,Iu=o,null!==Nu?t=0:(Tu=null,Ru=0,t=Ou)}if(0!==t){if(2===t&&(0!==(o=pt(e))&&(r=o,t=oc(e,o))),1===t)throw n=Pu,hc(e,0),ac(e,r),nc(e,$e()),n;if(6===t)ac(e,r);else{if(o=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!sr(i(),o))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(o)&&(2===(t=mc(e,r))&&(0!==(a=pt(e))&&(r=a,t=oc(e,a))),1===t))throw n=Pu,hc(e,0),ac(e,r),nc(e,$e()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wc(e,Uu,ju);break;case 3:if(ac(e,r),(130023424&r)===r&&10<(t=zu+500-$e())){if(0!==dt(e,0))break;if(((o=e.suspendedLanes)&r)!==r){Zu(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=ro(wc.bind(null,e,Uu,ju),t);break}wc(e,Uu,ju);break;case 4:if(ac(e,r),(4194240&r)===r)break;for(t=e.eventTimes,o=-1;0<r;){var s=31-at(r);a=1<<s,(s=t[s])>o&&(o=s),r&=~a}if(r=o,10<(r=(120>(r=$e()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*_u(r/1960))-r)){e.timeoutHandle=ro(wc.bind(null,e,Uu,ju),r);break}wc(e,Uu,ju);break;default:throw Error(i(329))}}}return nc(e,$e()),e.callbackNode===n?rc.bind(null,e):null}function oc(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Uu,Uu=n,null!==t&&ic(t)),e}function ic(e){null===Uu?Uu=e:Uu.push.apply(Uu,e)}function ac(e,t){for(t&=~Lu,t&=~Mu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function sc(e){if(0!==(6&Iu))throw Error(i(327));xc();var t=dt(e,0);if(0===(1&t))return nc(e,$e()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Pu,hc(e,0),ac(e,t),nc(e,$e()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Uu,ju),nc(e,$e()),null}function uc(e,t){var n=Iu;Iu|=1;try{return e(t)}finally{0===(Iu=n)&&(Vu=$e()+500,zo&&Wo())}}function cc(e){null!==Ku&&0===Ku.tag&&0===(6&Iu)&&xc();var t=Iu;Iu|=1;var n=Su.transition,r=bt;try{if(Su.transition=null,bt=1,e)return e()}finally{bt=r,Su.transition=n,0===(6&(Iu=t))&&Wo()}}function lc(){Au=Du.current,So(Du)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oo(n)),null!==Nu)for(n=Nu.return;null!==n;){var r=n;switch(ni(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Po();break;case 3:$i(),So(Ro),So(No),ra();break;case 5:Zi(r);break;case 4:$i();break;case 13:case 19:So(ea);break;case 10:Ti(r.type._context);break;case 22:case 23:lc()}n=n.return}if(Tu=e,Nu=e=Dc(e.current,null),Ru=Au=t,Ou=0,Pu=null,Lu=Mu=Fu=0,Uu=Bu=null,null!==Di){for(t=0;t<Di.length;t++)if(null!==(r=(n=Di[t]).interleaved)){n.interleaved=null;var o=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=o,r.next=a}n.pending=r}Di=null}return e}function dc(e,t){for(;;){var n=Nu;try{if(Ii(),oa.current=Ja,la){for(var r=sa.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}la=!1}if(aa=0,ca=ua=sa=null,ha=!1,da=0,ku.current=null,null===n||null===n.return){Ou=1,Pu=t,Nu=null;break}e:{var a=e,s=n.return,u=n,c=t;if(t=Ru,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,vs(p,s,u,0,t),1&p.mode&&ms(a,l,t),c=l;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ms(a,l,t),pc();break e}c=Error(i(426))}else if(ii&&1&u.mode){var v=gs(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,u,0,t),mi(cs(c,u));break e}}a=c=cs(c,u),4!==Ou&&(Ou=2),null===Bu?Bu=[a]:Bu.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,ji(a,fs(0,c,t));break e;case 1:u=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hu||!Hu.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,ji(a,ps(a,u,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(w){t=w,Nu===n&&null!==n&&(Nu=n=n.return);continue}break}}function fc(){var e=Cu.current;return Cu.current=Ja,null===e?Ja:e}function pc(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Tu||0===(268435455&Fu)&&0===(268435455&Mu)||ac(Tu,Ru)}function mc(e,t){var n=Iu;Iu|=2;var r=fc();for(Tu===e&&Ru===t||(ju=null,hc(e,t));;)try{gc();break}catch(o){dc(e,o)}if(Ii(),Iu=n,Cu.current=r,null!==Nu)throw Error(i(261));return Tu=null,Ru=0,Ou}function gc(){for(;null!==Nu;)yc(Nu)}function vc(){for(;null!==Nu&&!Qe();)yc(Nu)}function yc(e){var t=Eu(e.alternate,e,Au);e.memoizedProps=e.pendingProps,null===t?bc(e):Nu=t,ku.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Au)))return void(Nu=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Nu=n);if(null===e)return Ou=6,void(Nu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nu=t);Nu=t=e}while(null!==t);0===Ou&&(Ou=5)}function wc(e,t,n){var r=bt,o=Su.transition;try{Su.transition=null,bt=1,function(e,t,n,r){do{xc()}while(null!==Ku);if(0!==(6&Iu))throw Error(i(327));n=e.finishedWork;var o=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-at(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}(e,a),e===Tu&&(Nu=Tu=null,Ru=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,Tc(tt,function(){return xc(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Su.transition,Su.transition=null;var s=bt;bt=1;var u=Iu;Iu|=4,ku.current=null,function(e,t){if(eo=Gt,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break e}var s=0,u=-1,c=-1,l=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==o&&3!==d.nodeType||(u=s+o),d!==a||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++l===o&&(u=s),f===a&&++h===r&&(c=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(to={focusedElem:e,selectionRange:n},Gt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:ns(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(i(163))}}catch(x){_c(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=eu,eu=!1}(e,n),mu(n,e),pr(to),Gt=!!eo,to=eo=null,e.current=n,vu(n,e,o),Ye(),Iu=u,bt=s,Su.transition=a}else e.current=n;if(qu&&(qu=!1,Ku=e,Xu=o),a=e.pendingLanes,0===a&&(Hu=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(ot,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),nc(e,$e()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Wu)throw Wu=!1,e=Gu,Gu=null,e;0!==(1&Xu)&&0!==e.tag&&xc(),a=e.pendingLanes,0!==(1&a)?e===Yu?Qu++:(Qu=0,Yu=e):Qu=0,Wo()}(e,t,n,r)}finally{Su.transition=o,bt=r}return null}function xc(){if(null!==Ku){var e=wt(Xu),t=Su.transition,n=bt;try{if(Su.transition=null,bt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Xu=0,0!==(6&Iu))throw Error(i(331));var o=Iu;for(Iu|=4,$s=e.current;null!==$s;){var a=$s,s=a.child;if(0!==(16&$s.flags)){var u=a.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for($s=l;null!==$s;){var h=$s;switch(h.tag){case 0:case 11:case 15:tu(8,h,a)}var d=h.child;if(null!==d)d.return=h,$s=d;else for(;null!==$s;){var f=(h=$s).sibling,p=h.return;if(ou(h),h===l){$s=null;break}if(null!==f){f.return=p,$s=f;break}$s=p}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}$s=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,$s=s;else e:for(;null!==$s;){if(0!==(2048&(a=$s).flags))switch(a.tag){case 0:case 11:case 15:tu(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$s=y;break e}$s=a.return}}var b=e.current;for($s=b;null!==$s;){var w=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==w)w.return=s,$s=w;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:nu(9,u)}}catch(E){_c(u,u.return,E)}if(u===s){$s=null;break e}var x=u.sibling;if(null!==x){x.return=u.return,$s=x;break e}$s=u.return}}if(Iu=o,Wo(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(ot,e)}catch(E){}r=!0}return r}finally{bt=n,Su.transition=t}}return!1}function Ec(e,t,n){e=zi(e,t=fs(0,t=cs(n,t),1),1),t=Zu(),null!==e&&(vt(e,1,t),nc(e,t))}function _c(e,t,n){if(3===e.tag)Ec(e,e,n);else for(;null!==t;){if(3===t.tag){Ec(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hu||!Hu.has(r))){t=zi(t,e=ps(t,e=cs(n,e),1),1),e=Zu(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=Zu(),e.pingedLanes|=e.suspendedLanes&n,Tu===e&&(Ru&n)===n&&(4===Ou||3===Ou&&(130023424&Ru)===Ru&&500>$e()-zu?hc(e,0):Lu|=n),nc(e,t)}function kc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=Zu();null!==(e=Fi(e,t))&&(vt(e,t,n),nc(e,n))}function Sc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),kc(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),kc(e,n)}function Tc(e,t){return Ke(e,t)}function Nc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,r){return new Nc(e,t,n,r)}function Ac(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,o,a){var s=2;if(r=e,"function"===typeof e)Ac(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Pc(n.children,o,a,t);case C:s=8,o|=8;break;case k:return(e=Rc(12,n,t,2|o)).elementType=k,e.lanes=a,e;case N:return(e=Rc(13,n,t,o)).elementType=N,e.lanes=a,e;case R:return(e=Rc(19,n,t,o)).elementType=R,e.lanes=a,e;case O:return Fc(n,o,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case S:s=10;break e;case I:s=9;break e;case T:s=11;break e;case A:s=14;break e;case D:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Rc(s,n,t,o)).elementType=e,t.type=r,t.lanes=a,t}function Pc(e,t,n,r){return(e=Rc(7,e,r,t)).lanes=n,e}function Fc(e,t,n,r){return(e=Rc(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Lc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,o,i,a,s,u){return e=new Bc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Rc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Li(i),e}function zc(e){if(!e)return To;e:{if(je(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Oo(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Oo(n))return Mo(e,n,t)}return t}function Vc(e,t,n,r,o,i,a,s,u){return(e=Uc(n,r,!0,e,0,i,0,s,u)).context=zc(null),n=e.current,(i=Ui(r=Zu(),o=ec(n))).callback=void 0!==t&&null!==t?t:null,zi(n,i,o),e.current.lanes=o,vt(e,o,r),nc(e,r),e}function jc(e,t,n,r){var o=t.current,i=Zu(),a=ec(o);return n=zc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ui(i,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=zi(o,t,a))&&(tc(e,o,a,i),Vi(e,o,a)),a}function Wc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}Eu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ro.current)bs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return bs=!1,function(e,t,n){switch(t.tag){case 3:Ns(t),pi();break;case 5:Ji(t);break;case 1:Oo(t.type)&&Lo(t);break;case 4:Yi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;Io(_i,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Io(ea,1&ea.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(Io(ea,1&ea.current),null!==(e=Ws(e,t,n))?e.sibling:null);Io(ea,1&ea.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vs(e,t,n);t.flags|=128}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Io(ea,ea.current),r)break;return null;case 22:case 23:return t.lanes=0,Cs(e,t,n)}return Ws(e,t,n)}(e,t,n);bs=0!==(131072&e.flags)}else bs=!1,ii&&0!==(1048576&t.flags)&&ei(t,Ko,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;js(e,t),e=t.pendingProps;var o=Do(t,No.current);Ri(t,n),o=ga(null,t,r,e,o,n);var a=va();return t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Oo(r)?(a=!0,Lo(t)):a=!1,t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Li(t),o.updater=os,t.stateNode=o,o._reactInternals=t,us(t,r,e,n),t=Ts(null,t,r,!0,a,n)):(t.tag=0,ii&&a&&ti(t),ws(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(js(e,t),e=t.pendingProps,r=(o=r._init)(r._payload),t.type=r,o=t.tag=function(e){if("function"===typeof e)return Ac(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===A)return 14}return 2}(r),e=ns(r,e),o){case 0:t=Ss(null,t,r,e,n);break e;case 1:t=Is(null,t,r,e,n);break e;case 11:t=xs(null,t,r,e,n);break e;case 14:t=Es(null,t,r,ns(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,Ss(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 1:return r=t.type,o=t.pendingProps,Is(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 3:e:{if(Ns(t),null===e)throw Error(i(387));r=t.pendingProps,o=(a=t.memoizedState).element,Bi(e,t),Wi(t,r,null,n);var s=t.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Rs(e,t,r,n,o=cs(Error(i(423)),t));break e}if(r!==o){t=Rs(e,t,r,n,o=cs(Error(i(424)),t));break e}for(oi=co(t.stateNode.containerInfo.firstChild),ri=t,ii=!0,ai=null,n=Ei(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pi(),r===o){t=Ws(e,t,n);break e}ws(e,t,r,n)}t=t.child}return t;case 5:return Ji(t),null===e&&li(t),r=t.type,o=t.pendingProps,a=null!==e?e.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==a&&no(r,a)&&(t.flags|=32),ks(e,t),ws(e,t,s,n),t.child;case 6:return null===e&&li(t),null;case 13:return Ms(e,t,n);case 4:return Yi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xi(t,null,r,n):ws(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,xs(e,t,r,o=t.elementType===r?o:ns(r,o),n);case 7:return ws(e,t,t.pendingProps,n),t.child;case 8:case 12:return ws(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,a=t.memoizedProps,s=o.value,Io(_i,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===o.children&&!Ro.current){t=Ws(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var u=a.dependencies;if(null!==u){s=a.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Ui(-1,n&-n)).tag=2;var l=a.updateQueue;if(null!==l){var h=(l=l.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ni(a.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Ni(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ws(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ri(t,n),r=r(o=Ai(o)),t.flags|=1,ws(e,t,r,n),t.child;case 14:return o=ns(r=t.type,t.pendingProps),Es(e,t,r,o=ns(r.type,o),n);case 15:return _s(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:ns(r,o),js(e,t),t.tag=1,Oo(r)?(e=!0,Lo(t)):e=!1,Ri(t,n),as(t,r,o),us(t,r,o,n),Ts(null,t,r,!0,e,n);case 19:return Vs(e,t,n);case 22:return Cs(e,t,n)}throw Error(i(156,t.tag))};var qc="function"===typeof reportError?reportError:function(e){console.error(e)};function Kc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function Jc(e,t,n,r,o){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof o){var s=o;o=function(){var e=Wc(a);s.call(e)}}jc(t,a,e,o)}else a=function(e,t,n,r,o){if(o){if("function"===typeof r){var i=r;r=function(){var e=Wc(a);i.call(e)}}var a=Vc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=a,e[mo]=a.current,jr(8===e.nodeType?e.parentNode:e),cc(),a}for(;o=e.lastChild;)e.removeChild(o);if("function"===typeof r){var s=r;r=function(){var e=Wc(u);s.call(e)}}var u=Uc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[mo]=u.current,jr(8===e.nodeType?e.parentNode:e),cc(function(){jc(t,u,n,r)}),u}(n,t,e,o,r);return Wc(a)}Xc.prototype.render=Kc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));jc(e,t,null,null)},Xc.prototype.unmount=Kc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cc(function(){jc(null,e,null,null)}),t[mo]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ct();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Lt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),nc(t,$e()),0===(6&Iu)&&(Vu=$e()+500,Wo()))}break;case 13:cc(function(){var t=Fi(e,1);if(null!==t){var n=Zu();tc(t,e,1,n)}}),Hc(e,1)}},Et=function(e){if(13===e.tag){var t=Fi(e,134217728);if(null!==t)tc(t,e,134217728,Zu());Hc(e,134217728)}},_t=function(e){if(13===e.tag){var t=ec(e),n=Fi(e,t);if(null!==n)tc(n,e,t,Zu());Hc(e,t)}},Ct=function(){return bt},kt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ee=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=Eo(r);if(!o)throw Error(i(90));K(r),J(r,o)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=uc,Ne=cc;var Zc={usingClientEntryPoint:!1,Events:[wo,xo,Eo,Se,Ie,uc]},el={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tl={bundleType:el.bundleType,version:el.version,rendererPackageName:el.rendererPackageName,rendererConfig:el.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:el.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nl.isDisabled&&nl.supportsFiber)try{ot=nl.inject(tl),it=nl}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zc,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(i(299));var n=!1,r="",o=qc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(o=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,o),e[mo]=t.current,jr(8===e.nodeType?e.parentNode:e),new Kc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return cc(e)},t.hydrate=function(e,t,n){if(!Yc(t))throw Error(i(200));return Jc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,o=!1,a="",s=qc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,o,0,a,s),e[mo]=t.current,jr(e),r)for(e=0;e<r.length;e++)o=(o=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new Xc(t)},t.render=function(e,t,n){if(!Yc(t))throw Error(i(200));return Jc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yc(e))throw Error(i(40));return!!e._reactRootContainer&&(cc(function(){Jc(null,null,e,!1,function(){e._reactRootContainer=null,e[mo]=null})}),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return Jc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},352(e,t,n){"use strict";var r=n(119);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},414(e,t,n){"use strict";e.exports=n(654)},591(){},654(e,t,n){"use strict";var r=n(950),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},745(){},761(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,o=e[r];if(!(0<i(o,t)))break e;e[r]=t,e[n]=o,n=r}}function r(e){return 0===e.length?null:e[0]}function o(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,o=e.length,a=o>>>1;r<a;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<o&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<o&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],h=1,d=null,f=3,p=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(l);null!==t;){if(null===t.callback)o(l);else{if(!(t.startTime<=e))break;o(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function x(e){if(g=!1,w(e),!m)if(null!==r(c))m=!0,O(E);else{var t=r(l);null!==t&&P(x,t.startTime-e)}}function E(e,n){m=!1,g&&(g=!1,y(S),S=-1),p=!0;var i=f;try{for(w(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!N());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var s=a(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&o(c),w(n)}else o(c);d=r(c)}if(null!==d)var u=!0;else{var h=r(l);null!==h&&P(x,h.startTime-n),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,C=!1,k=null,S=-1,I=5,T=-1;function N(){return!(t.unstable_now()-T<I)}function R(){if(null!==k){var e=t.unstable_now();T=e;var n=!0;try{n=k(!0,e)}finally{n?_():(C=!1,k=null)}}else C=!1}if("function"===typeof b)_=function(){b(R)};else if("undefined"!==typeof MessageChannel){var A=new MessageChannel,D=A.port2;A.port1.onmessage=R,_=function(){D.postMessage(null)}}else _=function(){v(R,0)};function O(e){k=e,C||(C=!0,_())}function P(e,n){S=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,O(E))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,o,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:o,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>a?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(g?(y(S),S=-1):g=!0,P(x,i-a))):(e.sortIndex=s,n(c,e),m||p||(m=!0,O(E))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},950(e,t,n){"use strict";e.exports=n(49)}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),(()=>{"use strict";var e=n(950),t=n(352);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function i(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var u={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const c=["color","size","strokeWidth","absoluteStrokeWidth","children"];var l=(t,n)=>{const r=(0,e.forwardRef)((r,o)=>{let{color:i="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:h,children:d}=r,f=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(r,c);return(0,e.createElement)("svg",s(s({ref:o},u),{},{width:a,height:a,stroke:i,strokeWidth:h?24*Number(l)/Number(a):l,className:"lucide lucide-".concat((p=t,p.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()))},f),[...n.map(t=>{let[n,r]=t;return(0,e.createElement)(n,r)}),...(Array.isArray(d)?d:[d])||[]]);var p});return r.displayName="".concat(t),r};const h=l("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),d=l("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var f=n(414);const p=e=>{let{onAccept:t,language:n}=e;const r={th:{title:"\u0e01\u0e32\u0e23\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e41\u0e25\u0e30\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e2a\u0e48\u0e27\u0e19\u0e1a\u0e38\u0e04\u0e04\u0e25",description:"\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32\u0e43\u0e0a\u0e49\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e27\u0e34\u0e40\u0e04\u0e23\u0e32\u0e30\u0e2b\u0e4c\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e1e\u0e37\u0e49\u0e19\u0e10\u0e32\u0e19 (\u0e40\u0e1e\u0e28\u0e41\u0e25\u0e30\u0e2d\u0e32\u0e22\u0e38\u0e42\u0e14\u0e22\u0e1b\u0e23\u0e30\u0e21\u0e32\u0e13) \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e41\u0e2a\u0e14\u0e07\u0e40\u0e19\u0e37\u0e49\u0e2d\u0e2b\u0e32\u0e17\u0e35\u0e48\u0e40\u0e2b\u0e21\u0e32\u0e30\u0e2a\u0e21\u0e01\u0e31\u0e1a\u0e04\u0e38\u0e13 \u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14\u0e08\u0e30\u0e44\u0e21\u0e48\u0e16\u0e39\u0e01\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01\u0e41\u0e25\u0e30\u0e08\u0e30\u0e16\u0e39\u0e01\u0e25\u0e1a\u0e17\u0e31\u0e19\u0e17\u0e35\u0e40\u0e21\u0e37\u0e48\u0e2d\u0e04\u0e38\u0e13\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e23\u0e30\u0e1a\u0e1a",consent:"\u0e02\u0e49\u0e32\u0e1e\u0e40\u0e08\u0e49\u0e32\u0e22\u0e34\u0e19\u0e22\u0e2d\u0e21\u0e43\u0e2b\u0e49\u0e43\u0e0a\u0e49\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e27\u0e34\u0e40\u0e04\u0e23\u0e32\u0e30\u0e2b\u0e4c\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e1e\u0e37\u0e49\u0e19\u0e10\u0e32\u0e19",accept:"\u0e22\u0e2d\u0e21\u0e23\u0e31\u0e1a\u0e41\u0e25\u0e30\u0e40\u0e23\u0e34\u0e48\u0e21\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19",privacy:"\ud83d\udd12 \u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13\u0e08\u0e30\u0e16\u0e39\u0e01\u0e23\u0e31\u0e01\u0e29\u0e32\u0e04\u0e27\u0e32\u0e21\u0e1b\u0e25\u0e2d\u0e14\u0e20\u0e31\u0e22",mascot:"\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e40\u0e08\u0e49\u0e32! \u0e14\u0e34\u0e09\u0e31\u0e19\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19 \u0e22\u0e34\u0e19\u0e14\u0e35\u0e15\u0e49\u0e2d\u0e19\u0e23\u0e31\u0e1a\u0e2a\u0e39\u0e48\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32\u0e40\u0e08\u0e49\u0e32"},en:{title:"Camera & Personal Data Usage",description:"Lanna Polytechnic College uses camera to analyze basic information (gender and approximate age) to display appropriate content. All data will not be recorded and will be deleted immediately when you leave.",consent:"I consent to the use of camera for basic data analysis",accept:"Accept and Start",privacy:"\ud83d\udd12 Your data will be kept secure",mascot:"Hello! I'm Tiew Son, welcome to Lanna Polytechnic College!"},zh:{title:"\u6444\u50cf\u5934\u548c\u4e2a\u4eba\u6570\u636e\u4f7f\u7528",description:"\u5170\u7eb3\u7406\u5de5\u5b66\u9662\u4f7f\u7528\u6444\u50cf\u5934\u5206\u6790\u57fa\u672c\u4fe1\u606f\uff08\u6027\u522b\u548c\u5927\u81f4\u5e74\u9f84\uff09\u4ee5\u663e\u793a\u9002\u5f53\u7684\u5185\u5bb9\u3002\u6240\u6709\u6570\u636e\u4e0d\u4f1a\u88ab\u8bb0\u5f55\uff0c\u5f53\u60a8\u79bb\u5f00\u65f6\u5c06\u7acb\u5373\u5220\u9664\u3002",consent:"\u6211\u540c\u610f\u4f7f\u7528\u6444\u50cf\u5934\u8fdb\u884c\u57fa\u672c\u6570\u636e\u5206\u6790",accept:"\u63a5\u53d7\u5e76\u5f00\u59cb",privacy:"\ud83d\udd12 \u60a8\u7684\u6570\u636e\u5c06\u5f97\u5230\u5b89\u5168\u4fdd\u62a4",mascot:"\u4f60\u597d\uff01\u6211\u662f\u5c0f\u677e\u9f20\uff0c\u6b22\u8fce\u6765\u5230\u5170\u7eb3\u7406\u5de5\u5b66\u9662\uff01"},ko:{title:"\uce74\uba54\ub77c \ubc0f \uac1c\uc778\uc815\ubcf4 \uc0ac\uc6a9",description:"\ub780\ub098 \ud3f4\ub9ac\ud14c\ud06c\ub2c9 \ub300\ud559\uc740 \uc801\uc808\ud55c \ucf58\ud150\uce20\ub97c \ud45c\uc2dc\ud558\uae30 \uc704\ud574 \uae30\ubcf8 \uc815\ubcf4(\uc131\ubcc4 \ubc0f \ub300\ub7b5\uc801\uc778 \ub098\uc774)\ub97c \ubd84\uc11d\ud558\ub294 \uce74\uba54\ub77c\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \ubaa8\ub4e0 \ub370\uc774\ud130\ub294 \uae30\ub85d\ub418\uc9c0 \uc54a\uc73c\uba70 \uc885\ub8cc \uc2dc \uc989\uc2dc \uc0ad\uc81c\ub429\ub2c8\ub2e4.",consent:"\uae30\ubcf8 \ub370\uc774\ud130 \ubd84\uc11d\uc744 \uc704\ud55c \uce74\uba54\ub77c \uc0ac\uc6a9\uc5d0 \ub3d9\uc758\ud569\ub2c8\ub2e4",accept:"\uc218\ub77d \ubc0f \uc2dc\uc791",privacy:"\ud83d\udd12 \uadc0\ud558\uc758 \ub370\uc774\ud130\ub294 \uc548\uc804\ud558\uac8c \ubcf4\ud638\ub429\ub2c8\ub2e4",mascot:"\uc548\ub155\ud558\uc138\uc694! \uc800\ub294 \ub760\uc6b0\uc190\uc785\ub2c8\ub2e4. \ub780\ub098 \ud3f4\ub9ac\ud14c\ud06c\ub2c9 \ub300\ud559\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4!"}},o=r[n]||r.th;return(0,f.jsx)("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-900 via-blue-700 to-blue-500 flex items-center justify-center z-50 p-6",children:(0,f.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8 relative overflow-hidden",children:[(0,f.jsx)("div",{className:"absolute top-0 right-0 w-40 h-40 bg-blue-200 rounded-full -mr-20 -mt-20 opacity-50"}),(0,f.jsx)("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-blue-300 rounded-full -ml-16 -mb-16 opacity-50"}),(0,f.jsxs)("div",{className:"relative z-10",children:[(0,f.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,f.jsx)("div",{className:"bg-blue-100 p-4 rounded-full",children:(0,f.jsx)(h,{className:"w-12 h-12 text-blue-600"})})}),(0,f.jsx)("h2",{className:"text-3xl font-bold text-center text-gray-800 mb-4",children:o.title}),(0,f.jsx)("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4 mb-6 border-2 border-yellow-200",children:(0,f.jsxs)("div",{className:"flex items-start gap-3",children:[(0,f.jsx)("div",{className:"flex-shrink-0",children:(0,f.jsx)("img",{src:"/tiewson.png",alt:"Lanna Poly Logo",className:"w-20 h-20 object-contain drop-shadow-md"})}),(0,f.jsx)("p",{className:"text-gray-700 leading-relaxed pt-1",children:o.mascot})]})}),(0,f.jsx)("p",{className:"text-gray-600 text-center mb-6 leading-relaxed",children:o.description}),(0,f.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-6 p-4 bg-blue-50 rounded-xl",children:[(0,f.jsx)(d,{className:"w-6 h-6 text-blue-600"}),(0,f.jsx)("span",{className:"text-sm text-gray-600",children:o.consent})]}),(0,f.jsx)("div",{className:"text-center mb-6",children:(0,f.jsx)("p",{className:"text-sm text-gray-500",children:o.privacy})}),(0,f.jsx)("button",{onClick:t,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",children:o.accept}),(0,f.jsxs)("div",{className:"mt-6 text-center text-xs text-gray-400",children:["\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32 \u0e40\u0e0a\u0e35\u0e22\u0e07\u0e43\u0e2b\u0e21\u0e48",(0,f.jsx)("br",{}),"Lanna Polytechnic Chiangmai Technological College"]})]})]})})};var m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function g(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function v(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}u((r=r.apply(e,t||[])).next())})}function y(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var b=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,t[0],t[1]),t.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(t){var n=t.split(":"),r=n[0],o=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,o)})}},e}();function w(){return x}var x=null,E=new Map,_=new Map;function C(e,t){var n=T(e,t);return E.get(n)}function k(e){for(var t=E.entries(),n=[];;){var r=t.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&n.push(s)}return n}function S(e){var t=e.kernelName,n=e.backendName,r=T(t,n);if(E.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");E.set(r,e)}function I(e){var t=e.kernelName;_.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),_.set(t,e)}function T(e,t){return t+"_"+e}function N(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function R(e,t,n){return Math.max(e,Math.min(t,n))}function A(e){return e%2==0?e:e+1}function D(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function O(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function P(e,t,n){void 0===n&&(n=""),O(B(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function F(e){O(null!=e,function(){return"The input to the tensor constructor must be a non-null value."})}function M(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||J(e)&&!n)for(var r=0;r<e.length;++r)M(e[r],t,n);else t.push(e);return t}function L(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function B(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function U(e){return e%1==0}function z(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function V(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function j(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function W(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise(function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function G(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(-1===e[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function H(e,t){var n=t.length;return O((e=null==e?t.map(function(e,t){return t}):[].concat(e)).every(function(e){return e>=-n&&e<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),O(e.every(function(e){return U(e)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(e){return e<0?n+e:e})}function q(e,t){for(var n=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||o?null:H(t,e).sort(),a=0,s=0;s<e.length;++s){if(null!=i){if(i[a]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[a]<=s&&a++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function K(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function X(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Q(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Y(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function $(e,t){return"complex64"!==t&&("float32"!==t||"complex64"===e)&&("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)}function J(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Z(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function ee(e){if(null==e)return 0;var t=0;return e.forEach(function(e){return t+=e.length}),t}function te(e){return"string"==typeof e||e instanceof String}function ne(e){return"boolean"==typeof e}function re(e){return"number"==typeof e}function oe(e){return Array.isArray(e)?oe(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":re(e)?"float32":te(e)?"string":ne(e)?"bool":"float32"}function ie(e){return!!(e&&e.constructor&&e.call&&e.apply)}function ae(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function se(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function ue(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=M(e)),n&&Q(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)0!==Math.round(e[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function ce(e,t){if(0===e.length)return t[0];var n=e.reduce(function(e,t){return e*t});if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[t+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(e,t){return e*t});for(a=0;a<i;a++)o[a]=e(t+a*u,s,r)}return o}(0,e,t)}function le(e,t){for(var n=he(e,t),r=0;r<n.length;r++)n[r]=1;return n}function he(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function de(){return w().platform.now()}function fe(e){e.forEach(function(t){O(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function pe(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",w().platform.encode(e,t)}function me(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",w().platform.decode(e,t)}function ge(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function ve(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}Object.freeze({shuffle:N,clamp:R,nearestLargerEven:A,sum:D,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var o=Number(e[r])-Number(t[r]);n+=o*o}return n},assert:O,assertShapesMatch:P,assertNonNull:F,flatten:M,sizeFromShape:L,isScalarShape:function(e){return 0===e.length},arraysEqual:B,isInt:U,tanh:z,sizeToSquarishShape:V,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return N(t),t},rightPad:j,repeatedTry:W,inferFromImplicitShape:G,parseAxisParam:H,squeezeShape:q,getTypedArrayFromDType:K,getArrayFromDType:X,checkConversionForErrors:Q,isValidDtype:Y,hasEncodingLoss:$,isTypedArray:J,bytesPerElement:Z,bytesFromStringArray:ee,isString:te,isBoolean:ne,isNumber:re,inferDtype:oe,isFunction:ie,nearestDivisor:ae,computeStrides:se,toTypedArray:ue,toNestedArray:ce,makeOnesTypedArray:le,makeZerosTypedArray:he,now:de,assertNonNegativeIntegerDimensions:fe,fetch:function(e,t){return w().platform.fetch(e,t)},encodeString:pe,decodeString:me,locToIndex:ge,indexToLoc:ve});var ye=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new be)}return e.prototype.profileKernel=function(e,t,n){var r,o=this,i=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var o=e[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),i.then(function(i){var a="";null!=i.getExtraProfileInfo&&(a=i.getExtraProfileInfo()),o.logger.logKernelProfile(e,n,r,i.kernelMs,t,a)})})}),r},e}(),be=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,o,i){var a="number"==typeof r?j(r+"ms",9):r.error,s=j(e,25),u=t.rank,c=t.size,l=j(t.shape.toString(),14),h="";for(var d in o){var f=o[d].shape||t.shape,p=f.length;h+=d+": "+p+"D "+(p>0?f:"")+" "}console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+h+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function we(e,t,n){return j(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":te(e)?"'"+e+"'":"bool"===n?xe(e):parseFloat(e.toFixed(7)).toString(),t)}function xe(e){return 0===e?"false":"true"}function Ee(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var _e=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=L(e),null!=n){var o=n.length;O(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||X(t,this.size),this.strides=se(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),O(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,o=e;r<o.length;r++){var i=o[r];if(i<0||i>=this.shape[n]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Ce().makeTensor(this.values,this.shape,this.dtype)},e}(),Ce=null,ke=null,Se=null,Ie=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=L(e),this.strides=se(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),O(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,o){return this.throwIfDisposed(),this.reshape([e,t,n,r,o])},e.prototype.asType=function(e){return this.throwIfDisposed(),ke.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ke.buffer(this.shape,this.dtype,e)]}})})},e.prototype.bufferSync=function(){return ke.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ce(this.shape,e)]}})})},e.prototype.arraySync=function(){return ce(this.shape,this.dataSync())},e.prototype.data=function(){return v(this,void 0,void 0,function(){var e,t;return y(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Ce().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(e){return me(e)})]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,e]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var e=Ce().readSync(this.dataId);if("string"===this.dtype)try{return e.map(function(e){return me(e)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Ce().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Ce().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),ke.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),ke.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),ke.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),ke.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),ke.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),ke.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),ke.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var o=se(t),i=function(e,t,n,r){var o=L(t),i=r[r.length-1],a=new Array(i).fill(0),s=t.length,u="complex64"===n?Ee(e):e;if(s>1)for(var c=0;c<o/i;c++)for(var l=c*i,h=0;h<i;h++)a[h]=Math.max(a[h],we(u[l+h],0,n).length);return a}(e,t,n,o),a=t.length,s=function e(t,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[we(Ee(t)[0],0,r)]:"bool"===r?[xe(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=3*s,h=Array.from(t.slice(0,l)),d=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(h=Ee(h),d=Ee(d)),["["+h.map(function(e,t){return we(e,i[t],r)}).join(", ")+", ..., "+d.map(function(e,t){return we(e,i[u-3+t],r)}).join(", ")+"]"]}return["["+("complex64"===r?Ee(t):Array.from(t)).map(function(e,t){return we(e,i[t],r)}).join(", ")+"]"]}var f=n.slice(1),p=o.slice(1),m=o[0]*s,g=[];if(u>20){for(var v=0;v<3;v++){var y=(b=v*m)+m;g.push.apply(g,e(t.slice(b,y),f,r,p,i,!1))}for(g.push("..."),v=u-3;v<u;v++)y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),f,r,p,i,v===u-1))}else for(v=0;v<u;v++){var b;y=(b=v*m)+m,g.push.apply(g,e(t.slice(b,y),f,r,p,i,v===u-1))}var w=2===c?",":"";for(g[0]="["+g[0]+w,v=1;v<g.length-1;v++)g[v]=" "+g[v]+w;var x=",\n";for(v=2;v<c;v++)x+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(a?"":x),g}(e,t,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),ke.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),ke.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),ke.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),ke.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),ke.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),ke.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),ke.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),ke.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),ke.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),ke.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),ke.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,o){return void 0===n&&(n=.001),Se("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,r,n)},e.prototype.batchNorm=function(e,t,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),ke.batchNorm(this,e,t,n,r,o)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),ke.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),ke.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),ke.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),ke.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),ke.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),ke.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),ke.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),ke.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),ke.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),ke.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),ke.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),ke.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),ke.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),ke.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),ke.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),ke.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),ke.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),ke.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),ke.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ke.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),ke.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),ke.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),ke.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),ke.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),ke.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),ke.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),ke.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),ke.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),ke.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),ke.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),ke.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),ke.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),ke.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),ke.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),ke.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),ke.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),ke.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),ke.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),ke.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),ke.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),ke.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),ke.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),ke.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),ke.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),ke.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),ke.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),ke.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),ke.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),ke.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),ke.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),ke.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),ke.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),ke.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),ke.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),ke.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),ke.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),ke.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ke.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),ke.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),ke.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),ke.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),ke.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),ke.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),ke.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),ke.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),ke.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),ke.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),ke.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),ke.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),ke.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),ke.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),ke.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),ke.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),ke.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),ke.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),ke.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),ke.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),ke.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),ke.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),ke.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),ke.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),ke.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),ke.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),ke.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),ke.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),ke.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),ke.conv1d(this,e,t,n,r,o,i)},e.prototype.conv2d=function(e,t,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ke.conv2d(this,e,t,n,r,o,i)},e.prototype.conv2dTranspose=function(e,t,n,r,o){return this.throwIfDisposed(),ke.conv2dTranspose(this,e,t,n,r,o)},e.prototype.depthwiseConv2D=function(e,t,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),ke.depthwiseConv2d(this,e,t,n,r,o,i)},e.prototype.separableConv2d=function(e,t,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),ke.separableConv2d(this,e,t,n,r,o,i)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),ke.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ke.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),ke.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,o){return this.throwIfDisposed(),ke.pool(this,e,t,n,r,o)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),Ce().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ke.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),ke.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ke.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),ke.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),ke.stridedSlice(this,e,t,n,r,o,i,a,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),ke.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),ke.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),ke.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),ke.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),ke.spectral.irfft(this)},e}();Object.defineProperty(Ie,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Te,Ne,Re,Ae,De,Oe=function(e){function t(t,n,r,o){var i=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return i.trainable=n,i.name=r,i}return g(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!B(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");Ce().disposeTensor(this),this.dataId=e.dataId,Ce().incRef(this,null)},t.prototype.dispose=function(){Ce().disposeVariable(this),this.isDisposedInternal=!0},t}(Ie);Object.defineProperty(Oe,Symbol.hasInstance,{value:function(e){return e instanceof Ie&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Te||(Te={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ne||(Ne={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Re||(Re={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ae||(Ae={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(De||(De={}));var Pe={float32:Ae,int32:Ne,bool:Re,complex64:De};function Fe(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return Pe[e][t]}function Me(e){return Fe(e,"int32")}function Le(e,t){if(e.dtype===t.dtype)return[e,t];var n=Fe(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Be(e,t){O(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function Ue(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Ie)n.push(t);else if(o=t,Array.isArray(o)||"object"==typeof o){var o,i=t;for(var a in i){var s=i[a];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:Le,assertTypesMatch:Be,isTensorInList:function(e,t){return t.some(function(t){return t.id===e.id})},getTensorsInContainer:Ue});var ze,Ve=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),je=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ve}return e.prototype.ready=function(){return v(this,void 0,void 0,function(){var e,t,n;return y(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return v(this,void 0,void 0,function(){var t,n,r;return y(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ye(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var e=this;k(this.backendName).forEach(function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)})},e.prototype.disposeRegisteredKernels=function(e){var t=this;k(e).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])})},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,i=r.then(function(n){return!(o<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)}).catch(function(n){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),o=r.success,i=r.asyncInit;if(i||o)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,o=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],function(e){return{x:function(){return e.toFloat()}}},[]),t},e.prototype.runKernel=function(e,t,n,r,o){return this.runKernelFunc(null,t,null,e,n,r,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(e){o+="complex64"===e.dtype?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,o,i,a){var s,u=this;void 0===i&&(i=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=function(e){l&&(c=e.map(function(e){return u.keep(u.clone(e))}))},f=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=C(r,this.backendName);return h=null!=g?function(){var e=u.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:o,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map(function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}),c=s.filter(function(e,t){return a[t]});return d((i||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();m=u.tidy(function(){return e(u.backend,d)});var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,function(){return h()}):h()}),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(e){return t[e].shape}),outputShapes:s.map(function(e){return e.shape})}),Array.isArray(m)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=e;"string"===n&&te(e[0])&&(o=e.map(function(e){return pe(e)}));var i=r.write(o,t,n),a=new Ie(t,n,i,this.nextTensorId());if(this.incRef(a,r),"string"===n){var s=this.state.tensorInfo.get(i),u=ee(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return a},e.prototype.makeTensorFromDataId=function(e,t,n,r){var o=new Ie(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,r),o},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var o=new Oe(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Z(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Oe||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return v(this,void 0,void 0,function(){var t,n;return y(this,function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(e){return e.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,o){var i=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},s=function(e){return _.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(a.gradient=function(e){return e=e.map(function(e,t){if(null==e){var r=n[t],o=he(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return e}),r(e.length>1?e:e[0],o)}),this.state.activeTape.push(a)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=Ue(e),r=new Set(n.map(function(e){return e.id})),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||r.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(e){e.kept||e.scopeId!==a.id||t.track(e)})},e.prototype.gradients=function(e,t,n,r){var o=this;if(void 0===r&&(r=!1),O(t.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});O(i instanceof Ie,function(){return"The result y returned by f() must be a tensor."});var a=function(e,t,n){for(var r={},o={},i=0;i<t.length;i++)r[t[i].id]=!0;for(i=0;i<e.length;i++){var a=(p=e[i]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){p.outputs.forEach(function(e){return r[e.id]=!0}),c=!0,o[p.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var d={};for(i=e.length-1;i>=0;i--)for(a=(p=e[i]).inputs,l=0;l<p.outputs.length;l++)if(h[p.outputs[l].id]){for(var s in a)h[a[s].id]=!0,d[p.id]=!0;break}var f=[];for(i=0;i<e.length;i++){var p;if(o[(p=e[i]).id]&&d[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},p);v.inputs=m,v.outputs=p.outputs,f.push(v)}}return f}(this.state.activeTape,t,i);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var e,r,s={};s[i.id]=null==n?(r=le(L(e=i.shape),"float32"),We.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var o=t[r],i=[];if(o.outputs.forEach(function(t){var n=e[t.id];null!=n?i.push(n):i.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var a=o.gradient(i),s=function(t){if(!(t in a))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(a)+".");var r=n(function(){return a[t]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=o.inputs[t];if(!B(r.shape,i.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==e[i.id])e[i.id]=r;else{var s=e[i.id];e[i.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=t.length-1;o>=0;o--)r(o)}(s,a,function(e){return o.tidy(e)});var u=t.map(function(e){return s[e.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()}),o.state.activeTape=null),{value:i,grads:u}})},e.prototype.customGrad=function(e){var t=this;return O(ie(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];O(r.every(function(e){return e instanceof Ie}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(e,t){i[t]=e}),t.runKernelFunc(function(t,o){return O((n=e.apply(void 0,r.concat([o]))).value instanceof Ie,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),O(ie(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(e,t){var o=n.gradFunc(e,t),i=Array.isArray(o)?o:[o];O(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),O(i.every(function(e){return e instanceof Ie}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return i.forEach(function(e,t){a[t]=function(){return e}}),a})}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return v(this,void 0,void 0,function(){var t,n;return y(this,function(r){switch(r.label){case 0:return t=de(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=de()-t,[2,n]}})})},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ve,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),We=function(){var e=function(){if(null==ze){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}ze=e}return ze}();if(null==e._tfengine){var t=new b(e);e._tfengine=new je(t)}return function(e){x=e}(e._tfengine.ENV),Ce=function(){return e._tfengine},e._tfengine}();function Ge(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var He=w();He.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),He.registerFlag("IS_BROWSER",function(){return Ge()}),He.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),He.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),He.registerFlag("PROD",function(){return!1}),He.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return He.getBool("DEBUG")}),He.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),He.registerFlag("IS_TEST",function(){return!1});var qe,Ke,Xe,Qe={},Ye={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function $e(e,t){Qe[e]=t}function Je(e){e in Qe||(Qe[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",function(t){t.preventDefault(),delete Qe[e]},!1),1===e?t.getContext("webgl",Ye)||t.getContext("experimental-webgl",Ye):t.getContext("webgl2",Ye)}(e));var t=Qe[e];return t.isContextLost()?(delete Qe[e],Je(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Qe[e])}function Ze(e,t){return[t,e]}function et(e){var t=L(e);return V(Math.ceil(t/4))}function tt(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function nt(e,t){var n,r,o,i,a,s,u,c,l,h=e;return 2===w().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,o=h.RGBA16F,i=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,i=h.RGBA,a=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function rt(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+it(e,t))}(e),r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(qe||(qe={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Ke||(Ke={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xe||(Xe={}));function ot(e){return!!(w().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function it(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function at(e,t,n){return Nt(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function st(e,t,n){var r=Nt(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(rt(e,t,function(){return e.shaderSource(r,n)}),rt(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ut(e,t,n){var r=Nt(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(rt(e,t,function(){return e.shaderSource(r,n)}),rt(e,t,function(){return e.compileShader(r)}),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=ht.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],o=e.split("\n"),i=o.length.toString().length+2,a=o.map(function(e,t){return j((t+1).toString(),i)+e}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),h=a.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+j(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var ct,lt,ht=/ERROR: [0-9]+:([0-9]+):/g;function dt(e,t){return Nt(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function ft(e,t,n){if(rt(e,t,function(){return e.linkProgram(n)}),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function pt(e,t,n){if(rt(e,t,function(){return e.validateProgram(n)}),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function mt(e,t,n){var r=Nt(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return rt(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),rt(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function gt(e,t,n){var r=Nt(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return rt(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),rt(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function vt(e,t){return Nt(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function yt(e,t){var n=w().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function bt(e,t){return Nt(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function wt(e,t,n,r,o,i,a,s){var u=e.getAttribLocation(n,r);return-1!==u&&(rt(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),rt(e,t,function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)}),rt(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function xt(e,t,n,r){Rt(e,r),rt(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function Et(e,t,n,r){return Nt(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function _t(e,t,n){return e.getUniformLocation(t,n)}function Ct(e,t,n,r,o,i){rt(e,t,function(){return xt(e,t,r,i)}),rt(e,t,function(){return e.uniform1i(o,i)})}function kt(e,t,n,r){rt(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),rt(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function St(e,t,n){rt(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),rt(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function It(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Tt(e,t))}function Tt(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Nt(e,t,n,r){var o=rt(e,t,function(){return n()});if(null==o)throw new Error(r);return o}function Rt(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function At(e,t){return void 0===t&&(t=2),L(e.slice(0,e.length-t))}function Dt(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Ot(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[At(e)].concat(Dt(e))),t}function Pt(e,t){var n;void 0===t&&(t=!1);var r=w().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map(function(t,n){return n>=e.length-2?A(e[n]):e[n]})).length&&(e=[2,e[0]])),2!==e.length){var o=q(e);e=o.newShape}var i=L(e);if(e.length<=1&&i<=r)return[1,i];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var a=At(e),s=2,u=2;return e.length&&(s=(n=Dt(e))[0],u=n[1]),V(i=a*(s/2)*(u/2)).map(function(e){return 2*e})}return V(i)}function Ft(e){return e%2==0}function Mt(e,t){if(B(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Ft(n)&&Ft(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Ft(e[0])&&Ft(t[0])}function Lt(e){if(null==ct){var t=Je(e);ct=t.getParameter(t.MAX_TEXTURE_SIZE)}return ct}function Bt(e){if(null==lt){var t=Je(e);lt=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,lt)}function Ut(e){if(0===e)return 0;var t=Je(e);return zt(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:zt(t,"EXT_disjoint_timer_query")?1:0}function zt(e,t){return null!=e.getExtension(t)}function Vt(e){try{if(null!=Je(e))return!0}catch(e){return!1}return!1}function jt(e){if(0===e)return!1;var t=Je(e);if(1===e){if(!zt(t,"OES_texture_float"))return!1}else if(!zt(t,"EXT_color_buffer_float"))return!1;return Gt(t)}function Wt(e){if(0===e)return!1;var t=Je(e);if(1!==e){if(zt(t,"EXT_color_buffer_float"))return Gt(t);if(zt(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=nt(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),i}(t,n)}return!1}return!!zt(t,"OES_texture_float")&&!!zt(t,"WEBGL_color_buffer_float")&&Gt(t)}function Gt(e){var t=nt(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function Ht(e){return 2===e&&null!=Je(e).fenceSync}var qt=Object.freeze({callAndCheck:rt,canBeRepresented:ot,getWebGLErrorMessage:it,getExtensionOrThrow:at,createVertexShader:st,createFragmentShader:ut,createProgram:dt,linkProgram:ft,validateProgram:pt,createStaticVertexBuffer:mt,createStaticIndexBuffer:gt,getNumChannels:function(){return 2===w().getNumber("WEBGL_VERSION")?1:4},createTexture:vt,validateTextureSize:yt,createFramebuffer:bt,bindVertexBufferToProgramAttribute:wt,bindTextureUnit:xt,unbindTextureUnit:function(e,t,n){Rt(e,n),rt(e,t,function(){return e.activeTexture(e.TEXTURE0+n)}),rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Et,getProgramUniformLocation:_t,bindTextureToProgramUniformSampler:Ct,bindCanvasToFramebuffer:function(e,t){rt(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),rt(e,t,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),rt(e,t,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},bindColorTextureToFramebuffer:kt,unbindColorTextureFromFramebuffer:St,validateFramebuffer:It,getFramebufferErrorMessage:Tt,getBatchDim:At,getRowsCols:Dt,getShapeAs3D:Ot,getTextureShapeFromLogicalShape:Pt,isReshapeFree:Mt,getWebGLMaxTextureSize:Lt,resetMaxTextureSize:function(){ct=null},resetMaxTexturesInShader:function(){lt=null},getMaxTexturesInShader:Bt,getWebGLDisjointQueryTimerVersion:Ut,hasExtension:zt,isWebGLVersionEnabled:Vt,isCapableOfRenderingToFloatTexture:jt,isDownloadFloatTextureEnabled:Wt,isWebGLFenceEnabled:Ht}),Kt=w();function Xt(e){w().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Qt(e,t){return We.tidy(e,t)}function Yt(e){Ue(e).forEach(function(e){return e.dispose()})}function $t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];w().getBool("IS_TEST")||console.warn.apply(console,e)}function Jt(e,t){var n=e;if(J(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||J(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&w().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||J(t)){O(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),O(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var o=n.slice(1),i=0;i<t.length;++i)e(t[i],o,r.concat(i))}else O(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(e,r,[]),r}function Zt(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function en(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof Ie)return Zt(r,e.dtype,t,n),e;var o=oe(e);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Zt(r,o,t,n),null==e||!J(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Jt(e,o);J(e)||Array.isArray(e)||(e=[e]);var s="string"!==o?ue(e,o,w().getBool("DEBUG")):M(e,[],!0);return We.makeTensor(s,a,o)}function tn(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,r){return en(e,t+"["+r+"]",n)},r)}function nn(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function rn(e,t,n){for(var r=e.length+t.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(e[i++]):o.push(t[a++]);return o}function on(e,t){for(var n=[],r=e.length,o=0;o<r;o++)-1===t.indexOf(o)&&n.push(e[o]);return[n,t.map(function(t){return e[t]})]}function an(e,t){return rn(e,t.map(function(e){return 1}),t)}function sn(e,t,n){O(nn(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function un(e,t){if(nn(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n}function cn(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ln(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function hn(e,t){var n=e[0].length;e.forEach(function(e,t){O(e.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"})}),O(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(e,o){for(var i=0;i<n;i++)O(i===t||e[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function dn(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function fn(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];We.startScope(n);try{var o=r.apply(void 0,e);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),We.endScope(o),o}catch(e){throw We.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Kt.registerFlag("HAS_WEBGL",function(){return Kt.getNumber("WEBGL_VERSION")>0}),Kt.registerFlag("WEBGL_VERSION",function(){return Vt(2)?2:Vt(1)?1:0}),Kt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===Kt.get("WEBGL_VERSION")}),Kt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Kt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Kt.registerFlag("WEBGL_PACK",function(){return Kt.getBool("HAS_WEBGL")}),Kt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_CLIP",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Kt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_PACK_REDUCE",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_CONV_IM2COL",function(){return Kt.getBool("WEBGL_PACK")}),Kt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Lt(Kt.getNumber("WEBGL_VERSION"))}),Kt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Bt(Kt.getNumber("WEBGL_VERSION"))}),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=Kt.getNumber("WEBGL_VERSION");return 0===e?0:Ut(e)}),Kt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Kt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),Kt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return jt(Kt.getNumber("WEBGL_VERSION"))}),Kt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Kt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Kt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Kt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Wt(Kt.getNumber("WEBGL_VERSION"))}),Kt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Ht(Kt.getNumber("WEBGL_VERSION"))}),Kt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Kt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Se=Xt;var pn=fn({complex_:function(e,t){var n=en(e,"real","complex"),r=en(t,"imag","complex");return P(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),We.runKernelFunc(function(e){return e.complex(n,r)},{$real:n,$imag:r})}}),mn=fn({real_:function(e){var t=en(e,"input","real");return We.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),gn=fn({imag_:function(e){var t=en(e,"input","imag");return We.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function vn(e,t,n){return yn(e,t,Jt(e,n),n)}function yn(e,t,n,r){if(null==r&&(r=oe(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!J(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){fe(t);var o=L(t),i=L(n);O(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==L(t.slice(a));O(n[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return J(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ue(e,r,w().getBool("DEBUG")):M(e,[],!0),We.makeTensor(e,t,r)}function bn(e,t){if((J(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&J(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return yn(e,[],[],t)}function wn(e,t){F(e);var n=Jt(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return yn(e,null,n,t)}function xn(e,t,n){if(F(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Jt(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return yn(e,t,r,n)}function En(e,t,n){if(F(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Jt(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return yn(e,t,r,n)}function _n(e,t,n){if(F(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Jt(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return yn(e,t,r,n)}function Cn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=Cn(e,"float32"),r=kn(e,"float32");return pn(n,r)}var o=le(L(e),t);return We.makeTensor(o,e,t)}function kn(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=kn(e,"float32"),r=kn(e,"float32");return pn(n,r)}var o=he(L(e),t);return We.makeTensor(o,e,t)}function Sn(e,t,n){return We.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function In(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return kn([0],r);var o=he(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return wn(o,r)}var Tn=fn({onesLike_:function(e){var t=en(e,"x","onesLike");if("complex64"===t.dtype){var n=Tn(mn(t)),r=Nn(gn(t));return pn(n,r)}return We.runKernelFunc(function(e){return e.onesLike(t)},{$x:t},function(e,t){return{$x:function(){return Nn(e)}}})}}),Nn=fn({zerosLike_:function(e){var t=en(e,"x","zerosLike");return We.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,t){return{$x:function(){return Nn(e)}}})}}),Rn=fn({concat_:function(e,t){void 0===t&&(t=0),O(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=tn(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")}),t=H(t,n[0].shape)[0];var r=dn(n.map(function(e){return e.shape}),t);if(0===L(r))return vn([],r);if(1===(n=n.filter(function(e){return e.size>0})).length)return n[0];var o=n.map(function(e){return e.shape});hn(o,t);var i=n,a={axis:t};return We.runKernelFunc(function(e){return e.concat(n,t)},i,function(e){var n=o.map(function(e){return e[t]});return Fn(e,n,t).map(function(e){return function(){return e}})},"Concat",a)}}),An=fn({concat1d_:function(e){return Rn(e,0)}}),Dn=fn({concat2d_:function(e,t){return Rn(e,t)}}),On=fn({concat3d_:function(e,t){return Rn(e,t)}}),Pn=fn({concat4d_:function(e,t){return Rn(e,t)}}),Fn=fn({split_:function(e,t,n){void 0===n&&(n=0);var r,o=en(e,"x","split");return n=H(n,o.shape)[0],"number"==typeof t?(O(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(O(o.shape[n]===t.reduce(function(e,t){return e+t}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),We.runKernelFunc(function(e){return e.split(o,r,n)},{$x:o},function(e){return{$x:function(){return Rn(e,n)}}})}});function Mn(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var Ln=Mn(function(e){!function(e,t){function n(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var o=new n(e),i=t&&t.state,a=o.next;return a.int32=function(){return 4294967296*o.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.alea=o}(0,e)}),Bn=Mn(function(e){!function(e,t){function n(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var o=new n(e),i=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.xor128=o}(0,e)}),Un=Mn(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var o=new n(e),i=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)}),zn=Mn(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=o.next,a.quick=a,i&&(i.x&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)}),Vn=Mn(function(e){!function(e,t){function n(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,i=t.i;return t.w=r=r+1640531527|0,n=o[i+34&127],e=o[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,o,i,a,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),o=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=a+1640531527|0,o=0==(n=s[127&i]^=r+a)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=a,e.X=s,e.i=o}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var o=new n(e),i=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=o.next,a.quick=a,i&&(i.X&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)}),jn=Mn(function(e){!function(e,t){function n(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var o=new n(e),i=t&&t.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var e=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}t&&t.exports?t.exports=o:this.tychei=o}(0,e)}),Wn=Mn(function(e){!function(t,r){var o,i=this,a=256,s="random",u=r.pow(a,6),c=r.pow(2,52),l=2*c,h=255;function d(e,n,h){var d=[],v=m(function e(t,n){var r,o=[],i=typeof t;if(n&&"object"==i)for(r in t)try{o.push(e(t[r],n-1))}catch(e){}return o.length?o:"string"==i?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,g(t)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(a):(e=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(e)),g(e)}catch(e){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,g(t)]}}():e,3),d),y=new f(d),b=function(){for(var e=y.g(6),t=u,n=0;e<c;)e=(e+n)*a,t*=a,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,m(g(y.S),t),(n.pass||h||function(e,t,n,o){return o&&(o.S&&p(o,y),e.state=function(){return p(y,{})}),n?(r[s]=e,t):e})(b,v,"global"in n?n.global:this==r,n.state)}function f(e){var t,n=e.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+e[o%n]+(t=s[o])],s[i]=t;(r.g=function(e){for(var t,n=0,o=r.i,i=r.j,s=r.S;e--;)t=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+t])+(s[i]=t)];return r.i=o,r.j=i,n})(a)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){for(var n,r=e+"",o=0;o<r.length;)t[h&o]=h&(n^=19*t[h&o])+r.charCodeAt(o++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(r["seed"+s]=d,m(r.random(),t),e.exports){e.exports=d;try{o=n(82)}catch(e){}}}([],Math)});Wn.alea=Ln,Wn.xor128=Bn,Wn.xorwow=Un,Wn.xorshift7=zn,Wn.xor4096=Vn,Wn.tychei=jn;var Gn=Wn.alea,Hn=function(){function e(e,t,n,r,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Gn(i.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),qn=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var o=r||Math.random();this.randu=Gn(o.toString()),this.randn=new Hn(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,o,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(o=this.randu())<t||Math.log(o)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Kn=function(){function e(e,t,n,r){var o=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Gn(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Xn(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",fe(e),new _e(e,t,n)}var Qn=fn({batchToSpaceND_:function(e,t,n){var r=en(e,"x","batchToSpaceND"),o=t.reduce(function(e,t){return e*t});return O(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),O(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),O(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),We.runKernelFunc(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),Yn=fn({broadcastTo_:function(e,t){var n=en(e,"broadcastTo","x"),r=n.shape;if(t.some(function(e){return!(e>0)||e%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(t),a=t.length-1;a>=0;a--)if(n.shape[a]===t[a])i[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(e,t){return e>1?t:-1}).filter(function(e){return e>=0});return 0===s.length?n.clone():We.runKernelFunc(function(e){return e.tile(n,i)},{input:n},function(e){return{input:function(){return e.sum(s,!0)}}})}}),$n=fn({cast_:function(e,t){var n=en(e,"x","cast");if(!Y(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:t};return We.runKernelFunc(function(e){return e.cast(n,t)},{x:n},function(e){return{x:function(){return e.clone()}}},"Cast",r)}}),Jn=fn({clone_:function(e){var t=en(e,"x","clone",null);return We.runKernelFunc(function(){return We.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),Zn=fn({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=en(e,"x","cumsum"),i=un([t|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=ln(1,o.rank)[0],u=We.runKernelFunc(function(e){return e.cumsum(a,s,n,r)},{permutedX:a},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),er=fn({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=en(e,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return O(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),O(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),O(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape}),We.runKernelFunc(function(e){return e.depthToSpace(r,t,n)},{$x:r})}}),tr=fn({expandDims_:function(e,t){void 0===t&&(t=0);var n=en(e,"x","expandDims",null);O(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(O(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),pr(n,r)}}),nr=fn({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var o=Xn([e,t],r),i=e<=t?e:t,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return yr(tr(s,0),[n[0],1,1]);if(2===n.length)return yr(tr(tr(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return yr(tr(tr(tr(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),rr=fn({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var o=en(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=We.runKernelFunc(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===a?u.as1D():u}}),or=fn({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=en(e,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),We.runKernelFunc(function(e){return e.oneHot(o,t,n,r)},{$indices:o},function(e){return{$indices:function(){return kn(o.shape,"float32")}}}).reshape(i)}}),ir=fn({pad_:function(e,t,n){void 0===n&&(n=0);var r=en(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return We.runKernelFunc(function(e){return e.pad(r,t,n)},{x:r},function(e){var n=t.map(function(e){return e[0]});return{x:function(){return e.slice(n,r.shape)}}},"PadV2",o)}}),ar=fn({pad1d_:function(e,t,n){return void 0===n&&(n=0),O(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),ir(e,[t],n)}}),sr=fn({pad2d_:function(e,t,n){return void 0===n&&(n=0),O(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ir(e,t,n)}}),ur=fn({pad3d_:function(e,t,n){return void 0===n&&(n=0),O(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ir(e,t,n)}}),cr=fn({pad4d_:function(e,t,n){return void 0===n&&(n=0),O(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),ir(e,t,n)}}),lr=fn({rand_:function(e,t,n){var r=L(e),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return We.makeTensor(o,e,n)}}),hr=fn({randomNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Hn(t,n,r,!1,o),a=Xn(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),dr=fn({randomGamma_:function(e,t,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new qn(t,n,r,o),a=Xn(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),fr=fn({randomUniform_:function(e,t,n,r,o){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=Xn(e,r),a=new Kn(t,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),pr=fn({reshape_:function(e,t){var n=en(e,"x","reshape",null);t=G(t,n.size),O(n.size===L(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return We.runKernelFunc(function(e){return e.reshape(n,t)},{x:n},function(e){return{x:function(){return e.reshape(n.shape)}}},"Reshape",r)}}),mr=fn({spaceToBatchND_:function(e,t,n){var r=en(e,"x","spaceToBatchND");return O(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),O(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),O(r.shape.reduce(function(e,r,o){return o>0&&o<=t.length?e&&(r+n[o-1][0]+n[o-1][1])%t[o-1]==0:e},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),We.runKernelFunc(function(e){return e.spaceToBatchND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}})}}),gr=fn({squeeze_:function(e,t){var n=en(e,"x","squeeze");return pr(n,q(n.shape,t).newShape)}}),vr=fn({stack_:function(e,t){void 0===t&&(t=0);var n=tn(e,"tensors","stack");if(O(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;O(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(e){P(o,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){O(i===e.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(e){return e.expandDims(t)});return Rn(a,t)}}),yr=fn({tile_:function(e,t){var n=en(e,"x","tile",null);O(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return We.runKernelFunc(function(e,r){var o=e.tile(n,t);return r([n]),o},{x:n},function(e,n){var r=n[0];return{x:function(){var n=Nn(r);if(1===r.rank)for(var o=0;o<t[0];++o)n=n.add(e.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<t[0];++o)for(var i=0;i<t[1];++i)n=n.add(e.slice([o*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<t[0];++o)for(i=0;i<t[1];++i)for(var a=0;a<t[2];++a)n=n.add(e.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<t[0];++o)for(i=0;i<t[1];++i)for(a=0;a<t[2];++a)for(var s=0;s<t[3];++s)n=n.add(e.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",o,r)}}),br=fn({truncatedNormal_:function(e,t,n,r,o){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Hn(t,n,r,!0,o),a=Xn(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),wr=fn({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=en(e,"x","unstack");O(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return We.runKernelFunc(function(e){return e.unstack(n,t)},{x:n},function(e){return{x:function(){return vr(e,t)}}},"Unpack",r)}});function xr(e,t,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,a=0;a<i;++a)o=o.concat([e[a+1]/t[a],t[a]]);o=o.concat(e.slice(i+1))}return o}function Er(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function _r(e,t,n,r){void 0===r&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function Cr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function kr(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function Sr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=e.shape,s=n.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var c=se(e.shape).map(function(e){return e/u}).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:Sr});function Ir(e){return e<=30?e:ae(e,Math.floor(Math.sqrt(e)))}function Tr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==t.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function Nr(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Tr(n,t,e)}function Rr(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:L(t.shape)/u,sliceSize:a,strides:se(n.slice(0,o)).concat([1]),outputSize:L(n)}}Object.freeze({validateUpdateShape:Tr,validateInput:Nr,calculateShapes:Rr});function Ar(e,t,n){O(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),O(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(r){O(t[r]+n[r]<=e.shape[r],function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"})},o=0;o<e.rank;++o)r(o)}function Dr(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Or(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function Pr(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),R(0,i,s-1)}function Fr(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?R(0,i,s):R(-1,i,s-1)}function Mr(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function Lr(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}Object.freeze({assertParamsValid:Ar,maskToAxes:Dr,computeOutShape:Or,startForAxis:Pr,stopForAxis:Fr,isSliceContinous:Mr,computeFlatOffset:Lr});function Br(e){return We.customGrad(e)}var Ur=fn({softmax_:function(e,t){void 0===t&&(t=-1);var n=en(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return We.runKernelFunc(function(e,r){var o=e.softmax(n,t);return r([o]),o},{logits:n},function(e,n){var r=n[0],o=e.mul(r);return{logits:function(){return o.sub(o.sum([t],!0).mul(r))}}},"Softmax",{dim:t},[],[!0])}}),zr=fn({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=en(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Br(function(e,n){var r=e.max(t,!0),o=e.sub(r),i=o.toFloat().sub(o.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}})(n)}}),Vr=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),jr=function(){function e(){}return e.prototype.time=function(e){return Wr("time")},e.prototype.read=function(e){return Wr("read")},e.prototype.readSync=function(e){return Wr("readSync")},e.prototype.numDataIds=function(){return Wr("numDataIds")},e.prototype.disposeData=function(e){return Wr("disposeData")},e.prototype.write=function(e,t,n){return Wr("write")},e.prototype.move=function(e,t,n,r){return Wr("move")},e.prototype.memory=function(){return Wr("memory")},e.prototype.floatPrecision=function(){return Wr("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return Wr("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,Wr("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return Wr("slice")},e.prototype.stridedSlice=function(e,t,n,r){return Wr("stridedSlice")},e.prototype.unstack=function(e,t){return Wr("unstack")},e.prototype.reverse=function(e,t){return Wr("reverse")},e.prototype.concat=function(e,t){return Wr("concat")},e.prototype.neg=function(e){return Wr("neg")},e.prototype.add=function(e,t){return Wr("add")},e.prototype.addN=function(e){return Wr("addN")},e.prototype.subtract=function(e,t){return Wr("subtract")},e.prototype.multiply=function(e,t){return Wr("multiply")},e.prototype.realDivide=function(e,t){return Wr("realDivide")},e.prototype.floorDiv=function(e,t){return Wr("floorDiv")},e.prototype.sum=function(e,t){return Wr("sum")},e.prototype.prod=function(e,t){return Wr("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return Wr("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return Wr("argMin")},e.prototype.argMax=function(e,t){return Wr("argMax")},e.prototype.equal=function(e,t){return Wr("equal")},e.prototype.notEqual=function(e,t){return Wr("notEqual")},e.prototype.less=function(e,t){return Wr("less")},e.prototype.lessEqual=function(e,t){return Wr("lessEqual")},e.prototype.greater=function(e,t){return Wr("greater")},e.prototype.greaterEqual=function(e,t){return Wr("greaterEqual")},e.prototype.logicalNot=function(e){return Wr("logicalNot")},e.prototype.logicalAnd=function(e,t){return Wr("logicalAnd")},e.prototype.logicalOr=function(e,t){return Wr("logicalOr")},e.prototype.where=function(e){return Wr("where")},e.prototype.select=function(e,t,n){return Wr("select")},e.prototype.topk=function(e,t,n){return Wr("topk")},e.prototype.min=function(e,t){return Wr("min")},e.prototype.minimum=function(e,t){return Wr("minimum")},e.prototype.mod=function(e,t){return Wr("mod")},e.prototype.max=function(e,t){return Wr("max")},e.prototype.maximum=function(e,t){return Wr("maximum")},e.prototype.all=function(e,t){return Wr("all")},e.prototype.any=function(e,t){return Wr("any")},e.prototype.squaredDifference=function(e,t){return Wr("squaredDifference")},e.prototype.ceil=function(e){return Wr("ceil")},e.prototype.floor=function(e){return Wr("floor")},e.prototype.round=function(e){return Wr("round")},e.prototype.sign=function(e){return Wr("sign")},e.prototype.isNaN=function(e){return Wr("isNaN")},e.prototype.isInf=function(e){return Wr("isInf")},e.prototype.isFinite=function(e){return Wr("isFinite")},e.prototype.pow=function(e,t){return Wr("pow")},e.prototype.exp=function(e){return Wr("exp")},e.prototype.expm1=function(e){return Wr("expm1")},e.prototype.softmax=function(e,t){return Wr("softmax")},e.prototype.log=function(e){return Wr("log")},e.prototype.log1p=function(e){return Wr("log1p")},e.prototype.sqrt=function(e){return Wr("sqrt")},e.prototype.rsqrt=function(e){return Wr("rsqrt")},e.prototype.square=function(e){return Wr("square")},e.prototype.reciprocal=function(e){return Wr("reciprocal")},e.prototype.relu=function(e){return Wr("relu")},e.prototype.relu6=function(e){return Wr("relu6")},e.prototype.prelu=function(e,t){return Wr("prelu")},e.prototype.elu=function(e){return Wr("elu")},e.prototype.eluDer=function(e,t){return Wr("eluDer")},e.prototype.selu=function(e){return Wr("selu")},e.prototype.int=function(e){return Wr("int")},e.prototype.clip=function(e,t,n){return Wr("clip")},e.prototype.abs=function(e){return Wr("abs")},e.prototype.complexAbs=function(e){return Wr("complexAbs")},e.prototype.sigmoid=function(e){return Wr("sigmoid")},e.prototype.softplus=function(e){return Wr("softplus")},e.prototype.sin=function(e){return Wr("sin")},e.prototype.cos=function(e){return Wr("cos")},e.prototype.tan=function(e){return Wr("tan")},e.prototype.asin=function(e){return Wr("asin")},e.prototype.acos=function(e){return Wr("acos")},e.prototype.atan=function(e){return Wr("atan")},e.prototype.atan2=function(e,t){return Wr("atan2")},e.prototype.sinh=function(e){return Wr("sinh")},e.prototype.cosh=function(e){return Wr("cosh")},e.prototype.tanh=function(e){return Wr("tanh")},e.prototype.asinh=function(e){return Wr("asinh")},e.prototype.acosh=function(e){return Wr("acosh")},e.prototype.atanh=function(e){return Wr("atanh")},e.prototype.erf=function(e){return Wr("erf")},e.prototype.step=function(e,t){return Wr("step")},e.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Wr("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return Wr("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return Wr("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return Wr("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Wr("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return Wr("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return Wr("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return Wr("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return Wr("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return Wr("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return Wr("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return Wr("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return Wr("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return Wr("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return Wr("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return Wr("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return Wr("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return Wr("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return Wr("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return Wr("reshape")},e.prototype.cast=function(e,t){return Wr("cast")},e.prototype.tile=function(e,t){return Wr("tile")},e.prototype.pad=function(e,t,n){return Wr("pad")},e.prototype.transpose=function(e,t){return Wr("transpose")},e.prototype.gather=function(e,t,n){return Wr("gather")},e.prototype.gatherND=function(e,t){return Wr("gatherND")},e.prototype.scatterND=function(e,t,n){return Wr("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return Wr("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return Wr("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return Wr("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return Wr("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return Wr("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return Wr("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,o,i){return Wr("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,o){return Wr("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,o,i,a){return Wr("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return Wr("multinomial")},e.prototype.oneHot=function(e,t,n,r){return Wr("oneHot")},e.prototype.cumsum=function(e,t,n,r){return Wr("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,o){return Wr("nonMaxSuppression")},e.prototype.fft=function(e){return Wr("fft")},e.prototype.ifft=function(e){return Wr("ifft")},e.prototype.complex=function(e,t){return Wr("complex")},e.prototype.real=function(e){return Wr("real")},e.prototype.imag=function(e){return Wr("imag")},e.prototype.cropAndResize=function(e,t,n,r,o,i){return Wr("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return Wr("depthToSpace")},e.prototype.split=function(e,t,n){return Wr("split")},e.prototype.sparseToDense=function(e,t,n,r){return Wr("sparseToDense")},e.prototype.diag=function(e){return Wr("diag")},e.prototype.fill=function(e,t,n){return Wr("fill")},e.prototype.onesLike=function(e){return Wr("onesLike")},e.prototype.zerosLike=function(e){return Wr("zerosLike")},e.prototype.linspace=function(e,t,n){return Wr("linspace")},e.prototype.dispose=function(){return Wr("dispose")},e}();function Wr(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Gr(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,a=e[i]||1;(t[t.length-1-o]||1)>1&&1===a&&r.unshift(i)}return r}function Hr(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,a=t[i];(null==o||1===o&&a>1)&&n.unshift(i)}return n}function qr(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];null==i&&(i=1);var a=t[t.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function Kr(e,t,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=Jr(t),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,e[1],e[1]]}return Qr(e,s,n,r,o,i,!1,a)}function Xr(e,t,n,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=Zr(t),l=c[0],h=c[1],d=c[2];if("NDHWC"===a)u="channelsLast",s=[l,h,d,e[4],e[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,d,e[1],e[1]]}return Yr(e,s,n,r,o,!1,u,i)}function Qr(e,t,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if("channelsLast"===s)c=e[0],l=e[1],h=e[2],d=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],d=e[1],l=e[2],h=e[3]}var f,p=t[0],m=t[1],g=t[3],v=Jr(n),y=v[0],b=v[1],w=Jr(r),x=w[0],E=w[1],_=eo(p,x),C=eo(m,E),k=function(e,t,n,r,o,i,a,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,o){null==r&&(r=$r(e,t,n));var i=e[1],a=to((e[0]-t+2*r)/n+1,o);O(U(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var s=to((i-t+2*r)/n+1,o);return O(U(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[a,s]}([t,n],i,r,e,s);c=h[0],l=h[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/o);var d=Math.max(0,(c-1)*r+i-t),f=Math.max(0,(l-1)*o+a-n),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2);u={top:p,bottom:m,left:g,right:f-g,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/r),l=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,h,y,b,_,C,i),S=k.padInfo,I=k.outHeight,T=k.outWidth,N=a?g*d:g;return"channelsFirst"===s?f=[c,N,I,T]:"channelsLast"===s&&(f=[c,I,T,N]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:I,outWidth:T,outChannels:N,padInfo:S,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:m,effectiveFilterHeight:_,effectiveFilterWidth:C,dilationHeight:x,dilationWidth:E,inShape:e,outShape:f,filterShape:t}}function Yr(e,t,n,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],f=u[4];if("channelsLast"===a)c=e[0],l=e[1],h=e[2],d=e[3],f=e[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=e[0],f=e[1],l=e[2],h=e[3],d=e[4]}var p,m=t[0],g=t[1],v=t[2],y=t[4],b=Zr(n),w=b[0],x=b[1],E=b[2],_=Zr(r),C=_[0],k=_[1],S=_[2],I=eo(m,C),T=eo(g,k),N=eo(v,S),R=function(e,t,n,r,o,i,a,s,u,c,l){var h,d,f,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,o,i){null==o&&(o=$r(e,t,r));var a=e[1],s=e[2],u=to((e[0]-t+2*o)/r+1,i);O(U(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var c=to((a-t+2*o)/r+1,i);O(U(c),function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=to((s-t+2*o)/r+1,i);return O(U(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,c,l,1]}([t,n,r,1],s,0,o,e,l);d=m[0],f=m[1],p=m[2]}else if("same"===e){var g=((d=Math.ceil(t/o))-1)*o+s-t,v=((f=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/a))-1)*a+c-r,b=Math.floor(g/2),w=g-b,x=Math.floor(v/2),E=v-x,_=Math.floor(y/2);h={top:x,bottom:E,left:_,right:y-_,front:b,back:w,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/o),f=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/a)}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(o,l,h,d,w,x,E,I,T,N,s),A=R.padInfo,D=R.outDepth,P=R.outHeight,F=R.outWidth,M=i?y*f:y;return"channelsFirst"===a?p=[c,M,D,P,F]:"channelsLast"===a&&(p=[c,D,P,F,M]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:d,inChannels:f,outDepth:D,outHeight:P,outWidth:F,outChannels:M,padInfo:A,strideDepth:w,strideHeight:x,strideWidth:E,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:I,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationDepth:C,dilationHeight:k,dilationWidth:S,inShape:e,outShape:p,filterShape:t}}function $r(e,t,n,r){void 0===r&&(r=1);var o=eo(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function Jr(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Zr(e){return"number"==typeof e?[e,e,e]:e}function eo(e,t){return t<=1?e:e+(e-1)*(t-1)}function to(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function no(e){var t=Jr(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function ro(e,t){return no(e)||no(t)}function oo(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function io(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=kn(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!$(e.dtype,t))return We.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var a=n.real(e);return i=a.cast(t),a.dispose(),i}if("int32"===t)return n.int(e);if("bool"===t){var s=bn(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function ao(e,t){return We.makeTensorFromDataId(e.dataId,t,e.dtype)}function so(e,t,n){var r=(t-e)/(n-1),o=he(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return wn(o,"float32")}Object.freeze({castTensor:io,reshapeTensor:ao,linspaceImpl:so,upcastType:Fe,axesAreInnerMostDims:nn,combineLocations:rn,computeOutAndReduceShapes:on,expandShapeToKeepDim:an,assertAxesAreInnerMostDims:sn,getAxesPermutation:un,getUndoAxesPermutation:cn,getInnerMostAxes:ln,getBroadcastDims:Gr,getReductionAxes:Hr,assertAndGetBroadcastShape:qr,assertParamsConsistent:hn,computeOutShape:dn,computePool2DInfo:Kr,computePool3DInfo:Xr,computeConv2DInfo:Qr,computeConv3DInfo:Yr,computeDefaultPad:$r,tupleValuesAreOne:no,eitherStridesOrDilationsAreOne:ro,convertConv2DDataFormat:oo,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Ir});function uo(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function co(e,t){return{real:e[2*t],imag:e[2*t+1]}}function lo(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function ho(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function fo(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,o=e.length,i=0,a=!1;r<o;){var s=n(t,e[i=r+(o-r>>>1)]);s>0?r=i+1:(o=i,a=!s)}return a?r:-r-1}(e,t,n||po)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function po(e,t){return e>t?1:e<t?-1:0}function mo(e,t,n,r,o){return vo(e,t,n,r,o,0).selectedIndices}function go(e,t,n,r,o,i){var a=vo(e,t,n,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function vo(e,t,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}}).filter(function(e){return e.score>o}).sort(wo),c=i>0?-.5/i:0,l=[],h=[];l.length<n&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<o)break;for(var g=!1,v=l.length-1;v>=m;--v){var y=yo(e,p,l[v]);if(y>=r){g=!0;break}if(d.score=d.score*bo(r,c,y),d.score<=o)break}d.suppressBeginIndex=l.length,g||(d.score===f?(l.push(p),h.push(d.score)):d.score>o&&fo(u,d,wo))}var b=l.length;return s&&(l.fill(0,b),h.fill(0,b)),{selectedIndices:wn(l,"int32"),selectedScores:wn(h,"float32"),numValidOutputs:bn(b,"int32")}}function yo(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),f=(s-i)*(u-a),p=(h-c)*(d-l);if(f<=0||p<=0)return 0;var m=Math.max(i,c),g=Math.max(a,l),v=Math.min(s,h),y=Math.min(u,d),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(f+p-b)}function bo(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function wo(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function xo(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(t){o[n]=t;var i=e.slice(r,o);return r[n]+=t,i})}function Eo(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=Xn(n,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function _o(e,t,n,r,o){for(var i=t[t.length-1],a=[e.length/i,i],s=a[0],u=a[1],c=K(n,s*r),l=K("int32",s*r),h=0;h<s;h++){for(var d=h*u,f=e.subarray(d,d+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort(function(e,t){return t.value-e.value});var g=h*r,v=c.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var b=t.slice();return b[b.length-1]=r,[vn(c,b,n),vn(l,b,"int32")]}function Co(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=Xn(e,"int32"),i=Xn([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var ko=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},So=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(e,t){return"T"+t});var n=[];this.variableNames.forEach(function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")});var r=this.variableNames.map(function(e){return"v"+e}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Io=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function To(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(t){return e+"."+t})}function No(e,t){return 1===t?[e]:To(e,t)}function Ro(){var e,t,n,r,o,i,a,s,u,c;return 2===w().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Ao(e,t,n){void 0===n&&(n="index");var r=se(t);return r.map(function(t,o){return"int "+e[o]+" = "+n+" / "+t+"; "+(o===r.length-1?"int "+e[o+1]+" = "+n+" - "+e[o]+" * "+t:"index -= "+e[o]+" * "+t)+";"}).join("")}function Do(e){var t=se(e).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var Oo="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Po(e,t,n,r){var o=[];e.forEach(function(e){var t=L(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?o.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(o.push("uniform sampler2D "+e.name+";"),o.push("uniform int offset"+e.name+";"))});var i,a,s=o.join("\n"),u=e.map(function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";r+=n?Mo(e):Fo(e);var o=e.shapeInfo.logicalShape,i=t.logicalShape;return o.length<=i.length&&(r+=n?function(e,t){var n,r=e.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",a=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Gr(e.shapeInfo.logicalShape,t.logicalShape),c=Wo(s),l=s-a,h=["x","y","z","w","u","v"];n=0===a?"":s<2&&u.length>=1?"coords = 0;":u.map(function(e){return"coords."+h[e+l]+" = 0;"}).join("\n");var d;d=s<2&&a>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+h[t+l]}).join(", ");var f="return outputValue;",p=1===L(e.shapeInfo.logicalShape),m=1===L(t.logicalShape);if(1!==a||p||m){if(p&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=a-2,v=a-1;u.indexOf(g)>-1&&u.indexOf(v)>-1?f="return vec4(outputValue.x);":u.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+f+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=t.texShape,a=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&B(a,i))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c,l=Wo(u),h=Gr(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,f=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map(function(e){return"coords."+f[e+d]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords."+f[t+d]}).join(", "),"\n    float "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+c+"\n      return get"+r+"("+p+");\n    }\n  "}(e,t)),r}(e,t,r)}).join("\n"),c=t.texShape,l=Ro(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),d=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Lo+"\n    "+Bo+"\n    "+Uo+"\n  "}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(B(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),o=r*Math.ceil(e[e.length-2]/2),i=o,a="",s="b, r, c",u=2;u<e.length-1;u++)a="\n      int b"+u+" = index / "+(i*=e[e.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,o,i,a}(t.logicalShape,c),a=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return B(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=Ao(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=Ao(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=Ao(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=Ao(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),a=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=zo),[d,h,a,s,i,u,n].join("\n")}function Fo(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape,o=r[0],i=r[1];if(1===o&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var a=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+Vo(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+jo(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var a=Vo(t);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape;if(null!=o&&B(t,o)){var i=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var a=q(t),s=a.newShape,u=a.keptDims,c=s;if(c.length<t.length)return"\n      "+Fo(Go(e,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+Ho(["row","col"],u)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+t[1]+", 1)));\n        "+jo(e)+"\n      }\n    ";var l=o[0],h=o[1],d=Vo(n);return 1===h?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+t[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+t[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+l+", "+h+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[1]*t[2],i=t[2],a=q(t),s=a.newShape,u=a.keptDims,c=s;if(c.length<t.length)return"\n        "+Fo(Go(e,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+Ho(["row","col","depth"],u)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+i+", 1)));\n        "+jo(e)+"\n      }\n    ";var l=e.shapeInfo.texShape,h=l[0],d=l[1],f=e.shapeInfo.flatOffset;return d===o&&null==f?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===i&&null==f?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+t[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+i+" + depth + "+Vo(n)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,s=q(t),u=s.newShape,c=s.keptDims;if(u.length<t.length)return"\n      "+Fo(Go(e,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+Ho(["row","col","depth","depth2"],c)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+i+", "+o+", 1)));\n        "+jo(e)+"\n      }\n    ";var l=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],f=h[1];return f===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+t[1]*t[2]+", "+t[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+i+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+f+", index + "+Vo(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t[4],i=t[3]*o,a=t[2]*i,s=t[1]*a,u=q(t),c=u.newShape,l=u.keptDims;if(c.length<t.length)return"\n      "+Fo(Go(e,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+Ho(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+a+", "+i+", "+o+")) +\n          depth3;\n        "+jo(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,f=d[0],p=d[1];return p===s&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]+",\n               "+t[2]*t[3]+", "+t[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" + depth * "+i+" +\n          depth2 * "+o+" + depth3 + "+Vo(n)+";\n      vec2 uv = uvFromFlat("+f+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=q(t),i=o.newShape,a=o.keptDims;if(i.length<t.length)return"\n      "+Fo(Go(e,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+Ho(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,h=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+jo(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,p=f[0],m=f[1];return m===h&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+t[1]*t[2]*t[3]*t[4]+",\n               "+t[2]*t[3]*t[4]+",\n               "+t[3]*t[4]+",\n               "+t[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+Vo(n)+";\n      vec2 uv = uvFromFlat("+p+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Mo(e){var t;switch(e.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(t=e.name).charAt(0).toUpperCase()+t.slice(1))+"() {\n      return "+Ro().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Ro();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+t+", uv);\n    }\n  "}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=o[0],a=o[1],s=Ro();if(null!=o&&B(t,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===t[0])return"\n        "+Mo(Go(e,t.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+Ho(["b","row","col"],[1,2])+");\n        }\n      ";var a=i[0],s=i[1],u=Math.ceil(t[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+s+", "+u*Math.ceil(t[1]/2)+", "+u+", b, row, col);\n      return "+Ro().texture2D+"("+n+", uv);\n    }\n  "}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",f=2;f<n-1;f++)h="int b"+f+", "+h,d="b"+f+" * "+(l*=t[n-f-1])+" + "+d;return"\n    vec4 "+o+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Ro().texture2D+"("+r+", uv);\n    }\n  "}(e)}}var Lo="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Bo="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Uo="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zo="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Vo(e){return"offset"+e}function jo(e){var t=e.name,n=L(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Wo(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function Go(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Ho(e,t){return t.map(function(t){return e[t]}).join(", ")}var qo=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Wo(c),h=No("coords",c);if(1===i){var d=Wo(s=c+1);a="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[c-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[c-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[c-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+h[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+h[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+h[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+h[c-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map(function(e){return"int "+e}),g=No("sourceLocR",s-1).concat("inIdx.r"),v=No("sourceLocG",s-1).concat("inIdx.g"),y=No("sourceLocB",s-1).concat("inIdx.b"),b=No("sourceLocA",s-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",_=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+_+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+h[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+h[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Ko=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,h=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Xo=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*n*r);this.userCode="\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Qo=function(e,t,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],qr(e,t),qr(e,n);var a="0.0";null!=r&&(qr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(qr(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Yo=function(e,t,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qr(e,t),qr(e,n);var a="vec4(0.0)";null!=r&&(qr(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(qr(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},$o=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qr(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Jo="return a + b;",Zo="return a - b;",ei="return a * b;",ti="return (a < 0.) ? b * a : a;",ni=function(e,t,n){this.variableNames=["A","B"],this.outputShape=qr(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},ri="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",oi=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qr(t,n);var o=this.outputShape.length,i="";if(r)if(0===o||1===L(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+Wo(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=No("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},ii=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),ai=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),si=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},ui=function(e){this.outputShape=[],this.outputShape=dn(e,1),this.variableNames=e.map(function(e,t){return"T"+t});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var i=t.length,a=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},ci=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=dn(e,t);var n=this.outputShape,r=n.length,o=Wo(r),i=No("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(e,t){return"T"+t});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=a[t],l=a.slice(-2),h=a.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var f=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+li(a,c,f)+"),\n            vec2("+li(l,c,f)+"));\n        }"}var p=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+li(a,c,m)+"),\n          vec2("+li(l,c,m)+"));",this.userCode="\n      float getValue("+a.map(function(e){return"int "+e})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function li(e,t,n){var r=e.indexOf(t);return e.map(function(e,t){return t===r?e+" - "+n:e}).join()}var hi=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i="channelsLast"===e.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},di=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i="channelsLast"===e.dataFormat,a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},fi=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+t+" - "+o+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+a+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},pi=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},mi=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},gi=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vi=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,h=e.filterWidth,d=4*Math.floor(e.inChannels/4),f=e.inChannels%4,p="channelsLast"===e.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+b+"\n        setOutput(result);\n      }\n    "},yi=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,h=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},bi=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=e.outChannels/e.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},wi=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,h=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<f;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(v=2*y)*h+";\n        ",1===c){if(v<f&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<f)){var b=s%2==0?A(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<f&&(m+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<f&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<f&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<f&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var w="",x="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",x="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+x+"\n        setOutput(result);\n      }\n    "},xi=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],c=t[0],l=n[0],h=n[1];this.outputShape=[c,l,h,u];var d="bilinear"===r?1:0,f=[a-1+".0",s-1+".0"],p=f[0],m=f[1],g=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],b=g[2],w=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],x=w[0],E=w[1],_=w[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+x+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+_+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Ei=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Wo(r)+" coords = getOutputCoords();\n        int end = "+_i(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+_i(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function _i(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var Ci=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=et(e),n=Ro();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ao(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},ki=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qe.DENSE;var t=et(e),n=Ro();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Ao(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Si=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),Ii=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Ti=function(e){this.variableNames=["A"],this.outTexUsage=Ke.DOWNLOAD;var t=Ro();this.outputShape=e,this.userCode="\n      "+Oo+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},Ni=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ke.DOWNLOAD;var t=Ro();this.outputShape=e,this.userCode="\n      "+Oo+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},Ri=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Ro(),o=t[0],i=t[1];this.outputShape=e;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+Do(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},Ai=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Ro(),o=t[0],i=t[1];this.outputShape=e;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+Do(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},Di=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Oi=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),Pi=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Wo(this.rank),i=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<e.length;i++)i===t?o.push("int(getIndices("+r[i]+"))"):o.push(""+r[i]);return o.join()}(e,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Fi=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Wo(t.length),o=Wo(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Mi(e,t){var n=Ro();return st(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Li(e,t){return mt(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Bi(e,t){return gt(e,t,new Uint16Array([0,1,2,2,1,3]))}function Ui(e,t,n,r,o,i,a){yt(n,r);var s=vt(e,t),u=e.TEXTURE_2D;return rt(e,t,function(){return e.bindTexture(u,s)}),rt(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),rt(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),rt(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),rt(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),rt(e,t,function(){return e.texImage2D(u,0,o,n,r,0,i,a,null)}),rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function zi(e,t,n,r,o){var i=Ze(n,r);return Ui(e,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function Vi(e,t,n,r,o){var i=Ze(n,r);return Ui(e,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function ji(e,t,n,r,o){var i=Ze(n,r);return Ui(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function Wi(e,t,n,r,o){var i=tt(n,r);return Ui(e,t,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function Gi(e,t,n,r,o){var i=tt(n,r);return Ui(e,t,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function Hi(e,t,n,r){return rt(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),wt(e,t,n,"clipSpacePos",r,3,20,0)&&wt(e,t,n,"uv",r,2,20,12)}function qi(e,t,n,r,o,i,a){var s,u,c;rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,c=a.internalFormatPackedFloat),s.set(i),rt(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,o,0,e.RGBA,u,s)}),rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Ki(e,t,n,r){rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?rt(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):rt(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),rt(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function Xi(e,t,n,r,o){var i=e.createBuffer();rt(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return rt(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)}),rt(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),rt(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),i}function Qi(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Yi(e,t,n,r,o){var i=Ze(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return rt(e,t,function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function $i(e,t,n,r,o,i,a,s){var u=e,c=new Float32Array(function(e,t){var n=tt(e,t);return n[0]*n[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Ji(e,t,n,r){var o=new Float32Array(n*r*4);return rt(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var Zi=Object.freeze({createVertexShader:Mi,createVertexBuffer:Li,createIndexBuffer:Bi,createFloat32MatrixTexture:zi,createFloat16MatrixTexture:Vi,createUnsignedBytesMatrixTexture:ji,createPackedMatrixTexture:Wi,createFloat16PackedMatrixTexture:Gi,bindVertexProgramAttributeStreams:Hi,uploadDenseMatrixToTexture:qi,uploadPixelDataToTexture:Ki,createBufferFromOutputTexture:Xi,downloadFloat32MatrixFromBuffer:Qi,downloadByteEncodedFloatMatrixFromOutputTexture:Yi,downloadPackedMatrixFromBuffer:$i,downloadMatrixFromPackedOutputTexture:Ji}),ea=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=w().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,$e(t,e)):this.gl=Je(t);var n="WEBGL_color_buffer_float";if(1===w().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=at(this.gl,this.debug,"OES_texture_float"),zt(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=at(this.gl,this.debug,"OES_texture_half_float");else if(w().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),zt(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=at(this.gl,this.debug,"EXT_color_buffer_half_float");else if(w().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",zt(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!zt(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Li(this.gl,this.debug),this.indexBuffer=Bi(this.gl,this.debug),this.framebuffer=bt(this.gl,this.debug),this.textureConfig=nt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return w().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;rt(t,this.debug,function(){return t.finish()}),rt(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),rt(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),rt(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),rt(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),rt(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),zi(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Vi(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),ji(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),Ki(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),qi(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Gi(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Wi(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(St(this.gl,this.debug,this.framebuffer),this.outputTexture=null),rt(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Yi(r.gl,r.debug,t,n,r.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,o,i){return $i(this.gl,e,0,0,0,o,i,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Qi(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=Xi(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(w().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=o.clientWaitSync(i,0,0);return e===o.ALREADY_SIGNALED||e===o.CONDITION_SATISFIED},t=i}else w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return Ji(r.gl,r.debug,t,n)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ut(t,this.debug,e),r=Mi(t,this.debug),o=dt(t,this.debug);return rt(t,this.debug,function(){return t.attachShader(o,r)}),rt(t,this.debug,function(){return t.attachShader(o,n)}),ft(t,this.debug,o),this.debug&&pt(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Hi(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&rt(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&pt(this.gl,this.debug,this.program),rt(this.gl,this.debug,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Et(this.gl,this.debug,e,t):_t(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),rt(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Ct(this.gl,this.debug,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=tt(t,n),o=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,o,i)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&pt(this.gl,this.debug,this.program),It(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),rt(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),rt(this.gl,this.debug,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=at(this.gl,this.debug,2===w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(2!==w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return v(this,void 0,void 0,function(){var t=this;return y(this,function(n){switch(n.label){case 0:return[4,W(function(){return t.disposed||t.isQueryAvailable(e,w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||W(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),kt(this.gl,this.debug,e,this.framebuffer),this.debug&&It(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(kt(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&It(this.gl)):St(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;kt(r,this.debug,e,this.framebuffer),this.debug&&It(r),this.outputTexture=e,rt(r,this.debug,function(){return r.viewport(0,0,t,n)}),rt(r,this.debug,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var o=this;this.throwIfDisposed(),rt(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function ta(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(e,n){var r=e.logicalShape,o=t[n],i=o.shape;if(!B(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!e.isUniform||!o.isUniform){var a=e.texShape,s=o.isUniform?null:o.texData.texShape;if(!B(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var na=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,h=n.dataFormat,d=s.left,f=s.top,p=o*r,m=Ro(),g="channelsLast"===h,v=g?0:1,y=g?1:2,b="",w=0;w<=1;w++)for(var x=0;x<=1;x++)b+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+f+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+t[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+m.output+" = result;\n      }\n    "},ra=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},oa=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},ia=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},aa=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+t+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},sa=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,h=u-1-e.padInfo.top,d=c-1-e.padInfo.left,f=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+t+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+f+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ua=function(e,t,n,r,o,i,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";i&&(f=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},ca=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),la=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ha=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=No("rc",t),r=Wo(t),o=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",o=e-2;o<e;o++)r+=n[o]+" >= "+t[o],o<e-1&&(r+="||");return r}(t,e,n),i=function(e,t,n,r){if(1===e)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),a=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<e;a++)i=t[t.length-1-a]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},da=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});var r=e.length,o=Wo(r),i=t.map(function(e){return e[0]}).join(","),a=t.map(function(t,n){return t[0]+e[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},fa=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(t,n){return t[0]+e[n]+t[1]});for(var r=e.length,o=Wo(r),i=t.map(function(e){return e[0]}).join(","),a=t.map(function(t,n){return t[0]+e[n]}).join(","),s=No("rc",r),u=No("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=1===r?2:4;p<m;p++)f+="\n        "+h[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";f+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+f+"\n        setOutput(result);\n      }\n    "},pa=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var d="avg"===t,f="0.0";if(d||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var m=4*Math.floor(r/4),g=r%4,v="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},ma=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=e.padInfo.front,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;var g="avg"===t,v="0.0";if(g||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,x="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},ga=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",s="min"):"max"===t&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===t?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===t&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},va=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Ao(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+Do(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},ya=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ba=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},wa=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],c=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},xa=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Ea=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},_a=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map(function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=Wo(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},Ca=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=No("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Wo(n);function s(n){var r=e.map(function(r,o){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},ka=function(e,t,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Wo(o.length),u=Wo(i.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",f=t>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+f+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Sa=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Ia=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Wo(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},Ta=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Wo(this.rank),r="uniform int start["+this.rank+"];",o=function(e){if(1===e)return"sourceLoc";if(e<=6)return Na.slice(0,e).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map(function(e,t){return"sourceLoc."+Na[t]+" = start["+t+"] + coords."+Na[t]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+o+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Na=["x","y","z","w","u","v"],Ra=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Wo(this.rank),n=No("coords",this.rank),r=No("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map(function(e,t){return"start["+t+"]"}).join()+");":e.map(function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),Aa=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Wo(n.length),i=Wo(n.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=n.map(function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+e+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},Da=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,o=Oa(t,n),i=Pa(e,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===Xe.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Xe.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Xe.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Xe.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Xe.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var o=Pa(t,Oa(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(t){e.gpgpu.deleteMatrixTexture(t)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function Oa(e,t){if(e===Ke.UPLOAD)return Xe.PACKED_2X2_FLOAT32;if(e===Ke.RENDER||null==e)return function(e){return w().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Xe.PACKED_2X2_FLOAT32:Xe.UNPACKED_FLOAT32:e?Xe.PACKED_2X2_FLOAT16:Xe.UNPACKED_FLOAT16}(t);if(e===Ke.DOWNLOAD||e===Ke.PIXELS)return Xe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function Pa(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var Fa=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Wo(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<e.length;o++)r.push("imod("+n[o]+", "+e[o]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Ma=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Wo(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),o=0;o<e.length;o++)r[e[o]]=n[o];return r.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},La=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Wo(this.rank),i=To("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Ba=1.7580993408473768,Ua=1.0507009873554805,za=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Va="if (isnan(x)) return x;",ja="return abs(x);",Wa=Va+"\n  return (x < 0.0) ? 0.0 : x;\n",Ga=Va+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Ha="return (x >= 0.0) ? x : (exp(x) - 1.0);",qa="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Ba+";\n  float scale = "+Ua+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",Ka="return -x;",Xa="return ceil(x);",Qa="return floor(x);",Ya="return exp(x);",$a="return exp(x) - 1.0;",Ja=Va+"\n  return sin(x);\n",Za=Va+"\n  return cos(x);\n",es=Va+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",ts=Va+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",ns=Va+"\n  return atan(x);\n",rs=Va+"return log(x + sqrt(x * x + 1.0));",os=Va+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",is=Va+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",as="return x;",ss="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",us="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cs="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",ls=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},hs=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=No("rc",t),r=Wo(t),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),i=n.slice(-2),a=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},ds={};function fs(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?ss:Wa;if("elu"===e)return t?cs:Ha;if("relu6"===e)return t?us:Ga;if("prelu"===e)return t?ri:ti;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var ps=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!w().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var o=Je(w().getNumber("WEBGL_VERSION"));r.binaryCache=((n=w().getNumber("WEBGL_VERSION"))in ds||(ds[n]={}),ds[n]),r.gpgpu=new ea(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new Da(r.gpgpu),r.numMBBeforeWarning=null==w().global.screen?1024:w().global.screen.height*w().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Vr(r,We),r}return g(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(w().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Ke.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(w().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Ke.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,o=t.complexTensors,i=t.slice,a=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new ls(a,as):new za(a,as);var c=this.runWebGLProgram(u,[{dataId:e,shape:a,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,d,f=null!=this.activeTimers;return f&&(h=de()),d="complex64"===r?uo(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(e),f&&(this.downloadWaitMs+=de()-h),this.convertAndCacheOnCPU(e,d)},t.prototype.read=function(e){return v(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,c,l,h,d,f,p,m,g,v,b,x,E,_,C;return y(this,function(y){switch(y.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise(function(e){return t.push(e)})];if(n=this.texData.get(e),r=n.values,o=n.shape,i=n.slice,a=n.dtype,s=n.complexTensors,u=n.isPacked,null!=i)return void 0,c=u?new ls(o,as):new za(o,as),l=this.runWebGLProgram(c,[{dataId:e,shape:o,dtype:a}],a),h=this.read(l.dataId),this.disposeData(l.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!w().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===w().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==a&&w().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(e),p=this.texData.get(f.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,[p.texture].concat(et(o)))),this.pendingRead.set(e,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:y.sent(),y.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return g=y.sent(),v=g[0],b=g[1],m=uo(v,b),[3,5];case 4:null==d?m=this.getValuesFromTexture(e):(x=L(o),m=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),y.label=5;case 5:return null!=f&&this.disposeData(f.dataId),E=this.convertAndCacheOnCPU(e,m),_=this.pendingRead.get(e),this.pendingRead.delete(e),_.forEach(function(e){return e(E)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,E]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!ot(n)){if(w().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,i=n.isPacked,a=L(r);if(w().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(et(r))).subarray(0,a);return this.disposeData(s.dataId),c}var l=w().getBool("WEBGL_PACK")&&!0===i,h=l?Ot(r):r,d=l?new Ni(h):new Ti(h),f=this.runWebGLProgram(d,[{shape:h,dtype:o,dataId:e}],"float32"),p=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,a);return this.disposeData(f.dataId),m},t.prototype.time=function(e){return v(this,void 0,void 0,function(){var t,n,r,o,i,a,s;return y(this,function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=M(this.activeTimers.map(function(e){return e.query})).filter(function(e){return null!=e}),i=M(this.activeTimers.map(function(e){return e.name})).filter(function(e){return null!=e}),this.activeTimers=t,r&&(this.programTimersStack=null),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),a.kernelMs=D(s),a.getExtraProfileInfo=function(){return s.map(function(e,t){return{name:i[t],ms:e}}).map(function(e){return e.name+": "+e.ms}).join(", ")},[3,3];case 2:a.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:de(),endMs:null}},t.prototype.endTimer=function(e){return w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=de(),e)},t.prototype.getQueryTime=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){return w().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,o=t.texShape,i=t.usage,a=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,i,a)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return w().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=We.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every(function(e){return null==n.texData.get(e.dataId).texture&&e.size<t})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===L(n))return vn([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,o=Mr(e.shape,t,n);if(r||!o){var i=w().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ra(n):new Ta(n),a=i.getCustomSetupFunc(t);return this.compileAndRun(i,[e],null,a)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),o=this.makeOutput(n,e.dtype),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var a=Lr(t,e.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var o=Or(t,n,r);if(o.some(function(e){return 0===e}))return vn([],o);var i=new Aa(t,r,o);return this.compileAndRun(i,[e])},t.prototype.reverse=function(e,t){var n=w().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ca(e.shape,t):new _a(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map(function(e){return mn(e)}),r=e.map(function(e){return gn(e)});return pn(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>w().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(e.length/2),i=this.concat(e.slice(0,o),t),a=this.concat(e.slice(o),t);return this.concat([i,a],t)}if(w().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new ci(e.map(function(e){return e.shape}),t);return this.compileAndRun(s,e)}var u=dn(e.map(function(e){return e.shape}),t),c=e.map(function(e){return e.as2D(-1,L(e.shape.slice(t)))}),l=new ui(c.map(function(e){return e.shape}));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ka,e.dtype);var t=new za(e.shape,Ka);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var o=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],a=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===o||1===i)&&a>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===i?e:e.as3D(s,a,1),c=1===i?2:1,l=1===i?t.as3D(s,1,a):t;return this.multiply(u,l).sum(c,!0)}var h=Fe(e.dtype,t.dtype),d=new ua(e.shape,[s,o,i],n,r);return this.compileAndRun(d,[e,t],h)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,i=e.bias,a=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=o?n.shape[1]:n.shape[2],l=t.shape[0],h=Fe(t.dtype,n.dtype),d=null!=i,f=null!=s,p=a?fs(a,!0):null,m=new ua(t.shape,[l,u,c],r,o,d,p,f),g=[t,n];return i&&g.push(i),s&&g.push(s),this.compileAndRun(m,g,h)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),o=new $o("return areal * breal - aimag * bimag;",e.shape,t.shape),i=new $o("return areal * bimag + aimag * breal;",e.shape,t.shape),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ei,e.dtype);var l=new ni(ei,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,i){var a=[e,t,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),w().getBool("WEBGL_PACK_NORMALIZATION")){var c=new Yo(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,a)}var l=new Qo(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){var i=w().getBool("WEBGL_PACK_NORMALIZATION")?new ia(e.shape,t,n,r,o):new ra(e.shape,t,n,r,o);return this.compileAndRun(i,[e])},t.prototype.LRNGrad=function(e,t,n,r,o,i,a){var s=new oa(t.shape,r,o,i,a);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map(function(e){return me(e)});return Eo(Xn(e.shape,e.dtype,n),t)}var r=new Fa(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=w().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fa(e.shape,t,n):new da(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=w().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new La(e.shape,t):new Ma(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new Pi(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){O(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=xr(e.shape,t,r),i=Er(o.length,t.length),a=_r(e.shape,t,r),s=Cr(n,t.length),u=kr(a,n,t.length);return e.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){O(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var i=1+t.length;i<e.shape.length;++i)o.push([0,0]);var a=e.pad(o),s=xr(a.shape,t,r,!1),u=Er(s.length,t.length,!1),c=_r(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],o=e.shape[1],i=Ir(o),a=new ga({windowSize:i,inSize:o,batchSize:r},t),s=this.compileAndRun(a,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],o=e.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=Ir(o),a=new Io({windowSize:i,inSize:o,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(a,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,o=Ir(r[r.length-1]),i=new qo(r,o,t,null==n),a=null==n?[e]:[e,n],s=this.compileAndRun(i,a,"int32");return s.rank===e.rank?this.argReducePacked(e,t,s):s},t.prototype.sum=function(e,t){sn("sum",t,e.rank);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o),a=Me(e.dtype);return this.reduce(i,"sum",a).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o),a=Me(e.dtype);return this.reduce(i,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,o=un([r],e.rank),i=e;null!=o&&(i=e.transpose(o),r=ln(1,e.rank)[0]);var a=function(e,t,n){for(var r=[],o=e.length,i=0;i<o;i++)i!==t?r.push(e[i]):r.push(n);return r}(i.shape,r,n),s=L([i.shape[r]]),u=i.as2D(-1,s),c=Me(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(a);return null!=o&&(l=l.transpose(cn(o))),l},t.prototype.segOpCompute=function(e,t,n,r,o){var i=e.shape[0],a=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=ae(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=ae(e,n+1);return n}(a,o),u=new Sa({windowSize:s,inSize:a,batchSize:i,numSegments:o},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===o?c:(n=In(0,o).tile([a/s]),this.segOpCompute(c,t,n,r,o))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(sn("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!w().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=on(e.shape,r),i=o[0],a=L(o[1]),s=e.as2D(-1,a);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new Ei(e.shape,n,r);return this.compileAndRun(o,[e])},t.prototype.equal=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new ni("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new ni("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new ni("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new ni("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new ni("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new ni("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new za(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new ni("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new ni("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new Ia(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Fe(t.dtype,n.dtype))},t.prototype.where=function(e){$t("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Co(e.shape,t)},t.prototype.topk=function(e,t,n){return _o(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){sn("min",t,e.rank);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ni("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ni("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);sn("max",t,e.rank);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ni("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){sn("all",t,e.rank);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},t.prototype.any=function(e,t){sn("any",t,e.rank);var n=on(e.shape,t),r=n[0],o=L(n[1]),i=e.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new ni("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new ni("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Jo);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=Fe(e.dtype,t.dtype);if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Jo,n);var r=new ni(Jo,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new ls(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,o){void 0===o&&(o=!1);var i=new oi(n,e.shape,t.shape,o);return this.compileAndRun(i,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,o=this.texData.get(e.dataId),i=this.texData.get(t.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorInfo(e,i),u=r.makeComplexComponentTensorInfo(t,a),c=new ni(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],Fe(i.dtype,a.dtype))}),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>w().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var o=e.map(function(e){return e.dtype}).reduce(function(e,t){return Fe(e,t)}),i=e.map(function(e){return e.shape}),a=w().getBool("WEBGL_PACK")?new So(e[0].shape,i):new ko(e[0].shape,i);return this.compileAndRun(a,e,o)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Zo);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=Fe(e.dtype,t.dtype);if(w().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Zo,e.dtype);var r=new ni(Zo,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ni("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Fe(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Xa,e.dtype);var t=new za(e.shape,Xa);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Qa,e.dtype);var t=new za(e.shape,Qa);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new za(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new za(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new za(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new za(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new za(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ya,e.dtype);var t=new za(e.shape,Ya);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,$a,e.dtype);var t=new za(e.shape,$a);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=H([t],e.shape),r=this.max(e,n),o=an(r.shape,n),i=this.subtract(e,r.reshape(o)),a=this.exp(i),s=this.sum(a,n).reshape(o);return this.realDivide(a,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new za(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new za(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new za(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new za(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new za(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=w().getBool("WEBGL_PACK")?new ls(e.shape,ss):new za(e.shape,Wa),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=w().getBool("WEBGL_PACK")?new ls(e.shape,us):new za(e.shape,Ga),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi(ri,e.shape,t.shape):new ni(ti,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cs,e.dtype);var t=new za(e.shape,Ha);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new ni("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new za(e.shape,qa);return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new za(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,o=(r=w().getBool("WEBGL_PACK_CLIP")?new ai(e.shape):new ii(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,o)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(w().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ja,e.dtype);var t=new za(e.shape,ja);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new si(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new za(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new za(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new za(e.shape,Ja);return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new za(e.shape,Za);return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new za(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new za(e.shape,es);return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new za(e.shape,ts);return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new za(e.shape,ns);return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new ni("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new za(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new za(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new za(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new za(e.shape,rs);return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new za(e.shape,os);return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new za(e.shape,is);return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new za(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new za(e.shape,function(e){return void 0===e&&(e=0),Va+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,o,i){var a=e.shape,s=this.texData.get(e.dataId),u=n.inChannels,c=a[0]*a[1]*a[2],l=n.outChannels,h="channelsLast"===n.dataFormat,d=(1===c||1===l)&&u>1e3,f=a[2]%2!=0&&!!s.isPacked;if(d||!w().getBool("WEBGL_LAZILY_UNPACK")||!w().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var p=h?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],m=this.reshape(e,[1,p,n.inChannels]),g=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),n.outShape)}var v=h?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),y={dataId:e.dataId,shape:[1,v,n.inChannels],dtype:e.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,O(Mt(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var x=this.reshape(t,[1,n.inChannels,n.outChannels]),E=this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),_=this.texData.get(E.dataId);return O(_.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=b,_.shape=n.outShape,We.makeTensorFromDataId(E.dataId,n.outShape,E.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,o,i){var a=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,d=a*s*u,f=l*c,p=[d,f],m=e.squeeze([0]),g=t.reshape([1,d,-1]),v=new na(p,m.shape,n),y=this.compileAndRun(v,[m]).reshape([1,p[0],p[1]]),b=null!=r,w=null!=i,x=o?fs(o,!0):null,E=new ua(y.shape,[1,f,n.outChannels],!0,!1,b,x,w),_=[y,g];r&&_.push(r),w&&_.push(i);var C=this.compileAndRun(E,_);return h?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,i=e.activation,a=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,o,i,a);if(w().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,o,i,a);var s=null!=o,u=null!=a,c=i?fs(i,!1):null,l=new vi(r,s,c,u),h=[t,n];return o&&h.push(o),a&&h.push(a),this.compileAndRun(l,h)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(w().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new vi(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new di(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new hi(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,o=e.convInfo,i=e.bias,a=e.activation,s=e.preluActivationWeights,u=w().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,c=a?fs(a,u):null,l=[n,r],h=null!=i,d=null!=s;return h&&l.push(i),d&&l.push(s),u?(t=new wi(o,h,c,d),this.compileAndRun(t,l)):(t=new bi(o,h,c,d),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return w().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new wi(n),this.compileAndRun(r,[e,t])):(r=new bi(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new gi(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new mi(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new yi(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new pi(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new fi(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new pa(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new pa(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var o=new pa(r,"max",!0),i=this.compileAndRun(o,[t]),a=new aa(r),s=this.compileAndRun(a,[e,i],t.dtype);return i.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new Ko(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return io(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,i=0;i<e.rank;i++)i!==t&&(r[o++]=e.shape[i]);var a=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[t]=i,u[i]=this.slice(e,a,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new ma(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new Xo(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new ma(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var o=new ma(r,"max",!0),i=this.compileAndRun(o,[t]),a=new sa(r),s=this.compileAndRun(a,[e,i],t.dtype);return i.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!Mt(e.shape,t)&&(null===n.texture||!Mt(n.shape,t))){var r=this.packedReshape(e,t);return We.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return ao(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var o=w().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new wa(e.shape,t,n,r):new ba(e.shape,t,n,r);return this.compileAndRun(o,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new ya(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var o=new Ea(e.shape,t,n,r);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new xa(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var o=t?e:Ur(e),i=o.shape[0],a=o.shape[1],s=new ca(i,a,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},t.prototype.oneHot=function(e,t,n,r){var o=new la(e.size,t,n,r);return this.compileAndRun(o,[e])},t.prototype.diag=function(e){var t=new Ii(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return $t("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),mo(e.dataSync(),t.dataSync(),n,r,o)},t.prototype.cropAndResize=function(e,t,n,r,o,i){var a=new xi(e.shape,t.shape,r,o,i);return this.compileAndRun(a,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){O(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var r=e.shape[0],o="NHWC"===n?e.shape[1]:e.shape[2],i="NHWC"===n?e.shape[2]:e.shape[3],a="NHWC"===n?e.shape[3]:e.shape[1],s=o*t,u=i*t,c=a/(t*t),l=new Si("NHWC"===n?[r,s,u,c]:[r,c,s,u],t,n);return this.compileAndRun(l,[e])},t.prototype.split=function(e,t,n){return xo(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=Rr(0,e,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=e.reshape([i,o]),h=t.reshape([i,a]);if(0===u)return ao(vn([]),n);var d=bn(0),f=new ka(i,o,l.rank,h.rank,s,c);return this.compileAndRun(f,[h,l,d]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var o=Rr(0,e,n),i=o.sliceRank,a=o.numUpdates,s=o.strides,u=o.outputSize,c=new ka(a,i,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new Di("return real * expR - imag * expI;",e.shape,t),o=new Di("return real * expI + imag * expR;",e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(e.shape[0],e.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Sr(e,t),i=o[0],a=o[1],s=o[2],u=o[3],c=t.reshape([a,r]),l=e.reshape([e.size/s,s]),h=new Fi(r,u,[a,s]);return this.compileAndRun(h,[l,c]).reshape(i)},t.prototype.fill=function(e,t,n){if("string"===(n=n||oe(t))){var r=X(n,L(e));return r.fill(t),We.makeTensor(r,e,n,this)}var o=new Oi(e,t),i=o.getCustomSetupFunc(t);return this.compileAndRun(o,[],n,i)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return so(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return We.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new hs(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new ha(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[At(e.shape)].concat(Dt(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},o=[At(t)].concat(Dt(t)),i=new va(o,n),a=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:a.dataId,shape:t,dtype:a.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,o=n.shape,i=n.dtype,a=Ot(o);return t=r?new ki(a):new Ci(a),{dtype:i,shape:o,dataId:this.runWebGLProgram(t,[{shape:a,dtype:i,dataId:e}],i,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,o){var i=this;void 0===o&&(o=!1);var a=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(a.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===qe.DENSE){var u=et(e.outputShape);s.texShape=u.map(function(e){return 2*e})}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===L(a.shape))return s.values=K(a.dtype,0),a;var c=[],l=t.map(function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&L(t.shape)<=w().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),c.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!Mt(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=i.packedReshape(t,o),c.push(t),n=i.texData.get(t.dataId),r.shape=o}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);var h,d={shape:a.shape,texData:s,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach(function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+=e.shape+"_"+n+"_"+t});var o=e.userCode;return e.constructor.name+"_"+r+"_"+o}(e,l,d),p=this.getAndSaveBinary(f,function(){return function(e,t,n,r){var o=t.userCode,i=n.map(function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}}),a=i.map(function(e){return e.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Po(i,s,o,t.packedInputs),c=e.createProgram(u),l=null,h=e.getUniformLocation(c,"NAN",!1);1===w().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var d={},f=0;f<t.variableNames.length;f++){var p=t.variableNames[f];d[p]=e.getUniformLocation(c,p,!1),d["offset"+p]=e.getUniformLocation(c,"offset"+p,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:l,nanLoc:h}}(i.gpgpu,e,l,d)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(e,t,n,r,o){ta(t.inShapeInfos,n),ta([t.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,a[0],a[1]):e.setOutputMatrixTexture(i,a[0],a[1]),e.setProgram(t.webGLProgram),1===w().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach(function(n,r){var o=t.program.variableNames[r],i=t.uniformLocations[o],a=t.uniformLocations["offset"+o];if(null!=i)if(n.isUniform)if(L(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=a&&e.gl.uniform1i(a,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)}),null!=o&&o(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,l,d,r),c.forEach(function(e){return i.disposeData(e.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!w().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var g=this.unpackTensor(a);return this.disposeData(a.dataId),g}return a},t.prototype.compileAndRun=function(e,t,n,r,o){void 0===o&&(o=!1),n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,o);return We.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(w().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Qt(function(){if(!w().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=w().getBool("DEBUG");w().set("DEBUG",!1);var n=e.abs(bn(1e-8)).dataSync()[0];if(w().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,o=n.dtype,i=n.values,a=n.texture,s=n.usage,u=n.isPacked;if(null==a){var c,l=null!=this.activeTimers;l&&(c=de());var h=n.texShape;if(null==h&&(h=Pt(r,u),n.texShape=h),null!=i){var d=Ot(r),f=void 0,p=h[1],m=h[0],g=i instanceof Uint8Array;u?(p=(t=tt(h[0],h[1]))[0],m=t[1],f=new Ai(d,[m,p],g)):f=new Ri(d,[m,p],g);var v=this.makeTensorInfo([m,p],o);this.texData.get(v.dataId).usage=g?Ke.PIXELS:Ke.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,i);var y=this.runWebGLProgram(f,[v],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=de()-c)}else{var w=this.acquireTexture(h,s,o,u);n.texture=w}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*Z(t)},t}(jr);Ge()&&We.registerBackend("webgl",function(){return new ps},2);var ms=fn({square_:function(e){var t=en(e,"x","square"),n=[t];return We.runKernelFunc(function(e,n){return n([t]),e.square(t)},{x:t},null,"Square",{},n,[])}}),gs="SquaredDifference",vs=fn({squaredDifference_:function(e,t){var n,r=en(e,"a","squaredDifference"),o=en(t,"b","squaredDifference");n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return We.runKernelFunc(function(e,t){var n=e.squaredDifference(r,o);return t([r,o]),n},i,function(e,t){var n=t[0],r=t[1],o=bn(2);return{a:function(){return e.mul(n.sub(r).mul(o))},b:function(){return e.mul(r.sub(n).mul(o))}}},gs,{},a,[])}}),ys=fn({abs_:function(e){var t=en(e,"x","abs");return"complex64"===t.dtype?We.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):We.runKernelFunc(function(e,n){var r=e.abs(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}},"Abs")}}),bs=fn({acos_:function(e){var t=en(e,"x","acos");return We.runKernelFunc(function(e,n){var r=e.acos(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(bn(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),ws=fn({acosh_:function(e){var t=en(e,"x","acosh");return We.runKernelFunc(function(e,n){var r=e.acosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),xs=fn({asin_:function(e){var t=en(e,"x","asin");return We.runKernelFunc(function(e,n){var r=e.asin(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(bn(1).sub(n.toFloat().square()).sqrt())}}})}}),Es=fn({asinh_:function(e){var t=en(e,"x","asinh");return We.runKernelFunc(function(e,n){var r=e.asinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.divStrict(bn(1).add(n.toFloat().square()).sqrt())}}})}}),_s=fn({atan_:function(e){var t=en(e,"x","atan");return We.runKernelFunc(function(e,n){var r=e.atan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}})}}),Cs=fn({atanh_:function(e){var t=en(e,"x","atanh");return We.runKernelFunc(function(e,n){var r=e.atanh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(bn(1).sub(n.toFloat().square()))}}})}}),ks=fn({ceil_:function(e){var t=en(e,"x","ceil");return We.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Ss=fn({clipByValue_:function(e,t,n){var r=en(e,"x","clipByValue");O(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],i={min:t,max:n};return We.runKernelFunc(function(e,o){var i=e.clip(r,t,n);return o([r]),i},{x:r},function(e,r){var o=r[0];return{x:function(){return e.where(o.greaterEqual(t).logicalAnd(o.lessEqual(n)),Nn(e))}}},"ClipByValue",i,o)}}),Is=fn({cos_:function(e){var t=en(e,"x","cos"),n=[t];return We.runKernelFunc(function(e,n){var r=e.cos(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}},"Cos",{},n)}}),Ts=fn({cosh_:function(e){var t=en(e,"x","cosh");return We.runKernelFunc(function(e,n){var r=e.cosh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}})}}),Ns=fn({erf_:function(e){var t=en(e,"x","erf");return O("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),We.runKernelFunc(function(e,n){var r=e.erf(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Rs=fn({exp_:function(e){var t=en(e,"x","exp");return We.runKernelFunc(function(e,n){var r=e.exp(t);return n([r]),r},{x:t},function(e,t){return{x:function(){return e.mulStrict(t[0])}}},"Exp",{},[],[!0])}}),As=fn({expm1_:function(e){var t=en(e,"x","expm1");return We.runKernelFunc(function(e,n){var r=e.expm1(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}})}}),Ds=fn({floor_:function(e){var t=en(e,"x","floor");return We.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Os=fn({log_:function(e){var t=en(e,"x","log"),n=[t];return We.runKernelFunc(function(e,n){var r=e.log(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}},"Log",{},n)}}),Ps=fn({log1p_:function(e){var t=en(e,"x","log1p");return We.runKernelFunc(function(e,n){var r=e.log1p(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}})}}),Fs=fn({logSigmoid_:function(e){var t=en(e,"x","logSigmoid");return We.runKernelFunc(function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}})}}),Ms=fn({neg_:function(e){var t=en(e,"x","neg"),n=[t];return We.runKernelFunc(function(e){return e.neg(t)},{x:t},function(e){return{x:function(){return e.neg()}}},"Neg",{},n)}}),Ls=fn({reciprocal_:function(e){var t=en(e,"x","reciprocal");return We.runKernelFunc(function(e,n){var r=e.reciprocal(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}})}}),Bs=fn({round_:function(e){var t=en(e,"x","round");return We.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Us=fn({rsqrt_:function(e){var t=en(e,"x","rsqrt"),n=[t];return We.runKernelFunc(function(e,n){var r=e.rsqrt(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),zs=fn({sigmoid_:function(e){var t=en(e,"x","sigmoid");return We.runKernelFunc(function(e,n){var r=e.sigmoid(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(bn(1).sub(n)))}}},"Sigmoid")}}),Vs=fn({sign_:function(e){var t=en(e,"x","sign");return We.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),js=fn({isNaN_:function(e){var t=en(e,"x","isNaN");return We.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Ws=fn({isInf_:function(e){var t=en(e,"x","isInf");return We.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Gs=fn({isFinite_:function(e){var t=en(e,"x","isFinite");return We.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return Nn(e)}}})}}),Hs=fn({sin_:function(e){var t=en(e,"x","sin"),n=[t];return We.runKernelFunc(function(e,n){var r=e.sin(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}},"Sin",{},n)}}),qs=fn({sinh_:function(e){var t=en(e,"x","sinh");return We.runKernelFunc(function(e,n){var r=e.sinh(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}})}}),Ks=fn({softplus_:function(e){var t=en(e,"x","softplus");return We.runKernelFunc(function(e,n){var r=e.softplus(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}})}}),Xs=fn({sqrt_:function(e){var t=en(e,"x","sqrt");return We.runKernelFunc(function(e,n){var r=e.sqrt(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}})}}),Qs=fn({step_:function(e,t){void 0===t&&(t=0);var n=en(e,"x","step");return We.runKernelFunc(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return Nn(e)}}})}}),Ys=fn({tan_:function(e){var t=en(e,"x","tan");return We.runKernelFunc(function(e,n){var r=e.tan(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}})}}),$s=fn({tanh_:function(e){var t=en(e,"x","tanh");return We.runKernelFunc(function(e,n){var r=e.tanh(t);return n([r]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return bn(1).sub(n.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Js(e,t,n,r,o,i){var a,s,u=en(e,"x","batchNorm"),c=en(t,"mean","batchNorm"),l=en(n,"variance","batchNorm");return null!=o&&(a=en(o,"scale","batchNorm")),null!=r&&(s=en(r,"offset","batchNorm")),O(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),O(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),O(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&O(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&O(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),tu(u,c,l,s,a,i)}function Zs(e,t,n,r,o,i){var a,s,u=en(e,"x","batchNorm"),c=en(t,"mean","batchNorm"),l=en(n,"variance","batchNorm");return null!=o&&(a=en(o,"scale","batchNorm")),null!=r&&(s=en(r,"offset","batchNorm")),O(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),O(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),O(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&O(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&O(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),tu(u,c,l,s,a,i)}function eu(e,t,n,r,o,i){var a,s,u=en(e,"x","batchNorm"),c=en(t,"mean","batchNorm"),l=en(n,"variance","batchNorm");return null!=o&&(a=en(o,"scale","batchNorm")),null!=r&&(s=en(r,"offset","batchNorm")),O(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),O(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),O(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&O(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&O(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),tu(u,c,l,s,a,i)}function tu(e,t,n,r,o,i){null==i&&(i=.001);var a,s,u,c=en(e,"x","batchNorm"),l=en(t,"mean","batchNorm"),h=en(n,"variance","batchNorm");null!=o&&(a=en(o,"scale","batchNorm")),null!=r&&(s=en(r,"offset","batchNorm")),O(l.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),O(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),O(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,h,a];return We.runKernelFunc(function(e,t){var n=e.batchNormalization(u,nu(l),nu(h),i,nu(a),nu(s));return t([c,l,h,a]),n},{x:c,mean:l,variance:h,scale:a,offset:s},function(e,t){var n=t,r=n[0],o=n[1],a=n[2],s=n[3],c=null==s?bn(1):s,l=Hr(o.shape,u.shape),h=[];if(1===o.rank){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var f=r.sub(o),p=e.mul(c),m=Us(a.add(bn(i))),g=m.mul(m).mul(m).mul(bn(-.5));return{x:function(){return 1===o.rank?e.mul(yr(m.as4D(1,1,1,o.shape[0]),h)).mul(c).reshape(r.shape):e.mul(m).mul(c).reshape(r.shape)},mean:function(){var e=m.mul(bn(-1)).mul(p);return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)},variance:function(){var e=g.mul(f).mul(p);return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)},scale:function(){var t=f.mul(m),n=e.mul(t);return 1===o.rank&&(n=n.sum(l)),n.reshape(o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(c.shape)}function nu(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function ru(){Xt("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var ou=fn({batchNormalization2d_:function(e,t,n,r,o,i){return void 0===r&&(r=.001),ru(),Js(e,t,n,i,o,r)}}),iu=fn({batchNormalization3d_:function(e,t,n,r,o,i){return void 0===r&&(r=.001),ru(),Zs(e,t,n,i,o,r)}}),au=fn({batchNormalization4d_:function(e,t,n,r,o,i){return void 0===r&&(r=.001),ru(),eu(e,t,n,i,o,r)}}),su=fn({batchNormalization_:function(e,t,n,r,o,i){return void 0===r&&(r=.001),ru(),tu(e,t,n,i,o,r)}}),uu=fn({batchNorm_:tu}),cu=fn({batchNorm2d_:Js}),lu=fn({batchNorm3d_:Zs}),hu=fn({batchNorm4d_:eu}),du=fn({logicalAnd_:function(e,t){var n=en(e,"a","logicalAnd","bool"),r=en(t,"b","logicalAnd","bool");return qr(n.shape,r.shape),We.runKernelFunc(function(e){return e.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),fu=fn({logicalNot_:function(e){var t=en(e,"x","logicalNot","bool");return We.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),pu=fn({logicalOr_:function(e,t){var n=en(e,"a","logicalOr","bool"),r=en(t,"b","logicalOr","bool");return qr(n.shape,r.shape),We.runKernelFunc(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),mu=fn({logicalXor_:function(e,t){var n=en(e,"a","logicalXor","bool"),r=en(t,"b","logicalXor","bool");return qr(n.shape,r.shape),pu(e,t).logicalAnd(du(e,t).logicalNot())}}),gu=fn({where_:function(e,t,n){var r=en(t,"a","where"),o=en(n,"b","where"),i=en(e,"condition","where","bool");return P(r.shape,o.shape,"Error in where: "),1===i.rank?O(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):P(i.shape,o.shape,"Error in where: "),We.runKernelFunc(function(e,t){var n=e.select(i,r,o);return t([i]),n},{$condition:i,$a:r,$b:o},function(e,t){var n=t[0];return{$condition:function(){return Nn(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}})}}),vu=function(e){return v(this,void 0,void 0,function(){var t,n,r;return y(this,function(o){switch(o.label){case 0:return[4,(t=en(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Co(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},yu=fn({add_:function(e,t){var n,r=en(e,"a","add"),o=en(t,"b","add");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e){return e.add(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=Hr(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Hr(o.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(o.shape)}}},"Add")}}),bu=fn({addN_:function(e){O(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),O(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return en(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!B(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return We.runKernelFunc(function(e){return e.addN(t)},r,function(e){var n={};return t.forEach(function(t,r){n[r]=function(){return e.clone()}}),n},"AddN")}}),wu=fn({addStrict_:function(e,t){var n=en(e,"a","addStrict"),r=en(t,"b","addStrict");return P(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),xu=fn({atan2_:function(e,t){var n,r=en(e,"a","atan2"),o=en(t,"b","atan2");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e,t){var n=e.atan2(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=yu(n.square(),r.square()),o=e.mul(r.div(t)),a=Hr(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},$b:function(){var t=yu(n.square(),r.square()),o=Ms(e.mul(n.div(t))),a=Hr(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}})}}),Eu=fn({div_:function(e,t){var n,r=en(e,"a","div"),o=en(t,"b","div");if(n=Le(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return ku(r,o);var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e,t){var n=e.realDivide(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=Hr(n.shape,i);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Hr(r.shape,i);o.length>0&&(t=t.sum(o).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}},"Div")}}),_u=fn({divNoNan_:function(e,t){var n,r=en(e,"a","div"),o=en(t,"b","div");r=(n=Le(r,o))[0],o=n[1];var i=Eu(r,o),a=Nn(i),s=o.equal(a);return gu(s,a,i)}}),Cu=fn({divStrict_:function(e,t){var n=en(e,"a","div"),r=en(t,"b","div");return P(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),ku=fn({floorDiv_:function(e,t){var n,r=en(e,"a","floorDiv"),o=en(t,"b","floorDiv");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e,t){var n=e.floorDiv(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),o=Hr(n.shape,i);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Hr(r.shape,i);o.length>0&&(t=t.sum(o).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}},"FloorDiv")}}),Su=fn({maximum_:function(e,t){var n,r=en(e,"a","maximum"),o=en(t,"b","maximum");return n=Le(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),qr(r.shape,o.shape),We.runKernelFunc(function(e,t){var n=e.maximum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}},"Maximum")}}),Iu=fn({maximumStrict_:function(e,t){var n=en(e,"a","maximumStrict"),r=en(t,"b","maximumStrict");return P(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Tu=fn({minimum_:function(e,t){var n,r=en(e,"a","minimum"),o=en(t,"b","minimum");return n=Le(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),qr(r.shape,o.shape),We.runKernelFunc(function(e,t){var n=e.minimum(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}},"Minimum")}}),Nu=fn({minimumStrict_:function(e,t){var n=en(e,"a","minimumStrict"),r=en(t,"b","minimumStrict");return P(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Ru=fn({mod_:function(e,t){var n,r=en(e,"a","mod"),o=en(t,"b","mod");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e,t){var n=e.mod(r,o);return t([r,o]),n},{$a:r,$b:o},function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Hr(n.shape,i);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),o=Hr(r.shape,i);return o.length>0?t.sum(o).reshape(r.shape):t}}})}}),Au=fn({modStrict_:function(e,t){var n=en(e,"a","modStrict"),r=en(t,"b","modStrict");return P(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Du=fn({mul_:function(e,t){var n,r=en(e,"a","mul"),o=en(t,"b","mul");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e,t){var n=e.multiply(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),o=Hr(n.shape,i);return o.length>0?t.sum(o).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),o=Hr(r.shape,i);return o.length>0?t.sum(o).reshape(r.shape):t}}},"Mul")}}),Ou=fn({mulStrict_:function(e,t){var n=en(e,"a","mul"),r=en(t,"b","mul");return P(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Pu=fn({pow_:function(e,t){var n,r=en(e,"base","pow"),o=en(t,"exp","pow");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape),a=[r,o];return We.runKernelFunc(function(e,t){var n=e.pow(r,o);return t([r,o,n]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1],o=t[2];return{a:function(){var t=r.toFloat(),o=e.mul(t.mul(n.pow(t.sub(bn(1))))),a=Hr(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},b:function(){var t=n.greater(0),a=n.log().where(t,Nn(n)),s=e.mul(o.mul(a)),u=Hr(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},a,[!0])}}),Fu=fn({powStrict_:function(e,t){return P(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Mu=fn({squaredDifferenceStrict_:function(e,t){var n=en(e,"a","squaredDifferenceStrict"),r=en(t,"b","squaredDifferenceStrict");return P(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Lu=fn({sub_:function(e,t){var n,r=en(e,"a","sub"),o=en(t,"b","sub");n=Le(r,o),r=n[0],o=n[1];var i=qr(r.shape,o.shape);return We.runKernelFunc(function(e){return e.subtract(r,o)},{a:r,b:o},function(e){return{a:function(){var t=e,n=Hr(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Hr(o.shape,i);return n.length>0&&(t=t.sum(n)),t.neg().reshape(o.shape)}}},"Sub")}}),Bu=fn({subStrict_:function(e,t){var n=en(e,"a","subStrict"),r=en(t,"b","subStrict");return P(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Uu=fn({equal_:function(e,t){var n,r=en(e,"a","equal"),o=en(t,"b","equal");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e){return e.equal(r,o)},{$a:r,$b:o})}}),zu=fn({equalStrict_:function(e,t){var n=en(e,"a","equalStrict"),r=en(t,"b","equalStrict");return P(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Vu=fn({greater_:function(e,t){var n,r=en(e,"a","greater"),o=en(t,"b","greater");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e){return e.greater(r,o)},{a:r,b:o},null,"Greater")}}),ju=fn({greaterEqual_:function(e,t){var n,r=en(e,"a","greaterEqual"),o=en(t,"b","greaterEqual");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e,t){var n=e.greaterEqual(r,o);return t([r,o]),n},{a:r,b:o},function(e,t){var n=t[0],r=t[1];return{a:function(){return Nn(n)},b:function(){return Nn(r)}}},"GreaterEqual")}}),Wu=fn({greaterEqualStrict_:function(e,t){var n=en(e,"a","greaterEqualStrict"),r=en(t,"b","greaterEqualStrict");return P(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Gu=fn({greaterStrict_:function(e,t){var n=en(e,"a","greaterStrict"),r=en(t,"b","greaterStrict");return P(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Hu=fn({less_:function(e,t){var n,r=en(e,"a","less"),o=en(t,"b","less");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e){return e.less(r,o)},{a:r,b:o},null,"Less")}}),qu=fn({lessEqual_:function(e,t){var n,r=en(e,"a","lessEqual"),o=en(t,"b","lessEqual");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e,t){var n=e.lessEqual(r,o);return t([r,o]),n},{a:r,b:o},null,"LessEqual")}}),Ku=fn({lessEqualStrict_:function(e,t){var n=en(e,"a","lessEqualStrict"),r=en(t,"b","lessEqualStrict");return P(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Xu=fn({lessStrict_:function(e,t){var n=en(e,"a","lessStrict"),r=en(t,"b","lessStrict");return P(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Qu=fn({notEqual_:function(e,t){var n,r=en(e,"a","notEqual"),o=en(t,"b","notEqual");return n=Le(r,o),r=n[0],o=n[1],qr(r.shape,o.shape),We.runKernelFunc(function(e){return e.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),Yu=fn({notEqualStrict_:function(e,t){var n=en(e,"a","notEqualStrict"),r=en(t,"b","notEqualStrict");return P(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function $u(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ju(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Zu=fn({gather_:function(e,t,n){void 0===n&&(n=0);var r=en(e,"x","gather"),o=en(t,"indices","gather","int32");n=H(n,r.shape)[0];var i=function(e,t,n){for(var r=e.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(e.shape[s]),i*=e.shape[s];for(s=0;s<t.rank;s++)o.push(t.shape[s]);for(s=n+1;s<e.rank;s++)o.push(e.shape[s]),a*=e.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return We.runKernelFunc(function(e,t){var i=e.gather(r,o.flatten(),n);return t([o]),i},{x:r,indices:o},function(e,t){var o=t[0];return{x:function(){var t=r.shape,i=o.size,a=t.slice(0,n),s=a.length,u=t.slice(n,t.length).slice(1),c=u.length,l=$u(0,s),h=$u(s+1,s+1+c),d=Ju([a,[i],u]),f=e.reshape(d),p=o.reshape([i]),m=Ju([[s],l,h]),g=f.transpose(m),v=ec(g,p,r.shape[n]),y=cn(m);return v.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(i.outputShape)}}),ec=fn({unsortedSegmentSum_:function(e,t,n){var r=en(e,"x","unsortedSegmentSum"),o=en(t,"segmentIds","unsortedSegmentSum","int32");return O(U(n),function(){return"numSegments must be of dtype int"}),We.runKernelFunc(function(e,t){var i=e.unsortedSegmentSum(r,o,n);return t([o]),i},{$x:r},function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Su(t,Nn(t)),r=Zu(e,n),o=ju(t,bn(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=tr(o,a+1);o=du(o,Cn(r.shape,"bool"));var s=Nn(r);return gu(o,r,s)}(e,n)}}})}});function tc(e,t,n,r,o,i,a){void 0===i&&(i="NHWC"),O(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),O(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),O(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),O(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];O(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),O(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&O(U(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=oo(i),f=Qr(s,n.shape,r,1,o,a,!1,d),p=We.runKernelFunc(function(e,t){var r=e.conv2dDerInput(u,n,f);return t([n,u]),r},{dy4D:u,filter:n},function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return ic(e,n,r,o,i,1,a)},filter:function(){return sc(e,s,n.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function nc(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e),n=t[0],r=t[1],o=t[2];return 1===n&&1===r&&1===o}function rc(e,t,n,r,o){O(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,a=t,s=!1;4===t.rank&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=a.shape[4];O(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),O(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),O(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),O(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),O(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=Yr(i,n.shape,r,1,o),h=We.runKernelFunc(function(e){return e.conv3dDerInput(a,n,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var oc=fn({conv1d_:function(e,t,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=en(e,"x","conv1d"),u=en(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),O(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),O(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&O(U(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),O(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),O(ro(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),O("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=ic(d,h,[1,n],r,"NHWC",[1,i],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),ic=fn({conv2d_:function(e,t,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=en(e,"x","conv2d"),u=en(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),O(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&O(U(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h="NHWC"===o?c.shape[3]:c.shape[1];O(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),O(ro(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var d=oo(o),f=Qr(c.shape,u.shape,n,i,r,a,!1,d),p=[u,c],m=We.runKernelFunc(function(e,t){var n=e.conv2d(c,u,f);return t([u,c]),n},{x:c,filter:u},function(e,t){var a=t,s=a[0],u=a[1];return O(no(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return uc(u.shape,e,s,n,r,o)},filter:function(){return sc(u,e,s.shape,n,r,o)}}},"Conv2D",f,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),ac=fn({conv3d_:function(e,t,n,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var a=en(e,"x","conv3d"),s=en(t,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),O(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),O(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),O(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),O(function(e,t){return nc(e)||nc(t)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),O("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=Yr(u.shape,s.shape,n,i,r),h=We.runKernelFunc(function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n},{x:u,$filter:s},function(e,t){O(nc(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var o=t[0],a=t[1];return{x:function(){return rc(o.shape,e,a,n,r)},$filter:function(){return function(e,t,n,r,o){var i=e;4===e.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var a=t;4===a.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),O(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),O(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),O(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),O(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),O(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=Yr(i.shape,n,r,1,o);return We.runKernelFunc(function(e){return e.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(o,e,a.shape,n,r)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),sc=fn({conv2dDerFilter_:function(e,t,n,r,o,i,a){void 0===i&&(i="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),O(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),O(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),O(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];O(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),O(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),null!=a&&O(U(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=oo(i),d=Qr(s.shape,n,r,1,o,a,!1,h);return We.runKernelFunc(function(e){return e.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),uc=fn({conv2dDerInput_:tc}),cc=fn({depthwiseConv2d_:function(e,t,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=en(e,"x","depthwiseConv2d"),u=en(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),O(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),O(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),O(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),O(ro(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=a&&O(U(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=Qr(c.shape,u.shape,n,i,r,a,!0),d=[c,u],f=We.runKernelFunc(function(e,t){var n=e.depthwiseConv2D(c,u,h);return t([c,u]),n},{x:c,filter:u},function(e,t){O(no(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=t[0],r=t[1];return{x:function(){return lc(n.shape,e,r,h)},filter:function(){return hc(n,e,r.shape,h)}}},"DepthwiseConv2dNative",h,d);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),lc=fn({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,i=!1;3===t.rank&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=We.runKernelFunc(function(e){return e.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),hc=fn({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;3===e.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),We.runKernelFunc(function(e){return e.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),dc=fn({separableConv2d_:function(e,t,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=en(e,"x","separableConv2d"),u=en(t,"depthwiseFilter","separableConv2d"),c=en(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),O(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),O(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),O(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),O(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],f=u.shape[3];O(c.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."});var p=cc(l,u,r,o,a,i),m=ic(p,c,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),fc=fn({conv2dTranspose_:function(e,t,n,r,o,i){return tc(n,en(e,"x","conv2dTranspose"),en(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),pc=fn({conv3dTranspose_:function(e,t,n,r,o){return rc(n,en(e,"x","conv3dTranspose"),en(t,"filter","conv3dTranspose"),r,o)}}),mc=fn({matMul_:function(e,t,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=en(e,"a","matMul"),a=en(t,"b","matMul");o=Le(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=i.shape.slice(0,-2),d=a.shape.slice(0,-2),f=L(h),p=L(d);O(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),O(B(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),O(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=i.shape.slice(0,-2).concat([c,l]),g=n?i.as3D(f,s,c):i.as3D(f,c,s),v=r?a.as3D(p,l,u):a.as3D(p,u,l),y={transposeA:n,transposeB:r};return We.runKernelFunc(function(e,t){var o=e.batchMatMul(g,v,n,r);return t([g,v]),o},{a:g,b:v},function(e,t){var o=t,i=o[0],a=o[1];return n||r?!n&&r?{a:function(){return e.matMul(a,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return a.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return a.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(a,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),gc=fn({dot_:function(e,t){var n=en(e,"t1","dot"),r=en(t,"t2","dot");O(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return O(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),vc=fn({outerProduct_:function(e,t){var n=en(e,"v1","outerProduct"),r=en(t,"v2","outerProduct");return O(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),yc=fn({reverse_:function(e,t){var n=en(e,"x","reverse");if(0===n.rank)return n.clone();var r=H(t,n.shape);return We.runKernelFunc(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),bc=fn({reverse1d_:function(e){var t=en(e,"x","reverse");return O(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),yc(t,0)}}),wc=fn({reverse2d_:function(e,t){var n=en(e,"x","reverse");return O(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),yc(n,t)}}),xc=fn({reverse3d_:function(e,t){var n=en(e,"x","reverse");return O(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),yc(n,t)}}),Ec=fn({reverse4d_:function(e,t){var n=en(e,"x","reverse");return O(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),yc(n,t)}});function _c(e,t,n,r,o,i){var a=en(e,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),O(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),O(ro(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&O(U(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Kr(s.shape,t,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&B(c.inShape,c.outShape))return a.clone();var l=[s],h=We.runKernelFunc(function(e,t){var n=e.maxPool(s,c);return t([s,n]),n},{x:s},function(e,i){var a=i[0],s=i[1];return{x:function(){return function(e,t,n,r,o,i,a,s){var u=en(e,"dy","maxPoolBackprop"),c=en(t,"input","maxPoolBackprop"),l=en(n,"output","maxPoolBackprop");O(c.rank===u.rank,function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),O(ro(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),O(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),O(4===c.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."});var h=Kr(c.shape,r,o,i,a,s);return We.runKernelFunc(function(e){return e.maxPoolBackprop(u,c,l,h)},{$dy:u,$input:c})}(e,a,s,t,n,r,o)}}},"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Cc(e,t,n,r,o,i){var a=en(e,"x","avgPool","float32");null==r&&(r=[1,1]),O(ro(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),O(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&O(U(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=Kr(s.shape,t,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&B(c.inShape,c.outShape))return a.clone();var l=We.runKernelFunc(function(e){return e.avgPool(s,c)},{x:s},function(e){return{x:function(){return function(e,t,n,r,o,i){var a=en(e,"dy","avgPoolBackprop"),s=en(t,"input","avgPoolBackprop");O(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),O(ro(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),O(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),O(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var h=Kr(u.shape,n,r,o,i),d=We.runKernelFunc(function(e){return e.avgPoolBackprop(c,u,h)},{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(e,s,t,n,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var kc=fn({maxPool_:function(e,t,n,r,o){return _c(e,t,n,1,r,o)}}),Sc=fn({avgPool_:function(e,t,n,r,o){return Cc(e,t,n,1,r,o)}}),Ic=fn({pool_:function(e,t,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=en(e,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),O(ro(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,l=Kr(s.shape,t,i,o,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map(function(e,n){return e+(e-1)*(t[n]-1)}).map(function(e){return e-1}),r=n.map(function(e){return Math.floor(e/2)}),o=n.map(function(e,t){return e-r[t]});return n.map(function(e,t){return[r[t],o[t]]})}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=function(e,t,n){var r=n.map(function(e){return e[0]}),o=n.map(function(e){return e[1]}),i=e.concat(r,o),a=t.map(function(e,t){return(e-i[t]%e)%e}),s=o.map(function(e,t){return e+a[t]});return[t.map(function(e,t){return[r[t],s[t]]}),t.map(function(e,t){return[0,a[t]]})]}([l.inHeight,l.inWidth],h,c),p=f[0],m=f[1],g=d?r:"valid",v=d?s:mr(s,h,p),y=("avg"===n?function(){return Cc(v,t,i,1,g)}:function(){return _c(v,t,i,1,g)})(),b=d?y:Qn(y,h,m);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Tc=fn({maxPool3d_:function(e,t,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=en(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),O(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),O("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),O(ro(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&O(U(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Xr(u.shape,t,n,a,r,o,i),h=We.runKernelFunc(function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n},{x:u},function(e,i){var s=i[0],u=i[1];return{x:function(){return function(e,t,n,r,o,i,a,s){var u=en(e,"dy","maxPool3dBackprop"),c=en(t,"input","maxPool3dBackprop"),l=en(n,"output","maxPool3dBackprop"),h=u,d=c,f=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),O(5===h.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."}),O(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),O(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),null==i&&(i=[1,1,1]),O(ro(o,i),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),null!=s&&O(U(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var m=Xr(d.shape,r,o,i,a,s),g=We.runKernelFunc(function(e){return e.maxPool3dBackprop(h,d,f,m)},{dy5D:h,input5D:d});return p?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(e,s,u,t,n,a,r,o)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Nc=fn({avgPool3d_:function(e,t,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=en(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),O(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),O("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),O(ro(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&O(U(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Xr(u.shape,t,n,a,r,o,i),h=We.runKernelFunc(function(e){return e.avgPool3d(u,l)},{x:u},function(e){return{x:function(){return function(e,t,n,r,o,i,a){var s=en(e,"dy","avgPool3dBackprop"),u=en(t,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),O(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),O(5===l.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."}),null==o&&(o=[1,1,1]),O(ro(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=a&&O(U(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=Xr(l.shape,n,r,o,i,a),f=We.runKernelFunc(function(e){return e.avgPool3dBackprop(c,l,d)},{dy5D:c,input5D:l});return h?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(e,u,t,n,a,r,o)}}});return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Rc=fn({slice_:function(e,t,n){var r,o,i=en(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(e){O(-1!==e,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(e,t){return e>=0?e:(O(-1===e,function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."}),i.shape[t]-r[t])}),Ar(i,r,o);var a=i.shape,s={begin:r,size:o};return We.runKernelFunc(function(e){return e.slice(i,r,o)},{x:i},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],a[n]-r[n]-o[n]]);return{x:function(){return e.pad(t)}}},"Slice",s)}}),Ac=fn({slice1d_:function(e,t,n){var r=en(e,"x","slice1d");return O(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Rc(r,[t],[n])}}),Dc=fn({slice2d_:function(e,t,n){var r=en(e,"x","slice2d");return O(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Rc(r,t,n)}}),Oc=fn({slice3d_:function(e,t,n){var r=en(e,"x","slice3d");return O(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Rc(r,t,n)}}),Pc=fn({slice4d_:function(e,t,n){var r=en(e,"x","slice4d");return O(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Rc(r,t,n)}});function Fc(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(an(t.shape,r))),e.rank<n.rank&&(e=e.reshape(an(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==o?r:r.transpose(o)}}}var Mc=fn({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","all","bool"),o=H(t,r.shape),i=o,a=un(i,r.rank);null!=a&&(r=r.transpose(a),i=ln(i.length,r.rank));var s=We.runKernelFunc(function(e){return e.all(r,i)},{$x:r});if(n){var u=an(s.shape,o);return s.reshape(u)}return s}}),Lc=fn({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","any","bool"),o=H(t,r.shape),i=o,a=un(i,r.rank);null!=a&&(r=r.transpose(a),i=ln(i.length,r.rank));var s=We.runKernelFunc(function(e){return e.any(r,i)},{$x:r});if(n){var u=an(s.shape,o);return s.reshape(u)}return s}}),Bc=fn({argMax_:function(e,t){void 0===t&&(t=0);var n=en(e,"x","argMax");null==t&&(t=0);var r=H(t,n.shape),o=un(r,n.rank);null!=o&&(n=n.transpose(o),r=ln(r.length,n.rank));var i={axis:r[0]},a=[n];return We.runKernelFunc(function(e,t){var o=e.argMax(n,r[0]);return t([n]),o},{x:n},function(e,t){var n=t[0];return{x:function(){return Nn(n)}}},"ArgMax",i,a)}}),Uc=fn({argMin_:function(e,t){void 0===t&&(t=0);var n=en(e,"x","argMin");null==t&&(t=0);var r=H(t,n.shape),o=un(r,n.rank);return null!=o&&(n=n.transpose(o),r=ln(r.length,n.rank)),We.runKernelFunc(function(e,t){var o=e.argMin(n,r[0]);return t([n]),o},{$x:n},function(e,t){var n=t[0];return{$x:function(){return Nn(n)}}})}}),zc=fn({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","logSumExp"),o=H(t,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=an(s.shape,o);return s.reshape(u)}return s}}),Vc=fn({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","max"),o=r,i=H(t,r.shape),a=i,s=un(a,r.rank);null!=s&&(r=r.transpose(s),a=ln(a.length,r.rank));var u=[r],c=We.runKernelFunc(function(e,t){var n=e.max(r,a);return t([o,n]),n},{x:r},function(e,t){return Fc(e,t[1],t[0],i,s)},"Max",{axes:a},u,[!0]);if(n){var l=an(c.shape,i);c=c.reshape(l)}return c}}),jc=fn({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","mean"),o=H(t,r.shape),i=L(on(r.shape,o)[1]);return Br(function(e){var r=bn(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Cn(e.shape,"float32")).div(i)}}})(r)}}),Wc=fn({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","min"),o=r,i=H(t,r.shape),a=i,s=un(a,r.rank);null!=s&&(r=r.transpose(s),a=ln(a.length,r.rank));var u=[r],c=We.runKernelFunc(function(e,t){var n=e.min(r,a);return t([o,n]),n},{x:r},function(e,t){return Fc(e,t[1],t[0],i,s)},"Min",{axes:a},u,[!0]);if(n){var l=an(c.shape,i);c=c.reshape(l)}return c}}),Gc=fn({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=H(t,(e=en(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;n||(i=an(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),Hc=fn({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=H(t,r.shape);return Br(function(e){var t=un(o,e.rank),r=o,i=e;null!=t&&(i=e.transpose(t),r=ln(r.length,e.rank));var a=function(t){var n=e.shape.slice();return o.forEach(function(e){n[e]=1}),t.reshape(n).mul(Cn(e.shape,"float32"))},s={axes:r},u=We.runKernelFunc(function(e){return e.sum(i,r)},{x:i},function(e){return{x:function(){return a(e)}}},"Sum",s);if(n){var c=an(u.shape,o);u=u.reshape(c)}return{value:u,gradFunc:a}})(r)}}),qc=fn({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=en(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=H(t,r.shape),i=un(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=ln(a.length,r.rank));var u=We.runKernelFunc(function(e){return e.prod(s,a)},{permutedX:s});if(n){var c=an(u.shape,o);u=u.reshape(c)}return u}}),Kc=fn({elu_:function(e){var t=en(e,"x","elu");return We.runKernelFunc(function(e,n){var r=e.elu(t);return n([r]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){return We.runKernelFunc(function(t){return t.eluDer(e,n)},{dy:e,y:n})}}})}}),Xc=fn({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=en(e,"x","leakyRelu");return Su(bn(t).mul(n),n)}}),Qc=fn({prelu_:function(e,t){var n=en(e,"x","prelu"),r=en(t,"alpha","prelu");return We.runKernelFunc(function(e,t){var o=e.prelu(n,r);return t([n,r]),o},{x:n,alpha:r},function(e,t){var n=t[0],r=t[1],o=n.greater(0);return{x:function(){return gu(o,e,e.mul(r))},alpha:function(){var t=gu(o,Nn(e),e.mul(n)),i=Hr(r.shape,e.shape);return i.length>0&&(t=t.sum(i)),t.reshape(r.shape)}}},"Prelu")}}),Yc=fn({relu_:function(e){var t=en(e,"x","relu");return"bool"===t.dtype?t.toInt():We.runKernelFunc(function(e,n){var r=e.relu(t);return n([t]),r},{x:t},function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}},"Relu")}}),$c=fn({relu6_:function(e){var t=en(e,"x","relu6");return"bool"===t.dtype?t.toInt():We.runKernelFunc(function(e,n){var r=e.relu6(t);return n([t]),r},{x:t},function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}},"Relu6")}}),Jc=fn({selu_:function(e){var t=en(e,"x","selu");return We.runKernelFunc(function(e,n){var r=e.selu(t);return n([t]),r},{$x:t},function(e,t){var n=t[0];return{$x:function(){var t=n.greater(bn(0)),r=bn(Ba),o=bn(Ua),i=e.mul(o),a=e.mul(r).mul(n.toFloat().exp());return gu(t,i,a)}}})}}),Zc=fn({transpose_:function(e,t){var n=en(e,"x","transpose");if(null==t&&(t=n.shape.map(function(e,t){return t}).reverse()),O(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(e){O(e>=0&&e<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return We.runKernelFunc(function(e){return e.transpose(n,t)},{x:n},function(e){var n=cn(t);return{x:function(){return e.transpose(n)}}},"Transpose",r)}}),el=fn({localResponseNormalization_:function(e,t,n,r,o){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=en(e,"x","localResponseNormalization");O(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),O(U(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=We.runKernelFunc(function(e,i){var s=e.localResponseNormalization4D(a,t,n,r,o);return i([a,s]),s},{x4D:a},function(e,i){var a=i[0],s=i[1];return{x4D:function(){return We.runKernelFunc(function(i){return i.LRNGrad(e,a,s,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),tl=fn({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(bn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=en(e,"x","norm"),t,n),i=o.shape;if(r){var a=H(n,e.shape);i=an(o.shape,a)}return o.reshape(i)}}),nl=fn({basicLSTMCell_:function(e,t,n,r,o,i){var a=en(e,"forgetBias","basicLSTMCell"),s=en(t,"lstmKernel","basicLSTMCell"),u=en(n,"lstmBias","basicLSTMCell"),c=en(r,"data","basicLSTMCell"),l=en(o,"c","basicLSTMCell"),h=en(i,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),v=d.slice([0,p],m),y=d.slice([0,2*p],m),b=d.slice([0,3*p],m),w=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid())),x=w.tanh().mulStrict(b.sigmoid());return[w,x]}}),rl=fn({multiRNNCell_:function(e,t,n,r){for(var o=en(t,"data","multiRNNCell"),i=tn(n,"c","multiRNNCell"),a=tn(r,"h","multiRNNCell"),s=o,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),ol=fn({movingAverage_:function(e,t,n,r,o){void 0===o&&(o=!0);var i=en(e,"v","movingAverage"),a=en(t,"x","movingAverage"),s=en(n,"decay","movingAverage");Be(i,a),O(B(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=bn(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){O(null!=r,function(){return"When using zeroDebias: true, step is required."});var h=en(r,"step","movingAverage");l=l.div(u.sub(Pu(s,h)))}return i.add(l)}}),il=fn({stridedSlice_:function(e,t,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=en(e,"x","stridedSlice"),l=Dr(s),h=c.shape.slice();l.forEach(function(e){t[e]=0,n[e]=1,h.splice(e,0,1)}),c=c.reshape(h);for(var d=0;d<c.rank;d++)t[d]=Pr(o,t,r,c.shape,d),n[d]=Fr(i,n,r,c.shape,d),r[d]=r[d]||1;var f=Dr(u);f.forEach(function(e){n[e]=t[e]+1,r[e]=1});var p=Or(t,n,r),m=p.filter(function(e,t){return-1===f.indexOf(t)});return r.every(function(e){return 1===e})?Rc(c,t,p).reshape(m):We.runKernelFunc(function(e){return e.stridedSlice(c,t,n,r)},{$x:c}).reshape(m)}}),al=fn({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=en(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=We.runKernelFunc(function(e){return e.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),sl=fn({scatterND_:function(e,t,n){var r=en(e,"indices","scatterND","int32"),o=en(t,"updates","scatterND");return Nr(o,r,n),We.runKernelFunc(function(e){return e.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),ul=fn({fft_:function(e){O("complex64"===e.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc(function(e){return e.fft(r)},{input:e}).reshape(e.shape)}}),cl=fn({ifft_:function(e){O("complex64"===e.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return We.runKernelFunc(function(e){return e.ifft(r)},{input:e}).reshape(e.shape)}}),ll=fn({rfft_:function(e,t){O("float32"===e.dtype,function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(null!=t&&t<r){var i=e.shape.map(function(e){return 0}),a=e.shape.map(function(e){return e});a[e.shape.length-1]=t,n=e.slice(i,a),r=t}else if(null!=t&&t>r){var s=e.shape.map(function(e){return e});s[e.shape.length-1]=t-r,n=e.concat(kn(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=pn(n,u).as2D(o,r),l=ul(c),h=Math.floor(r/2)+1,d=mn(l),f=gn(l),p=d.split([h,r-h],d.shape.length-1),m=f.split([h,r-h],f.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=h,pn(p[0],m[0]).reshape(g)}}),hl=fn({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=cl(r);return mn(o)}var i=[n,2*(t-1)],a=mn(e).as2D(n,t),s=gn(e).as2D(n,t),u=a.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(bn(-1)),l=a.concat(u,1),h=s.concat(c,1);return r=pn(l,h).as2D(i[0],i[1]),o=cl(r),mn(o)}}),dl=Object.freeze({fft:ul,ifft:cl,rfft:ll,irfft:hl}),fl=fn({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var o=en(e,"sparseIndices","sparseToDense","int32"),i=en(t,"sparseValues","sparseToDense"),a=en(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var o=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var a=t.size;if(0!==t.rank&&(1!==t.rank||a!==o))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+o+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),We.runKernelFunc(function(e){return e.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),pl=fn({gatherND_:function(e,t){var n=en(t,"indices","gatherND","int32"),r=en(e,"x","gatherND");return We.runKernelFunc(function(e){return e.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),ml=fn({diag_:function(e){var t=en(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return We.runKernelFunc(function(e){return e.diag(t)},{$x:t}).reshape(n)}}),gl=fn({dropout_:function(e,t,n,r){var o=en(e,"x","dropout");if(O("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),O(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return e instanceof Ie?o.clone():o;var i=function(e,t){if(null==t)return e.shape.slice();if(B(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(o,n),a=1-t,s=fr(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function vl(e,t,n){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=t-n*Math.cos(a)}return wn(o,"float32")}var yl,bl=fn({hannWindow_:function(e){return vl(e,.5,.5)}}),wl=fn({hammingWindow_:function(e){return vl(e,.54,.46)}}),xl=fn({frame_:function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+t<=e.size;)a.push(Rc(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Rn([Rc(e,i,t-s),Sn([s],o)]);a.push(u),i+=n}return 0===a.length?xn([],[0,t]):Rn(a).as2D(a.length,t)}}),El=fn({stft_:function(e,t,n,r,o){var i;void 0===o&&(o=bl),null==r&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=xl(e,t,n),s=Du(a,o(t)),u=[],c=0;c<a.shape[0];c++)u.push(ll(s.slice([c,0],[1,t]),r));return Rn(u)}}),_l=Object.freeze({hannWindow:bl,hammingWindow:wl,frame:xl,stft:El});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(yl||(yl={}));var Cl=fn({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=yl.SUM_BY_NONZERO_WEIGHTS);var o=en(e,"labels","absoluteDifference"),i=en(t,"predictions","absoluteDifference"),a=null;null!=n&&(a=en(n,"weights","absoluteDifference")),P(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return kl(s,a,r)}}),kl=fn({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=yl.SUM_BY_NONZERO_WEIGHTS);var r=en(e,"losses","computeWeightedLoss"),o=null;null!=t&&(o=en(t,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===yl.NONE)return i;if(n===yl.SUM)return i.sum();if(n===yl.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(bn(a)):s}if(n===yl.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(bn(r.size));var u=o.mul(Cn(r.shape)).notEqual(bn(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Sl=fn({cosineDistance_:function(e,t,n,r,o){void 0===o&&(o=yl.SUM_BY_NONZERO_WEIGHTS);var i=en(e,"labels","cosineDistance"),a=en(t,"predictions","cosineDistance"),s=null;null!=r&&(s=en(r,"weights","cosineDistance")),P(i.shape,a.shape,"Error in cosineDistance: ");var u=bn(1).sub(i.mul(a).sum(n,!0));return kl(u,s,o)}}),Il=fn({hingeLoss_:function(e,t,n,r){void 0===r&&(r=yl.SUM_BY_NONZERO_WEIGHTS);var o=en(e,"labels","hingeLoss"),i=en(t,"predictions","hingeLoss"),a=null;null!=n&&(a=en(n,"weights","hingeLoss")),P(o.shape,i.shape,"Error in hingeLoss: ");var s=bn(1);o=bn(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return kl(u,a,r)}}),Tl=fn({huberLoss_:function(e,t,n,r,o){void 0===r&&(r=1),void 0===o&&(o=yl.SUM_BY_NONZERO_WEIGHTS);var i=en(e,"labels","huberLoss"),a=en(t,"predictions","huberLoss"),s=null;null!=n&&(s=en(n,"weights","huberLoss")),P(i.shape,a.shape,"Error in huberLoss: ");var u=bn(r),c=a.sub(i).abs(),l=Tu(c,u),h=c.sub(l),d=bn(.5).mul(l.square()).add(u.mul(h));return kl(d,s,o)}}),Nl=fn({logLoss_:function(e,t,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=yl.SUM_BY_NONZERO_WEIGHTS);var i=en(e,"labels","logLoss"),a=en(t,"predictions","logLoss"),s=null;null!=n&&(s=en(n,"weights","logLoss")),P(i.shape,a.shape,"Error in logLoss: ");var u=bn(1),c=bn(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return kl(l,s,o)}}),Rl=fn({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=yl.SUM_BY_NONZERO_WEIGHTS);var o=en(e,"labels","meanSquaredError"),i=en(t,"predictions","meanSquaredError"),a=null;null!=n&&(a=en(n,"weights","meanSquaredError")),P(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return kl(s,a,r)}}),Al=fn({sigmoidCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=yl.SUM_BY_NONZERO_WEIGHTS);var i=en(e,"multiClassLabels","sigmoidCrossEntropy"),a=en(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=en(n,"weights","sigmoidCrossEntropy")),P(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var h=function(e,t){var n=en(e,"labels","sigmoidCrossEntropyWithLogits"),r=en(t,"logits","sigmoidCrossEntropyWithLogits");P(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return kl(h,s,o)}}),Dl=fn({softmaxCrossEntropy_:function(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=yl.SUM_BY_NONZERO_WEIGHTS);var i=en(e,"onehotLabels","softmaxCrossEntropy"),a=en(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=en(n,"weights","softmaxCrossEntropy")),P(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var h=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return Br(function(e,t,r){var o=t.logSumExp([n],!0),i=t.toFloat().sub(o);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],o=t[1],i=an(e.shape,[n]);return[e.reshape(i).mul(r.toFloat().sub(o.exp())),e.reshape(i).mul(o.exp().sub(r.toFloat()))]}}})(e,t)}(i,a);return kl(h,s,o)}}),Ol=Object.freeze({get Reduction(){return yl},absoluteDifference:Cl,computeWeightedLoss:kl,cosineDistance:Sl,hingeLoss:Il,huberLoss:Tl,logLoss:Nl,meanSquaredError:Rl,sigmoidCrossEntropy:Al,softmaxCrossEntropy:Dl});function Pl(e,t){return void 0===t&&(t=!1),We.tidy(function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=nr(n),i=e.clone(),a=xn([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(e){var t,u=i,c=s,l=o;t=We.tidy(function(){var t=i.slice([e,e],[n-e,1]),u=t.norm(),c=i.slice([e,e],[1,1]),l=xn([[-1]]).where(c.greater(0),xn([[1]])),h=c.sub(l.mul(u)),d=t.div(h);s=1===d.shape[0]?a.clone():a.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var f=l.matMul(h).div(u).neg(),p=i.slice([e,0],[n-e,r]),m=f.mul(s);if(0===e)i=p.sub(m.matMul(s.transpose().matMul(p)));else{var g=p.sub(m.matMul(s.transpose().matMul(p)));i=i.slice([0,0],[e,r]).concat(g,0)}var v=o.slice([0,e],[n,o.shape[1]-e]);if(0===e)o=v.sub(v.matMul(s).matMul(m.transpose()));else{var y=v.sub(v.matMul(s).matMul(m.transpose()));o=o.slice([0,0],[n,e]).concat(y,1)}return[s,i,o]}),s=t[0],i=t[1],o=t[2],Yt([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var Fl=fn({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=en(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),n<0&&(n=s);var u=In(0,a,1,"int32").reshape([-1,1]),c=In(0,s,1,"int32"),l=Lu(u,c),h=du(l.lessEqual(bn(+t,"int32")),l.greaterEqual(bn(-n,"int32"))),d=kn([a,s],r.dtype);return vr(wr(r.reshape([-1,a,s])).map(function(e){return gu(h,e,d)})).reshape(o)}}),Ml=fn({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,O(null!=e&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(t){O(e[t].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=Fn(e,e.shape[0],0).map(function(e){return gr(e,[0])});O(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],a=e,s=function(e){i.push(We.tidy(function(){var t=a[e];if(e>0)for(var n=0;n<e;++n){var r=Hc(i[n].mulStrict(t)).mul(i[n]);t=t.sub(r)}return t.div(tl(t,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?vr(i,0):i}}),Ll=fn({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return Pl(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),r=wr(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach(function(e){var n=Pl(e,t),r=n[0],a=n[1];o.push(r),i.push(a)}),[vr(o,0).reshape(e.shape),vr(i,0).reshape(e.shape)]}}),Bl=Object.freeze({bandPart:Fl,gramSchmidt:Ml,qr:Ll});function Ul(e,t,n,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=e.shape[0];return n=Math.min(n,a),O(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),O(2===e.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),O(4===e.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),O(1===t.rank,function(){return"scores must be a 1D tensor"}),O(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),O(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var zl=fn({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=en(e,"images","resizeBilinear");O(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=We.runKernelFunc(function(e,t){return t([o]),e.resizeBilinear(o,a,s,n)},{x:o},function(e,t){return{x:function(){return We.runKernelFunc(function(r){return r.resizeBilinearBackprop(e,t[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Vl=fn({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=en(e,"images","resizeNearestNeighbor");O(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),O(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),O("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=We.runKernelFunc(function(e,t){return t([o]),e.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(e,t){return{batchImages:function(){return We.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jl=fn({nonMaxSuppression_:function(e,t,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=en(e,"boxes","nonMaxSuppression"),a=en(t,"scores","nonMaxSuppression"),s=Ul(i,a,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return We.runKernelFunc(function(e){return e.nonMaxSuppression(i,a,n,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),Wl=fn({nonMaxSuppressionWithScore_:function(e,t,n,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=en(e,"boxes","nonMaxSuppression"),s=en(t,"scores","nonMaxSuppression"),u=Ul(a,s,n,r,o,i),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=We.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Gl=fn({cropAndResize_:function(e,t,n,r,o,i){var a=en(e,"image","cropAndResize"),s=en(t,"boxes","cropAndResize","float32"),u=en(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return O(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),O(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),O(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),O(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),O(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),O("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),We.runKernelFunc(function(e,t){return e.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Hl=Object.freeze({resizeBilinear:zl,resizeNearestNeighbor:Vl,nonMaxSuppression:jl,nonMaxSuppressionAsync:function(e,t,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),v(this,void 0,void 0,function(){var i,a,s,u,c,l,h;return y(this,function(d){switch(d.label){case 0:return i=en(e,"boxes","nonMaxSuppressionAsync"),a=en(t,"scores","nonMaxSuppressionAsync"),s=Ul(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],h=mo(c,l,n,r,o),i!==e&&i.dispose(),a!==t&&a.dispose(),[2,h]}})})},nonMaxSuppressionWithScore:Wl,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),v(this,void 0,void 0,function(){var a,s,u,c,l,h,d;return y(this,function(f){switch(f.label){case 0:return a=en(e,"boxes","nonMaxSuppressionAsync"),s=en(t,"scores","nonMaxSuppressionAsync"),u=Ul(a,s,n,r,o,i),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=f.sent(),l=c[0],h=c[1],d=go(l,h,n,r,o,i),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,d]}})})},cropAndResize:Gl}),ql=function(e,t){return!(e>0)||"linear"===t},Kl=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Xl=function(e,t){var n=t,r=Hr(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Ql=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Yc(e);if("elu"===t)return Kc(e);if("relu6"===t)return $c(e);if("prelu"===t)return Qc(e,n);throw new Error("Unknown fused activation "+t+".")},Yl=fn({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,i=void 0!==o&&o,a=e.transposeB,s=void 0!==a&&a,u=e.bias,c=e.activation,l=void 0===c?"linear":c,h=e.preluActivationWeights;if(!1===ql(We.state.gradientDepth,l)){var d=mc(n,r,i,s);return null!=u&&(d=yu(d,u)),Ql(d,l,h)}var f=en(n,"a","fused matMul"),p=en(r,"b","fused matMul");t=Le(f,p),f=t[0],p=t[1];var m=i?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?f.shape[f.rank-1]:f.shape[f.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=f.shape.slice(0,-2),w=p.shape.slice(0,-2),x=L(b),E=L(w);O(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),O(B(b,w),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+w+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),O(m===g,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var _,C,k=f.shape.slice(0,-2).concat([v,y]),S=i?f.as3D(x,m,v):f.as3D(x,v,m),I=s?p.as3D(E,y,g):p.as3D(E,g,y);null!=u&&qr(k,(_=Le(_=en(u,"bias","fused matMul"),f)[0]).shape),null!=h&&(C=en(h,"prelu weights","fused matMul"));var T={a:S,b:I};null!=u&&(T.bias=_),null!=h&&(T.preluActivationWeights=C);var N=[S,I];return We.runKernelFunc(function(e,t){var n=e.fusedBatchMatMul({a:S,b:I,transposeA:i,transposeB:s,bias:_,activation:l,preluActivationWeights:C});return t([S,I,n]),n},T,function(e,t){var n=t[0],r=t[1],o=t[2],a=Kl(e,o,l),c={};return null!=u&&(c={bias:function(){return Xl(_,a)}}),i||s?!i&&s?Object.assign({a:function(){return a.matMul(r,!1,!1)},b:function(){return a.matMul(n,!0,!1)}},c):i&&!s?Object.assign({a:function(){return r.matMul(a,!1,!0)},b:function(){return n.matMul(a,!1,!1)}},c):Object.assign({a:function(){return r.matMul(a,!0,!0)},b:function(){return a.matMul(n,!0,!0)}},c):Object.assign({a:function(){return a.matMul(r,!1,!0)},b:function(){return n.matMul(a,!0,!1)}},c)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},N,[!0]).reshape(k)}}),$l=fn({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights;if(d=d||"linear",!1===ql(We.state.gradientDepth,d)){var p=ic(t,n,r,o,a,u,c);return null!=l&&(p=yu(p,l)),Ql(p,d,f)}var m=en(t,"x","conv2d"),g=en(n,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),O(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),O(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=c&&O(U(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),O(v.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),O(ro(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),O("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var b,w,x=Qr(v.shape,g.shape,r,u,o,c);null!=l&&(b=Le(b=en(l,"bias","fused conv2d"),m)[0],qr(x.outShape,b.shape)),null!=f&&(w=en(f,"prelu weights","fused conv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=f&&(E.preluActivationWeights=w);var _=[g,v],C=We.runKernelFunc(function(e,t){var n=e.fusedConv2d({input:v,filter:g,convInfo:x,bias:b,activation:d,preluActivationWeights:w});return t([g,v,n]),n},E,function(e,t){var n=t,i=n[0],a=n[1],s=n[2],c=Kl(e,s,d);O(no(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var h={};return null!=l&&(h={bias:function(){return Xl(b,c)}}),Object.assign({x:function(){return uc(a.shape,c,i,r,o)},filter:function(){return sc(a,c,i.shape,r,o)}},h)},"FusedConv2D",{convInfo:x,activation:d},_,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Jl=fn({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights;if(!1===ql(We.state.gradientDepth,d)){var p=cc(t,n,r,o,a,u,c);return null!=l&&(p=yu(p,l)),Ql(p,d,f)}var m=en(t,"x","depthwiseConv2d"),g=en(n,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),O(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),O(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),O(v.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==u&&(u=[1,1]),O(ro(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&O(U(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var b,w,x=Qr(v.shape,g.shape,r,u,o,c,!0);null!=l&&(b=Le(b=en(l,"bias","fused conv2d"),m)[0],qr(x.outShape,b.shape)),null!=f&&(w=en(f,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:g};null!=l&&(E.bias=b),null!=f&&(E.preluActivationWeights=w);var _=[g,v],C=We.runKernelFunc(function(e,t){var n=e.fusedDepthwiseConv2D({input:v,filter:g,convInfo:x,bias:b,activation:d,preluActivationWeights:w});return t([g,v,n]),n},E,function(e,t){O(no(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=t[0],r=t[1],o=t[2],i=Kl(e,o,d),a={};return null!=l&&(a={bias:function(){return Xl(b,i)}}),Object.assign({x:function(){return lc(r.shape,i,n,x)},filter:function(){return hc(r,i,n.shape,x)}},a)},"FusedDepthwiseConv2D",{convInfo:x,activation:d},_,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Zl=Object.freeze({matMul:Yl,conv2d:$l,depthwiseConv2d:Jl}),eh=Object.freeze({image:Hl,linalg:Bl,losses:Ol,spectral:dl,fused:Zl,signal:_l,square:ms,squaredDifference:vs,conv1d:oc,conv2d:ic,conv3d:ac,depthwiseConv2d:cc,separableConv2d:dc,conv2dTranspose:fc,conv3dTranspose:pc,op:fn,batchNormalization2d:ou,batchNormalization3d:iu,batchNormalization4d:au,batchNormalization:su,batchNorm:uu,batchNorm2d:cu,batchNorm3d:lu,batchNorm4d:hu,booleanMaskAsync:function(e,t,n){return v(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,m;return y(this,function(g){switch(g.label){case 0:for(r=en(e,"tensor","boolMask"),o=en(t,"mask","boolMask","bool"),i=null==n?0:n,a=o.rank,s=r.shape,O(a>0,function(){return"mask cannot be scalar"}),P(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),h=r.reshape(l),d=o.reshape([-1]),[4,vu(d)];case 1:return f=g.sent(),p=f.squeeze([1]),m=Zu(h,p,i),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,m]}})})},complex:pn,real:mn,imag:gn,concat:Rn,concat1d:An,concat2d:Dn,concat3d:On,concat4d:Pn,split:Fn,matMul:mc,dot:gc,outerProduct:vc,reverse:yc,reverse1d:bc,reverse2d:wc,reverse3d:xc,reverse4d:Ec,maxPool:kc,avgPool:Sc,pool:Ic,maxPool3d:Tc,avgPool3d:Nc,slice:Rc,slice1d:Ac,slice2d:Dc,slice3d:Oc,slice4d:Pc,abs:ys,acos:bs,acosh:ws,asin:xs,asinh:Es,atan:_s,atanh:Cs,ceil:ks,clipByValue:Ss,cos:Is,cosh:Ts,erf:Ns,exp:Rs,expm1:As,floor:Ds,log:Os,log1p:Ps,logSigmoid:Fs,neg:Ms,reciprocal:Ls,round:Bs,rsqrt:Us,sigmoid:zs,sign:Vs,isNaN:js,isInf:Ws,isFinite:Gs,sin:Hs,sinh:qs,softplus:Ks,sqrt:Xs,step:Qs,tan:Ys,tanh:$s,all:Mc,any:Lc,argMax:Bc,argMin:Uc,logSumExp:zc,max:Vc,mean:jc,min:Wc,moments:Gc,sum:Hc,prod:qc,equal:Uu,equalStrict:zu,greater:Vu,greaterEqual:ju,greaterEqualStrict:Wu,greaterStrict:Gu,less:Hu,lessEqual:qu,lessEqualStrict:Ku,lessStrict:Xu,notEqual:Qu,notEqualStrict:Yu,add:yu,addN:bu,addStrict:wu,atan2:xu,div:Eu,divNoNan:_u,divStrict:Cu,floorDiv:ku,maximum:Su,maximumStrict:Iu,minimum:Tu,minimumStrict:Nu,mod:Ru,modStrict:Au,mul:Du,mulStrict:Ou,pow:Pu,powStrict:Fu,squaredDifferenceStrict:Mu,sub:Lu,subStrict:Bu,elu:Kc,leakyRelu:Xc,prelu:Qc,relu:Yc,relu6:$c,selu:Jc,logicalAnd:du,logicalNot:fu,logicalOr:pu,logicalXor:mu,where:gu,whereAsync:vu,buffer:Xn,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Qn,broadcastTo:Yn,cast:$n,clone:Jn,cumsum:Zn,depthToSpace:er,expandDims:tr,eye:nr,multinomial:rr,oneHot:or,pad:ir,pad1d:ar,pad2d:sr,pad3d:ur,pad4d:cr,rand:lr,randomNormal:hr,randomGamma:dr,randomUniform:fr,reshape:pr,spaceToBatchND:mr,squeeze:gr,stack:vr,tile:yr,truncatedNormal:br,unstack:wr,setdiff1dAsync:function(e,t){return v(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h;return y(this,function(d){switch(d.label){case 0:return n=en(e,"x","setdiff1d"),r=en(t,"y","setdiff1d"),O(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),O(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),O(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new _e([s],n.dtype),c=new _e([s],"int32"),l=0,h=0;l<o.length;l++)a.has(o[l])||(u.values[h]=o[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:Sn,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return We.runKernelFunc(function(r){return r.linspace(e,t,n)},{})},ones:Cn,range:In,scalar:bn,tensor:vn,tensor1d:wn,tensor2d:xn,tensor3d:En,tensor4d:_n,tensor5d:function(e,t,n){if(F(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Jt(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return yn(e,t,r,n)},tensor6d:function(e,t,n){if(F(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Jt(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return yn(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),We.makeVariable(e,t,n,r)},zeros:kn,onesLike:Tn,zerosLike:Nn,transpose:Zc,softmax:Ur,logSoftmax:zr,localResponseNormalization:el,norm:tl,gather:Zu,unsortedSegmentSum:ec,basicLSTMCell:nl,multiRNNCell:rl,movingAverage:ol,stridedSlice:il,topk:al,scatterND:sl,fft:ul,ifft:cl,rfft:ll,irfft:hl,sparseToDense:fl,gatherND:pl,diag:ml,dropout:gl,hannWindow:bl,hammingWindow:wl,frame:xl,stft:El,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),v(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,m,g;return y(this,function(v){switch(v.label){case 0:return r=en(e,"predictions","inTopK"),o=en(t,"targets","inTopK"),O(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),O(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),P(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],O(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],l=u[1],h=K("bool",c=u[0]),d=0;d<c;d++){for(f=d*l,p=a.subarray(f,f+l),m=[],g=0;g<p.length;g++)m.push({value:p[g],index:g});for(m.sort(function(e,t){return t.value-e.value}),h[d]=0,g=0;g<n;g++)if(m[g].index===s[d]){h[d]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,vn(h,o.shape,"bool")]}})})}});function th(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){null!=e&&O("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function nh(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var rh=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new Vr(t,We),t}return g(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,w().get("IS_NODE")&&$t("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;return"complex64"===n?uo(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map(function(e){return me(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Xn(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return We.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){return t=de(),e(),[2,{kernelMs:de()-t}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:We.keep(e.clone()),imag:We.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(th(e,"slice"),Mr(e.shape,t,n)){var r=Lr(t,e.strides),o=L(n);return vn(this.readSync(e.dataId).subarray(r,r+o),n,e.dtype)}for(var i=Xn(n,e.dtype),a=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(e,n){return e+t[n]});i.values[s]=a.get.apply(a,u)}return i.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){th(e,"stridedSlice");var o=Or(t,n,r);if(o.some(function(e){return 0===e}))return vn([],o);for(var i=Xn(o,e.dtype),a=this.bufferSync(e),s=0;s<i.size;s++){for(var u=i.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];i.set.apply(i,[a.get.apply(a,c)].concat(u))}return i.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Xn([e.size,e.size],e.dtype),r=n.values,o=0;o<t.length;o++)r[o*e.size+o]=t[o];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),o=0,i=0;i<e.rank;i++)i!==t&&(r[o++]=e.shape[i]);var a=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[t]=i,u[i]=this.slice(e,a,s).reshape(r);return u},t.prototype.reverse=function(e,t){th(e,"reverse");for(var n=Xn(e.shape,e.dtype),r=this.bufferSync(e),o=function(o){var i=n.indexToLoc(o),a=i.slice();t.forEach(function(t){return a[t]=e.shape[t]-1-a[t]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map(function(e){return mn(e)}),o=e.map(function(e){return gn(e)});return pn(this.concat(r,t),this.concat(o,t))}var i=e.map(function(e){var n=L(e.shape.slice(t));return e.as2D(-1,n)}),a=dn(i.map(function(e){return e.shape}),1),s=Xn(a,e[0].dtype).values;if(1===i[0].shape[0]){var u=0;i.forEach(function(e){s.set(n.readSync(e.dataId),u),u+=e.size})}else{var c=0;i.forEach(function(e){for(var t=n.readSync(e.dataId),r=0,o=0;o<e.shape[0];++o)for(var i=o*a[1]+c,u=0;u<e.shape[1];++u)s[i+u]=t[r++];c+=e.shape[1]})}var l=dn(e.map(function(e){return e.shape}),t);return vn(s,l,e[0].dtype)},t.prototype.neg=function(e){return th(e,"neg"),this.multiply(bn(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e+n,imag:t+r}}):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),function(e,t){return e+t})},t.prototype.addN=function(e){var t=this;th(e,"addN");for(var n=e.map(function(e){return t.readSync(e.dataId)}),r=Xn(e[0].shape,e[0].dtype),o=r.values,i=0;i<e.length;i++)for(var a=n[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=H([t],e.shape),r=this.max(e,n),o=an(r.shape,n),i=this.subtract(e,r.reshape(o)),a=this.exp(i),s=this.sum(a,n).reshape(o);return this.realDivide(a,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e-n,imag:t-r}}):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),function(e,t){return e-t})},t.prototype.pow=function(e,t){return th([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},t.prototype.batchMatMul=function(e,t,n,r){th([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=l[0],d=l[1],f=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],m=p[0],g=p[1],v=p[2],y=i*a,b=Xn([s,i,a],e.dtype),w=b.values,x=this.blockSize,E=0;E<s;E++)for(var _=0;_<i;_+=x)for(var C=0;C<a;C+=x)for(var k=0;k<o;k+=x)for(var S=Math.min(_+x,i),I=Math.min(C+x,a),T=Math.min(k+x,o),N=_;N<S;N++)for(var R=C;R<I;R++){for(var A=0,D=k;D<T;D++)A+=u[E*h+N*d+D*f]*c[D*m+R*g+E*v];w[E*y+(N*a+R)]+=A}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,o=e.transposeB,i=e.bias,a=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,o);return i&&(u=this.add(u,i)),a&&(u=nh(this,u,a,s)),u},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}}):this.broadcastedBinaryOp(e,t,Fe(e.dtype,t.dtype),function(e,t){return e*t})},t.prototype.realDivide=function(e,t){return th([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},t.prototype.floorDiv=function(e,t){return th([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},t.prototype.sum=function(e,t){th(e,"sum"),sn("sum",t,e.rank);for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,Fe(e.dtype,"int32")),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=0,d=0;d<a;++d)h+=u[l+d];s[c]=h}return i},t.prototype.prod=function(e,t){th(e,"sum");for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,Fe(e.dtype,"int32")),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=1,d=0;d<a;++d)h*=u[l+d];s[c]=h}return i},t.prototype.unsortedSegmentSum=function(e,t,n){th(e,"unsortedSegmentSum");for(var r=[],o=e.rank-t.rank,i=0;i<o;++i)t=t.expandDims(i+1);for(i=0;i<n;++i){var a=bn(i,"int32"),s=Uu(a,t).asType("float32").mul(e).sum(0);r.push(s)}return vr(r)},t.prototype.argMin=function(e,t){th(e,"argMin");var n=[t];sn("argMin",n,e.rank);for(var r=on(e.shape,n),o=r[0],i=r[1],a=kn(o,"int32"),s=L(i),u=this.readSync(a.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var m=c[h+p];m<d&&(d=m,f=p)}u[l]=f}return a},t.prototype.argMax=function(e,t){th(e,"argMax");var n=[t];sn("argMax",n,e.rank);for(var r=on(e.shape,n),o=r[0],i=r[1],a=kn(o,"int32"),s=L(i),u=this.readSync(a.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var m=c[h+p];m>d&&(d=m,f=p)}u[l]=f}return a},t.prototype.cumsum=function(e,t,n,r){if(th(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=Fe(e.dtype,"int32"),i=kn(e.shape,o),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var d=c(l,h);if(0===h)a[d]=n?0:s[d];else{var f=c(l,h-1);a[d]=n?s[f]+a[f]:s[d]+a[f]}}return i},t.prototype.equal=function(e,t){return th([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},t.prototype.notEqual=function(e,t){return th([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},t.prototype.less=function(e,t){return th([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},t.prototype.lessEqual=function(e,t){return th([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},t.prototype.greater=function(e,t){return th([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>t?1:0})},t.prototype.greaterEqual=function(e,t){return th([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e>=t?1:0})},t.prototype.logicalNot=function(e){th(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return th([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},t.prototype.logicalOr=function(e,t){return th([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},t.prototype.select=function(e,t,n){th([e,t,n],"select");for(var r=this.readSync(e.dataId),o=this.readSync(t.dataId),i=this.readSync(n.dataId),a=kn(t.shape,Fe(t.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:L(t.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)1===r[l]?s[u++]=o[l]:s[u++]=i[l];return a},t.prototype.where=function(e){th([e],"where");var t=this.readSync(e.dataId);return Co(e.shape,t)},t.prototype.topk=function(e,t,n){return th(e,"topk"),_o(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){th(e,"min"),sn("min",t,e.rank);for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,e.dtype),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];f<h&&(h=f)}s[c]=h}return i},t.prototype.minimum=function(e,t){return th([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},t.prototype.mod=function(e,t){return th([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})},t.prototype.max=function(e,t){th(e,"max"),sn("max",t,e.rank);for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,e.dtype),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];f>h&&(h=f)}s[c]=h}return i},t.prototype.maximum=function(e,t){return th([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},t.prototype.all=function(e,t){th(e,"all"),sn("all",t,e.rank);for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,e.dtype),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];h=h&&f}s[c]=h}return i},t.prototype.any=function(e,t){th(e,"any"),sn("any",t,e.rank);for(var n=on(e.shape,t),r=n[0],o=n[1],i=kn(r,e.dtype),a=L(o),s=this.readSync(i.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];h=h||f}s[c]=h}return i},t.prototype.squaredDifference=function(e,t){return th([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},t.prototype.ceil=function(e){th(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){th(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){th(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:t[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){th(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){th(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){th(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){th(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=Math.floor(t[r]);t[r]-o<.5?n[r]=Math.floor(t[r]):t[r]-o>.5?n[r]=Math.ceil(t[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){th(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){th(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){th(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){th(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.log1p(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){th(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){th(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var o=t[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){th(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){th(e,"relu");for(var t=kn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return t},t.prototype.relu6=function(e){th(e,"relu");for(var t=kn(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return t},t.prototype.prelu=function(e,t){return th([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return e<0?t*e:e})},t.prototype.elu=function(e){th(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=n[r];t[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){th([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=this.readSync(e.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){th(e,"selu");for(var t=Ba,n=Ua,r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?n*a:t*(Math.exp(a)-1)}return this.makeOutput(r,e.shape,"float32")},t.prototype.clip=function(e,t,n){th(e,"clip");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<t?t:a}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r){var o=n[2*r],i=n[2*r+1];t[r]=Math.hypot(o,i)}return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){th(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){th(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){th(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var i,a=r[o]>-t,s=r[o]<t,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){th(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){th(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){th(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){th(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){th(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){th(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return th([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},t.prototype.sinh=function(e){th(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){th(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){th(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=z(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){th(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){th(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){th(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){th(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),i=Math.abs(n[r]),a=1/(1+.3275911*i);t[r]=o*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-i*i))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),th(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=0;o<r.length;++o){var i=r[o];isNaN(i)?n[o]=NaN:n[o]=i>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,i=e.activation,a=e.preluActivationWeights,s=this.conv2d(t,n,r);return o&&(s=this.add(s,o)),i&&(s=nh(this,s,i,a)),s},t.prototype.conv2d=function(e,t,n){th([e,t],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Xn(n.outShape,e.dtype),h=e.strides[0],d=c?e.strides[1]:e.strides[2],f=c?e.strides[2]:1,p=c?1:e.strides[1],m=l.strides[0],g=c?l.strides[1]:l.strides[2],v=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),w=this.readSync(t.dataId),x=l.values,E=0;E<n.batchSize;++E)for(var _=E*h,C=E*m,k=0;k<n.outHeight;++k)for(var S=C+k*g,I=k*n.strideHeight-u,T=0;T<r;T++){var N=I+T*i;if(!(N<0||N>=n.inHeight))for(var R=T*t.strides[0],A=_+N*d,D=0;D<n.outWidth;++D)for(var O=S+D*v,P=D*n.strideWidth-s,F=0;F<o;F++){var M=P+F*a;if(!(M<0||M>=n.inWidth))for(var L=A+M*f,B=R+F*t.strides[1],U=0;U<n.inChannels;++U){for(var z=b[L+U*p],V=0;V<n.outChannels;++V)x[O+V*y]+=z*w[B+V];B+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,d=Xn(n.outShape,e.dtype),f=this.readSync(e.dataId),p=this.readSync(t.dataId),m=d.values,g=0;g<n.batchSize;++g)for(var v=g*e.strides[0],y=g*d.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*d.strides[1],x=b*n.strideDepth-c,E=0;E<r;E++){var _=x+E*a;if(!(_<0||_>=n.inDepth))for(var C=E*t.strides[0],k=v+_*e.strides[1],S=0;S<n.outHeight;++S)for(var I=w+S*d.strides[2],T=S*n.strideHeight-h,N=0;N<o;N++){var R=T+N*s;if(!(R<0||R>=n.inHeight))for(var A=C+N*t.strides[1],D=k+R*e.strides[2],O=0;O<n.outWidth;++O)for(var P=I+O*n.outChannels,F=O*n.strideWidth-l,M=0;M<i;M++){var L=F+M*u;if(!(L<0||L>=n.inWidth))for(var B=A+M*t.strides[2],U=D+L*n.inChannels,z=B,V=0;V<n.inChannels;++V){for(var j=f[U+V],W=0;W<n.outChannels;++W)m[P+W]+=j*p[z+W];z+=n.outChannels}}}}return d.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){th([e,t],"conv2dDerInput");for(var r=Xn(n.inShape,"float32"),o=r.values,i=this.readSync(e.dataId),a=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,d=n.filterHeight,f=n.filterWidth,p=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,y=n.outHeight,b=n.outWidth,w=n.strideHeight,x=n.strideWidth,E=n.dataFormat,_=d-1-n.padInfo.top,C=f-1-n.padInfo.left,k="channelsLast"===E,S=r.strides[0],I=k?r.strides[1]:r.strides[2],T=k?r.strides[2]:1,N=k?1:r.strides[1],R=e.strides[0],A=k?e.strides[1]:e.strides[2],D=k?e.strides[2]:1,O=k?1:e.strides[1],P=0;P<h;++P)for(var F=0;F<p;++F)for(var M=0;M<m;++M)for(var L=M-_,B=Math.max(0,Math.ceil(L/w)),U=Math.min(y,(d+L)/w),z=0;z<g;++z){for(var V=z-C,j=Math.max(0,Math.ceil(V/x)),W=Math.min(b,(f+V)/x),G=0,H=B;H<U;++H)for(var q=H*w-L,K=j;K<W;++K)for(var X=R*P+A*H+D*K,Q=u*(d-1-q)+c*(f-1-(K*x-V))+l*F,Y=0;Y<v;++Y)G+=i[X+O*Y]*a[Q+Y];o[S*P+I*M+T*z+N*F]=G}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Xn(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(e.dataId),h=e.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],w=v[2],x=v[3],E=n.batchSize,_=n.filterDepth,C=n.filterHeight,k=n.filterWidth,S=n.inChannels,I=n.inDepth,T=n.inHeight,N=n.inWidth,R=n.outChannels,A=n.outDepth,D=n.outHeight,O=n.outWidth,P=n.strideDepth,F=n.strideHeight,M=n.strideWidth,L=_-1-n.padInfo.front,B=C-1-n.padInfo.top,U=k-1-n.padInfo.left,z=0;z<E;++z)for(var V=0;V<S;++V)for(var j=0;j<I;++j)for(var W=j-L,G=Math.max(0,Math.ceil(W/P)),H=Math.min(A,(_+W)/P),q=0;q<T;++q)for(var K=q-B,X=Math.max(0,Math.ceil(K/F)),Q=Math.min(D,(C+K)/F),Y=0;Y<N;++Y){for(var $=Y-U,J=Math.max(0,Math.ceil($/M)),Z=Math.min(O,(k+$)/M),ee=0,te=G;te<H;++te)for(var ne=te*P-W,re=X;re<Q;++re)for(var oe=re*F-K,ie=J;ie<Z;++ie)for(var ae=d*z+f*te+p*re+m*ie,se=y*(_-1-ne)+b*(C-1-oe)+w*(k-1-(ie*M-$))+x*V,ue=0;ue<R;++ue)ee+=l[ae+ue]*g[se+ue];o[a*z+s*j+u*q+c*Y+V]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){th([e,t],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=Xn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(e),d=this.bufferSync(t),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),g=0;g<a;++g)for(var v=Math.max(0,Math.ceil((c-g)/o)),y=Math.min(n.outWidth,(n.inWidth+c-g)/o),b=0;b<n.inChannels;++b)for(var w=0;w<n.outChannels;++w){for(var x=0,E=0;E<n.batchSize;++E)for(var _=p;_<m;++_)for(var C=f+_*r-l,k=v;k<y;++k){var S=g+k*o-c;x+=s?h.get(E,C,S,b)*d.get(E,_,k,w):h.get(E,b,C,S)*d.get(E,w,_,k)}u.set(x,f,g,b,w)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Xn(n.filterShape,"float32"),l=c.values,h=c.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(t.dataId),v=t.strides,y=v[0],b=v[1],w=v[2],x=v[3],E=this.readSync(e.dataId),_=e.strides,C=_[0],k=_[1],S=_[2],I=_[3],T=n.padInfo.front,N=n.padInfo.left,R=n.padInfo.top,A=0;A<a;++A)for(var D=Math.max(0,Math.ceil((T-A)/r)),O=Math.min(n.outDepth,(n.inDepth+T-A)/r),P=A*d,F=0;F<s;++F)for(var M=Math.max(0,Math.ceil((R-F)/o)),L=Math.min(n.outHeight,(n.inHeight+R-F)/o),B=F*f+P,U=0;U<u;++U)for(var z=Math.max(0,Math.ceil((N-U)/i)),V=Math.min(n.outWidth,(n.inWidth+N-U)/i),j=U*p+B,W=0;W<n.inChannels;++W)for(var G=W*m+j,H=0;H<n.outChannels;++H){for(var q=0,K=0;K<n.batchSize;++K)for(var X=K*C,Q=K*y,Y=D;Y<O;++Y)for(var $=(A+Y*r-T)*k+X,J=Y*b+Q,Z=M;Z<L;++Z)for(var ee=(F+Z*o-R)*S+$,te=Z*w+J,ne=z;ne<V;++ne){var re=ne*x+te;q+=E[(U+ne*i-N)*I+ee+W]*g[re+H]}l[G+H]=q}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.input,n=e.filter,r=e.convInfo,o=e.bias,i=e.activation,a=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return o&&(s=this.add(s,o)),i&&(s=nh(this,s,i,a)),s},t.prototype.depthwiseConv2D=function(e,t,n){th([e,t],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Xn(n.outShape,e.dtype),h=this.readSync(e.dataId),d=this.readSync(t.dataId),f=l.values,p=0;p<n.batchSize;++p)for(var m=p*e.strides[0],g=p*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],b=v*n.strideHeight-s,w=0;w<r;++w){var x=b+w*i;if(!(x<0||x>=n.inHeight))for(var E=w*t.strides[0],_=m+x*e.strides[1],C=0;C<n.outWidth;++C)for(var k=y+C*l.strides[2],S=C*n.strideWidth-u,I=0;I<o;++I){var T=S+I*a;if(!(T<0||T>=n.inWidth))for(var N=E+I*t.strides[1],R=_+T*n.inChannels,A=k,D=N,O=0;O<n.inChannels;++O){for(var P=h[R+O],F=0;F<c;++F)f[A+F]+=P*d[D+F];A+=c,D+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){th([e,t],"depthwiseConv2DDerInput");for(var r=Xn(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=this.readSync(e.dataId),l=e.strides,h=l[0],d=l[1],f=l[2],p=this.readSync(t.dataId),m=t.strides,g=m[0],v=m[1],y=m[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,E=n.inChannels,_=n.inHeight,C=n.inWidth,k=n.outChannels,S=n.outHeight,I=n.outWidth,T=n.strideHeight,N=n.strideWidth,R=w-1-n.padInfo.top,A=x-1-n.padInfo.left,D=k/E,O=0;O<b;++O)for(var P=0;P<E;++P)for(var F=0;F<_;++F)for(var M=F-R,L=Math.max(0,Math.ceil(M/T)),B=Math.min(S,(w+M)/T),U=0;U<C;++U){for(var z=U-A,V=Math.max(0,Math.ceil(z/N)),j=Math.min(I,(x+z)/N),W=0,G=L;G<B;++G)for(var H=G*T-M,q=V;q<j;++q)for(var K=h*O+d*G+f*q,X=g*(w-1-H)+v*(x-1-(q*N-z))+y*P,Q=0;Q<D;++Q)W+=c[K+(P*D+Q)]*p[X+Q];o[a*O+s*F+u*U+P]=W}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){th([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=Xn(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(e),d=this.bufferSync(t),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((c-f)/r)),m=Math.min(n.outHeight,(n.inHeight+c-f)/r),g=0;g<a;++g)for(var v=Math.max(0,Math.ceil((u-g)/o)),y=Math.min(n.outWidth,(n.inWidth+u-g)/o),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/l),x=b%l,E=0,_=0;_<n.batchSize;++_)for(var C=p;C<m;++C)for(var k=f+C*r-c,S=v;S<y;++S){var I=g+S*o-u;E+=h.get(_,k,I,w)*d.get(_,C,S,b)}s.set(E,f,g,w,x)}return s.toTensor()},t.prototype.tile=function(e,t){return th(e,"tile"),Eo(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){th(e,"pad");var r=t.map(function(t,n){return t[0]+e.shape[n]+t[1]}),o=t.map(function(e){return e[0]}),i=this.bufferSync(e),a=Xn(r,e.dtype);0!==n&&a.values.fill(n);for(var s=0;s<e.size;s++){var u=i.indexToLoc(s),c=u.map(function(e,t){return e+o[t]});a.set.apply(a,[i.get.apply(i,u)].concat(c))}return a.toTensor()},t.prototype.transpose=function(e,t){th(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var o=this.readSync(e.dataId),i=Xn(n,e.dtype),a=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=i.locToIndex(u);i.values[l]=o[r]}return i.toTensor()},t.prototype.gather=function(e,t,n){th([e,t],"gather");var r=e.shape.slice(),o=this.readSync(t.dataId);r[n]=o.length;for(var i=Xn(r,e.dtype),a=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=a.locToIndex(c);i.values[s]=a.values[l]}return i.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){th([e],"batchToSpaceND");var r=t.reduce(function(e,t){return e*t}),o=xr(e.shape,t,r),i=Er(o.length,t.length),a=_r(e.shape,t,r),s=Cr(n,t.length),u=kr(a,n,t.length);return e.reshape(o).transpose(i).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){th([e],"spaceToBatchND");var r=t.reduce(function(e,t){return e*t}),o=[[0,0]];o.push.apply(o,n);for(var i=1+t.length;i<e.shape.length;++i)o.push([0,0]);var a=e.pad(o),s=xr(a.shape,t,r,!1),u=Er(s.length,t.length,!1),c=_r(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){th(e,"pool");for(var r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),f=Xn(t.outShape,e.dtype),p=f.values,m=t.outShape[1]*t.outShape[2]*t.outShape[3],g=t.outShape[2]*t.outShape[3],v=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*m,w=y*e.strides[0],x=0;x<t.inChannels;++x)for(var E=0;E<t.outHeight;++E)for(var _=E*r-c,C=Math.max(0,_),k=Math.min(t.inHeight,s+_),S=b+E*g,I=0;I<t.outWidth;++I){for(var T=I*o-l,N=Math.max(0,T),R=Math.min(t.inWidth,u+T),A=h,D=0,O=0,P=C;P<k;P+=i){for(var F=w+P*e.strides[1],M=N;M<R;M+=a){var L=d[F+M*e.strides[2]+x];"max"===n&&L>A?A=L:"avg"===n&&(D+=L,O++)}if(isNaN(A))break}p[S+I*v+x]="avg"===n?D/O:A}return f.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=Xn(t.outShape,"int32"),r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,h=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var f=0;f<t.inChannels;++f)for(var p=0;p<t.outHeight;++p){for(var m=p*r-c,g=m;g<0;)g+=i;for(var v=Math.min(t.inHeight,s+m),y=0;y<t.outWidth;++y){for(var b=y*o-l,w=b;w<0;)w+=a;for(var x=Math.min(t.inWidth,u+b),E=Number.NEGATIVE_INFINITY,_=-1,C=g;C<v;C+=i)for(var k=C-m,S=w;S<x;S+=a){var I=S-b,T=h.get(d,C,S,f);T>E&&(E=T,_=k*u+I)}n.set(_,d,p,y,f)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){th([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,d=c-1-r.padInfo.top,f=Xn(t.shape,"float32"),p=this.bufferSync(o),m=this.bufferSync(e),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-d,x=b-h,E=0,_=0;_<c;_+=s){var C=(w+_)/i;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var k=0;k<l;k+=u){var S=(x+k)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var I=c*l-1-p.get(g,C,S,v)===_*l+k?1:0;0!==I&&(E+=m.get(g,C,S,v)*I)}}}f.set(E,g,y,b,v)}return f.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){th([e,t],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,d=c-1-n.padInfo.top,f=Xn(t.shape,"float32"),p=1/(i*a),m=this.bufferSync(e),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-d,x=b-h,E=0,_=0;_<c;_+=s){var C=(w+_)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var k=0;k<l;k+=u){var S=(x+k)/o;S<0||S>=n.outWidth||Math.floor(S)!==S||(E+=m.get(g,C,S,v))}}f.set(E*p,g,y,b,v)}return f.toTensor()},t.prototype.pool3d=function(e,t,n){th(e,"pool3d");for(var r=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(e.dataId),v=Xn(t.outShape,e.dtype),y=v.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[2]*t.outShape[3]*t.outShape[4],x=t.outShape[3]*t.outShape[4],E=t.outShape[4],_=0;_<t.batchSize;++_)for(var C=_*b,k=_*e.strides[0],S=0;S<t.inChannels;++S)for(var I=0;I<t.outDepth;++I){for(var T=I*r-d,N=T;N<0;)N+=a;for(var R=Math.min(t.inDepth,c+T),A=C+I*w,D=0;D<t.outHeight;++D){for(var O=D*o-f,P=O;P<0;)P+=s;for(var F=Math.min(t.inHeight,l+O),M=A+D*x,L=0;L<t.outWidth;++L){for(var B=L*i-p,U=B;U<0;)U+=u;for(var z=Math.min(t.inWidth,h+B),V=M+L*E,j=m,W=0,G=0,H=N;H<R;H+=a){for(var q=k+H*e.strides[1],K=P;K<F;K+=s){for(var X=q+K*e.strides[2],Q=U;Q<z;Q+=u){var Y=g[X+Q*e.strides[3]+S];if("max"===n&&Y>j?j=Y:"avg"===n&&(W+=Y,G++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}y[V+S]="avg"===n?W/G:j}}}return v.toTensor()},t.prototype.avgPool3d=function(e,t){return th(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){th([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,g=p-1-n.padInfo.left,v=f-1-n.padInfo.top,y=Xn(t.shape,"float32"),b=1/(a*s*u),w=this.bufferSync(e),x=0;x<n.batchSize;++x)for(var E=0;E<n.inChannels;++E)for(var _=0;_<n.inDepth;++_)for(var C=0;C<n.inHeight;++C)for(var k=0;k<n.inWidth;++k){for(var S=_-m,I=C-v,T=k-g,N=0,R=0;R<d;R+=c){var A=(S+R)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var D=0;D<f;D+=l){var O=(I+D)/o;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var P=0;P<p;P+=h){var F=(T+P)/i;F<0||F>=n.outWidth||Math.floor(F)!==F||(N+=w.get(x,A,O,F,E))}}}y.set(N*b,x,_,C,k,E)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return th(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Xn(t.outShape,"int32"),r=t.strideDepth,o=t.strideHeight,i=t.strideWidth,a=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),g=0;g<t.batchSize;++g)for(var v=0;v<t.inChannels;++v)for(var y=0;y<t.outDepth;++y){for(var b=y*r-d,w=b;w<0;)w+=a;for(var x=Math.min(t.inDepth,c+b),E=0;E<t.outHeight;++E){for(var _=E*o-f,C=_;C<0;)C+=s;for(var k=Math.min(t.inHeight,l+_),S=0;S<t.outWidth;++S){for(var I=S*i-p,T=I;T<0;)T+=u;for(var N=Math.min(t.inWidth,h+I),R=Number.NEGATIVE_INFINITY,A=-1,D=w;D<x;D+=a)for(var O=D-b,P=C;P<k;P+=s)for(var F=P-_,M=T;M<N;M+=u){var L=M-I,B=m.get(g,D,P,M,v);B>=R&&(R=B,A=O*l*h+F*l+L)}n.set(A,g,y,E,S,v)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){th([t,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(t,r),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=h-1-r.padInfo.front,m=f-1-r.padInfo.left,g=d-1-r.padInfo.top,v=Xn(t.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(e),w=0;w<r.batchSize;++w)for(var x=0;x<r.inChannels;++x)for(var E=0;E<r.inDepth;++E)for(var _=0;_<r.inHeight;++_)for(var C=0;C<r.inWidth;++C){for(var k=E-p,S=_-g,I=C-m,T=0,N=0;N<h;N+=u){var R=(k+N)/i;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var A=0;A<d;A+=c){var D=(S+A)/a;if(!(D<0||D>=r.outHeight||Math.floor(D)!==D))for(var O=0;O<f;O+=l){var P=(I+O)/s;if(!(P<0||P>=r.outWidth||Math.floor(P)!==P)){var F=h*d*f-1-y.get(w,R,D,P,x)===N*d*f+A*f+O?1:0;0!==F&&(T+=b.get(w,R,D,P,x)*F)}}}}v.set(T,w,E,_,C,x)}return v.toTensor()},t.prototype.cast=function(e,t){return io(e,t,this)},t.prototype.reshape=function(e,t){return ao(e,t)},t.prototype.avgPool=function(e,t){return th(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){th(e,"resizeBilinear");for(var o=e.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(e.dataId),l=new Float32Array(L([i,t,n,u])),h=[r&&t>1?a-1:a,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=0,p=h[0]/d[0],m=h[1]/d[1],g=0;g<i;g++)for(var v=0;v<t;v++)for(var y=p*v,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),E=g*e.strides[0]+b*e.strides[1],_=g*e.strides[0]+x*e.strides[1],C=0;C<n;C++)for(var k=m*C,S=Math.floor(k),I=k-S,T=Math.min(s-1,Math.ceil(k)),N=E+S*e.strides[2],R=_+S*e.strides[2],A=E+T*e.strides[2],D=_+T*e.strides[2],O=0;O<u;O++){var P=c[N+O],F=c[R+O],M=P+(c[A+O]-P)*I,B=M+(F+(c[D+O]-F)*I-M)*w;l[f++]=B}return vn(l,[i,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){th([e,t],"resizeBilinearBackprop");for(var r=t.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),d=[n&&c>1?i-1:i,n&&l>1?a-1:a],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=d[0]/f[0],m=d[1]/f[1],g=this.readSync(e.dataId),v=0,y=0;y<o;y++)for(var b=y*t.strides[0],w=0;w<c;w++)for(var x=w*p,E=Math.floor(x),_=Math.min(Math.ceil(x),i-1),C=b+E*t.strides[1],k=b+_*t.strides[1],S=x-E,I=1-S,T=0;T<l;T++)for(var N=T*m,R=Math.floor(N),A=Math.min(Math.ceil(N),a-1),D=N-R,O=1-D,P=C+R*t.strides[2],F=C+A*t.strides[2],M=k+R*t.strides[2],L=k+A*t.strides[2],B=I*O,U=I*D,z=S*O,V=S*D,j=0;j<s;j++){var W=g[v++];h[P+j]+=W*B,h[F+j]+=W*U,h[M+j]+=W*z,h[L+j]+=W*V}return _n(h,[o,a,i,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){th(e,"resizeNearestNeighbor");for(var o=e.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(e.dataId),l=new Float32Array(i*t*n*u),h=[r&&t>1?a-1:a,r&&n>1?s-1:s],d=[r&&t>1?t-1:t,r&&n>1?n-1:n],f=h[0]/d[0],p=h[1]/d[1],m=0,g=0;g<i;g++)for(var v=g*e.strides[0],y=0;y<t;y++)for(var b=f*y,w=v+Math.min(a-1,r?Math.round(b):Math.floor(b))*e.strides[1],x=0;x<n;x++)for(var E=p*x,_=w+Math.min(s-1,r?Math.round(E):Math.floor(E))*e.strides[2],C=0;C<u;C++){var k=c[_+C];l[m++]=k}return vn(l,[i,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){th([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),d=this.readSync(e.dataId),f=[n&&c>1?i-1:i,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=f[0]/p[0],g=f[1]/p[1],v=1/m,y=1/g,b=2*Math.ceil(v)+2,w=2*Math.ceil(y)+2,x=0;x<o;x++)for(var E=x*t.strides[0],_=0;_<i;_++)for(var C=E+_*t.strides[1],k=Math.floor(_*v),S=Math.floor(k-b/2),I=0;I<a;I++)for(var T=C+I*t.strides[2],N=Math.floor(I*y),R=Math.floor(N-w/2),A=0;A<s;A++){for(var D=0,O=0;O<b;O++){var P=O+S;if(!(P<0||P>=c)){var F=E+P*e.strides[1],M=P*m;if(_===Math.min(i-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<w;L++){var B=L+R;if(!(B<0||B>=l)){var U=F+B*e.strides[2],z=B*g;I===Math.min(a-1,n?Math.round(z):Math.floor(z))&&(D+=d[U+A])}}}}h[T+A]=D}return _n(h,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,o,i){th([e,t,n,o,i],"batchNorm");for(var a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),h=new Float32Array(a.length),d=l.length,f=c.length,p=u.length,m=s.length,g=0,v=0,y=0,b=0,w=0;w<a.length;++w)h[w]=l[g++]+(a[w]-s[v++])*c[y++]/Math.sqrt(u[b++]+r),g>=d&&(g=0),v>=m&&(v=0),y>=f&&(y=0),b>=p&&(b=0);return _n(h,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,o){th(e,"localResponseNormalization4D");var i=e.shape[3],a=i-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%i,r=e-n+Math.max(0,n-t),o=e-n+Math.min(n+t,a),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var d=l(h),f=s[h]*Math.pow(n+r*d,-o);c[h]=f}return _n(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,o,i,a){th(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),h=new Float32Array(e.size),d=e.size,f=0;f<d;f++){for(var p=f%s,m=f-p+Math.max(0,p-r),g=f-p+Math.min(s,p+r+1),v=0,y=m;y<g;y++)v+=Math.pow(c[y],2);for(v=i*v+o,y=m;y<g;y++){var b=-2*i*a*c[y]*l[f]/v;f===y&&(b+=Math.pow(v,-a)),b*=u[f],h[y]+=b}}return _n(h,e.shape)},t.prototype.multinomial=function(e,t,n,r){th(e,"multinomial");for(var o=t?e:Ur(e),i=o.shape[0],a=o.shape[1],s=kn([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<i;++l){var h=l*a,d=new Float32Array(a-1);d[0]=c[h];for(var f=1;f<d.length;++f)d[f]=d[f-1]+c[h+f];for(var p=Gn(r.toString()),m=l*n,g=0;g<n;++g){var v=p();u[m+g]=d.length;for(var y=0;y<d.length;y++)if(v<d[y]){u[m+g]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){th(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(r);for(var i=this.readSync(e.dataId),a=0;a<e.size;++a)i[a]>=0&&i[a]<t&&(o[a*t+i[a]]=n);return xn(o,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,o){return th(e,"nonMaxSuppression"),mo(this.readSync(e.dataId),this.readSync(t.dataId),n,r,o)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],o=Xn(e.shape,"float32"),i=Xn(e.shape,"float32"),a=mn(e).as2D(n,r),s=gn(e).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=pn(c,l),d=this.readSync(this.fftImpl(h,t).dataId),f=0;f<r;f++){var p=co(d,f);o.values[u*r+f]=p.real,i.values[u*r+f]=p.imag}return pn(o.toTensor(),i.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(o=pn(mn(o).div(bn(r)),gn(o).div(bn(r)))),o}var i=this.readSync(e.dataId),a=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(i,r,t));return pn(a.real,a.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),o=t/2,i=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=0;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),a=pn(i.real,i.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),o=2;o<e.length;o+=4)n[Math.floor(o/4)]=e[o],r[Math.floor(o/4)]=e[o+1];return{real:n,imag:r}}(r),u=pn(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),o=0;o<Math.ceil(e/2);o++){var i=(t?2:-2)*Math.PI*(o/e);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(t,n),l=pn(c.real,c.imag).mul(u),h=a.add(l),d=a.sub(l),f=mn(h).concat(mn(d)),p=gn(h).concat(gn(d));return pn(f,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),o=0;o<t;o++){for(var i=0,a=0,s=0;s<t;s++){var u=ho(o*s,t,n),c=co(e,s);i+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(i/=t,a/=t),lo(r,i,a,o)}return r},t.prototype.depthToSpace=function(e,t,n){O("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),O(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var r=e.shape[0],o=e.shape[1],i=e.shape[2],a=e.shape[3],s=o*t,u=i*t,c=a/(t*t),l=this.readSync(e.dataId),h=new Float32Array(r*s*u*c),d=0,f=0;f<r;++f)for(var p=0;p<s;++p)for(var m=Math.floor(p/t),g=p%t,v=0;v<u;++v)for(var y=Math.floor(v/t),b=(g*t+v%t)*c,w=0;w<c;++w){var x=w+b+a*(y+i*(m+o*f));h[d++]=l[x]}return _n(h,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var o=qr(e.shape,t.shape),i=Xn(o,n),a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Gr(e.shape,o),c=Gr(t.shape,o),l=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(a[h%a.length],s[h%s.length]);else{var d=this.bufferSync(e),f=this.bufferSync(t),p=function(n){var o=i.indexToLoc(n),h=o.slice(-e.rank);u.forEach(function(e){return h[e]=0});var p=d.locToIndex(h),m=o.slice(-t.rank);c.forEach(function(e){return m[e]=0});var g=f.locToIndex(m);l[n]=r(a[p],s[g])};for(h=0;h<l.length;++h)p(h)}return i.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=qr(e.shape,t.shape),o=Xn(r,"float32"),i=Xn(r,"float32"),a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Gr(e.shape,r),c=Gr(t.shape,r),l=o.values,h=i.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var f=d%a.length,p=d%s.length,m=n(a[2*f],a[2*f+1],s[2*p],s[2*p+1]);l[d]=m.real,h[d]=m.imag}else{var g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var i=o.indexToLoc(r),d=i.slice(-e.rank);u.forEach(function(e){return d[e]=0});var f=g.locToIndex(d),p=i.slice(-t.rank);c.forEach(function(e){return p[e]=0});var m=v.locToIndex(p),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);l[r]=y.real,h[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(o.toTensor(),i.toTensor())},t.prototype.split=function(e,t,n){return xo(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,o,i){for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=t.shape[0],d=r[0],f=r[1],p=Xn([h,d,f,l],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),v=this.readSync(e.dataId),y=e.strides,b=p.strides,w=0;w<h;w++){var x=4*w,E=m[x],_=m[x+1],C=m[x+2],k=m[x+3],S=g[w];if(!(S>=s))for(var I=d>1?(C-E)*(u-1)/(d-1):0,T=f>1?(k-_)*(c-1)/(f-1):0,N=0;N<d;N++){var R=d>1?E*(u-1)+N*I:.5*(E+C)*(u-1);if(R<0||R>u-1)for(var A=0;A<f;A++)for(var D=0;D<l;D++){var O=D+A*b[2]+N*b[1]+w*b[0];p.values[O]=i}else if("bilinear"===o){var P=Math.floor(R),F=Math.ceil(R),M=R-P;for(A=0;A<f;A++)if((H=f>1?_*(c-1)+A*T:.5*(_+k)*(c-1))<0||H>c-1)for(D=0;D<l;D++)O=D+A*b[2]+N*b[1]+w*b[0],p.values[O]=i;else{var L=Math.floor(H),B=Math.ceil(H),U=H-L;for(D=0;D<l;D++){var z=v[O=D+L*y[2]+P*y[1]+S*y[0]],V=v[O=D+B*y[2]+P*y[1]+S*y[0]],j=v[O=D+L*y[2]+F*y[1]+S*y[0]],W=z+(V-z)*U,G=j+(v[O=D+B*y[2]+F*y[1]+S*y[0]]-j)*U;O=D+A*b[2]+N*b[1]+w*b[0],p.values[O]=W+(G-W)*M}}}else for(A=0;A<f;++A){var H;if((H=f>1?_*(c-1)+A*T:.5*(_+k)*(c-1))<0||H>c-1)for(D=0;D<l;D++)O=D+A*b[2]+N*b[1]+w*b[0],p.values[O]=i;else{var q=Math.round(H),K=Math.round(R);for(D=0;D<l;D++){var X=D+q*y[2]+K*y[1]+S*y[0],Q=D+A*b[2]+N*b[1]+w*b[0];p.values[Q]=v[X]}}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var o=Rr(0,e,n),i=o.sliceRank,a=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize;return this.scatter(e,t,n,c,s,a,i,u,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],o=Sr(e,t),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return vn([],i,e.dtype);for(var c=new _e([a,s],e.dtype),l=this.readSync(t.dataId),h=this.readSync(e.dataId),d=0;d<a;d++){for(var f=[],p=0,m=0;m<r;m++){var g=l[d*r+m];p+=g*u[m],f.push(g)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+f+" does not index into "+e.shape);for(var v=0;v<s;v++)c.values[d*s+v]=h[p*s+v]}return c.toTensor().reshape(i)},t.prototype.scatterND=function(e,t,n){var r=Rr(0,e,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=bn(0);return this.scatter(e,t,n,u,a,i,o,s,c,!0)},t.prototype.fill=function(e,t,n){var r=X(n=n||oe(t),L(e));return r.fill(t),We.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=X(e.dtype,L(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return so(e,t,n)},t.prototype.scatter=function(e,t,n,r,o,i,a,s,u,c){var l=[r/o,o],h=this.readSync(e.dataId),d=this.readSync(t.dataId);if(0===r)return vn([],n,t.dtype);var f=new _e(l,t.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<i;p++){for(var m=[],g=0,v=0;v<a;v++){var y=h[p*a+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var b=0;b<o;b++)c?f.values[g*o+b]+=d[p*o+b]:f.values[g*o+b]=0===t.rank?d[0]:d[p*o+b]}return f.toTensor().reshape(n)},t}(jr);We.registerBackend("cpu",function(){return new rh},1);for(var oh=0,ih=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n;th(i,"NonMaxSuppressionWithScore");var f=go(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;th(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:gs,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n;th([o,i],gs);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(e,t,n,r,o,i){var a=qr(e,t),s=a.length,u=se(a),c=K(o,L(a)),l=e.length,h=t.length,d=se(e),f=se(t),p=Gr(e,a),m=Gr(t,a);if(p.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=i(n[g%n.length],r[g%r.length]);else{var v=function(e){var t=ve(e,s,u),o=t.slice(-l);p.forEach(function(e){return o[e]=0});var a=ge(o,l,d),g=t.slice(-h);m.forEach(function(e){return g[e]=0});var v=ge(g,h,f);c[e]=i(n[a],r[v])};for(g=0;g<c.length;++g)v(g)}return[c,a]}(o.shape,i.shape,s,u,o.dtype,function(e,t){var n=e-t;return n*n}),l=c[0],h=c[1];return{dataId:a.write(l,h,o.dtype),shape:h,dtype:o.dtype}}}];oh<ih.length;oh++)S(ih[oh]);for(var ah,sh=function(e){this.variableNames=["A"];var t=Ro(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},uh=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Ro(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},ch=0,lh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,i=r.numChannels,a="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],h=[l,c],d=[l,c,i];(s||a)&&(null==ah&&(ah=document.createElement("canvas").getContext("2d")),ah.canvas.width=c,ah.canvas.height=l,ah.drawImage(o,0,0,c,l),o=ah.canvas);var f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=Ke.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),o);var p=w().getBool("WEBGL_PACK")?new uh(d):new sh(d),m=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;$t("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n,f=go(d.readSync(i.dataId),d.readSync(a.dataId),u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,i=new za(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:gs,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n,s=w().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oi("return (a - b) * (a - b);",o.shape,i.shape):new ni("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];ch<lh.length;ch++)S(lh[ch]);for(var hh=0,dh=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:gs,gradFunc:function(e,t){var n=t[0],r=t[1],o=bn(2);return{a:function(){return Du(e,Du(o,Lu(n,r)))},b:function(){return Du(e,Du(o,Lu(r,n)))}}}}];hh<dh.length;hh++)I(dh[hh]);var fh=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();w().get("IS_BROWSER")&&w().setPlatform("browser",new fh);var ph,mh=function(){function e(){this.util=n(745),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=w().global.fetch?w().global.fetch(e,t):(null==ph&&(ph=n(318)),ph(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();w().get("IS_NODE")&&w().setPlatform("node",new mh);var gh={float32:4,int32:4,uint16:2,uint8:1,bool:1};function vh(e,t){for(var n={},r=0,o=function(t){var o=t.name,i=t.dtype,a=t.shape,s=L(a),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=gh[c.dtype],h=e.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===i)u=Float32Array.from(d,function(e){return e*c.scale+c.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(d,function(e){return Math.round(e*c.scale+c.min)})}r+=s*l}else if("string"===i){var f=L(t.shape);u=[];for(var p=0;p<f;p++){var m=new Uint32Array(e.slice(r,r+4))[0];r+=4;var g=new Uint8Array(e.slice(r,r+m));u.push(g),r+=m}}else{var v=gh[i];if(h=e.slice(r,r+s*v),"float32"===i)u=new Float32Array(h);else if("int32"===i)u=new Int32Array(h);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(h)}r+=s*v}n[o]=vn(u,a,i)},i=0,a=t;i<a.length;i++)o(a[i]);return n}function yh(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),o),o+=e.byteLength}),r.buffer}var bh="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function wh(e){return bh?Buffer.byteLength(e):new Blob([e]).size}function xh(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer}function Eh(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function _h(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:wh(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:wh(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Ch=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(e){var n=e(t,r);null!==n&&o.push(n)}),o},e}(),kh="://",Sh=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){O(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(kh)&&(t=t.slice(0,t.indexOf(kh))),O(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();O(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Ih(e){if(-1===e.indexOf(kh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Sh.getSchemes().join(","));return{scheme:e.split(kh)[0],path:e.split(kh)[1]}}function Th(e,t,n){return void 0===n&&(n=!1),v(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h;return y(this,function(d){switch(d.label){case 0:return O(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),O((r=Ch.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),O(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],O((i=Ch.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),O(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),a=i[0],s=Ih(e).scheme,u=Ih(e).path,c=s===Ih(e).scheme,[4,o.load()];case 1:return l=d.sent(),n&&c?[4,Sh.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return h=d.sent(),!n||c?[3,6]:[4,Sh.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Nh="models_store",Rh="model_info_store";function Ah(){if(!w().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Dh(e){var t=e.result;t.createObjectStore(Nh,{keyPath:"modelPath"}),t.createObjectStore(Rh,{keyPath:"modelPath"})}var Oh=function(){function e(e){if(this.indexedDB=Ah(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},e.prototype.load=function(){return v(this,void 0,void 0,function(){return y(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(e,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Dh(o)},o.onsuccess=function(){var i=o.result;if(null==t){var a=i.transaction(Nh,"readonly"),s=a.objectStore(Nh).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,c=_h(t),l=i.transaction(Rh,"readwrite"),h=l.objectStore(Rh),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var o=(u=i.transaction(Nh,"readwrite")).objectStore(Nh).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});o.onsuccess=function(){return e({modelArtifactsInfo:c})},o.onerror=function(e){var t=(h=l.objectStore(Rh)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(o.error)},t.onerror=function(e){return i.close(),r(o.error)}}},d.onerror=function(e){return i.close(),r(d.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(e){return r(o.error)}})},e.URL_SCHEME="indexeddb://",e}(),Ph=function(e){return w().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Oh.URL_SCHEME)?(t=e.slice(Oh.URL_SCHEME.length),new Oh(t)):null;var t};Ch.registerSaveRouter(Ph),Ch.registerLoadRouter(Ph);var Fh=function(){function e(){this.indexedDB=Ah()}return e.prototype.listModels=function(){return v(this,void 0,void 0,function(){var e=this;return y(this,function(t){return[2,new Promise(function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return Dh(r)},r.onsuccess=function(){var e=r.result,o=e.transaction(Rh,"readonly"),i=o.objectStore(Rh).getAll();i.onsuccess=function(){for(var e={},n=0,r=i.result;n<r.length;n++){var o=r[n];e[o.modelPath]=o.modelArtifactsInfo}t(e)},i.onerror=function(t){return e.close(),n(i.error)},o.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(e){return v(this,void 0,void 0,function(){var t=this;return y(this,function(n){var r;return e=(r=e).startsWith(Oh.URL_SCHEME)?r.slice(Oh.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return Dh(o)},o.onsuccess=function(){var t,i=o.result,a=i.transaction(Rh,"readwrite"),s=a.objectStore(Rh),u=s.get(e);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var o=s.delete(e),a=function(){var o=(t=i.transaction(Nh,"readwrite")).objectStore(Nh).delete(e);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(e){return r(u.error)}};o.onsuccess=a,o.onerror=function(e){return a(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},a.oncomplete=function(){null==t?i.close():t.oncomplete=function(){return i.close()}}},o.onerror=function(e){return r(o.error)}})]})})},e}();if(w().getBool("IS_BROWSER"))try{Sh.registerManager(Oh.URL_SCHEME,new Fh)}catch(m){}var Mh="/",Lh="tensorflowjs_models",Bh="info",Uh="model_topology",zh="weight_specs",Vh="weight_data",jh="model_metadata";function Wh(e){return{info:[Lh,e,Bh].join(Mh),topology:[Lh,e,Uh].join(Mh),weightSpecs:[Lh,e,zh].join(Mh),weightData:[Lh,e,Vh].join(Mh),modelMetadata:[Lh,e,jh].join(Mh)}}function Gh(e){var t=e.split(Mh);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Mh)}var Hh=function(){function e(e){if(!w().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Wh(this.modelPath)}return e.prototype.save=function(e){return v(this,void 0,void 0,function(){var t,n,r;return y(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=_h(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(bh)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,o=t.length;r<o;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},e.prototype.load=function(){return v(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return y(this,function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,t.userDefinedMetadata=i.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(bh){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(a),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),qh=function(e){return w().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Hh.URL_SCHEME)?(t=e.slice(Hh.URL_SCHEME.length),new Hh(t)):null;var t};Ch.registerSaveRouter(qh),Ch.registerLoadRouter(qh);var Kh=function(){function e(){O(w().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),O("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return v(this,void 0,void 0,function(){var e,t,n,r,o,i;return y(this,function(a){for(e={},t=Lh+Mh,n=Mh+Bh,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(t)&&o.endsWith(n)&&(i=Gh(o),e[i]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},e.prototype.removeModel=function(e){return v(this,void 0,void 0,function(){var t,n;return y(this,function(r){var o;if(e=(o=e).startsWith(Hh.URL_SCHEME)?o.slice(Hh.URL_SCHEME.length):o,t=Wh(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},e}();if(w().getBool("IS_BROWSER"))try{Sh.registerManager(Hh.URL_SCHEME,new Kh)}catch(m){}function Xh(e){return new Promise(function(e){return setTimeout(e)}).then(e)}var Qh=function(){function e(t){if(!w().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return v(this,void 0,void 0,function(){var t,n,r,o,i,a;return y(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=o,[4,Xh(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==e.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,Xh(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:_h(e)}]}})})},e.URL_SCHEME="downloads://",e}(),Yh=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return v(this,void 0,void 0,function(){var e,t,n=this;return y(this,function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void o(e)}var l=[],h=[],d=[];u.forEach(function(e){e.paths.forEach(function(e){h.push(e),d.push(null)}),l.push.apply(l,e.weights)}),u.forEach(function(e){e.paths.forEach(function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,o=h.indexOf(e);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:xh(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},t.onerror=function(t){return o("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])})})}else o(new Error("weightManifest field is missing from file "+e.name))}else o(new Error("modelTopology field is missing from file "+e.name))},i.onerror=function(t){return o("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(e)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map(function(e){return Eh(e.name)}),o={},i=0,a=e;i<a.length;i++)a[i].paths.forEach(function(e){var i=Eh(e);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[e]=t[r.indexOf(i)]});if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},e}();function $h(e,t,n,r){!function(e){O(null!=e&&Array.isArray(e)&&e.length>0,function(){return"promises must be a none empty array"})}(e),function(e,t){O(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e}),O(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t}),O(t>=e,function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(e.map(function(i){return i.then(function(i){var a=n+ ++o/e.length*(r-n);return t(a),i}),i}))}function Jh(e,t){return v(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l;return y(this,function(h){switch(h.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?w().platform.fetch:t.fetchFunc,r=e.map(function(e){return n(e,t.requestInit,{isBinary:!0})}),o=0,i=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,$h(r,t.onProgress,o,i)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(e){return e.arrayBuffer()}),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,$h(s,t.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}})})}function Zh(e){var t=this;return function(n,r,o){return void 0===r&&(r=""),v(t,void 0,void 0,function(){var t,i,a,s,u,c,l,h,d,f;return y(this,function(p){switch(p.label){case 0:if(t=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(e,n){var r=0;e.weights.forEach(function(e){var u="quantization"in e?e.quantization.dtype:e.dtype,c=gh[u]*L(e.shape),l=function(){t[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:e,groupOffset:r,sizeBytes:c})};null!=o?o.forEach(function(t,n){t===e.name&&(l(),a[n]=!0)}):l(),s.push(e.name),r+=c})}),!a.every(function(e){return e}))throw u=o.filter(function(e,t){return!a[t]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=t.reduce(function(e,t,n){return t&&e.push(n),e},[]),l=[],c.forEach(function(e){n[e].paths.forEach(function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)})}),[4,e(l)];case 1:return h=p.sent(),d={},f=0,c.forEach(function(e){for(var t=n[e].paths.length,r=0,o=0;o<t;o++)r+=h[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,c=0;c<t;c++){var l=new Uint8Array(h[f+c]);s.set(l,u),u+=l.byteLength}i[e].forEach(function(e){var t=vh(a.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]}),f+=t}),[2,d]}})})}}Ch.registerSaveRouter(function(e){return w().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Qh.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new Qh(e)}(e.slice(Qh.URL_SCHEME.length)):null});var ed=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(O("function"==typeof t.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=w().platform.fetch,O(null!=e&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&O(2===e.length,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return v(this,void 0,void 0,function(){var t,n,r,o;return y(this,function(i){switch(i.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=i.sent()).ok)return[2,{modelArtifactsInfo:_h(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return v(this,void 0,void 0,function(){var e,t,n,r,o,i,a,s,u,c,l,h;return y(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=t.modelTopology,o=t.weightsManifest,i=t.generatedBy,a=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:h=d.sent(),c=h[0],l=h[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:i,convertedBy:a,format:s}]}})})},e.prototype.loadWeights=function(e){return v(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,c,l,h;return y(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=e;s<u.length;s++)c=u[s],a.push.apply(a,c.weights);return l=[],e.forEach(function(e){e.paths.forEach(function(e){l.push(i+e+o)})}),[4,Jh(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[a,xh(h)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function td(e){return null!=e.match(ed.URL_SCHEME_REGEX)}var nd=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every(function(e){return td(e)}):td(e))?rd(e,{onProgress:t}):null};function rd(e,t){return new ed(e,t)}Ch.registerSaveRouter(nd),Ch.registerLoadRouter(nd);var od,id=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return v(this,void 0,void 0,function(){return y(this,function(e){return[2,this.modelArtifacts]})})},e}(),ad=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){return[2,this.saveHandler(e)]})})},e}(),sd=Object.freeze({browserFiles:function(e){return new Yh(e)},browserHTTPRequest:function(e,t){return rd(e,t)},concatenateArrayBuffers:xh,decodeWeights:vh,encodeWeights:function(e,t){return v(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return y(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e),i=function(i){var a=o[i],u=Array.isArray(e)?e[i].tensor:e[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var c={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise(function(e){return v(s,void 0,void 0,function(){var t,n,r,o,i,a,s;return y(this,function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(t=c.sent(),n=t.reduce(function(e,t){return e+t.length},0)+4*t.length,r=new Uint8Array(n),o=0,i=0;i<t.length;i++)a=t[i],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,o),o+=4,r.set(a,o),o+=a.length;return e(r),[2]}})})});r.push(l)}else r.push(u.data());null!=t&&(c.group=t),n.push(c)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:yh(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new id(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new id({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new id({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return Ch.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:_h,getSaveHandlers:function(e){return Ch.getSaveHandlers(e)},http:rd,isHTTPScheme:td,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),v(this,void 0,void 0,function(){return y(this,function(o){return[2,Zh(function(e){return Jh(e,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return Ch.registerLoadRouter(e)},registerSaveRouter:function(e){return Ch.registerSaveRouter(e)},weightsLoaderFactory:Zh,withSaveHandler:function(e){return new ad(e)},copyModel:function(e,t){return v(this,void 0,void 0,function(){return y(this,function(n){return[2,Th(e,t,!1)]})})},listModels:function(){return v(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return y(this,function(s){switch(s.label){case 0:e=Sh.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,Sh.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())t[o+kh+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return v(this,void 0,void 0,function(){return y(this,function(n){return[2,Th(e,t,!0)]})})},removeModel:function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){return t=Ih(e),[2,Sh.getManager(t.scheme).removeModel(t.path)]})})}}),ud=fn({confusionMatrix_:function(e,t,n){var r=en(e,"labels","confusionMatrix"),o=en(t,"predictions","confusionMatrix");O(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),O(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),O(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),O(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),O(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=or(r.asType("int32"),n),a=or(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),cd=(Object.freeze({confusionMatrix:ud}),fn({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=C("FromPixels",We.backendName))return We.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],h=c[1];if(a?s=e.getContext("2d").getImageData(0,0,l,h).data:r||n?s=e.data:(i||o)&&(null==od&&(od=document.createElement("canvas").getContext("2d")),od.canvas.width=l,od.canvas.height=h,od.drawImage(e,0,0,l,h),s=od.getImageData(0,0,l,h).data),4===t)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*t);for(var f=0;f<d;f++)for(var p=0;p<t;++p)u[f*t+p]=s[4*f+p]}return En(u,[h,l,t],"int32")}})),ld=Object.freeze({toPixels:function(e,t){return v(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,m,g,v,b,w,x,E,_,C,k;return y(this,function(y){switch(y.label){case 0:if(n=en(e,"img","toPixels"),e instanceof Ie||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=y.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=y.sent(),h=l[0],d=l[1],f=h[0],p=d[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(m="float32"===n.dtype?255:1,g=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)b=void 0,w=void 0,x=void 0,E=void 0,1===a?(b=s[v]*m,w=s[v]*m,x=s[v]*m,E=255):3===a?(b=s[3*v]*m,w=s[3*v+1]*m,x=s[3*v+2]*m,E=255):4===a&&(b=s[4*v]*m,w=s[4*v+1]*m,x=s[4*v+2]*m,E=s[4*v+3]*m),g[0+(_=4*v)]=Math.round(b),g[_+1]=Math.round(w),g[_+2]=Math.round(x),g[_+3]=Math.round(E);return null!=t&&(t.width=i,t.height=o,C=t.getContext("2d"),k=new ImageData(g,i,o),C.putImageData(k,0,0)),n!==e&&n.dispose(),[2,g]}})})},fromPixels:cd}),hd=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),dd=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function fd(e){O(null!=e.className,function(){return"Class being registered does not have the static className property defined."}),O("string"==typeof e.className,function(){return"className is required to be a string, but got type "+typeof e.className}),O(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),dd.register(e)}Object.freeze({Serializable:hd,SerializationMap:dd,registerClass:fd});function pd(){return 32===We.backend.floatPrecision()?.001:.1}function md(e,t,n){var r=!0;if((J(e)||J(t))&&(r=!1),J(e)&&J(t)&&(r=!0),r){var o=e.constructor.name,i=t.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(e)&&Array.isArray(t)){var a=Jt(e),s=Jt(t);if(!B(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=J(e)?e:M(e),c=J(t)?t:M(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var h=u[l],d=c[l];if(!n(h,d))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function gd(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=pd()),md(e,t,function(e,t){return gd(e,t,n)})},testEpsilon:pd,expectPromiseToFail:function(e,t){e().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return te(e)||te(e[0])||te(t)||te(t[0])?md(e,n,function(e,t){return e==t}):md(e,t,function(e,t){return gd(e,t,0)})},expectNumbersClose:function(e,t,n){if(null==n&&(n=pd()),!gd(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:Zi,webgl_util:qt,forceHalfFloat:function(){w().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:ps,setWebGLContext:$e,GPGPUContext:ea});var vd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return g(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),o=r.value,i=r.grads;if(null!=n){var a=n.map(function(e){return{name:e.name,tensor:i[e.name]}});this.applyGradients(a)}else this.applyGradients(i);return Yt(i),t?o:(o.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){O(ie(e),function(){return"The f passed in variableGrads(f) must be a function"}),O(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof Oe}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=t;if(!n)for(var r in t=[],We.registeredVariables)t.push(We.registeredVariables[r]);var o=n?t.filter(function(e){return!e.trainable}):null,i=t.length;O((t=t.filter(function(e){return e.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=We.gradients(e,t,null,!0),s=a.value,u=a.grads;O(u.some(function(e){return null!=e}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),O(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return t.forEach(function(e,t){null!=u[t]&&(c[e.name]=u[t])}),null!=o&&o.forEach(function(e){return c[e.name]=null}),{value:s,grads:c}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Yt(this.iterations_)},t.prototype.saveIterations=function(){return v(this,void 0,void 0,function(){return y(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:bn(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){return y(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){return y(this,function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}})})},t}(hd);Object.defineProperty(vd,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var yd=function(e){function t(t,n,r){void 0===r&&(r=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=We.backend.epsilon()),o}return g(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Qt(function(){return Nn(o).variable(!1)})}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Qt(function(){return Nn(o).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Qt(function(){var e=a.mul(t.rho).add(i.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(a.add(t.epsilon).sqrt()).mul(i),r=s.mul(t.rho).add(n.square().mul(1-t.rho));a.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Yt(this.accumulatedGrads.map(function(e){return e.variable})),Yt(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=e.length/2,this.accumulatedGrads=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(vd);fd(yd);var bd=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return g(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=We.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Qt(function(){return Sn(o.shape,t.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=t.accumulatedGrads[r].variable;Qt(function(){var e=a.add(i.square());a.assign(e);var n=i.div(e.add(We.backend.epsilon()).sqrt()).mul(-t.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Yt(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(vd);fd(bd);var wd=function(e){function t(t,n,r,o){void 0===o&&(o=null);var i=e.call(this)||this;return i.learningRate=t,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Qt(function(){i.accBeta1=bn(n).variable(),i.accBeta2=bn(r).variable()}),null==o&&(i.epsilon=We.backend.epsilon()),i}return g(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Qt(function(){var r=Lu(1,t.accBeta1),o=Lu(1,t.accBeta2);n.forEach(function(n,i){var a=We.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Qt(function(){return Nn(a).variable(!1)})}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:Qt(function(){return Nn(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),d=l.div(r),f=h.div(o);u.assign(l),c.assign(h);var p=d.div(f.sqrt().add(t.epsilon)).mul(-t.learningRate).add(a);a.assign(p)}}),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Yt(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&Yt(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){var t,n=this;return y(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Qt(function(){n.accBeta1.assign(Pu(n.beta1,n.iterations_+1)),n.accBeta2.assign(Pu(n.beta2,n.iterations_+1))}),t=e.length/2,this.accumulatedFirstMoment=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(vd);fd(wd);var xd=function(e){function t(t,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Qt(function(){a.iteration=bn(0).variable(),a.accBeta1=bn(n).variable()}),null==o&&(a.epsilon=We.backend.epsilon()),a}return g(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e);Qt(function(){var r=Lu(1,t.accBeta1),o=Eu(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach(function(n,i){var a=We.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Nn(a).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Nn(a).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2),d=s.abs(),f=h.maximum(d);u.assign(l),c.assign(f);var p=o.div(r).mul(l.div(f.add(t.epsilon))).add(a);a.assign(p)}}),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Yt(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&Yt(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){return y(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){return y(this,function(e){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(vd);fd(xd);var Ed=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return g(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var i=We.registeredVariables[n];Qt(function(){var e=t.c.mul(o).add(i);i.assign(e)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return We.keep(e)}(bn(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(vd);fd(Ed);var _d=function(e){function t(t,n,r){void 0===r&&(r=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=bn(o.momentum),o}return g(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=We.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Qt(function(){return Nn(o).variable(!1)})});var i=t.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[n];null!=a&&Qt(function(){var e,n=t.m.mul(i).add(a);e=t.useNesterov?t.c.mul(a.add(n.mul(t.m))).add(o):t.c.mul(n).add(o),i.assign(n),o.assign(e)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Yt(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){return y(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(Ed);fd(_d);var Cd=function(e){function t(t,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=e.call(this)||this;if(a.learningRate=t,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,null==o&&(a.epsilon=We.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return g(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map(function(e){return e.name}):Object.keys(e)).forEach(function(n,r){var o=We.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Qt(function(){return Nn(o).variable(!1)})}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Qt(function(){return Nn(o).variable(!1)})}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Qt(function(){return Nn(o).variable(!1)})});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var a=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Qt(function(){var e=a.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(i.mul(1-t.decay)),c=s.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));a.assign(e),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var h=a.mul(t.decay).add(i.square().mul(1-t.decay));c=s.mul(t.momentum).add(i.mul(t.learningRate).div(h.add(t.epsilon).sqrt())),a.assign(h),s.assign(c),l=o.sub(c),o.assign(l)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Yt(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Yt(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&Yt(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return v(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map(function(e){return{name:e.originalName,tensor:e.variable}}))]}})})},t.prototype.setWeights=function(e){return v(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),t=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(t,2*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map(function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(vd);fd(Cd);var kd=function(){function e(){}return e.sgd=function(e){return new Ed(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new _d(e,t,n)},e.rmsprop=function(e,t,n,r,o){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new Cd(e,t,n,r,o)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new wd(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new yd(e,t,n)},e.adamax=function(e,t,n,r,o){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new xd(e,t,n,r,o)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new bd(e,t)},e}();kd.sgd,kd.momentum,kd.adadelta,kd.adagrad,kd.rmsprop,kd.adamax,kd.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;function Sd(e,t,n){if(void 0===n&&(n=!1),e.beginPath(),t.slice(1).forEach(function(n,r){var o=n.x,i=n.y,a=t[r];e.moveTo(a.x,a.y),e.lineTo(o,i)}),n){var r=t[t.length-1],o=t[0];if(!r||!o)return;e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)}e.stroke()}Ie.prototype.squaredDifference=function(e){return vs(this,e)},ke=eh;var Id=function(e,t){return Id=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Id(e,t)};function Td(e,t){function n(){this.constructor=e}Id(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Nd=function(){return Nd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Nd.apply(this,arguments)};function Rd(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(g){i(g)}}function s(e){try{u(r.throw(e))}catch(g){i(g)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}u((r=r.apply(e,t||[])).next())})}function Ad(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(g){i=[6,g],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function Dd(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Od=function(){function e(e,t){if(!jd(e)||!jd(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Pd(e,t){return e instanceof Ie&&e.shape.length===t}function Fd(e){return Pd(e,3)}function Md(e){return Pd(e,4)}function Ld(e){return e%2===0}function Bd(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function Ud(e){return e&&e.width&&e.height}function zd(e){return e.reduce(function(e,t){return e.add(t)},new Gd(0,0)).div(new Gd(e.length,e.length))}function Vd(e,t,n){return Array(e).fill(0).map(function(e,r){return t+r*n})}function jd(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}function Wd(e){return jd(e)&&0<=e&&e<=1}var Gd=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Hd=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(jd),i=[r.x,r.y,r.width,r.height].every(jd);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(jd)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Gd(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Gd(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Gd(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Gd(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.round(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Math.floor(e)});return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,i=t.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:n,y:r,width:o,height:i})},e.prototype.rescale=function(t){var n=Ud(t)?t.width:t,r=Ud(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,h=s-c;return new e({x:u,y:c,width:Math.min(l,t-u),height:Math.min(h,n-c)}).floor()},e.prototype.shift=function(t,n){var r=this.width,o=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:o})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(o=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:c,x:a,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),qd=function(e){function t(t,n,r,o,i){return void 0===i&&(i=!1),e.call(this,{left:t,top:n,right:r,bottom:o},i)||this}return Td(t,e),t}(Hd),Kd=function(){function e(e,t,n,r,o){this._imageDims=new Od(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new Hd(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Hd(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Xd=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return Td(t,e),t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(Kd);function Qd(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function Yd(e,t,n,r){void 0===r&&(r=!0);for(var o=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),i=[],a=function(){var t=o.pop();i.push(t);for(var a=o,s=[],u=0;u<a.length;u++){var c=a[u],l=e[t],h=e[c];s.push(Qd(l,h,r))}o=o.filter(function(e,t){return s[t]<=n})};o.length>0;)a();return i}function $d(e,t){return Qt(function(){var n=t[0],r=t[1],o=t[2],i=Sn(Dd(e.shape.slice(0,3),[1]),n),a=Sn(Dd(e.shape.slice(0,3),[1]),r),s=Sn(Dd(e.shape.slice(0,3),[1]),o),u=Rn([i,a,s],3);return Lu(e,u)})}function Jd(e){return 1/(1+Math.exp(-e))}var Zd,ef=function(e){function t(t,n,r,o,i){return void 0===i&&(i=!1),e.call(this,{x:t,y:n,width:r,height:o},i)||this}return Td(t,e),t}(Hd),tf=function(){function e(e,t,n){void 0===n&&(n=new Gd(0,0));var r=t.width,o=t.height;this._imgDims=new Od(r,o),this._shift=n,this._positions=e.map(function(e){return e.mul(new Gd(r,o)).add(n)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Gd(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Gd(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Gd(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof Xd?e.box.floor():new Hd(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=r.useDlibAlignment,i=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],r=e[2],o=function(e){return r.sub(e).magnitude()},i=(o(t)+o(n))/2,a=Math.floor(i/.45),s=zd(e),u=Math.floor(Math.max(0,s.x-.5*a)),c=Math.floor(Math.max(0,s.y-.43*a));return new ef(u,c,Math.min(a,this.imageWidth+u),Math.min(a,this.imageHeight+c))},e.prototype.alignMinBbox=function(e){var t=function(e){var t=e.map(function(e){return e.x}),n=e.map(function(e){return e.y}),r=t.reduce(function(e,t){return t<e?t:e},1/0),o=n.reduce(function(e,t){return t<e?t:e},1/0),i=t.reduce(function(e,t){return e<t?t:e},0),a=n.reduce(function(e,t){return e<t?t:e},0);return new qd(r,o,i,a)}(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),nf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],zd([e[3],e[4]])]},t}(tf),rf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(zd)},t}(tf),of=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),this.label+(e?" ("+Bd(this.distance)+")":"")},e}(),af=function(e){function t(t,n){var r=e.call(this,t)||this;return r._label=n,r}return Td(t,e),t.assertIsValidLabeledBox=function(e,t){if(Hd.assertIsValidBox(e,t),!jd(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Hd),sf=function(){function e(e,t){if("string"!==typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(e){return new Float32Array(e)});return new e(t.label,n)},e}();!function(e){function t(t,n,r,o){var i=e.call(this,t,n)||this;return i._score=r,i._classScore=o,i}Td(t,e),t.assertIsValidPredictedBox=function(e,t){if(af.assertIsValidLabeledBox(e,t),!Wd(e.score)||!Wd(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(af);function uf(e){return e.detection instanceof Xd}function cf(e,t){var n={detection:t};return Object.assign({},e,n)}function lf(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function hf(e){var t="";if(!e)try{e=n(591)}catch(r){t=r.toString()}return{readFile:e?function(t){return new Promise(function(n,r){e.readFile(t,function(e,t){return e?r(e):n(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function df(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=hf();return Nd({Canvas:e||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function ff(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function pf(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function mf(e){Zd=e}function gf(){ff()&&mf(lf()),pf()&&mf(df())}var vf,yf={getEnv:function(){if(!Zd)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return Zd},setEnv:mf,initialize:gf,createBrowserEnv:lf,createFileSystem:hf,createNodejsEnv:df,monkeyPatch:function(e){if(Zd||gf(),!Zd)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?Zd.Canvas:t,r=e.Image,o=void 0===r?Zd.Image:r;Zd.Canvas=n,Zd.Image=o,Zd.createCanvasElement=e.createCanvasElement||function(){return new n},Zd.createImageElement=e.createImageElement||function(){return new o},Zd.ImageData=e.ImageData||Zd.ImageData,Zd.Video=e.Video||Zd.Video,Zd.fetch=e.fetch||Zd.fetch,Zd.readFile=e.readFile||Zd.readFile},isBrowser:ff,isNodejs:pf};function bf(e){return yf.isNodejs()||"string"!==typeof e?e:document.getElementById(e)}function wf(e){var t=yf.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=bf(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}gf(),function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(vf||(vf={}));var xf=function(e){void 0===e&&(e={});var t=e.anchorPosition,n=e.backgroundColor,r=e.fontColor,o=e.fontSize,i=e.fontStyle,a=e.padding;this.anchorPosition=t||vf.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=i||"Georgia",this.padding=a||4},Ef=function(){function e(t,n,r){void 0===r&&(r={}),this.text="string"===typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new xf(r)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},e.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,r=n===vf.BOTTOM_RIGHT||n===vf.TOP_RIGHT,o=n===vf.BOTTOM_LEFT||n===vf.BOTTOM_RIGHT,i=this.measureWidth(e),a=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=o?this.anchor.y-a:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-a),0)}}return{x:s,y:u}},e.prototype.draw=function(e){var t=bf(e),n=wf(t),r=this.options,o=r.backgroundColor,i=r.fontColor,a=r.fontSize,s=r.fontStyle,u=r.padding;n.font=a+"px "+s;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=o;var h=this.getUpperLeft(n,t);n.fillRect(h.x,h.y,c,l),n.fillStyle=i,this.text.forEach(function(e,t){var r=u+h.x,o=u+h.y+(t+1)*a;n.fillText(e,r,o)})},e}(),_f=function(e){void 0===e&&(e={});var t=e.boxColor,n=e.lineWidth,r=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var i={anchorPosition:vf.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new xf(Object.assign({},i,o))},Cf=function(){function e(e,t){void 0===t&&(t={}),this.box=new Hd(e),this.options=new _f(t)}return e.prototype.draw=function(e){var t=wf(e),n=this.options,r=n.boxColor,o=n.lineWidth,i=this.box,a=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=o,t.strokeRect(a,s,u,c);var l=this.options.label;l&&new Ef([l],{x:a-o/2,y:s},this.options.drawLabelOptions).draw(e)},e}();function kf(e){var t=yf.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function Sf(e){var t=yf.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Od(e.naturalWidth,e.naturalHeight):e instanceof r?new Od(e.videoWidth,e.videoHeight):new Od(e.width,e.height)}function If(e){var t=e.width,n=e.height,r=(0,yf.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function Tf(e,t){var n=yf.getEnv().ImageData;if(!(e instanceof n)&&!kf(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||Sf(e),o=r.width,i=r.height,a=If({width:o,height:i});return e instanceof n?wf(a).putImageData(e,0,0):wf(a).drawImage(e,0,0,o,i),a}function Nf(e,t){return Rd(this,void 0,void 0,function(){var n,r,o,i,a,s;return Ad(this,function(u){switch(u.label){case 0:return n=t||yf.getEnv().createCanvasElement(),r=e.shape.slice(Md(e)?1:0),o=r[0],i=r[1],a=r[2],s=Qt(function(){return e.as3D(o,i,a).toInt()}),[4,ld.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function Rf(e){var t=yf.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}var Af=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(Fd(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(Md(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var o=e instanceof yf.getEnv().Canvas?e:Tf(e);n._canvases[t]=o,n._inputDimensions[t]=[o.height,o.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return Vd(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new Od(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Qt(function(){var r=Vd(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof Ie){var i=Md(o)?o:o.expandDims();return i=function(e,t){return void 0===t&&(t=!1),Qt(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(t?.5:1)),s=r>o?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,Sn(n,0)},c=u(a),l=i-c.shape[s],h=[t&&l?u(l):null,e,c].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Rn(h,s)})}(i,t),i.shape[1]===e&&i.shape[2]===e||(i=Hl.resizeBilinear(i,[e,e])),i.as3D(e,e,3)}if(o instanceof yf.getEnv().Canvas)return ld.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=yf.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Sf(e),s=t/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=If({width:t,height:t}),h=e instanceof i?e:Tf(e),d=Math.abs(u-c)/2,f=n&&u<c?d:0,p=n&&c<u?d:0;return wf(l).drawImage(h,f,p,u,c),l}(o,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=vr(r.map(function(e){return e.toFloat()})).as4D(n.batchSize,e,e,3);return o})},e}();function Df(e){return Rd(this,void 0,void 0,function(){var t,n,r;return Ad(this,function(o){switch(o.label){case 0:if(e instanceof Af)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(bf)).forEach(function(e,r){if(!Rf(e)&&!Fd(e)&&!Md(e)){if("string"===typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Md(e)){var o=e.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(e){return Rf(e)&&(t=e,new Promise(function(e,n){if(t instanceof yf.getEnv().Canvas||kf(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),e(t))}function o(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),n(e))}t.addEventListener("load",r),t.addEventListener("error",o)}));var t}))];case 1:return o.sent(),[2,new Af(r,Array.isArray(e))]}})})}function Of(e,t){return Rd(this,void 0,void 0,function(){var n,r,o,i,a,s;return Ad(this,function(u){switch(u.label){case 0:return n=yf.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,Df(e)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,Nf(i)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=wf(r),[2,t.map(function(e){return e instanceof Xd?e.forSize(r.width,r.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(r.width,r.height)}).map(function(e){var t=e.x,n=e.y,r=e.width,o=e.height,i=If({width:r,height:o});return wf(i).putImageData(s.getImageData(t,n,r,o),0,0),i})]}})})}function Pf(e,t){return Rd(this,void 0,void 0,function(){return Ad(this,function(n){if(!Fd(e)&&!Md(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Md(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Qt(function(){var n=e.shape.slice(Md(e)?1:0),r=n[0],o=n[1],i=n[2],a=t.map(function(e){return e instanceof Xd?e.forSize(o,r).box:e}).map(function(e){return e.clipAtImageBorders(o,r)}).map(function(t){var n=t.x,a=t.y,s=t.width,u=t.height;return Oc(e.as3D(r,o,i),[a,n,0],[u,s,i])});return a})]})})}function Ff(e,t){return Rd(this,void 0,void 0,function(){var n;return Ad(this,function(r){switch(r.label){case 0:return[4,(0,yf.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function Mf(e){return Rd(this,void 0,void 0,function(){return Ad(this,function(t){switch(t.label){case 0:return[4,Ff(e)];case 1:return[2,t.sent().json()]}})})}function Lf(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",o=(e=e.replace(r,"")).split("/").filter(function(e){return e}),i=e.endsWith(".json")?o[o.length-1]:n,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=e.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function Bf(e,t){return Rd(this,void 0,void 0,function(){var n,r,o,i;return Ad(this,function(a){switch(a.label){case 0:return n=Lf(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,Mf(r)];case 1:return i=a.sent(),[2,sd.loadWeights(i,o)]}})})}var Uf=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Oe})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Oe)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,r=t.tensor,o=vn(r.dataSync());r.dispose(),e.reassignParamFromPath(n,o)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return Rd(this,void 0,void 0,function(){return Ad(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Bf(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(e){return Rd(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,c,l;return Ad(this,function(h){switch(h.label){case 0:if(e&&"string"!==typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=yf.getEnv().readFile,n=Lf(e,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,i=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},a=sd.weightsLoaderFactory(i),c=(u=JSON).parse,[4,t(r)];case 1:return s=c.apply(u,[h.sent().toString()]),[4,a(s,o)];case 2:return l=h.sent(),this.loadFromWeightMap(l),[2]}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}},{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof Ie))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function zf(e,t,n){return Qt(function(){var r=dc(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=yu(r,t.bias)})}function Vf(e,t,n){return void 0===n&&(n=!1),Qt(function(){var r=Yc(n?yu(ic(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):zf(e,t.conv0,[2,2])),o=zf(r,t.conv1,[1,1]),i=zf(Yc(yu(r,o)),t.conv2,[1,1]);return Yc(yu(r,yu(o,i)))})}function jf(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Qt(function(){var o=Yc(n?yu(ic(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):zf(e,t.conv0,r?[2,2]:[1,1])),i=zf(o,t.conv1,[1,1]),a=zf(Yc(yu(o,i)),t.conv2,[1,1]),s=zf(Yc(yu(o,yu(i,a))),t.conv3,[1,1]);return Yc(yu(o,yu(i,yu(a,s))))})}function Wf(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Qt(function(){var o=yu(ic(e,t.filters,[1,1],n),t.bias);return r?Yc(o):o})}function Gf(e,t){Object.keys(e).forEach(function(n){t.some(function(e){return e.originalPath===n})||e[n].dispose()})}function Hf(e,t){return function(n,r,o,i){var a=_n(e(n*r*o*o),[o,o,n,r]),s=wn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function qf(e,t){return function(n,r,o){var i=xn(e(n*r),[n,r]),a=wn(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var Kf=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function Xf(e,t){return function(n,r,o){var i=_n(e(9*n),[3,3,n,1]),a=_n(e(n*r),[1,1,n,r]),s=wn(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new Kf(i,a,s)}}function Qf(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new Kf(n,r,o)}}function Yf(e,t){return function(n,r,o){var i=e[n];if(!Pd(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:o||n}),i}}function $f(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function Jf(e,t){var n=Hf(e,t),r=Xf(e,t);function o(e,t,o,i){return void 0===i&&(i=!1),{conv0:i?n(e,t,3,o+"/conv0"):r(e,t,o+"/conv0"),conv1:r(t,t,o+"/conv1"),conv2:r(t,t,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(e,t,n,i){void 0===i&&(i=!1);var a=o(e,t,n,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(t,t,n+"/conv3")}}}}function Zf(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function ep(e,t){var n=Yf(e,t),r=Zf(n),o=Qf(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):o(e+"/conv0"),conv1:o(e+"/conv1"),conv2:o(e+"/conv2"),conv3:o(e+"/conv3")}}}}var tp=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return Td(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Qt(function(){var n=jf($d(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn(255)),t.dense0,!0);return n=jf(n,t.dense1),n=jf(n,t.dense2),n=jf(n,t.dense3),n=Sc(n,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ep(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return Gf(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=$f(e),r=n.extractWeights,o=n.getRemainingWeights,i=Jf(r,t).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(e)},t}(Uf);function np(e,t){return Qt(function(){return yu(mc(e,t.weights),t.bias)})}function rp(e){var t={},n={};return Object.keys(e).forEach(function(r){(r.startsWith("fc")?n:t)[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var op=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return Td(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Qt(function(){var r=e instanceof Af?t.faceFeatureExtractor.forwardInput(e):e;return np(r.as2D(r.shape[0],-1),n.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],o=$f(e),i=o.extractWeights,a=o.getRemainingWeights,s=qf(i,r)(t,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=rp(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=Yf(e,n),o={fc:(t="fc",{weights:r(t+"/weights",2),bias:r(t+"/bias",1)})};return Gf(e,n),{params:o,paramMappings:n}}(r)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,o=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(Uf),ip=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ap=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);ip.forEach(function(n,r){t[n]=e[r]})}return e.prototype.asSortedArray=function(){var e=this;return ip.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),sp=function(e){function t(t){return void 0===t&&(t=new tp),e.call(this,"FaceExpressionNet",t)||this}return Td(t,e),t.prototype.forwardInput=function(e){var t=this;return Qt(function(){return Ur(t.runNet(e))})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictExpressions=function(e){return Rd(this,void 0,void 0,function(){var t,n,r,o,i=this;return Ad(this,function(a){switch(a.label){case 0:return[4,Df(e)];case 1:return t=a.sent(),[4,this.forwardInput(t)];case 2:return n=a.sent(),[4,Promise.all(wr(n).map(function(e){return Rd(i,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}})})}))];case 3:return r=a.sent(),n.dispose(),o=r.map(function(e){return new ap(e)}),[2,t.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(op);function up(e,t){var n={expressions:t};return Object.assign({},e,n)}function cp(e){return uf(e)&&e.landmarks instanceof tf&&e.unshiftedLandmarks instanceof tf&&e.alignedRect instanceof Xd}function lp(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),i=e.detection.imageDims,a={landmarks:r,unshiftedLandmarks:t,alignedRect:new Xd(e.detection.score,o.rescale(i.reverse()),i)};return Object.assign({},e,a)}var hp=function(e){void 0===e&&(e={});var t=e.drawLines,n=void 0===t||t,r=e.drawPoints,o=void 0===r||r,i=e.lineWidth,a=e.lineColor,s=e.pointSize,u=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"},dp=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new hp(t)}return e.prototype.draw=function(e){var t=wf(e),n=this.options,r=n.drawLines,o=n.drawPoints,i=n.lineWidth,a=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof rf&&(t.strokeStyle=a,t.lineWidth=i,Sd(t,this.faceLandmarks.getJawOutline()),Sd(t,this.faceLandmarks.getLeftEyeBrow()),Sd(t,this.faceLandmarks.getRightEyeBrow()),Sd(t,this.faceLandmarks.getNose()),Sd(t,this.faceLandmarks.getLeftEye(),!0),Sd(t,this.faceLandmarks.getRightEye(),!0),Sd(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach(function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()})}},e}();function fp(e,t){var n=[],r=$f(e),o=r.extractWeights,i=r.getRemainingWeights,a=function(e,t){var n=Hf(e,t),r=Xf(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,o){return{separable_conv0:r(e,t,o+"/separable_conv0"),separable_conv1:r(t,t,o+"/separable_conv1"),expansion_conv:n(e,t,1,o+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(o,n),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,h={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};Vd(t,0,1).forEach(function(e){d["main_block_"+e]=l(128,"middle_flow/main_block_"+e)});var f={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:h,middle_flow:d,exit_flow:f}}}function pp(e,t){var n=[],r=function(e,t){var n=Yf(e,t),r=Zf(n),o=Qf(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:o(e+"/separable_conv0"),separable_conv1:o(e+"/separable_conv1"),separable_conv2:o(e+"/separable_conv2")}}}}(e,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},c={};Vd(t,0,1).forEach(function(e){c["main_block_"+e]=s("middle_flow/main_block_"+e)});var l={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return Gf(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function mp(e,t,n){return yu(ic(e,t.filters,n,"same"),t.bias)}function gp(e,t,n){void 0===n&&(n=!0);var r=n?Yc(e):e;return r=zf(r,t.separable_conv0,[1,1]),r=zf(Yc(r),t.separable_conv1,[1,1]),r=kc(r,[3,3],[2,2],"same"),r=yu(r,mp(e,t.expansion_conv,[2,2]))}var vp,yp=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return Td(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Qt(function(){var r=$d(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn(256)),o=Yc(mp(r,n.entry_flow.conv_in,[2,2]));return o=gp(o,n.entry_flow.reduction_block_0,!1),o=gp(o,n.entry_flow.reduction_block_1),Vd(t._numMainBlocks,0,1).forEach(function(e){o=function(e,t){var n=zf(Yc(e),t.separable_conv0,[1,1]);return n=zf(Yc(n),t.separable_conv1,[1,1]),n=zf(Yc(n),t.separable_conv2,[1,1]),yu(n,e)}(o,n.middle_flow["main_block_"+e])}),o=gp(o,n.exit_flow.reduction_block),o=Yc(zf(o,n.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return pp(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return fp(e,this._numMainBlocks)},t}(Uf);!function(e){e.FEMALE="female",e.MALE="male"}(vp||(vp={}));var bp=function(e){function t(t){void 0===t&&(t=new yp(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Td(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Qt(function(){var r=e instanceof Af?t.faceFeatureExtractor.forwardInput(e):e,o=Sc(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:np(o,n.fc.age).as1D(),gender:np(o,n.fc.gender)}})},t.prototype.forwardInput=function(e){var t=this;return Qt(function(){var n=t.runNet(e),r=n.age,o=n.gender;return{age:r,gender:Ur(o)}})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return Rd(this,void 0,void 0,function(){var t,n,r,o,i,a,s=this;return Ad(this,function(u){switch(u.label){case 0:return[4,Df(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=wr(n.age),o=wr(n.gender),i=r.map(function(e,t){return{ageTensor:e,genderTensor:o[t]}}),[4,Promise.all(i.map(function(e){var t=e.ageTensor,n=e.genderTensor;return Rd(s,void 0,void 0,function(){var e,r,o,i,a;return Ad(this,function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],i=(o=r>.5)?vp.MALE:vp.FEMALE,a=o?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:i,genderProbability:a}]}})})}))];case 3:return a=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=$f(e),r=n.extractWeights,o=n.getRemainingWeights,i=qf(r,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=rp(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=Yf(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Gf(e,t),{params:o,paramMappings:t}}(r)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(Uf),wp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map(function(e){var n=e.width,r=e.height,o=t/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return Qt(function(){var n=function(e,t){return vr([Sn([68],e),Sn([68],t)],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],o=n.width,i=n.height;return t(o,i)?Math.abs(o-i)/2:0},a=e.mul(Sn([o,136],t)).sub(vr(Array.from(Array(o),function(e,t){return n(function(e){return i(e,function(e,t){return e<t})}(t),function(e){return i(e,function(e,t){return t<e})}(t))}))).div(vr(Array.from(Array(o),function(e,t){return n(r[t].width,r[t].height)})));return a})},t.prototype.forwardInput=function(e){var t=this;return Qt(function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map(function(e){return{height:e[0],width:e[1]}}))})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.detectLandmarks=function(e){return Rd(this,void 0,void 0,function(){var t,n,r,o=this;return Ad(this,function(i){switch(i.label){case 0:return[4,Df(e)];case 1:return t=i.sent(),n=Qt(function(){return wr(o.forwardInput(t))}),[4,Promise.all(n.map(function(e,n){return Rd(o,void 0,void 0,function(){var r,o,i,a,s;return Ad(this,function(u){switch(u.label){case 0:return i=(o=Array).from,[4,e.data()];case 1:return r=i.apply(o,[u.sent()]),a=r.filter(function(e,t){return Ld(t)}),s=r.filter(function(e,t){return!Ld(t)}),[2,new rf(Array(68).fill(0).map(function(e,t){return new Gd(a[t],s[t])}),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(op),xp=function(e){function t(t){return void 0===t&&(t=new tp),e.call(this,"FaceLandmark68Net",t)||this}return Td(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(wp);var Ep=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return Td(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Qt(function(){var n=Vf($d(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(bn(255)),t.dense0,!0);return n=Vf(n,t.dense1),n=Vf(n,t.dense2),n=Sc(n,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=ep(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return Gf(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=$f(e),r=n.extractWeights,o=n.getRemainingWeights,i=Jf(r,t).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u}}}(e)},t}(Uf),_p=function(e){function t(t){return void 0===t&&(t=new Ep),e.call(this,"FaceLandmark68TinyNet",t)||this}return Td(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(wp);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Td(t,e)}(xp);function Cp(e,t,n,r,o){void 0===o&&(o="same");var i=t.conv,a=i.filters,s=i.bias,u=ic(e,a,n,o);return u=function(e,t){return yu(Du(e,t.weights),t.biases)}(u=yu(u,s),t.scale),r?Yc(u):u}function kp(e,t){return Cp(e,t,[1,1],!1)}function Sp(e,t){return Cp(e,t,[2,2],!0,"valid")}function Ip(e,t){function n(n,r,o,i){var a=function(t,n,r){var o=e(t),i=o.length/(n*r*r);if(i%1!==0)throw new Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return Qt(function(){return Zc(_n(o,[n,i,r,r]),[2,3,1,0])})}(n,r,o),s=wn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}function r(r,o,i,a){var s=n(r,o,i,a+"/conv"),u=function(n,r){var o=wn(e(n)),i=wn(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:i}}(o,a+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*e,t,n,o+"/conv1"),conv2:r(e,t,n,o+"/conv2")}}}}function Tp(e,t){var n=Yf(e,t);function r(e){var t=n(e+"/conv/filters",4),r=n(e+"/conv/bias",1),o=function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e);return{conv:{filters:t,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}function Np(e){var t=[],n=Tp(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),h=o("conv64_2"),d=o("conv64_3"),f=o("conv128_down"),p=o("conv128_1"),m=o("conv128_2"),g=o("conv256_down"),v=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),w=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Pd(w,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:w};return Gf(e,t),{params:x,paramMappings:t}}function Rp(e,t){var n=function(e,t){return Cp(e,t,[1,1],!0)}(e,t.conv1);return n=kp(n,t.conv2),n=yu(n,e),n=Yc(n)}function Ap(e,t){var n=Sp(e,t.conv1);n=kp(n,t.conv2);var r=Sc(e,2,2,"valid"),o=kn(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=Dd(n.shape);a[1]=1;var s=kn(a),u=Dd((n=Rn([n,s],1)).shape);u[2]=1;var c=kn(u);n=Rn([n,c],2)}return r=i?Rn([r,o],3):r,n=yu(r,n),n=Yc(n)}var Dp=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return Td(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Qt(function(){var n=Sp($d(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(bn(256)),t.conv32_down);n=Rp(n=kc(n,3,2,"valid"),t.conv32_1),n=Rp(n,t.conv32_2),n=Rp(n,t.conv32_3),n=Rp(n=Ap(n,t.conv64_down),t.conv64_1),n=Rp(n,t.conv64_2),n=Rp(n,t.conv64_3),n=Rp(n=Ap(n,t.conv128_down),t.conv128_1),n=Rp(n,t.conv128_2),n=Rp(n=Ap(n,t.conv256_down),t.conv256_1);var r=(n=Ap(n=Rp(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return mc(r,t.fc)})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return Rd(this,void 0,void 0,function(){var t,n,r,o=this;return Ad(this,function(i){switch(i.label){case 0:return[4,Df(e)];case 1:return t=i.sent(),n=Qt(function(){return wr(o.forwardInput(t))}),[4,Promise.all(n.map(function(e){return e.data()}))];case 2:return r=i.sent(),n.forEach(function(e){return e.dispose()}),[2,t.isBatchInput?r:r[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Np(e)},t.prototype.extractParams=function(e){return function(e){var t=$f(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=Ip(n,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),_=Qt(function(){return Zc(xn(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:w,conv256_2:x,conv256_down_out:E,fc:_},paramMappings:o}}(e)},t}(Uf);function Op(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var Pp=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,o=t.maxNumScales,i=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!==typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!==typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function Fp(e,t){function n(n,r,o,i,a){var s=_n(e(n*r*o*o),[o,o,n,r]),u=wn(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,o){var i=n(e,t,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(n,o,i){var a=function(n,r){var o=_n(e(9*n),[3,3,n,1]),i=wn(e(n)),a=wn(e(n)),s=wn(e(n)),u=wn(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:i,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,i+"/depthwise_conv");return{depthwise_conv:a,pointwise_conv:r(n,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function Mp(e){var t=[],n=function(e,t){var n=Yf(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",i=t+"/depthwise_conv",a=t+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,a)}}function i(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function a(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Fd(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Gf(e,t),{params:a,paramMappings:t}}function Lp(e,t,n){return Qt(function(){var r=ic(e,t.filters,n,"same");return r=yu(r,t.batch_norm_offset),Ss(r,0,6)})}function Bp(e,t){return Qt(function(){var n=null,r=Lp(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(e,t){var o=t+1,i=function(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}(o);r=function(e,t,n){return Qt(function(){var r=cc(e,t.filters,n,"same");return r=uu(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Ss(r,0,6)})}(r,e.depthwise_conv,i),r=Lp(r,e.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Up(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),d=(a-o)*(s-i),f=(l-u)*(h-c);if(d<=0||f<=0)return 0;var p=Math.max(o,u),m=Math.max(i,c),g=Math.min(a,l),v=Math.min(s,h),y=Math.max(g-p,0)*Math.max(v-m,0);return y/(d+f-y)}function zp(e,t){var n=function(e){var t=wr(Zc(e,[1,0])),n=[Lu(t[2],t[0]),Lu(t[3],t[1])];return{sizes:n,centers:[yu(t[0],Eu(n[0],bn(2))),yu(t[1],Eu(n[1],bn(2)))]}}(e),r=n.sizes,o=n.centers,i=wr(Zc(t,[1,0])),a=Eu(Du(Rs(Eu(i[2],bn(5))),r[0]),bn(2)),s=yu(Du(Eu(i[0],bn(10)),r[0]),o[0]),u=Eu(Du(Rs(Eu(i[3],bn(5))),r[1]),bn(2)),c=yu(Du(Eu(i[1],bn(10)),r[1]),o[1]);return Zc(vr([Lu(s,a),Lu(c,u),yu(s,a),yu(c,u)]),[1,0])}function Vp(e,t){return Qt(function(){var n=e.shape[0];return{boxPredictionEncoding:pr(Wf(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:pr(Wf(e,t.class_predictor),[n,-1,3])}})}var jp=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Wp=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return Td(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Qt(function(){var n=e.toBatchTensor(512,!1).toFloat(),r=Bp(Lu(Du(n,bn(.007843137718737125)),bn(1)),t.mobilenetv1),o=function(e,t,n){return Qt(function(){var r=Lp(e,n.conv_0,[1,1]),o=Lp(r,n.conv_1,[2,2]),i=Lp(o,n.conv_2,[1,1]),a=Lp(i,n.conv_3,[2,2]),s=Lp(a,n.conv_4,[1,1]),u=Lp(s,n.conv_5,[2,2]),c=Lp(u,n.conv_6,[1,1]),l=Lp(c,n.conv_7,[2,2]),h=Vp(t,n.box_predictor_0),d=Vp(e,n.box_predictor_1),f=Vp(o,n.box_predictor_2),p=Vp(a,n.box_predictor_3),m=Vp(u,n.box_predictor_4),g=Vp(l,n.box_predictor_5);return{boxPredictions:Rn([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:Rn([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1)}})}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Qt(function(){var r=e.shape[0],o=zp(pr(yr(n.extra_dim,[r,1,1]),[-1,4]),pr(e,[-1,4]));o=pr(o,[r,o.shape[0]/r,4]);var i=zs(Rc(t,[0,0,1],[-1,-1,-1])),a=Rc(i,[0,0,0],[-1,-1,1]);return a=pr(a,[r,a.shape[1]]),{boxes:wr(o),scores:wr(a)}})}(o.boxPredictions,o.classPredictions,t.output_layer)})},t.prototype.forward=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=this.forwardInput,[4,Df(e)];case 1:return[2,t.apply(this,[n.sent()])]}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Rd(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,m,g,v,y,b,w,x;return Ad(this,function(E){switch(E.label){case 0:return n=new jp(t),r=n.maxResults,o=n.minConfidence,[4,Df(e)];case 1:for(i=E.sent(),a=this.forwardInput(i),s=a.boxes,u=a.scores,c=s[0],l=u[0],h=1;h<s.length;h++)s[h].dispose(),u[h].dispose();return p=(f=Array).from,[4,l.data()];case 2:return d=p.apply(f,[E.sent()]),m=function(e,t,n,r,o){var i=e.shape[0],a=Math.min(n,i),s=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>o}).sort(function(e,t){return t.score-e.score}),u=function(e){return e<=r?1:0},c=[];return s.forEach(function(t){if(!(c.length>=a)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=Up(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=o))break}n===t.score&&c.push(t.boxIndex)}}),c}(c,d,r,.5,o),g=i.getReshapedInputDimensions(0),v=i.inputSize,y=v/g.width,b=v/g.height,w=c.arraySync(),x=m.map(function(e){var t=[Math.max(0,w[e][0]),Math.min(1,w[e][2])].map(function(e){return e*b}),n=t[0],r=t[1],o=[Math.max(0,w[e][1]),Math.min(1,w[e][3])].map(function(e){return e*y}),a=o[0],s=o[1];return new Xd(d[e],new ef(a,n,s-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),c.dispose(),l.dispose(),[2,x]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Mp(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=$f(e),r=n.extractWeights,o=n.getRemainingWeights,i=Fp(r,t),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l={extra_dim:En(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)},t}(Uf);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Td(t,e)}(Wp);var Gp,Hp=[new Gd(.738768,.874946),new Gd(2.42204,2.65704),new Gd(4.30971,7.04493),new Gd(10.246,4.59428),new Gd(12.6868,11.8741)],qp=[new Gd(1.603231,2.094468),new Gd(6.041143,7.080126),new Gd(2.882459,3.518061),new Gd(4.266906,5.178857),new Gd(9.041765,10.66308)],Kp=[117.001,114.697,97.404],Xp=function(e){return"number"===typeof e};function Qp(e){return Qt(function(){var t=Du(e,bn(.10000000149011612));return yu(Yc(Lu(e,t)),t)})}function Yp(e,t){return Qt(function(){var n=ir(e,[[0,0],[1,1],[1,1],[0,0]]);return n=ic(n,t.conv.filters,[1,1],"valid"),n=Lu(n,t.bn.sub),n=Du(n,t.bn.truediv),Qp(n=yu(n,t.conv.bias))})}function $p(e,t){return Qt(function(){var n=ir(e,[[0,0],[1,1],[1,1],[0,0]]);return n=dc(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),Qp(n=yu(n,t.bias))})}function Jp(e,t){var n=Hf(e,t);var r=Xf(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,i){var a=n(r,o,3,i+"/conv"),s=function(n,r){var o=wn(e(n)),i=wn(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:i}}(o,i+"/bn");return{conv:a,bn:s}},extractSeparableConvParams:r}}function Zp(e,t){var n=Yf(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r(e+"/conv"),o=function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn");return{conv:t,bn:o}},extractSeparableConvParams:Qf(n)}}!function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"}(Gp||(Gp={}));var em=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),tm=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!==typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Xp(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"===typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return Xp(e.x)&&Xp(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(Xp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return Td(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=Yp(e,t.conv0);return n=Yp(n=kc(n,[2,2],[2,2],"same"),t.conv1),n=Yp(n=kc(n,[2,2],[2,2],"same"),t.conv2),n=Yp(n=kc(n,[2,2],[2,2],"same"),t.conv3),n=Yp(n=kc(n,[2,2],[2,2],"same"),t.conv4),n=Yp(n=kc(n,[2,2],[2,2],"same"),t.conv5),n=Yp(n=kc(n,[2,2],[1,1],"same"),t.conv6),Wf(n=Yp(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?Qp(Wf(e,t.conv0,"valid",!1)):$p(e,t.conv0);return n=$p(n=kc(n,[2,2],[2,2],"same"),t.conv1),n=$p(n=kc(n,[2,2],[2,2],"same"),t.conv2),n=$p(n=kc(n,[2,2],[2,2],"same"),t.conv3),n=$p(n=kc(n,[2,2],[2,2],"same"),t.conv4),n=$p(n=kc(n,[2,2],[2,2],"same"),t.conv5),n=kc(n,[2,2],[1,1],"same"),n=t.conv6?$p(n,t.conv6):n,Wf(n=t.conv7?$p(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Qt(function(){var o=e.toBatchTensor(t,!1).toFloat();return o=(o=n.config.meanRgb?$d(o,n.config.meanRgb):o).div(bn(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},t.prototype.forward=function(e,t){return Rd(this,void 0,void 0,function(){var n;return Ad(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Df(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Rd(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,m=this;return Ad(this,function(g){switch(g.label){case 0:return n=new em(t),r=n.inputSize,o=n.scoreThreshold,[4,Df(e)];case 1:return i=g.sent(),[4,this.forwardInput(i,r)];case 2:return a=g.sent(),s=Qt(function(){return wr(a)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),o)];case 3:return c=g.sent(),a.dispose(),s.dispose(),l=c.map(function(e){return e.box}),h=c.map(function(e){return e.score}),d=c.map(function(e){return e.classScore}),f=c.map(function(e){return m.config.classes[e.label]}),p=Yd(l.map(function(e){return e.rescale(r)}),h,this.config.iouThreshold,!0),[2,p.map(function(e){return new Kd(h[e],d[e],f[e],l[e],u)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],o=Zp(e,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return Gf(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var o,i=$f(e),a=i.extractWeights,s=i.getRemainingWeights,u=[],c=Jp(a,u),l=c.extractConvParams,h=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(t.withSeparableConvs){var f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],w=r[7],x=r[8];o={conv0:t.isFirstLayerConv2d?l(f,p,3,"conv0"):d(f,p,"conv0"),conv1:d(p,m,"conv1"),conv2:d(m,g,"conv2"),conv3:d(g,v,"conv3"),conv4:d(v,y,"conv4"),conv5:d(y,b,"conv5"),conv6:w?d(b,w,"conv6"):void 0,conv7:x?d(w,x,"conv7"):void 0,conv8:l(x||w||b,5*n,1,"conv8")}}else f=r[0],p=r[1],m=r[2],g=r[3],v=r[4],y=r[5],b=r[6],w=r[7],x=r[8],o={conv0:h(f,p,"conv0"),conv1:h(p,m,"conv1"),conv2:h(m,g,"conv2"),conv3:h(g,v,"conv3"),conv4:h(v,y,"conv4"),conv5:h(y,b,"conv5"),conv6:h(b,w,"conv6"),conv7:h(w,x,"conv7"),conv8:l(x,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return Rd(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,m,g,v,y,b,w,x,E,_,C,k,S,I,T,N,R,A,D=this;return Ad(this,function(O){switch(O.label){case 0:return r=t.width,o=t.height,i=Math.max(r,o),a=i/r,s=i/o,u=e.shape[1],c=this.config.anchors.length,l=Qt(function(){var t=e.reshape([u,u,c,D.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),D.withClassScores?Ur(t.slice([0,0,0,5],[u,u,c,D.config.classes.length]),3):bn(0)]}),h=l[0],d=l[1],f=l[2],p=[],[4,d.array()];case 1:return m=O.sent(),[4,h.array()];case 2:g=O.sent(),v=0,O.label=3;case 3:if(!(v<u))return[3,12];y=0,O.label=4;case 4:if(!(y<u))return[3,11];b=0,O.label=5;case 5:return b<c?(w=Jd(m[v][y][b][0]),!n||w>n?(x=(y+Jd(g[v][y][b][0]))/u*a,E=(v+Jd(g[v][y][b][1]))/u*s,_=Math.exp(g[v][y][b][2])*this.config.anchors[b].x/u*a,C=Math.exp(g[v][y][b][3])*this.config.anchors[b].y/u*s,k=x-_/2,S=E-C/2,I={row:v,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(f,I)]:[3,7]):[3,9]):[3,10];case 6:return A=O.sent(),[3,8];case 7:A={classScore:1,label:0},O.label=8;case 8:N=(T=A).classScore,R=T.label,p.push(Nd({box:new qd(k,S,k+_,S+C),score:w,classScore:w*N,label:R},I)),O.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return v++,[3,3];case 12:return h.dispose(),d.dispose(),f.dispose(),[2,p]}})})},t.prototype.extractPredictedClass=function(e,t){return Rd(this,void 0,void 0,function(){var n,r,o,i;return Ad(this,function(a){switch(a.label){case 0:return n=t.row,r=t.col,o=t.anchor,[4,e.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return i[n][r][o][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(Uf),nm=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:qp,meanRgb:Kp}:{anchors:Hp,withClassScores:!0});return e.call(this,n)||this}return Td(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Rd(this,void 0,void 0,function(){return Ad(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Xd(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(tm);var rm=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Td(t,e),t}(em),om=function(){function e(){}return e.prototype.then=function(e){return Rd(this,void 0,void 0,function(){var t;return Ad(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},e.prototype.run=function(){return Rd(this,void 0,void 0,function(){return Ad(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},e}();function im(e,t){var n={descriptor:t};return Object.assign({},e,n)}function am(e,t,n,r,o){return void 0===o&&(o=function(e){return e.alignedRect}),Rd(this,void 0,void 0,function(){var i,a,s,u,c;return Ad(this,function(l){switch(l.label){case 0:return i=e.map(function(e){return cp(e)?o(e):e.detection}),(s=r)?[3,5]:t instanceof Ie?[4,Pf(t,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,Of(t,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(a=s)];case 6:return c=l.sent(),a.forEach(function(e){return e instanceof Ie&&e.dispose()}),[2,c]}})})}function sm(e,t,n,r,o){return Rd(this,void 0,void 0,function(){var i=this;return Ad(this,function(a){return[2,am([e],t,function(e){return Rd(i,void 0,void 0,function(){return Ad(this,function(t){return[2,n(e[0])]})})},r,o)]})})}function um(e){var t=$f(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=function(e,t){var n=Hf(e,t),r=qf(e,t);function o(n,r){var o=wn(e(n));return t.push({paramPath:r}),o}function i(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:o(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:o(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:o(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=i([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return Nd(Nd({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=i([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return Nd(Nd({},e),{fc1:t,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var e=i([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return Nd(Nd({},e),{conv4:t,prelu4_alpha:a,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(n,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),h=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:o}}function cm(e){var t=[],n=function(e,t){var n=Yf(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function o(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function i(e){return n(e,1)}function a(e){return{conv1:r(e+"/conv1"),prelu1_alpha:i(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:i(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:i(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return Nd(Nd({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=a("rnet"),t=o("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return Nd(Nd({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=a("onet"),t=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=o("onet/fc1"),u=i("onet/prelu5_alpha"),c=o("onet/fc2_1"),l=o("onet/fc2_2"),h=o("onet/fc2_3");return Nd(Nd({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(e,t),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),u=i();return Gf(e,t),{params:{pnet:a,rnet:s,onet:u},paramMappings:t}}function lm(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}var hm=function(e){function t(t,n,r,o){return e.call(this,{left:t,top:n,right:r,bottom:o},!0)||this}return Td(t,e),t}(Hd);function dm(e){return Qt(function(){return Du(Lu(e,bn(127.5)),bn(.0078125))})}function fm(e,t){return Qt(function(){return yu(Yc(e),Du(t,Ms(Yc(Ms(e)))))})}function pm(e,t,n){return void 0===n&&(n=!1),Qt(function(){var r=Wf(e,t.conv1,"valid");return r=fm(r,t.prelu1_alpha),r=fm(r=Wf(r=kc(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),r=fm(r=Wf(r=n?r:kc(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function mm(e,t,n,r,o){o.stage1=[];var i=t.map(function(t){return Qt(function(){var n={scale:t},o=function(e,t){return Qt(function(){var n=lm(t,e.shape.slice(1)),r=n.height,o=n.width,i=dm(Hl.resizeBilinear(e,[r,o]));return Zc(i,[0,2,1,3])})}(e,t),i=Date.now(),a=function(e,t){return Qt(function(){var n=pm(e,t,!0),r=Wf(n,t.conv4_1,"valid"),o=tr(Vc(r,3),3);return{prob:Ur(Lu(r,o),3),regions:Wf(n,t.conv4_2,"valid")}})}(o,r),s=a.prob,u=a.regions;return n.pnet=Date.now()-i,{scoresTensor:wr(wr(s,3)[1])[0],regionsTensor:wr(u)[0],scale:t,statsForScale:n}})}),a=i.map(function(e){var t=e.scoresTensor,r=e.regionsTensor,i=e.scale,a=e.statsForScale,s=function(e,t,n,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new Gd(s,a));return o.map(function(e){var r=new qd(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),o=i[e.y][e.x],a=t.arraySync();return{cell:r,score:o,region:new hm(a[e.y][e.x][0],a[e.y][e.x][1],a[e.y][e.x][2],a[e.y][e.x][3])}})}(t,r,i,n);if(t.dispose(),r.dispose(),!s.length)return o.stage1.push(a),[];var u=Date.now(),c=Yd(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.5);return a.nms=Date.now()-u,a.numBoxes=c.length,o.stage1.push(a),c.map(function(e){return s[e]})}),s=a.reduce(function(e,t){return e.concat(t)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),h=Yd(s.map(function(e){return e.cell}),s.map(function(e){return e.score}),.7);o.stage1_nms=Date.now()-l,c=h.map(function(e){return s[e].score}),u=h.map(function(e){return s[e]}).map(function(e){var t=e.cell,n=e.region;return new qd(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()})}return{boxes:u,scores:c}}function gm(e,t,n){var r=n.width,o=n.height;return Rd(this,void 0,void 0,function(){var n,i,a,s=this;return Ad(this,function(u){switch(u.label){case 0:return n=wf(e),[4,Promise.all(t.map(function(t){return Rd(s,void 0,void 0,function(){var r,o,i,a,s,u,c,l;return Ad(this,function(h){return r=t.padAtBorders(e.height,e.width),o=r.y,i=r.ey,a=r.x,s=r.ex,u=a-1,c=o-1,l=n.getImageData(u,c,s-u,i-c),[2,yf.isNodejs()?Tf(l):createImageBitmap(l)]})})}))];case 1:return i=u.sent(),a=[],i.forEach(function(e){var t=wf(If({width:r,height:o}));t.drawImage(e,0,0,r,o);for(var n=t.getImageData(0,0,r,o).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);a.push(i)}),[2,a.map(function(e){return Qt(function(){return dm(Zc(_n(e,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function vm(e,t,n,r,o){return Rd(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,m,g,v,y;return Ad(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,gm(e,t,{width:24,height:24})];case 1:return a=b.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(e){var t=function(e,t){return Qt(function(){var n=pm(e,t),r=fm(np(pr(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),o=np(r,t.fc2_1),i=tr(Vc(o,1),1),a=Ur(Lu(o,i),1),s=np(r,t.fc2_2);return{scores:wr(a,1)[1],regions:s}})}(e,r);return e.dispose(),t}),o.stage2_rnet=Date.now()-i,u=s.length>1?Rn(s.map(function(e){return e.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),d=c.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=d.map(function(e){return t[e]}),p=d.map(function(e){return c[e]}),m=[],g=[],f.length>0&&(i=Date.now(),v=Yd(f,p,.7),o.stage2_nms=Date.now()-i,y=v.map(function(e){var t=s[d[e]].regions.arraySync();return new hm(t[0][0],t[0][1],t[0][2],t[0][3])}),g=v.map(function(e){return p[e]}),m=v.map(function(e,t){return f[e].calibrate(y[t])})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function ym(e,t,n,r,o){return Rd(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,m,g,v,y,b;return Ad(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,gm(e,t,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(e){var t=function(e,t){return Qt(function(){var n=pm(e,t);n=fm(n=Wf(n=kc(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=fm(np(pr(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),o=np(r,t.fc2_1),i=tr(Vc(o,1),1),a=Ur(Lu(o,i),1),s=np(r,t.fc2_2),u=np(r,t.fc2_3);return{scores:wr(a,1)[1],regions:s,points:u}})}(e,r);return e.dispose(),t}),o.stage3_onet=Date.now()-i,u=s.length>1?Rn(s.map(function(e){return e.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[w.sent()]),u.dispose(),d=c.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>n}).map(function(e){return e.idx}),f=d.map(function(e){var t=s[e].regions.arraySync();return new hm(t[0][0],t[0][1],t[0][2],t[0][3])}),p=d.map(function(e,n){return t[e].calibrate(f[n])}),m=d.map(function(e){return c[e]}),g=[],v=[],y=[],p.length>0&&(i=Date.now(),b=Yd(p,m,.7,!1),o.stage3_nms=Date.now()-i,g=b.map(function(e){return p[e]}),v=b.map(function(e){return m[e]}),y=b.map(function(e,t){return Array(5).fill(0).map(function(n,r){var o=s[e].points.arraySync();return new Gd(o[0][r]*(g[t].width+1)+g[t].left,o[0][r+5]*(g[t].height+1)+g[t].top)})})),s.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:g,scores:v,points:y}]}})})}var bm=function(e){function t(){return e.call(this,"Mtcnn")||this}return Td(t,e),t.prototype.load=function(t){return Rd(this,void 0,void 0,function(){return Ad(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},t.prototype.loadFromDisk=function(t){return Rd(this,void 0,void 0,function(){return Ad(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Rd(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,m,g,v,y,b,w,x,E;return Ad(this,function(_){switch(_.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=Qt(function(){return e=tr(ld.fromPixels(r)).toFloat(),Qt(function(){return vr(wr(e,3).reverse(),3)});var e}),s=function(e){return a.dispose(),o.total=Date.now()-i,e},u=a.shape.slice(1),c=u[0],l=u[1],h=new Pp(t),d=h.minFaceSize,f=h.scaleFactor,p=h.maxNumScales,m=h.scoreThresholds,g=h.scaleSteps,v=(g||function(e,t,n){for(var r=n[0],o=n[1],i=12/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(t,u)),s*=t,u+=1;return a}(d,f,[c,l])).filter(function(e){var t=lm(e,[c,l]);return Math.min(t.width,t.height)>12}).slice(0,p),o.scales=v,o.pyramid=v.map(function(e){return lm(e,[c,l])}),y=Date.now(),[4,mm(a,v,m[0],n.pnet,o)];case 1:return b=_.sent(),o.total_stage1=Date.now()-y,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,vm(r,b.boxes,m[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return w=_.sent(),o.total_stage2=Date.now()-y,w.boxes.length?(o.stage3_numInputBoxes=w.boxes.length,y=Date.now(),[4,ym(r,w.boxes,m[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return x=_.sent(),o.total_stage3=Date.now()-y,E=x.boxes.map(function(e,t){return lp(cf({},new Xd(x.scores[t],new ef(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new nf(x.points[t].map(function(t){return t.sub(new Gd(e.left,e.top)).div(new Gd(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,s({results:E,stats:o})]}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Rd(this,void 0,void 0,function(){var n;return Ad(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Df(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Rd(this,void 0,void 0,function(){var n;return Ad(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Df(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return cm(e)},t.prototype.extractParams=function(e){return um(e)},t}(Uf),wm=[new Gd(1.603231,2.094468),new Gd(6.041143,7.080126),new Gd(2.882459,3.518061),new Gd(4.266906,5.178857),new Gd(9.041765,10.66308)],xm=[117.001,114.697,97.404],Em=function(e){function t(){var t={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:wm,meanRgb:xm,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e.call(this,t)||this}return Td(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Rd(this,void 0,void 0,function(){return Ad(this,function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map(function(e){return new Xd(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(tm),_m={ssdMobilenetv1:new Wp,tinyFaceDetector:new Em,tinyYolov2:new nm,mtcnn:new bm,faceLandmark68Net:new xp,faceLandmark68TinyNet:new _p,faceRecognitionNet:new Dp,faceExpressionNet:new sp,ageGenderNet:new bp};function Cm(e,t){var n={age:t};return Object.assign({},e,n)}var km=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return Td(t,e),t}(om),Sm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n=this;return Ad(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,am(e=r.sent(),this.input,function(e){return Rd(n,void 0,void 0,function(){return Ad(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return _m.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){return up(e,t[n])})]}})})},t.prototype.withAgeAndGender=function(){return new Am(this,this.input)},t}(km),Im=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t;return Ad(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,sm(e,this.input,function(e){return _m.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=n.sent(),[2,up(e,t)]}})})},t.prototype.withAgeAndGender=function(){return new Dm(this,this.input)},t}(km),Tm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.withAgeAndGender=function(){return new Om(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Mm(this,this.input)},t}(Sm),Nm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.withAgeAndGender=function(){return new Pm(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Lm(this,this.input)},t}(Im),Rm=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=r,o}return Td(t,e),t}(om),Am=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n=this;return Ad(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,am(e=r.sent(),this.input,function(e){return Rd(n,void 0,void 0,function(){return Ad(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(e){return _m.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,t.sent()]}})})},this.extractedFaces)];case 2:return t=r.sent(),[2,e.map(function(e,n){var r=t[n],o=r.age;return Cm(Op(e,r.gender,r.genderProbability),o)})]}})})},t.prototype.withFaceExpressions=function(){return new Sm(this,this.input)},t}(Rm),Dm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n,r,o;return Ad(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?[4,sm(e,this.input,function(e){return _m.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=i.sent(),n=t.age,r=t.gender,o=t.genderProbability,[2,Cm(Op(e,r,o),n)]}})})},t.prototype.withFaceExpressions=function(){return new Im(this,this.input)},t}(Rm),Om=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.withFaceExpressions=function(){return new Tm(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Mm(this,this.input)},t}(Am),Pm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.withFaceExpressions=function(){return new Nm(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Lm(this,this.input)},t}(Dm),Fm=function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return Td(t,e),t}(om),Mm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e;return Ad(this,function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,am(e=t.sent(),this.input,function(e){return Promise.all(e.map(function(e){return _m.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,t.sent().map(function(t,n){return im(e[n],t)})]}})})},t.prototype.withFaceExpressions=function(){return new Tm(this,this.input)},t.prototype.withAgeAndGender=function(){return new Om(this,this.input)},t}(Fm),Lm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t;return Ad(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(e=n.sent())?[4,sm(e,this.input,function(e){return _m.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=n.sent(),[2,im(e,t)]}})})},t.prototype.withFaceExpressions=function(){return new Nm(this,this.input)},t.prototype.withAgeAndGender=function(){return new Pm(this,this.input)},t}(Fm),Bm=function(e){function t(t,n,r){var o=e.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=r,o}return Td(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?_m.faceLandmark68TinyNet:_m.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(om),Um=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n,r,o,i=this;return Ad(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),t=e.map(function(e){return e.detection}),this.input instanceof Ie?[4,Pf(this.input,t)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,Of(this.input,t)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map(function(e){return i.landmarkNet.detectLandmarks(e)}))];case 6:return o=a.sent(),n.forEach(function(e){return e instanceof Ie&&e.dispose()}),[2,e.map(function(e,t){return lp(e,o[t])})]}})})},t.prototype.withFaceExpressions=function(){return new Tm(this,this.input)},t.prototype.withAgeAndGender=function(){return new Om(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Mm(this,this.input)},t}(Bm),zm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n,r,o;return Ad(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(e=i.sent())?(t=e.detection,this.input instanceof Ie?[4,Pf(this.input,[t])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,Of(this.input,[t])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=i.sent(),n.forEach(function(e){return e instanceof Ie&&e.dispose()}),[2,lp(e,o)]}})})},t.prototype.withFaceExpressions=function(){return new Nm(this,this.input)},t.prototype.withAgeAndGender=function(){return new Pm(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Lm(this,this.input)},t}(Bm),Vm=function(e){function t(t,n){void 0===n&&(n=new jp);var r=e.call(this)||this;return r.input=t,r.options=n,r}return Td(t,e),t}(om),jm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t,n,r;return Ad(this,function(o){switch(o.label){case 0:return t=(e=this).input,(n=e.options)instanceof Pp?[4,_m.mtcnn.forward(t,n)]:[3,2];case 1:return[2,o.sent().map(function(e){return e.detection})];case 2:if(r=n instanceof rm?function(e){return _m.tinyFaceDetector.locateFaces(e,n)}:n instanceof jp?function(e){return _m.ssdMobilenetv1.locateFaces(e,n)}:n instanceof em?function(e){return _m.tinyYolov2.locateFaces(e,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return Rd(e,void 0,void 0,function(){var e;return Ad(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map(function(e){return cf({},e)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Um(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Sm(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Am(this.runAndExtendWithFaceDetections(),this.input)},t}(Vm);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Td(t,e),t.prototype.run=function(){return Rd(this,void 0,void 0,function(){var e,t;return Ad(this,function(n){switch(n.label){case 0:return[4,new jm(this.input,this.options)];case 1:return e=n.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return Rd(e,void 0,void 0,function(){var e;return Ad(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e?cf({},e):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new zm(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Im(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Dm(this.runAndExtendWithFaceDetection(),this.input)}}(Vm);!function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(e){if(e instanceof sf)return e;if(e instanceof Float32Array)return new sf(o(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new sf(o(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return function(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(e,t){return e-r[t]}).reduce(function(e,t){return e+Math.pow(t,2)},0))}(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new of(o,t.computeMeanDistance(e,r))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new of("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(e){return sf.fromJSON(e)});return new e(n,t.distanceThreshold)}}();function Wm(e,t){var n=new Od(t.width,t.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(e))return e.map(function(e){return Wm(e,{width:r,height:o})});if(cp(e)){var i=e.detection.forSize(r,o),a=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return lp(cf(e,i),a)}return uf(e)?cf(e,e.detection.forSize(r,o)):e instanceof tf||e instanceof Xd?e.forSize(r,o):e}const Gm=l("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Hm=t=>{let{onAnalysisUpdate:n,onPresenceChange:r}=t;const o=(0,e.useRef)(null),i=(0,e.useRef)(null),[a,s]=(0,e.useState)(!0),[u,c]=(0,e.useState)(null),[l,h]=(0,e.useState)(!1),p=(0,e.useRef)(Date.now()),m=(0,e.useRef)(null);return(0,e.useEffect)(()=>{(async()=>{try{const e="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model";await Promise.all([_m.tinyFaceDetector.loadFromUri(e),_m.ageGenderNet.loadFromUri(e),_m.faceLandmark68Net.loadFromUri(e),_m.faceRecognitionNet.loadFromUri(e)]),h(!0),console.log("\u2705 Face-API models loaded successfully")}catch(e){console.error("Error loading models:",e),c("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e42\u0e2b\u0e25\u0e14\u0e42\u0e21\u0e40\u0e14\u0e25 AI \u0e44\u0e14\u0e49")}})()},[]),(0,e.useEffect)(()=>{if(!l)return;return(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:"user"}});o.current&&(o.current.srcObject=e,o.current.onloadedmetadata=()=>{s(!1)})}catch(e){console.error("Error accessing webcam:",e),c("\u0e44\u0e21\u0e48\u0e2a\u0e32\u0e21\u0e32\u0e23\u0e16\u0e40\u0e02\u0e49\u0e32\u0e16\u0e36\u0e07\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e44\u0e14\u0e49 \u0e01\u0e23\u0e38\u0e13\u0e32\u0e2d\u0e19\u0e38\u0e0d\u0e32\u0e15\u0e01\u0e32\u0e23\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19\u0e01\u0e25\u0e49\u0e2d\u0e07"),s(!1)}})(),()=>{var e;null!==(e=o.current)&&void 0!==e&&e.srcObject&&o.current.srcObject.getTracks().forEach(e=>e.stop())}},[l]),(0,e.useEffect)(()=>{if(!l||a)return;const e=setInterval(async()=>{if(o.current&&4===o.current.readyState){const c=o.current,l=i.current;if(l){!function(e,t,n){void 0===n&&(n=!1);var r=n?Sf(t):t,o=r.width,i=r.height;e.width=o,e.height=i}(l,{width:c.videoWidth,height:c.videoHeight})}try{const o=await(a=c,s=new rm,void 0===s&&(s=new jp),new jm(a,s)).withFaceLandmarks().withAgeAndGender();if(l){l.getContext("2d").clearRect(0,0,l.width,l.height);const n=Wm(o,{width:c.videoWidth,height:c.videoHeight});!function(e,t){(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof Xd?t.score:uf(t)?t.detection.score:void 0,r=t instanceof Xd?t.box:uf(t)?t.detection.box:new Hd(t),o=n?""+Bd(n):void 0;new Cf(r,{label:o}).draw(e)})}(l,n),e=l,t=n,(Array.isArray(t)?t:[t]).forEach(function(t){var n=t instanceof tf?t:cp(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new dp(n).draw(e)})}if(o&&o.length>0){p.current=Date.now(),r(!0);const e=o[0],{age:t,gender:i,genderProbability:a}=e;n({gender:a>.7?i:"unknown",age:Math.round(t),confidence:a,detected:!0})}}catch(u){console.error("Detection error:",u)}}var e,t,a,s},1e3);return m.current=setInterval(()=>{Date.now()-p.current>3e4&&r(!1)},1e3),()=>{clearInterval(e),m.current&&clearInterval(m.current)}},[l,a,n,r]),u?(0,f.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 bg-red-50 rounded-xl",children:[(0,f.jsx)(Gm,{className:"w-12 h-12 text-red-500 mb-3"}),(0,f.jsx)("p",{className:"text-red-700 text-center",children:u})]}):(0,f.jsxs)("div",{className:"relative",children:[a&&(0,f.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 rounded-xl z-10",children:(0,f.jsxs)("div",{className:"text-white text-center",children:[(0,f.jsx)(d,{className:"w-12 h-12 mx-auto mb-3 animate-pulse"}),(0,f.jsx)("p",{children:"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e40\u0e1b\u0e34\u0e14\u0e01\u0e25\u0e49\u0e2d\u0e07..."})]})}),(0,f.jsxs)("div",{className:"relative rounded-xl overflow-hidden shadow-2xl",children:[(0,f.jsx)("video",{ref:o,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,f.jsx)("canvas",{ref:i,className:"absolute top-0 left-0 w-full h-full"})]}),(0,f.jsxs)("div",{className:"mt-4 flex items-center justify-center gap-2 text-sm text-gray-500",children:[(0,f.jsx)(d,{className:"w-4 h-4"}),(0,f.jsx)("span",{children:"\u0e01\u0e25\u0e49\u0e2d\u0e07\u0e01\u0e33\u0e25\u0e31\u0e07\u0e17\u0e33\u0e07\u0e32\u0e19"})]})]})},qm=l("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),Km=l("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Xm=l("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Qm=l("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Ym=l("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),$m=l("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Jm={th:'\u0e04\u0e38\u0e13\u0e04\u0e37\u0e2d "\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19" \u0e21\u0e32\u0e2a\u0e04\u0e2d\u0e15\u0e1c\u0e39\u0e49\u0e2b\u0e0d\u0e34\u0e07\u0e02\u0e2d\u0e07\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32 \u0e15\u0e2d\u0e1a\u0e40\u0e1b\u0e47\u0e19\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22\u0e40\u0e17\u0e48\u0e32\u0e19\u0e31\u0e49\u0e19 \u0e2a\u0e38\u0e20\u0e32\u0e1e \u0e40\u0e1b\u0e47\u0e19\u0e01\u0e31\u0e19\u0e40\u0e2d\u0e07 \u0e15\u0e2d\u0e1a\u0e2a\u0e31\u0e49\u0e19\u0e46 3-4 \u0e1b\u0e23\u0e30\u0e42\u0e22\u0e04',en:'You are "Tiew Son", the female mascot of Lanna Polytechnic College. \n       CRITICAL: You MUST answer in ENGLISH language only. \n       Keep it friendly and concise (3-4 sentences).',zh:'\u4f60\u662f"\u5c0f\u677e\u9f20"\uff0c\u5170\u7eb3\u7406\u5de5\u5b66\u9662\u7684\u5409\u7965\u7269\u3002\n       \u91cd\u8981\u63d0\u793a\uff1a\u4f60\u5fc5\u987b\u4ec5\u4e14\u53ea\u7528\u201c\u4e2d\u6587\u201d\u56de\u7b54\u3002\n       \u56de\u7b54\u8981\u53cb\u597d\u4e14\u7b80\u6d01\uff08\u6700\u591a3-4\u53e5\u8bdd\uff09\u3002',ko:'\ub2f9\uc2e0\uc740 "\ub760\uc6b0\uc190"\uc785\ub2c8\ub2e4. \ub780\ub098 \ud3f4\ub9ac\ud14c\ud06c\ub2c9 \ub300\ud559\uc758 \ub9c8\uc2a4\ucf54\ud2b8\uc785\ub2c8\ub2e4.\n       \uc911\uc694: \ubc18\ub4dc\uc2dc "\ud55c\uad6d\uc5b4"\ub85c\ub9cc \ub2f5\ubcc0\ud558\uc2ed\uc2dc\uc624.\n       \uce5c\uadfc\ud558\uace0 \uac04\uacb0\ud558\uac8c \ub2f5\ubcc0\ud558\uc138\uc694 (\ucd5c\ub300 3-4\ubb38\uc7a5).'},Zm={th:"\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e04\u0e48\u0e30! \u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19\u0e22\u0e34\u0e19\u0e14\u0e35\u0e15\u0e49\u0e2d\u0e19\u0e23\u0e31\u0e1a\u0e04\u0e48\u0e30 \u0e21\u0e35\u0e2d\u0e30\u0e44\u0e23\u0e43\u0e2b\u0e49\u0e0a\u0e48\u0e27\u0e22\u0e44\u0e2b\u0e21\u0e04\u0e30?",en:"Hello! I'm Tiew Son. How can I help you?",zh:"\u4f60\u597d\uff01\u6211\u662f\u5c0f\u677e\u9f20\u3002\u6211\u80fd\u5e2e\u4f60\u4ec0\u4e48\uff1f",ko:"\uc548\ub155\ud558\uc138\uc694! \ub760\uc6b0\uc190\uc785\ub2c8\ub2e4. \ubb34\uc5c7\uc744 \ub3c4\uc640\ub4dc\ub9b4\uae4c\uc694?"},eg={th:{"\u0e2a\u0e32\u0e02\u0e32":"\u0e40\u0e23\u0e32\u0e21\u0e35\u0e2b\u0e25\u0e32\u0e22\u0e2a\u0e32\u0e02\u0e32\u0e04\u0e48\u0e30 \u0e40\u0e0a\u0e48\u0e19 \u0e0a\u0e48\u0e32\u0e07\u0e22\u0e19\u0e15\u0e4c \u0e04\u0e2d\u0e21\u0e1e\u0e34\u0e27\u0e40\u0e15\u0e2d\u0e23\u0e4c \u0e1a\u0e31\u0e0d\u0e0a\u0e35 \u0e42\u0e23\u0e07\u0e41\u0e23\u0e21 \u0e41\u0e25\u0e30\u0e17\u0e48\u0e2d\u0e07\u0e40\u0e17\u0e35\u0e48\u0e22\u0e27 \u0e2a\u0e19\u0e43\u0e08\u0e2a\u0e32\u0e02\u0e32\u0e44\u0e2b\u0e19\u0e04\u0e30?","\u0e23\u0e31\u0e1a\u0e2a\u0e21\u0e31\u0e04\u0e23":"\u0e40\u0e1b\u0e34\u0e14\u0e23\u0e31\u0e1a\u0e2a\u0e21\u0e31\u0e04\u0e23\u0e0a\u0e48\u0e27\u0e07\u0e21\u0e35\u0e19\u0e32\u0e04\u0e21-\u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21\u0e04\u0e48\u0e30 \u0e2a\u0e21\u0e31\u0e04\u0e23\u0e44\u0e14\u0e49\u0e17\u0e35\u0e48\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e2b\u0e23\u0e37\u0e2d\u0e2d\u0e2d\u0e19\u0e44\u0e25\u0e19\u0e4c\u0e04\u0e48\u0e30",default:"\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19\u0e1e\u0e23\u0e49\u0e2d\u0e21\u0e0a\u0e48\u0e27\u0e22\u0e40\u0e2b\u0e25\u0e37\u0e2d\u0e04\u0e48\u0e30 \u0e16\u0e32\u0e21\u0e40\u0e23\u0e37\u0e48\u0e2d\u0e07\u0e2a\u0e32\u0e02\u0e32\u0e2b\u0e23\u0e37\u0e2d\u0e01\u0e32\u0e23\u0e2a\u0e21\u0e31\u0e04\u0e23\u0e40\u0e23\u0e35\u0e22\u0e19\u0e44\u0e14\u0e49\u0e40\u0e25\u0e22\u0e19\u0e30\u0e04\u0e30"},en:{default:"I'm here to help! Ask me about courses or admission."},zh:{default:"\u6211\u5728\u8fd9\u91cc\u5e2e\u52a9\u4f60\uff01\u95ee\u6211\u5173\u4e8e\u8bfe\u7a0b\u6216\u5165\u5b66\u7684\u95ee\u9898\u3002"},ko:{default:"\ub3c4\uc640\ub4dc\ub9ac\uaca0\uc2b5\ub2c8\ub2e4! \uacfc\uc815\uc774\ub098 \uc785\ud559\uc5d0 \ub300\ud574 \ubb3c\uc5b4\ubcf4\uc138\uc694."}},tg=["\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e17\u0e34\u0e27\u0e2a\u0e19","\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e04\u0e34\u0e27\u0e2a\u0e19","\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e1c\u0e34\u0e27\u0e2a\u0e19","\u0e17\u0e34\u0e27\u0e2a\u0e19","tiewson"],ng=t=>{let{language:n,onLanguageChange:r,userProfile:o}=t;const[i,a]=(0,e.useState)(!1),[s,u]=(0,e.useState)(!1),[c,l]=(0,e.useState)([]),[h,d]=(0,e.useState)(""),[p,m]=(0,e.useState)(!1),[v,y]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!1),[x,E]=(0,e.useState)("idle"),_=(0,e.useRef)(null),C=(0,e.useRef)(null),k=(0,e.useRef)(null),S=(0,e.useRef)(null),I=(0,e.useRef)(!1),T=(0,e.useRef)(!1),N=(0,e.useRef)(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)),R=(0,e.useCallback)(e=>{"speechSynthesis"in window&&(window.speechSynthesis.cancel(),u(!1),setTimeout(()=>{try{const t=200,r=e.match(/[^.!?]+[.!?]+/g)||[e];let o=[],i="";r.forEach(e=>{(i+e).length>t?(i&&o.push(i.trim()),i=e):i+=e}),i&&o.push(i.trim()),e.length<=t&&(o=[e]);const a={th:"th-TH",en:"en-US",zh:"zh-CN",ko:"ko-KR"};let s=0;const c=()=>{if(s>=o.length)return u(!1),void E("idle");const e=new SpeechSynthesisUtterance(o[s]);e.lang=a[n]||"th-TH",e.rate=1.05,e.pitch=1.25,e.volume=1,e.onstart=()=>{u(!0),E("talking")},e.onend=()=>{s++,s<o.length?setTimeout(c,100):(u(!1),E("idle"),S.current=null)},e.onerror=e=>{console.warn("TTS Error:",e.error),s++,s<o.length?setTimeout(c,500):(u(!1),E("idle"),S.current=null)},S.current=e,window.speechSynthesis.speak(e)};c(),N.current&&setTimeout(()=>{window.speechSynthesis.speaking&&(window.speechSynthesis.cancel(),u(!1),E("idle"))},6e4)}catch(t){console.error("TTS Init Error:",t),u(!1),E("idle")}},N.current?200:100))},[n]),A=(0,e.useCallback)(()=>{window.speechSynthesis&&window.speechSynthesis.cancel(),u(!1),E("idle"),S.current=null},[]);(0,e.useEffect)(()=>{if(N.current&&"speechSynthesis"in window){const e=()=>{const t=new SpeechSynthesisUtterance("");t.volume=0,window.speechSynthesis.speak(t),window.speechSynthesis.cancel(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};return document.addEventListener("touchstart",e,{once:!0}),document.addEventListener("click",e,{once:!0}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("click",e)}}},[]),(0,e.useEffect)(()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return void console.warn("Speech Recognition not supported");const e=window.SpeechRecognition||window.webkitSpeechRecognition;try{const t=new e;t.continuous=!0,t.interimResults=!1,t.lang="th-TH",t.onstart=()=>{T.current=!0,w(!0)},t.onend=()=>{T.current=!1,w(!1)},t.onresult=e=>{const r=e.results[e.results.length-1][0].transcript.toLowerCase();if(tg.some(e=>r.includes(e))){console.log("\u2705 Wake word detected:",r),E("bounce"),setTimeout(()=>E("idle"),1e3),y(!0);const e=Zm[n];l([{role:"assistant",content:e}]),R(e),t.stop()}},t.onerror=e=>{"no-speech"!==e.error&&"aborted"!==e.error&&console.warn("Wake word error:",e.error)},C.current=t}catch(t){console.error("Wake word init failed:",t)}try{const t=new e;t.continuous=!1,t.interimResults=!1,t.onstart=()=>{I.current=!0,a(!0)},t.onend=()=>{I.current=!1,a(!1)},t.onresult=e=>{const t=e.results[0][0].transcript;d(t),O(t)},t.onerror=e=>{"no-speech"!==e.error&&"aborted"!==e.error&&console.warn("Recognition error:",e.error),a(!1),I.current=!1},_.current=t}catch(t){console.error("Chat recognition init failed:",t)}return()=>{var e,t;null===(e=C.current)||void 0===e||e.stop(),null===(t=_.current)||void 0===t||t.stop(),A()}},[n,R,A]),(0,e.useEffect)(()=>{(()=>{var e;v||i?T.current&&(null===(e=C.current)||void 0===e||e.stop()):!T.current&&C.current&&setTimeout(()=>{try{var e;null===(e=C.current)||void 0===e||e.start()}catch(g){"Failed to execute 'start' on 'SpeechRecognition': recognition has already started."!==g.message&&console.warn("Wake word start failed:",g.message)}},500)})()},[v,i]);const D=(0,e.useCallback)(()=>{var e;i?null===(e=_.current)||void 0===e||e.stop():(A(),setTimeout(()=>{try{const e={th:"th-TH",en:"en-US",zh:"zh-CN",ko:"ko-KR"};_.current&&(_.current.lang=e[n]||"th-TH",_.current.start())}catch(g){g.message.includes("already started")||console.error("Mic start failed:",g)}},200))},[i,n,A]),O=(0,e.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;if(null!==e&&void 0!==e&&e.trim()&&!p){l(t=>[...t,{role:"user",content:e}]),d(""),m(!0),E("bounce");try{const t="AIzaSyADGdTkXOvwWQG33F-Yt77UE0f_KgzgV90",r="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent",o=await fetch("".concat(r,"?key=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"Instruction: ".concat(Jm[n],"\n\n                                    User Question: ").concat(e,"\n\n                                    Response Language: ").concat(n.toUpperCase())}]}],generationConfig:{temperature:.7,maxOutputTokens:300,topP:.8,topK:40}})});if(!o.ok){const e=await o.text();throw console.error("API Error:",o.status,e),new Error("HTTP ".concat(o.status))}const i=await o.json();let a="";if(i.candidates&&i.candidates.length>0){const e=i.candidates[0];e.content&&e.content.parts&&(a=e.content.parts.filter(e=>e.text).map(e=>e.text).join(" ").trim())}if(!a)throw console.warn("Empty AI response, using fallback"),new Error("Empty response from API");console.log("AI Response:",a),l(e=>[...e,{role:"assistant",content:a}]),setTimeout(()=>R(a),100)}catch(t){console.warn("Using fallback response:",t.message);const r=eg[n]||eg.th,o=e.toLowerCase(),i=r[Object.keys(r).find(e=>"default"!==e&&o.includes(e))]||r.default;l(e=>[...e,{role:"assistant",content:i}]),setTimeout(()=>R(i),100)}finally{m(!1),setTimeout(()=>E("idle"),1e3)}}},[h,p,n,R]);return(0,e.useEffect)(()=>{var e;null===(e=k.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[c]),(0,e.useEffect)(()=>{if(_.current){const e={th:"th-TH",en:"en-US",zh:"zh-CN",ko:"ko-KR"};_.current.lang=e[n]||"th-TH"}},[n]),(0,f.jsxs)(f.Fragment,{children:[!v&&(0,f.jsxs)("div",{className:"fixed bottom-6 right-6 z-40",children:[(0,f.jsxs)("button",{onClick:()=>{y(!0),E("bounce"),setTimeout(()=>E("idle"),1e3)},className:"relative group","aria-label":"Open Tiew Son Assistant",children:[(0,f.jsx)("img",{src:"/tiewson.png",alt:"\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19",className:"w-32 h-32 object-cover rounded-full shadow-2xl border-4 border-white transition-all duration-300 ".concat("bounce"===x?"animate-bounce":"talking"===x?"scale-105":"hover:scale-110"),style:{animation:"talking"===x?"pulse 1s ease-in-out infinite":void 0}}),(0,f.jsxs)("div",{className:"absolute -top-20 right-0 bg-white px-4 py-3 rounded-2xl shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none",children:[(0,f.jsxs)("p",{className:"text-sm text-gray-800 font-semibold",children:["th"===n&&'\ud83c\udfa4 \u0e1e\u0e39\u0e14\u0e27\u0e48\u0e32 "\u0e2a\u0e27\u0e31\u0e2a\u0e14\u0e35\u0e17\u0e34\u0e27\u0e2a\u0e19"',"en"===n&&'\ud83c\udfa4 Say "Hello Tiewson"',"zh"===n&&'\ud83c\udfa4 \u8bf4"\u4f60\u597d\u5c0f\u677e\u9f20"',"ko"===n&&'\ud83c\udfa4 "\uc548\ub155 \ub760\uc6b0\uc190" \ub9d0\ud558\uae30']}),(0,f.jsx)("div",{className:"absolute bottom-0 right-8 transform translate-y-1/2 rotate-45 w-3 h-3 bg-white"})]}),b&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{className:"absolute inset-0 rounded-full bg-green-400 opacity-20 animate-ping"}),(0,f.jsx)("div",{className:"absolute -top-1 -right-1 w-7 h-7 bg-green-500 rounded-full border-2 border-white flex items-center justify-center shadow-lg",children:(0,f.jsx)("span",{className:"text-white text-xs animate-pulse",children:"\ud83c\udfa4"})})]}),i&&(0,f.jsx)("div",{className:"absolute -top-1 -right-1 w-7 h-7 bg-red-500 rounded-full border-2 border-white animate-pulse"}),s&&(0,f.jsx)("div",{className:"absolute -top-1 -right-1 w-7 h-7 bg-orange-500 rounded-full border-2 border-white animate-pulse"})]}),b&&(0,f.jsx)("div",{className:"absolute -bottom-10 left-1/2 transform -translate-x-1/2 bg-green-500 text-white text-xs px-4 py-1.5 rounded-full shadow-lg animate-pulse whitespace-nowrap",children:"\ud83c\udfa4 \u0e01\u0e33\u0e25\u0e31\u0e07\u0e1f\u0e31\u0e07..."})]}),v&&(0,f.jsxs)("div",{className:"fixed bottom-6 right-6 w-96 bg-white rounded-3xl shadow-2xl overflow-hidden border-2 border-blue-100 z-40 animate-slideIn",children:[(0,f.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("img",{src:"/tiewson.png",alt:"\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19",className:"w-12 h-12 rounded-full border-2 border-white object-cover ".concat(s?"animate-pulse":"")}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{className:"text-white font-bold",children:"\u0e19\u0e49\u0e2d\u0e07\u0e17\u0e34\u0e27\u0e2a\u0e19"}),(0,f.jsx)("p",{className:"text-blue-100 text-xs",children:"Lanna Polytechnic Assistant"})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)("button",{onClick:()=>{const e=["th","en","zh","ko"],t=e[(e.indexOf(n)+1)%e.length];r(t)},className:"text-white hover:bg-blue-800 p-2 rounded-lg transition","aria-label":"Change language",children:(0,f.jsx)(qm,{className:"w-5 h-5"})}),(0,f.jsx)("button",{onClick:()=>{var e;y(!1),A(),null===(e=_.current)||void 0===e||e.stop()},className:"text-white hover:bg-blue-800 p-2 rounded-lg transition","aria-label":"Close chat",children:"\u2715"})]})]}),(0,f.jsxs)("div",{className:"h-80 overflow-y-auto p-4 bg-gray-50",children:[N.current&&1===c.length&&(0,f.jsx)("div",{className:"mb-3 text-center",children:(0,f.jsx)("div",{className:"inline-block bg-yellow-50 border border-yellow-200 text-yellow-800 text-xs px-3 py-2 rounded-lg",children:"\ud83d\udd0a \u0e2b\u0e32\u0e01 iOS \u0e44\u0e21\u0e48\u0e21\u0e35\u0e40\u0e2a\u0e35\u0e22\u0e07 \u0e01\u0e23\u0e38\u0e13\u0e32\u0e04\u0e25\u0e34\u0e01\u0e1b\u0e38\u0e48\u0e21\u0e25\u0e33\u0e42\u0e1e\u0e07\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e1b\u0e34\u0e14\u0e40\u0e2a\u0e35\u0e22\u0e07"})}),c.map((e,t)=>(0,f.jsx)("div",{className:"mb-3 ".concat("user"===e.role?"text-right":"text-left"),children:(0,f.jsx)("div",{className:"inline-block max-w-[80%] p-3 rounded-2xl whitespace-pre-wrap ".concat("user"===e.role?"bg-blue-600 text-white":"bg-white text-gray-800 shadow-md"),children:e.content})},t)),p&&(0,f.jsx)("div",{className:"text-left mb-3",children:(0,f.jsx)("div",{className:"inline-block bg-white p-3 rounded-2xl shadow-md",children:(0,f.jsxs)("div",{className:"flex gap-1",children:[(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,f.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,f.jsx)("div",{ref:k})]}),(0,f.jsx)("div",{className:"p-4 bg-white border-t border-gray-200",children:(0,f.jsxs)("div",{className:"flex gap-2",children:[(0,f.jsx)("button",{onClick:D,className:"p-3 rounded-xl transition-all ".concat(i?"bg-red-500 text-white scale-110":"bg-blue-100 text-blue-600 hover:bg-blue-200"),disabled:p,"aria-label":i?"Stop listening":"Start listening",children:i?(0,f.jsx)(Km,{className:"w-5 h-5"}):(0,f.jsx)(Xm,{className:"w-5 h-5"})}),(0,f.jsx)("input",{type:"text",value:h,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&O(),placeholder:"th"===n?"\u0e1e\u0e34\u0e21\u0e1e\u0e4c\u0e02\u0e49\u0e2d\u0e04\u0e27\u0e32\u0e21...":"Type message...",className:"flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition",disabled:p}),(0,f.jsx)("button",{onClick:()=>O(),disabled:!h.trim()||p,className:"p-3 rounded-xl bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all","aria-label":"Send message",children:(0,f.jsx)(Qm,{className:"w-5 h-5"})}),(0,f.jsx)("button",{onClick:()=>{if(s)A();else{R("th"===n?"\u0e17\u0e14\u0e2a\u0e2d\u0e1a\u0e40\u0e2a\u0e35\u0e22\u0e07":"Testing audio")}},className:"p-3 rounded-xl transition-all ".concat(s?"bg-orange-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),"aria-label":s?"Stop speaking":"Test speaker",title:s?"\u0e2b\u0e22\u0e38\u0e14\u0e1e\u0e39\u0e14":"\u0e17\u0e14\u0e2a\u0e2d\u0e1a\u0e40\u0e2a\u0e35\u0e22\u0e07",children:s?(0,f.jsx)(Ym,{className:"w-5 h-5"}):(0,f.jsx)($m,{className:"w-5 h-5"})})]})})]})]})},rg=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let o=e.charCodeAt(r);o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=63&o|128):55296===(64512&o)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++r)),t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=63&o|128):(t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=63&o|128)}return t},og={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let o=0;o<e.length;o+=3){const t=e[o],i=o+1<e.length,a=i?e[o+1]:0,s=o+2<e.length,u=s?e[o+2]:0,c=t>>2,l=(3&t)<<4|a>>4;let h=(15&a)<<2|u>>6,d=63&u;s||(d=64,i||(h=64)),r.push(n[c],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(rg(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const o=e[n++];if(o<128)t[r++]=String.fromCharCode(o);else if(o>191&&o<224){const i=e[n++];t[r++]=String.fromCharCode((31&o)<<6|63&i)}else if(o>239&&o<365){const i=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let o=0;o<e.length;){const t=n[e.charAt(o++)],i=o<e.length?n[e.charAt(o)]:0;++o;const a=o<e.length?n[e.charAt(o)]:64;++o;const s=o<e.length?n[e.charAt(o)]:64;if(++o,null==t||null==i||null==a||null==s)throw new ig;const u=t<<2|i>>4;if(r.push(u),64!==a){const e=i<<4&240|a>>2;if(r.push(e),64!==s){const e=a<<6&192|s;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class ig extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ag=function(e){return function(e){const t=rg(e);return og.encodeByteArray(t,!0)}(e).replace(/\./g,"")},sg=function(e){try{return og.decodeString(e,!0)}catch(g){console.error("base64Decode failed: ",g)}return null};const ug=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,cg=()=>{try{return ug()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(g){return}const t=e&&sg(e[1]);return t&&JSON.parse(t)})()}catch(g){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(g))}},lg=e=>{const t=(e=>{var t,n;return null===(n=null===(t=cg())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},hg=()=>{var e;return null===(e=cg())||void 0===e?void 0:e.config};class dg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function fg(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e);return[ag(JSON.stringify({alg:"none",type:"JWT"})),ag(JSON.stringify(i)),""].join(".")}function pg(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function mg(){return!function(){var e;const t=null===(e=cg())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(g){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function gg(){try{return"object"===typeof indexedDB}catch(g){return!1}}class vg extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,vg.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yg.prototype.create)}}class yg{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],o=r?function(e,t){return e.replace(bg,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",i="".concat(this.serviceName,": ").concat(o," (").concat(n,").");return new vg(n,i,t)}}const bg=/\{\$([^}]+)}/g;function wg(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const o of n){if(!r.includes(o))return!1;const n=e[o],i=t[o];if(xg(n)&&xg(i)){if(!wg(n,i))return!1}else if(n!==i)return!1}for(const o of r)if(!n.includes(o))return!1;return!0}function xg(e){return null!==e&&"object"===typeof e}function Eg(e){return e&&e._delegate?e._delegate:e}class _g{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Cg="[DEFAULT]";class kg{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new dg;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(g){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(g){if(r)return null;throw g}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Cg})}catch(g){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(g){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cg;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cg;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cg;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[o,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(o)&&i.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),o=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;o.add(e),this.onInitCallbacks.set(r,o);const i=this.instances.get(r);return i&&e(i,r),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(Zo){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(o=t,o===Cg?void 0:o),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(Zo){}var o;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cg;return this.component?this.component.multipleInstances?e:Cg:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Sg{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new kg(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Ig=[];var Tg;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Tg||(Tg={}));const Ng={debug:Tg.DEBUG,verbose:Tg.VERBOSE,info:Tg.INFO,warn:Tg.WARN,error:Tg.ERROR,silent:Tg.SILENT},Rg=Tg.INFO,Ag={[Tg.DEBUG]:"log",[Tg.VERBOSE]:"log",[Tg.INFO]:"info",[Tg.WARN]:"warn",[Tg.ERROR]:"error"},Dg=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=Ag[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var o=arguments.length,i=new Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];console[r]("[".concat(n,"]  ").concat(e.name,":"),...i)};class Og{constructor(e){this.name=e,this._logLevel=Rg,this._logHandler=Dg,this._userLogHandler=null,Ig.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Tg))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?Ng[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Tg.DEBUG,...t),this._logHandler(this,Tg.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Tg.VERBOSE,...t),this._logHandler(this,Tg.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Tg.INFO,...t),this._logHandler(this,Tg.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Tg.WARN,...t),this._logHandler(this,Tg.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,Tg.ERROR,...t),this._logHandler(this,Tg.ERROR,...t)}}let Pg,Fg;const Mg=new WeakMap,Lg=new WeakMap,Bg=new WeakMap,Ug=new WeakMap,zg=new WeakMap;let Vg={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Lg.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Bg.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Gg(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function jg(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Fg||(Fg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(Hg(this),n),Gg(Mg.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Gg(e.apply(Hg(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];const i=e.call(Hg(this),t,...r);return Bg.set(i,t.sort?t.sort():[t]),Gg(i)}}function Wg(e){return"function"===typeof e?jg(e):(e instanceof IDBTransaction&&function(e){if(Lg.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});Lg.set(e,t)}(e),t=e,(Pg||(Pg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Vg):e);var t}function Gg(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(Gg(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&Mg.set(t,e)}).catch(()=>{}),zg.set(t,e),t}(e);if(Ug.has(e))return Ug.get(e);const t=Wg(e);return t!==e&&(Ug.set(e,t),zg.set(t,e)),t}const Hg=e=>zg.get(e);const qg=["get","getKey","getAll","getAllKeys","count"],Kg=["put","add","delete","clear"],Xg=new Map;function Qg(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Xg.get(t))return Xg.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=Kg.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!qg.includes(n))return;const i=async function(e){const t=this.transaction(e,o?"readwrite":"readonly");let i=t.store;for(var a=arguments.length,s=new Array(a>1?a-1:0),u=1;u<a;u++)s[u-1]=arguments[u];return r&&(i=i.index(s.shift())),(await Promise.all([i[n](...s),o&&t.done]))[0]};return Xg.set(t,i),i}Vg=(e=>s(s({},e),{},{get:(t,n,r)=>Qg(t,n)||e.get(t,n,r),has:(t,n)=>!!Qg(t,n)||e.has(t,n)}))(Vg);class Yg{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const $g="@firebase/app",Jg="0.10.13",Zg=new Og("@firebase/app"),ev="@firebase/app-compat",tv="@firebase/analytics-compat",nv="@firebase/analytics",rv="@firebase/app-check-compat",ov="@firebase/app-check",iv="@firebase/auth",av="@firebase/auth-compat",sv="@firebase/database",uv="@firebase/data-connect",cv="@firebase/database-compat",lv="@firebase/functions",hv="@firebase/functions-compat",dv="@firebase/installations",fv="@firebase/installations-compat",pv="@firebase/messaging",mv="@firebase/messaging-compat",gv="@firebase/performance",vv="@firebase/performance-compat",yv="@firebase/remote-config",bv="@firebase/remote-config-compat",wv="@firebase/storage",xv="@firebase/storage-compat",Ev="@firebase/firestore",_v="@firebase/vertexai-preview",Cv="@firebase/firestore-compat",kv="firebase",Sv="[DEFAULT]",Iv={[$g]:"fire-core",[ev]:"fire-core-compat",[nv]:"fire-analytics",[tv]:"fire-analytics-compat",[ov]:"fire-app-check",[rv]:"fire-app-check-compat",[iv]:"fire-auth",[av]:"fire-auth-compat",[sv]:"fire-rtdb",[uv]:"fire-data-connect",[cv]:"fire-rtdb-compat",[lv]:"fire-fn",[hv]:"fire-fn-compat",[dv]:"fire-iid",[fv]:"fire-iid-compat",[pv]:"fire-fcm",[mv]:"fire-fcm-compat",[gv]:"fire-perf",[vv]:"fire-perf-compat",[yv]:"fire-rc",[bv]:"fire-rc-compat",[wv]:"fire-gcs",[xv]:"fire-gcs-compat",[Ev]:"fire-fst",[Cv]:"fire-fst-compat",[_v]:"fire-vertex","fire-js":"fire-js",[kv]:"fire-js-all"},Tv=new Map,Nv=new Map,Rv=new Map;function Av(e,t){try{e.container.addComponent(t)}catch(g){Zg.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),g)}}function Dv(e){const t=e.name;if(Rv.has(t))return Zg.debug("There were multiple attempts to register component ".concat(t,".")),!1;Rv.set(t,e);for(const n of Tv.values())Av(n,e);for(const n of Nv.values())Av(n,e);return!0}function Ov(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Pv=new yg("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Fv{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new _g("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pv.create("app-deleted",{appName:this._name})}}const Mv="10.14.1";function Lv(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:Sv,automaticDataCollectionEnabled:!1},t),o=r.name;if("string"!==typeof o||!o)throw Pv.create("bad-app-name",{appName:String(o)});if(n||(n=hg()),!n)throw Pv.create("no-options");const i=Tv.get(o);if(i){if(wg(n,i.options)&&wg(r,i.config))return i;throw Pv.create("duplicate-app",{appName:o})}const a=new Sg(o);for(const u of Rv.values())a.addComponent(u);const s=new Fv(n,r,a);return Tv.set(o,s),s}function Bv(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sv;const t=Tv.get(e);if(!t&&e===Sv&&hg())return Lv();if(!t)throw Pv.create("no-app",{appName:e});return t}function Uv(e,t,n){var r;let o=null!==(r=Iv[e])&&void 0!==r?r:e;n&&(o+="-".concat(n));const i=o.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=['Unable to register library "'.concat(o,'" with version "').concat(t,'":')];return i&&e.push('library name "'.concat(o,'" contains illegal characters (whitespace or "/")')),i&&a&&e.push("and"),a&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Zg.warn(e.join(" "))}Dv(new _g("".concat(o,"-version"),()=>({library:o,version:t}),"VERSION"))}const zv="firebase-heartbeat-store";let Vv=null;function jv(){return Vv||(Vv=function(e,t){let{blocked:n,upgrade:r,blocking:o,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),s=Gg(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Gg(a.result),e.oldVersion,e.newVersion,Gg(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{i&&e.addEventListener("close",()=>i()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(zv)}catch(g){console.warn(g)}}}).catch(e=>{throw Pv.create("idb-open",{originalErrorMessage:e.message})})),Vv}async function Wv(e,t){try{const n=(await jv()).transaction(zv,"readwrite"),r=n.objectStore(zv);await r.put(t,Gv(e)),await n.done}catch(g){if(g instanceof vg)Zg.warn(g.message);else{const t=Pv.create("idb-set",{originalErrorMessage:null===g||void 0===g?void 0:g.message});Zg.warn(t.message)}}}function Gv(e){return"".concat(e.name,"!").concat(e.options.appId)}class Hv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Kv(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qv();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(g){Zg.warn(g)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=qv(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const o of e){const e=n.find(e=>e.agent===o.agent);if(e){if(e.dates.push(o.date),Xv(n)>t){e.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),Xv(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),o=ag(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(g){return Zg.warn(g),""}}}function qv(){return(new Date).toISOString().substring(0,10)}class Kv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!gg()&&new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var e;t((null===(e=o.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await jv()).transaction(zv),n=await t.objectStore(zv).get(Gv(e));return await t.done,n}catch(g){if(g instanceof vg)Zg.warn(g.message);else{const t=Pv.create("idb-get",{originalErrorMessage:null===g||void 0===g?void 0:g.message});Zg.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Wv(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Wv(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Xv(e){return ag(JSON.stringify({version:2,heartbeats:e})).length}var Qv;Qv="",Dv(new _g("platform-logger",e=>new Yg(e),"PRIVATE")),Dv(new _g("heartbeat",e=>new Hv(e),"PRIVATE")),Uv($g,Jg,Qv),Uv($g,Jg,"esm2017"),Uv("fire-js","");var Yv,$v,Jv="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},Zv={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var o=0;16>o;++o)r[o]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(o=0;16>o;++o)r[o]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],o=e.g[2];var i=e.g[3],a=t+(i^n&(o^i))+r[0]+3614090360&4294967295;a=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=(n=(o=(i=(t=n+(a<<7&4294967295|a>>>25))+((a=i+(o^t&(n^o))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=o+(n^i&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^o&(i^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(o^i))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=i+(o^t&(n^o))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=o+(n^i&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^o&(i^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(o^i))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=i+(o^t&(n^o))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=o+(n^i&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^o&(i^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^n&(o^i))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=i+(o^t&(n^o))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=o+(n^i&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^o&(i^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(o^i&(n^o))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^o&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=o+(t^n&(i^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(o^i))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(o^i&(n^o))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^o&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=o+(t^n&(i^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(o^i))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(o^i&(n^o))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^o&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=o+(t^n&(i^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(o^i))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(o^i&(n^o))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=i+(n^o&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=o+(t^n&(i^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(i^t&(o^i))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^o^i)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^o)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=o+(i^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(o^i^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^o^i)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^o)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=o+(i^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(o^i^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^o^i)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^o)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=o+(i^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(o^i^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^o^i)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=i+(t^n^o)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=o+(i^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(o^i^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(o^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~o))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=o+(t^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(o|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(o^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~o))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=o+(t^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(o|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(o^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~o))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=o+(t^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(i^(o|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((i=(t=n+((a=t+(o^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=i+(n^(t|~o))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((o=i+((a=o+(t^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(o+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+o&4294967295,e.g[3]=e.g[3]+i&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,o=e.length-1;0<=o;o--){var i=0|e[o];r&&i==t||(n[o]=i,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var o=Array(arguments.length-2),i=2;i<arguments.length;i++)o[i-2]=arguments[i];return t.prototype[n].apply(e,o)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,o=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(o[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,o),i=0;break}}else for(;a<t;)if(o[i++]=e[a++],i==this.blockSize){n(this,o),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o={};function i(e){return-128<=e&&128>e?function(e,t){var n=o;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new r([0|e],0>e?-1:0)}):new r([0|e],0>e?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return s;if(0>e)return d(a(-e));for(var t=[],n=1,o=0;e>=n;o++)t[o]=e/n|0,n*=4294967296;return new r(t,0)}var s=i(0),u=i(1),c=i(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],o=0;o<t;o++)n[o]=~e.g[o];return new r(n,~e.h).add(u)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(l(t))throw Error("division by zero");if(l(e))return new m(s,s);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var o=y(n,1),i=y(r,1);for(r=y(r,2),n=y(n,2);!l(r);){var c=i.add(r);0>=c.l(e)&&(o=o.add(n),i=c),r=y(r,1),n=y(n,1)}return t=f(e,o.j(t)),new m(o,t)}for(o=s;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),c=(i=a(n)).j(t);h(c)||0<c.l(e);)c=(i=a(n-=r)).j(t);l(i)&&(i=u),o=o.add(i),e=f(e,c)}return new m(o,e)}function v(e){for(var t=e.g.length+1,n=[],o=0;o<t;o++)n[o]=e.i(o)<<1|e.i(o-1)>>>31;return new r(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var o=e.g.length-n,i=[],a=0;a<o;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new r(i,e.h)}(e=r.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=a(Math.pow(e,6)),n=this,r="";;){var o=g(n,t).g,i=((0<(n=f(n,o.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=o))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:l(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],o=0,i=0;i<=t;i++){var a=o+(65535&this.i(i))+(65535&e.i(i)),s=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);o=s>>>16,a&=65535,s&=65535,n[i]=s<<16|a}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return s;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(c)&&0>e.l(c))return a(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],o=0;o<2*t;o++)n[o]=0;for(o=0;o<this.g.length;o++)for(var i=0;i<e.g.length;i++){var u=this.i(o)>>>16,f=65535&this.i(o),m=e.i(i)>>>16,g=65535&e.i(i);n[2*o+2*i]+=f*g,p(n,2*o+2*i),n[2*o+2*i+1]+=u*g,p(n,2*o+2*i+1),n[2*o+2*i+1]+=f*m,p(n,2*o+2*i+1),n[2*o+2*i+2]+=u*m,p(n,2*o+2*i+2)}for(o=0;o<t;o++)n[o]=n[2*o+1]<<16|n[2*o];for(o=t;o<2*t;o++)n[o]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],o=0;o<t;o++)n[o]=this.i(o)&e.i(o);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],o=0;o<t;o++)n[o]=this.i(o)|e.i(o);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],o=0;o<t;o++)n[o]=this.i(o)^e.i(o);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,$v=Zv.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=a,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=a(Math.pow(n,8)),o=s,i=0;i<t.length;i+=8){var u=Math.min(8,t.length-i),c=parseInt(t.substring(i,i+u),n);8>u?(u=a(Math.pow(n,u)),o=o.j(u).add(a(c))):o=(o=o.j(r)).add(a(c))}return o},Yv=Zv.Integer=r}).apply("undefined"!==typeof Jv?Jv:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var ey,ty,ny,ry,oy,iy,ay,sy,uy="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},cy={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof uy&&uy];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var o=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in o))break e;o=o[a]}(r=r(i=o[e=e[e.length-1]]))!=i&&null!=r&&t(o,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,o={next:function(){if(!r&&n<e.length){var o=n++;return{value:t(o,e[o]),done:!1}}return r=!0,{done:!0,value:void 0}}};return o[Symbol.iterator]=function(){return o},o}(this,function(e,t){return t})}});var r=r||{},o=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:u).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var o=Array(arguments.length-2),i=2;i<arguments.length;i++)o[i-2]=arguments[i];return t.prototype[n].apply(e,o)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(i(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let o=0;o<r;o++)e[n+o]=t[o]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function v(e){return v[" "](e),e}v[" "]=function(){};var y=-1!=m().indexOf("Gecko")&&!(-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge"))&&!(-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE"))&&-1==m().indexOf("Edge");function b(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let n,r;for(let o=1;o<arguments.length;o++){for(n in r=arguments[o],r)e[n]=r[n];for(let t=0;t<x.length;t++)n=x[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function T(e){o.setTimeout(()=>{throw e},0)}function N(){var e=M;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new O,e=>e.reset());class O{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let P,F=!1,M=new class{constructor(){this.h=this.g=null}add(e,t){const n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},L=()=>{const e=o.Promise.resolve(void 0);P=()=>{e.then(B)}};var B=()=>{for(var e;e=N();){try{e.h.call(e.g)}catch(_){T(_)}var t=R;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}F=!1};function U(){this.s=this.s,this.C=this.C}function z(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}U.prototype.s=!1,U.prototype.ma=function(){this.s||(this.s=!0,this.N())},U.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},z.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(_){}return e}();function j(e,t){if(z.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{v(t.nodeName);var o=!0;break e}catch(k){}o=!1}o||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:W[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&j.aa.h.call(this)}}h(j,z);var W={2:"touch",3:"pen",4:"mouse"};j.prototype.h=function(){j.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var G="closure_listenable_"+(1e6*Math.random()|0),H=0;function q(e,t,n,r,o){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=o,this.key=++H,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e){this.src=e,this.g={},this.h=0}function Q(e,t){var n=t.type;if(n in e.g){var r,o=e.g[n],i=Array.prototype.indexOf.call(o,t,void 0);(r=0<=i)&&Array.prototype.splice.call(o,i,1),r&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,r){for(var o=0;o<e.length;++o){var i=e[o];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==r)return o}return-1}X.prototype.add=function(e,t,n,r,o){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var a=Y(e,t,r,o);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new q(t,this.src,i,!!r,o)).fa=n,e.push(t)),t};var $="closure_lm_"+(1e6*Math.random()|0),J={};function Z(e,t,n,r,o){if(r&&r.once)return te(e,t,n,r,o);if(Array.isArray(t)){for(var i=0;i<t.length;i++)Z(e,t[i],n,r,o);return null}return n=ue(n),e&&e[G]?e.K(t,n,a(r)?!!r.capture:!!r,o):ee(e,t,n,!1,r,o)}function ee(e,t,n,r,o,i){if(!t)throw Error("Invalid event type");var s=a(o)?!!o.capture:!!o,u=ae(e);if(u||(e[$]=u=new X(e)),(n=u.add(t,n,r,s,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=ie;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)V||(o=s),void 0===o&&(o=!1),e.addEventListener(t.toString(),r,o);else if(e.attachEvent)e.attachEvent(oe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function te(e,t,n,r,o){if(Array.isArray(t)){for(var i=0;i<t.length;i++)te(e,t[i],n,r,o);return null}return n=ue(n),e&&e[G]?e.L(t,n,a(r)?!!r.capture:!!r,o):ee(e,t,n,!0,r,o)}function ne(e,t,n,r,o){if(Array.isArray(t))for(var i=0;i<t.length;i++)ne(e,t[i],n,r,o);else r=a(r)?!!r.capture:!!r,n=ue(n),e&&e[G]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Y(i=e.g[t],n,r,o))&&(K(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=ae(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Y(t,n,r,o)),(n=-1<e?t[e]:null)&&re(n))}function re(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[G])Q(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(oe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ae(t))?(Q(n,e),0==n.h&&(n.src=null,t[$]=null)):K(e)}}}function oe(e){return e in J?J[e]:J[e]="on"+e}function ie(e,t){if(e.da)e=!0;else{t=new j(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&re(e),e=n.call(r,t)}return e}function ae(e){return(e=e[$])instanceof X?e:null}var se="__closure_events_fn_"+(1e9*Math.random()>>>0);function ue(e){return"function"===typeof e?e:(e[se]||(e[se]=function(t){return e.handleEvent(t)}),e[se])}function ce(){U.call(this),this.i=new X(this),this.M=this,this.F=null}function le(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new z(t,e);else if(t instanceof z)t.target=t.target||e;else{var o=t;E(t=new z(r,e),o)}if(o=!0,n)for(var i=n.length-1;0<=i;i--){var a=t.g=n[i];o=he(a,r,!0,t)&&o}if(o=he(a=t.g=e,r,!0,t)&&o,o=he(a,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=he(a=t.g=n[i],r,!1,t)&&o}function he(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var o=!0,i=0;i<t.length;++i){var a=t[i];if(a&&!a.da&&a.capture==n){var s=a.listener,u=a.ha||a.src;a.fa&&Q(e.i,a),o=!1!==s.call(u,r)&&o}}return o&&!r.defaultPrevented}function de(e,t,n){if("function"===typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:o.setTimeout(e,t||0)}function fe(e){e.g=de(()=>{e.g=null,e.i&&(e.i=!1,fe(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ce,U),ce.prototype[G]=!0,ce.prototype.removeEventListener=function(e,t,n,r){ne(this,e,t,n,r)},ce.prototype.N=function(){if(ce.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)K(n[r]);delete t.g[e],t.h--}}this.F=null},ce.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ce.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class pe extends U{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:fe(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function me(e){U.call(this),this.h=e,this.g={}}h(me,U);var ge=[];function ve(e){b(e.g,function(e,t){this.g.hasOwnProperty(t)&&re(e)},e),e.g={}}me.prototype.N=function(){me.aa.N.call(this),ve(this)},me.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ye=o.JSON.stringify,be=o.JSON.parse,we=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function xe(){}function Ee(e){return e.h||(e.h=e.i())}function _e(){}xe.prototype.h=null;var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ke(){z.call(this,"d")}function Se(){z.call(this,"c")}h(ke,z),h(Se,z);var Ie={},Te=null;function Ne(){return Te=Te||new ce}function Re(e){z.call(this,Ie.La,e)}function Ae(e){const t=Ne();le(t,new Re(t))}function De(e,t){z.call(this,Ie.STAT_EVENT,e),this.stat=t}function Oe(e){const t=Ne();le(t,new De(t,e))}function Pe(e,t){z.call(this,Ie.Ma,e),this.size=t}function Fe(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function Me(){this.g=!0}function Le(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var o=r[1];if(Array.isArray(o)&&!(1>o.length)){var i=o[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var a=1;a<o.length;a++)o[a]=""}}}return ye(n)}catch(s){return t}}(e,n)+(r?" "+r:"")})}Ie.La="serverreachability",h(Re,z),Ie.STAT_EVENT="statevent",h(De,z),Ie.Ma="timingevent",h(Pe,z),Me.prototype.xa=function(){this.g=!1},Me.prototype.info=function(){};var Be,Ue={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ze={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Ve(){}function je(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new me(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new We}function We(){this.i=null,this.g="",this.h=!1}h(Ve,xe),Ve.prototype.g=function(){return new XMLHttpRequest},Ve.prototype.i=function(){return{}},Be=new Ve;var Ge={},He={};function qe(e,t,n){e.L=1,e.v=yt(ft(t)),e.m=n,e.P=!0,Ke(e,null)}function Ke(e,t){e.F=Date.now(),Ye(e),e.A=ft(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),At(n.i,"t",r),e.C=0,n=e.j.J,e.h=new We,e.g=bn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new pe(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var o="readystatechange";Array.isArray(o)||(o&&(ge[0]=o.toString()),o=ge);for(var i=0;i<o.length;i++){var a=Z(n,o[i],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ae(),function(e,t,n,r,o,i){e.info(function(){if(e.g)if(i)for(var a="",s=i.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");a=2<=h.length&&"type"==h[1]?a+(l+"=")+c+"&":a+(l+"=redacted&")}}else a=null;else a=i;return"XMLHTTP REQ ("+r+") [attempt "+o+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Xe(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Qe(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?He:(n=Number(t.substring(n,r)),isNaN(n)?Ge:(r+=1)+n>t.length?He:(t=t.slice(r,r+n),e.C=r+n,t))}function Ye(e){e.S=Date.now()+e.I,$e(e,e.I)}function $e(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Fe(c(e.ba,e),t)}function Je(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function Ze(e){0==e.j.G||e.J||pn(e.j,e)}function et(e){Je(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ve(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function tt(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||at(n.h,e)))if(!e.K&&at(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(C){r=null}if(Array.isArray(r)&&3==r.length){var o=r;if(0==o[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;fn(n),nn(n)}ln(n),Oe(18)}}else n.za=o[1],0<n.za-n.T&&37500>o[2]&&n.F&&0==n.v&&!n.C&&(n.C=Fe(c(n.Za,n),6e3));if(1>=it(n.h)&&n.ca){try{n.ca()}catch(C){}n.ca=void 0}}else gn(n,11)}else if((e.K||n.g==e)&&fn(n),!p(t))for(o=n.Da.g.parse(t),t=0;t<o.length;t++){let c=o[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const o=c[4];null!=o&&(n.Aa=o,n.j.info("SVER="+n.Aa));const l=c[5];null!=l&&"number"===typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(st(i,i.h),i.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,vt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((r=n).qa=yn(r,r.J?r.ia:null,r.W),a.K){ut(r.h,a);var s=a,u=r.L;u&&(s.I=u),s.B&&(Je(s),Ye(s)),r.g=a}else cn(r);0<n.i.length&&on(n)}else"stop"!=c[0]&&"close"!=c[0]||gn(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?gn(n,7):tn(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Ae()}catch(C){}}je.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==$t(e)?t.j():this.Y(e)},je.prototype.Y=function(e){try{if(e==this.g)e:{const d=$t(this.g);var t=this.g.Ba();this.g.Z();if(!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||Jt(this.g)))){this.J||4!=d||7==t||Ae(),Je(this);var n=this.g.Z();this.X=n;t:if(Xe(this)){var r=Jt(this.g);e="";var i=r.length,a=4==$t(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){et(this),Ze(this);var s="";break t}this.h.i=new o.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(a&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==n,function(e,t,n,r,o,i,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+o+"]: "+t+"\n"+n+"\n"+i+" "+a})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(u)){var l=u;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Oe(12),et(this),Ze(this);break e}Le(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tt(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<s.length;){if(e=Qe(this,s),e==He){4==d&&(this.s=4,Oe(14),n=!1),Le(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ge){this.s=4,Oe(15),Le(this.i,this.l,s,"[Invalid Chunk]"),n=!1;break}Le(this.i,this.l,e,null),tt(this,e)}if(Xe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=s.length||this.h.h||(this.s=1,Oe(16),n=!1),this.o=this.o&&n,n){if(0<s.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),hn(h),h.M=!0,Oe(11))}}else Le(this.i,this.l,s,"[Invalid Chunked Response]"),et(this),Ze(this)}else Le(this.i,this.l,s,null),tt(this,s);4==d&&et(this),this.o&&!this.J&&(4==d?pn(this.j,this):(this.o=!1,Ye(this)))}else(function(e){const t={};e=(e.g&&2<=$t(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(p(e[r]))continue;var n=I(e[r]);const o=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=t[o]||[];t[o]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<s.indexOf("Unknown SID")?(this.s=3,Oe(12)):(this.s=0,Oe(13)),et(this),Ze(this)}}}catch(D){}},je.prototype.cancel=function(){this.J=!0,et(this)},je.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ae(),Oe(17)),et(this),this.s=2,Ze(this)):$e(this,this.S-e)};var nt=class{constructor(e,t){this.g=e,this.map=t}};function rt(e){this.l=e||10,o.PerformanceNavigationTiming?e=0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ot(e){return!!e.h||!!e.g&&e.g.size>=e.j}function it(e){return e.h?1:e.g?e.g.size:0}function at(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function st(e,t){e.g?e.g.add(t):e.h=t}function ut(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ct(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function lt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(i(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(i(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),o=r.length,a=0;a<o;a++)t.call(void 0,r[a],n&&n[a],e)}rt.prototype.cancel=function(){if(this.i=ct(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ht=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof dt){this.h=e.h,pt(this,e.j),this.o=e.o,this.g=e.g,mt(this,e.s),this.l=e.l;var t=e.i,n=new It;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),gt(this,n),this.m=e.m}else e&&(t=String(e).match(ht))?(this.h=!1,pt(this,t[1]||"",!0),this.o=bt(t[2]||""),this.g=bt(t[3]||"",!0),mt(this,t[4]),this.l=bt(t[5]||"",!0),gt(this,t[6]||"",!0),this.m=bt(t[7]||"")):(this.h=!1,this.i=new It(null,this.h))}function ft(e){return new dt(e)}function pt(e,t,n){e.j=n?bt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function mt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function gt(e,t,n){t instanceof It?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Nt(this,t),At(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=wt(t,kt)),e.i=new It(t,e.h))}function vt(e,t,n){e.i.set(t,n)}function yt(e){return vt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function bt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function wt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,xt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function xt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}dt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(wt(t,Et,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(wt(t,Et,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(wt(n,"/"==n.charAt(0)?Ct:_t,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",wt(n,St)),e.join("")};var Et=/[#\/\?@]/g,_t=/[#\?:]/g,Ct=/[#\?]/g,kt=/[#\?@]/g,St=/#/g;function It(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),o=null;if(0<=r){var i=e[n].substring(0,r);o=e[n].substring(r+1)}else i=e[n];t(i,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Nt(e,t){Tt(e),t=Dt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Rt(e,t){return Tt(e),t=Dt(e,t),e.g.has(t)}function At(e,t,n){Nt(e,t),0<n.length&&(e.i=null,e.g.set(Dt(e,t),d(n)),e.h+=n.length)}function Dt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ot(e,t,n,r,o){try{o&&(o.onload=null,o.onerror=null,o.onabort=null,o.ontimeout=null),r(n)}catch(k){}}function Pt(){this.g=new we}function Ft(e,t,n){const r=n||"";try{lt(e,function(e,n){let o=e;a(e)&&(o=ye(e)),t.push(r+n+"="+encodeURIComponent(o))})}catch(g){throw t.push(r+"type="+encodeURIComponent("_badmap")),g}}function Mt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Lt(e,t){ce.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Bt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Ut(e){e.readyState=4,e.l=null,e.j=null,e.v=null,zt(e)}function zt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Vt(e){let t="";return b(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function jt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Vt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):vt(e,t,n))}function Wt(e){ce.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=It.prototype).add=function(e,t){Tt(this),this.i=null,e=Dt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Tt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const o=e[r];for(let e=0;e<o.length;e++)n.push(t[r])}return n},e.V=function(e){Tt(this);let t=[];if("string"===typeof e)Rt(this,e)&&(t=t.concat(this.g.get(Dt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Tt(this),this.i=null,Rt(this,e=Dt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const i=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var o=i;""!==a[r]&&(o+="="+encodeURIComponent(String(a[r]))),e.push(o)}}return this.i=e.join("&")},h(Mt,xe),Mt.prototype.g=function(){return new Lt(this.l,this.j)},Mt.prototype.i=function(e){return function(){return e}}({}),h(Lt,ce),(e=Lt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,zt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ut(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,zt(this)),this.g&&(this.readyState=3,zt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ut(this):zt(this),3==this.readyState&&Bt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Ut(this))},e.Qa=function(e){this.g&&(this.response=e,Ut(this))},e.ga=function(){this.g&&Ut(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Lt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(Wt,ce);var Gt=/^https?$/i,Ht=["POST","PUT"];function qt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Kt(e),Qt(e)}function Kt(e){e.A||(e.A=!0,le(e,"complete"),le(e,"error"))}function Xt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=$t(e)||2!=e.Z()))if(e.u&&4==$t(e))de(e.Ea,0,e);else if(le(e,"readystatechange"),4==$t(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===r){var a=String(e.D).match(ht)[1]||null;!a&&o.self&&o.self.location&&(a=o.self.location.protocol.slice(0,-1)),i=!Gt.test(a?a.toLowerCase():"")}n=i}if(n)le(e,"complete"),le(e,"success");else{e.m=6;try{var s=2<$t(e)?e.g.statusText:""}catch(u){s=""}e.l=s+" ["+e.Z()+"]",Kt(e)}}finally{Qt(e)}}}function Qt(e,t){if(e.g){Yt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||le(e,"ready");try{n.onreadystatechange=r}catch(g){}}}function Yt(e){e.I&&(o.clearTimeout(e.I),e.I=null)}function $t(e){return e.g?e.g.readyState:0}function Jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(A){return null}}function Zt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function en(e){this.Aa=0,this.i=[],this.j=new Me,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Zt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Zt("baseRetryDelayMs",5e3,e),this.cb=Zt("retryDelaySeedMs",1e4,e),this.Wa=Zt("forwardChannelMaxRetries",2,e),this.wa=Zt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new rt(e&&e.concurrentRequestLimit),this.Da=new Pt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tn(e){if(rn(e),3==e.G){var t=e.U++,n=ft(e.I);if(vt(n,"SID",e.K),vt(n,"RID",t),vt(n,"TYPE","terminate"),sn(e,n),(t=new je(e,e.j,t)).L=2,t.v=yt(ft(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.v.toString(),"")}catch(S){}!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=bn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ye(t)}vn(e)}function nn(e){e.g&&(hn(e),e.g.cancel(),e.g=null)}function rn(e){nn(e),e.u&&(o.clearTimeout(e.u),e.u=null),fn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&o.clearTimeout(e.s),e.s=null)}function on(e){if(!ot(e.h)&&!e.s){e.s=!0;var t=e.Ga;P||L(),F||(P(),F=!0),M.add(t,e),e.B=0}}function an(e,t){var n;n=t?t.l:e.U++;const r=ft(e.I);vt(r,"SID",e.K),vt(r,"RID",n),vt(r,"AID",e.T),sn(e,r),e.m&&e.o&&jt(r,e.m,e.o),n=new je(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=un(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),st(e.h,n),qe(n,r,t)}function sn(e,t){e.H&&b(e.H,function(e,n){vt(t,n,e)}),e.l&&lt({},function(e,n){vt(t,n,e)})}function un(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var o=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=o[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let a=0;a<n;a++){let n=o[a].g;const s=o[a].map;if(n-=t,0>n)t=Math.max(0,o[a].g-100),i=!1;else try{Ft(s,e,"req"+n+"_")}catch(D){r&&r(s)}}if(i){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function cn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;P||L(),F||(P(),F=!0),M.add(t,e),e.v=0}}function ln(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Fe(c(e.Fa,e),mn(e,e.v)),e.v++,!0)}function hn(e){null!=e.A&&(o.clearTimeout(e.A),e.A=null)}function dn(e){e.g=new je(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=ft(e.qa);vt(t,"RID","rpc"),vt(t,"SID",e.K),vt(t,"AID",e.T),vt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&vt(t,"TO",e.ja),vt(t,"TYPE","xmlhttp"),sn(e,t),e.m&&e.o&&jt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=yt(ft(t)),n.m=null,n.P=!0,Ke(n,e)}function fn(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function pn(e,t){var n=null;if(e.g==t){fn(e),hn(e),e.g=null;var r=2}else{if(!at(e.h,t))return;n=t.D,ut(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var o=e.B;le(r=Ne(),new Pe(r,n)),on(e)}else cn(e);else if(3==(o=t.s)||0==o&&0<t.X||!(1==r&&function(e,t){return!(it(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Fe(c(e.Ga,e,t),mn(e,e.B)),e.B++,!0))}(e,t)||2==r&&ln(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),o){case 1:gn(e,5);break;case 4:gn(e,10);break;case 3:gn(e,6);break;default:gn(e,2)}}function mn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function gn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;const t=!r;r=new dt(r||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||pt(r,"https"),yt(r),t?function(e,t){const n=new Me;if(o.Image){const r=new Image;r.onload=l(Ot,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Ot,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Ot,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Ot,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Me;const n=new AbortController,r=setTimeout(()=>{n.abort(),Ot(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?Ot(0,0,!0,t):Ot(0,0,!1,t)}).catch(()=>{clearTimeout(r),Ot(0,0,!1,t)})}(r.toString(),n)}else Oe(2);e.G=0,e.l&&e.l.sa(t),vn(e),rn(e)}function vn(e){if(e.G=0,e.ka=[],e.l){const t=ct(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function yn(e,t,n){var r=n instanceof dt?ft(n):new dt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),mt(r,r.s);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new dt(null);r&&pt(a,r),t&&(a.g=t),i&&mt(a,i),n&&(a.l=n),r=a}return n=e.D,t=e.ya,n&&t&&vt(r,n,t),vt(r,"VER",e.la),sn(e,r),r}function bn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Wt(new Mt({eb:n})):new Wt(e.pa)).Ha(e.J),t}function wn(){}function xn(){}function En(e,t){ce.call(this),this.g=new en(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new kn(this)}function _n(e){ke.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Cn(){Se.call(this),this.status=1}function kn(e){this.g=e}(e=Wt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Be.g(),this.v=this.o?Ee(this.o):Ee(Be),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(k){return void qt(this,k)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=o.FormData&&e instanceof o.FormData,!(0<=Array.prototype.indexOf.call(Ht,t,void 0))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yt(this),this.u=!0,this.g.send(e),this.u=!1}catch(k){qt(this,k)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,le(this,"complete"),le(this,"abort"),Qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qt(this,!0)),Wt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Xt(this):this.bb())},e.bb=function(){Xt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<$t(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),be(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=en.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Oe(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=yn(this,null,this.W),on(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const o=new je(this,this.j,e);let i=this.o;if(this.S&&(i?(i=w(i),E(i,this.S)):i=this.S),null!==this.m||this.O||(o.H=i,i=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=un(this,o,t),vt(n=ft(this.I),"RID",e),vt(n,"CVER",22),this.D&&vt(n,"X-HTTP-Session-Id",this.D),sn(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Vt(i)))+"&"+t:this.m&&jt(n,this.m,i)),st(this.h,o),this.Ua&&vt(n,"TYPE","init"),this.P?(vt(n,"$req",t),vt(n,"SID","null"),o.T=!0,qe(o,n,null)):qe(o,n,t),this.G=2}}else 3==this.G&&(e?an(this,e):0==this.i.length||ot(this.h)||an(this))},e.Fa=function(){if(this.u=null,dn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Fe(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Oe(10),nn(this),dn(this))},e.Za=function(){null!=this.C&&(this.C=null,nn(this),ln(this),Oe(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Oe(2)):(this.j.info("Failed to ping google.com"),Oe(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=wn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},xn.prototype.g=function(e,t){return new En(e,t)},h(En,ce),En.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},En.prototype.close=function(){tn(this.g)},En.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ye(e),e=n);t.i.push(new nt(t.Ya++,e)),3==t.G&&on(t)},En.prototype.N=function(){this.g.l=null,delete this.j,tn(this.g),delete this.g,En.aa.N.call(this)},h(_n,ke),h(Cn,Se),h(kn,wn),kn.prototype.ua=function(){le(this.g,"a")},kn.prototype.ta=function(e){le(this.g,new _n(e))},kn.prototype.sa=function(e){le(this.g,new Cn)},kn.prototype.ra=function(){le(this.g,"b")},xn.prototype.createWebChannel=xn.prototype.g,En.prototype.send=En.prototype.o,En.prototype.open=En.prototype.m,En.prototype.close=En.prototype.close,sy=cy.createWebChannelTransport=function(){return new xn},ay=cy.getStatEventTarget=function(){return Ne()},iy=cy.Event=Ie,oy=cy.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ue.NO_ERROR=0,Ue.TIMEOUT=8,Ue.HTTP_ERROR=6,ry=cy.ErrorCode=Ue,ze.COMPLETE="complete",ny=cy.EventType=ze,_e.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",ce.prototype.listen=ce.prototype.K,ty=cy.WebChannel=_e,cy.FetchXmlHttpFactory=Mt,Wt.prototype.listenOnce=Wt.prototype.L,Wt.prototype.getLastError=Wt.prototype.Ka,Wt.prototype.getLastErrorCode=Wt.prototype.Ba,Wt.prototype.getStatus=Wt.prototype.Z,Wt.prototype.getResponseJson=Wt.prototype.Oa,Wt.prototype.getResponseText=Wt.prototype.oa,Wt.prototype.send=Wt.prototype.ea,Wt.prototype.setWithCredentials=Wt.prototype.Ha,ey=cy.XhrIo=Wt}).apply("undefined"!==typeof uy?uy:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const ly="@firebase/firestore";class hy{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hy.UNAUTHENTICATED=new hy(null),hy.GOOGLE_CREDENTIALS=new hy("google-credentials-uid"),hy.FIRST_PARTY=new hy("first-party-uid"),hy.MOCK_USER=new hy("mock-user");let dy="10.14.0";const fy=new Og("@firebase/firestore");function py(){return fy.logLevel}function my(e){if(fy.logLevel<=Tg.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const o=n.map(yy);fy.debug("Firestore (".concat(dy,"): ").concat(e),...o)}}function gy(e){if(fy.logLevel<=Tg.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const o=n.map(yy);fy.error("Firestore (".concat(dy,"): ").concat(e),...o)}}function vy(e){if(fy.logLevel<=Tg.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const o=n.map(yy);fy.warn("Firestore (".concat(dy,"): ").concat(e),...o)}}function yy(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(m){return e}}function by(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(dy,") INTERNAL ASSERTION FAILED: ")+e;throw gy(t),new Error(t)}function wy(e,t){e||by()}function xy(e,t){return e}const Ey={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _y extends vg{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Cy{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ky{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class Sy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(hy.UNAUTHENTICATED))}shutdown(){}}class Iy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ty{constructor(e){this.t=e,this.currentUser=hy.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){wy(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let o=new Cy;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Cy,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=o;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{my("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(my("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Cy)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(my("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(wy("string"==typeof t.accessToken),new ky(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return wy(null===e||"string"==typeof e),new hy(e)}}class Ny{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=hy.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ry{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Ny(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(hy.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ay{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Dy{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){wy(void 0===this.o);const n=e=>{null!=e.error&&my("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,my("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{my("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):my("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(wy("string"==typeof e.token),this.R=e.token,new Ay(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Oy(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class Py{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Oy(40);for(let o=0;o<r.length;++o)n.length<20&&r[o]<t&&(n+=e.charAt(r[o]%62))}return n}}function Fy(e,t){return e<t?-1:e>t?1:0}function My(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class Ly{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _y(Ey.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _y(Ey.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _y(Ey.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _y(Ey.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ly.fromMillis(Date.now())}static fromDate(e){return Ly.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Ly(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Fy(this.nanoseconds,e.nanoseconds):Fy(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class By{constructor(e){this.timestamp=e}static fromTimestamp(e){return new By(e)}static min(){return new By(new Ly(0,0))}static max(){return new By(new Ly(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Uy{constructor(e,t,n){void 0===t?t=0:t>e.length&&by(),void 0===n?n=e.length-t:n>e.length-t&&by(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Uy.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Uy?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),o=t.get(r);if(n<o)return-1;if(n>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class zy extends Uy{construct(e,t,n){return new zy(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const o of n){if(o.indexOf("//")>=0)throw new _y(Ey.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push(...o.split("/").filter(e=>e.length>0))}return new zy(e)}static emptyPath(){return new zy([])}}const Vy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jy extends Uy{construct(e,t,n){return new jy(e,t,n)}static isValidIdentifier(e){return Vy.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jy.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new jy(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(0===n.length)throw new _y(Ey.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new _y(Ey.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new _y(Ey.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(o(),r++)}if(o(),i)throw new _y(Ey.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jy(t)}static emptyPath(){return new jy([])}}class Wy{constructor(e){this.path=e}static fromPath(e){return new Wy(zy.fromString(e))}static fromName(e){return new Wy(zy.fromString(e).popFirst(5))}static empty(){return new Wy(zy.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===zy.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return zy.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Wy(new zy(e.slice()))}}class Gy{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}Gy.UNKNOWN_ID=-1;function Hy(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,o=By.fromTimestamp(1e9===r?new Ly(n+1,0):new Ly(n,r));return new Ky(o,Wy.empty(),t)}function qy(e){return new Ky(e.readTime,e.key,-1)}class Ky{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ky(By.min(),Wy.empty(),-1)}static max(){return new Ky(By.max(),Wy.empty(),-1)}}function Xy(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Wy.comparator(e.documentKey,t.documentKey),0!==n?n:Fy(e.largestBatchId,t.largestBatchId))}const Qy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Yy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function $y(e){if(e.code!==Ey.FAILED_PRECONDITION||e.message!==Qy)throw e;my("LocalStore","Unexpectedly lost primary lease")}class Jy{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&by(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Jy((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Jy?t:Jy.resolve(t)}catch(e){return Jy.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Jy.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Jy.reject(t)}static resolve(e){return new Jy((t,n)=>{t(e)})}static reject(e){return new Jy((t,n)=>{n(e)})}static waitFor(e){return new Jy((t,n)=>{let r=0,o=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++o,i&&o===r&&t()},e=>n(e))}),i=!0,o===r&&t()})}static or(e){let t=Jy.resolve(!1);for(const n of e)t=t.next(e=>e?Jy.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new Jy((n,r)=>{const o=e.length,i=new Array(o);let a=0;for(let s=0;s<o;s++){const u=s;t(e[u]).next(e=>{i[u]=e,++a,a===o&&n(i)},e=>r(e))}})}static doWhile(e,t){return new Jy((n,r)=>{const o=()=>{!0===e()?t().next(()=>{o()},r):n()};o()})}}function Zy(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function eb(e){return"IndexedDbTransactionError"===e.name}class tb{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function nb(e){return null==e}function rb(e){return 0===e&&1/e==-1/0}function ob(e){return"number"==typeof e&&Number.isInteger(e)&&!rb(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}tb.oe=-1;const ib=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ab=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],sb=ab,ub=[...sb,"indexConfiguration","indexState","indexEntries"];function cb(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function lb(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function hb(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class db{constructor(e,t){this.comparator=e,this.root=t||pb.EMPTY}insert(e,t){return new db(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,pb.BLACK,null,null))}remove(e){return new db(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pb.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new fb(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new fb(this.root,e,this.comparator,!1)}getReverseIterator(){return new fb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new fb(this.root,e,this.comparator,!0)}}class fb{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(0===o){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pb{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=null!=n?n:pb.RED,this.left=null!=r?r:pb.EMPTY,this.right=null!=o?o:pb.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,o){return new pb(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=o?o:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return pb.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return pb.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pb.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pb.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw by();if(this.right.isRed())throw by();const e=this.left.check();if(e!==this.right.check())throw by();return e+(this.isRed()?0:1)}}pb.EMPTY=null,pb.RED=!0,pb.BLACK=!1,pb.EMPTY=new class{constructor(){this.size=0}get key(){throw by()}get value(){throw by()}get color(){throw by()}get left(){throw by()}get right(){throw by()}copy(e,t,n,r,o){return this}insert(e,t,n){return new pb(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class mb{constructor(e){this.comparator=e,this.data=new db(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new gb(this.data.getIterator())}getIteratorFrom(e){return new gb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof mb))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new mb(this.comparator);return t.data=e,t}}class gb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class vb{constructor(e){this.fields=e,e.sort(jy.comparator)}static empty(){return new vb([])}unionWith(e){let t=new mb(jy.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new vb(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return My(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class yb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class bb{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new yb("Invalid base64 string: "+e):e}}(e);return new bb(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new bb(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Fy(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}bb.EMPTY_BYTE_STRING=new bb("");const wb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xb(e){if(wy(!!e),"string"==typeof e){let t=0;const n=wb.exec(e);if(wy(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Eb(e.seconds),nanos:Eb(e.nanos)}}function Eb(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function _b(e){return"string"==typeof e?bb.fromBase64String(e):bb.fromUint8Array(e)}function Cb(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function kb(e){const t=e.mapValue.fields.__previous_value__;return Cb(t)?kb(t):t}function Sb(e){const t=xb(e.mapValue.fields.__local_write_time__.timestampValue);return new Ly(t.seconds,t.nanos)}class Ib{constructor(e,t,n,r,o,i,a,s,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=o,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=s,this.useFetchStreams=u}}class Tb{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Tb("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Tb&&e.projectId===this.projectId&&e.database===this.database}}const Nb={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Rb(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Cb(e)?4:qb(e)?9007199254740991:Gb(e)?10:11:by()}function Ab(e,t){if(e===t)return!0;const n=Rb(e);if(n!==Rb(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Sb(e).isEqual(Sb(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=xb(e.timestampValue),r=xb(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return _b(e.bytesValue).isEqual(_b(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Eb(e.geoPointValue.latitude)===Eb(t.geoPointValue.latitude)&&Eb(e.geoPointValue.longitude)===Eb(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Eb(e.integerValue)===Eb(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Eb(e.doubleValue),r=Eb(t.doubleValue);return n===r?rb(n)===rb(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return My(e.arrayValue.values||[],t.arrayValue.values||[],Ab);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(cb(n)!==cb(r))return!1;for(const o in n)if(n.hasOwnProperty(o)&&(void 0===r[o]||!Ab(n[o],r[o])))return!1;return!0}(e,t);default:return by()}}function Db(e,t){return void 0!==(e.values||[]).find(e=>Ab(e,t))}function Ob(e,t){if(e===t)return 0;const n=Rb(e),r=Rb(t);if(n!==r)return Fy(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Fy(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Eb(e.integerValue||e.doubleValue),r=Eb(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Pb(e.timestampValue,t.timestampValue);case 4:return Pb(Sb(e),Sb(t));case 5:return Fy(e.stringValue,t.stringValue);case 6:return function(e,t){const n=_b(e),r=_b(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let o=0;o<n.length&&o<r.length;o++){const e=Fy(n[o],r[o]);if(0!==e)return e}return Fy(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Fy(Eb(e.latitude),Eb(t.latitude));return 0!==n?n:Fy(Eb(e.longitude),Eb(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Fb(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,o,i;const a=e.fields||{},s=t.fields||{},u=null===(n=a.value)||void 0===n?void 0:n.arrayValue,c=null===(r=s.value)||void 0===r?void 0:r.arrayValue,l=Fy((null===(o=null==u?void 0:u.values)||void 0===o?void 0:o.length)||0,(null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0);return 0!==l?l:Fb(u,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Nb.mapValue&&t===Nb.mapValue)return 0;if(e===Nb.mapValue)return 1;if(t===Nb.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),o=t.fields||{},i=Object.keys(o);r.sort(),i.sort();for(let a=0;a<r.length&&a<i.length;++a){const e=Fy(r[a],i[a]);if(0!==e)return e;const t=Ob(n[r[a]],o[i[a]]);if(0!==t)return t}return Fy(r.length,i.length)}(e.mapValue,t.mapValue);default:throw by()}}function Pb(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Fy(e,t);const n=xb(e),r=xb(t),o=Fy(n.seconds,r.seconds);return 0!==o?o:Fy(n.nanos,r.nanos)}function Fb(e,t){const n=e.values||[],r=t.values||[];for(let o=0;o<n.length&&o<r.length;++o){const e=Ob(n[o],r[o]);if(e)return e}return Fy(n.length,r.length)}function Mb(e){return Lb(e)}function Lb(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=xb(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return _b(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Wy.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Lb(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const o of t)r?r=!1:n+=",",n+="".concat(o,":").concat(Lb(e.fields[o]));return n+"}"}(e.mapValue):by()}function Bb(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Ub(e){return!!e&&"integerValue"in e}function zb(e){return!!e&&"arrayValue"in e}function Vb(e){return!!e&&"nullValue"in e}function jb(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Wb(e){return!!e&&"mapValue"in e}function Gb(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Hb(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return lb(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Hb(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Hb(e.arrayValue.values[n]);return t}return Object.assign({},e)}function qb(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Kb{constructor(e){this.value=e}static empty(){return new Kb({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Wb(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hb(t)}setAll(e){let t=jy.emptyPath(),n={},r=[];e.forEach((e,o)=>{if(!t.isImmediateParentOf(o)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=o.popLast()}e?n[o.lastSegment()]=Hb(e):r.push(o.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,r)}delete(e){const t=this.field(e.popLast());Wb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ab(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Wb(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){lb(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new Kb(Hb(this.value))}}function Xb(e){const t=[];return lb(e.fields,(e,n)=>{const r=new jy([e]);if(Wb(n)){const e=Xb(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new vb(t)}class Qb{constructor(e,t,n,r,o,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=o,this.data=i,this.documentState=a}static newInvalidDocument(e){return new Qb(e,0,By.min(),By.min(),By.min(),Kb.empty(),0)}static newFoundDocument(e,t,n,r){return new Qb(e,1,t,By.min(),n,r,0)}static newNoDocument(e,t){return new Qb(e,2,t,By.min(),By.min(),Kb.empty(),0)}static newUnknownDocument(e,t){return new Qb(e,3,t,By.min(),By.min(),Kb.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(By.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Kb.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Kb.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=By.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Qb&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qb(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Yb{constructor(e,t){this.position=e,this.inclusive=t}}function $b(e,t,n){let r=0;for(let o=0;o<e.position.length;o++){const i=t[o],a=e.position[o];if(r=i.field.isKeyField()?Wy.comparator(Wy.fromName(a.referenceValue),n.key):Ob(a,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Jb(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ab(e.position[n],t.position[n]))return!1;return!0}class Zb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function ew(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class tw{}class nw extends tw{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new lw(e,t,n):"array-contains"===t?new pw(e,n):"in"===t?new mw(e,n):"not-in"===t?new gw(e,n):"array-contains-any"===t?new vw(e,n):new nw(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new hw(e,n):new dw(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ob(t,this.value)):null!==t&&Rb(this.value)===Rb(t)&&this.matchesComparison(Ob(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return by()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rw extends tw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new rw(e,t)}matches(e){return ow(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function ow(e){return"and"===e.op}function iw(e){return aw(e)&&ow(e)}function aw(e){for(const t of e.filters)if(t instanceof rw)return!1;return!0}function sw(e){if(e instanceof nw)return e.field.canonicalString()+e.op.toString()+Mb(e.value);if(iw(e))return e.filters.map(e=>sw(e)).join(",");{const t=e.filters.map(e=>sw(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function uw(e,t){return e instanceof nw?function(e,t){return t instanceof nw&&e.op===t.op&&e.field.isEqual(t.field)&&Ab(e.value,t.value)}(e,t):e instanceof rw?function(e,t){return t instanceof rw&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&uw(n,t.filters[r]),!0)}(e,t):void by()}function cw(e){return e instanceof nw?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Mb(e.value))}(e):e instanceof rw?function(e){return e.op.toString()+" {"+e.getFilters().map(cw).join(" ,")+"}"}(e):"Filter"}class lw extends nw{constructor(e,t,n){super(e,t,n),this.key=Wy.fromName(n.referenceValue)}matches(e){const t=Wy.comparator(e.key,this.key);return this.matchesComparison(t)}}class hw extends nw{constructor(e,t){super(e,"in",t),this.keys=fw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class dw extends nw{constructor(e,t){super(e,"not-in",t),this.keys=fw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function fw(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Wy.fromName(e.referenceValue))}class pw extends nw{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return zb(t)&&Db(t.arrayValue,this.value)}}class mw extends nw{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Db(this.value.arrayValue,t)}}class gw extends nw{constructor(e,t){super(e,"not-in",t)}matches(e){if(Db(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Db(this.value.arrayValue,t)}}class vw extends nw{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!zb(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Db(this.value.arrayValue,e))}}class yw{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=o,this.startAt=i,this.endAt=a,this.ue=null}}function bw(e){return new yw(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ww(e){const t=xy(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>sw(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),nb(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Mb(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Mb(e)).join(",")),t.ue=e}return t.ue}function xw(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!ew(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!uw(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Jb(e.startAt,t.startAt)&&Jb(e.endAt,t.endAt)}function Ew(e){return Wy.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class _w{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=o,this.limitType=i,this.startAt=a,this.endAt=s,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Cw(e,t,n,r,o,i,a,s){return new _w(e,t,n,r,o,i,a,s)}function kw(e){return new _w(e)}function Sw(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Iw(e){return null!==e.collectionGroup}function Tw(e){const t=xy(e);if(null===t.ce){t.ce=[];const e=new Set;for(const o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new mb(jy.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new Zb(r,n))}),e.has(jy.keyField().canonicalString())||t.ce.push(new Zb(jy.keyField(),n))}return t.ce}function Nw(e){const t=xy(e);return t.le||(t.le=Rw(t,Tw(e))),t.le}function Rw(e,t){if("F"===e.limitType)return bw(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Zb(e.field,t)});const n=e.endAt?new Yb(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Yb(e.startAt.position,e.startAt.inclusive):null;return bw(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Aw(e,t){const n=e.filters.concat([t]);return new _w(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Dw(e,t,n){return new _w(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Ow(e,t){return xw(Nw(e),Nw(t))&&e.limitType===t.limitType}function Pw(e){return"".concat(ww(Nw(e)),"|lt:").concat(e.limitType)}function Fw(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>cw(e)).join(", "),"]")),nb(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Mb(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Mb(e)).join(",")),"Target(".concat(t,")")}(Nw(e)),"; limitType=").concat(e.limitType,")")}function Mw(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Wy.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Tw(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=$b(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Tw(e),t))&&!(e.endAt&&!function(e,t,n){const r=$b(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Tw(e),t))}(e,t)}function Lw(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Bw(e){return(t,n)=>{let r=!1;for(const o of Tw(e)){const e=Uw(o,t,n);if(0!==e)return e;r=r||o.field.isKeyField()}return 0}}function Uw(e,t,n){const r=e.field.isKeyField()?Wy.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),o=n.data.field(e);return null!==r&&null!==o?Ob(r,o):by()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return by()}}class zw{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,o]of n)if(this.equalsFn(r,e))return o}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){lb(this.inner,(t,n)=>{for(const[r,o]of n)e(r,o)})}isEmpty(){return hb(this.inner)}size(){return this.innerSize}}const Vw=new db(Wy.comparator);function jw(){return Vw}const Ww=new db(Wy.comparator);function Gw(){let e=Ww;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const o of n)e=e.insert(o.key,o);return e}function Hw(e){let t=Ww;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function qw(){return Xw()}function Kw(){return Xw()}function Xw(){return new zw(e=>e.toString(),(e,t)=>e.isEqual(t))}const Qw=new db(Wy.comparator),Yw=new mb(Wy.comparator);function $w(){let e=Yw;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const o of n)e=e.add(o);return e}const Jw=new mb(Fy);function Zw(){return Jw}function ex(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rb(t)?"-0":t}}function tx(e){return{integerValue:""+e}}function nx(e,t){return ob(t)?tx(t):ex(e,t)}class rx{constructor(){this._=void 0}}function ox(e,t,n){return e instanceof sx?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Cb(t)&&(t=kb(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof ux?cx(e,t):e instanceof lx?hx(e,t):function(e,t){const n=ax(e,t),r=fx(n)+fx(e.Pe);return Ub(n)&&Ub(e.Pe)?tx(r):ex(e.serializer,r)}(e,t)}function ix(e,t,n){return e instanceof ux?cx(e,t):e instanceof lx?hx(e,t):n}function ax(e,t){return e instanceof dx?function(e){return Ub(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class sx extends rx{}class ux extends rx{constructor(e){super(),this.elements=e}}function cx(e,t){const n=px(t);for(const r of e.elements)n.some(e=>Ab(e,r))||n.push(r);return{arrayValue:{values:n}}}class lx extends rx{constructor(e){super(),this.elements=e}}function hx(e,t){let n=px(t);for(const r of e.elements)n=n.filter(e=>!Ab(e,r));return{arrayValue:{values:n}}}class dx extends rx{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function fx(e){return Eb(e.integerValue||e.doubleValue)}function px(e){return zb(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class mx{constructor(e,t){this.field=e,this.transform=t}}class gx{constructor(e,t){this.version=e,this.transformResults=t}}class vx{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new vx}static exists(e){return new vx(void 0,e)}static updateTime(e){return new vx(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function yx(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class bx{}function wx(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Rx(e.key,vx.none()):new kx(e.key,e.data,vx.none());{const n=e.data,r=Kb.empty();let o=new mb(jy.comparator);for(let e of t.fields)if(!o.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),o=o.add(e)}return new Sx(e.key,r,new vb(o.toArray()),vx.none())}}function xx(e,t,n){e instanceof kx?function(e,t,n){const r=e.value.clone(),o=Tx(e.fieldTransforms,t,n.transformResults);r.setAll(o),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Sx?function(e,t,n){if(!yx(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Tx(e.fieldTransforms,t,n.transformResults),o=t.data;o.setAll(Ix(e)),o.setAll(r),t.convertToFoundDocument(n.version,o).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ex(e,t,n,r){return e instanceof kx?function(e,t,n,r){if(!yx(e.precondition,t))return n;const o=e.value.clone(),i=Nx(e.fieldTransforms,r,t);return o.setAll(i),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null}(e,t,n,r):e instanceof Sx?function(e,t,n,r){if(!yx(e.precondition,t))return n;const o=Nx(e.fieldTransforms,r,t),i=t.data;return i.setAll(Ix(e)),i.setAll(o),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return yx(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function _x(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),o=ax(r.transform,e||null);null!=o&&(null===n&&(n=Kb.empty()),n.set(r.field,o))}return n||null}function Cx(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&My(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ux&&t instanceof ux||e instanceof lx&&t instanceof lx?My(e.elements,t.elements,Ab):e instanceof dx&&t instanceof dx?Ab(e.Pe,t.Pe):e instanceof sx&&t instanceof sx}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class kx extends bx{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Sx extends bx{constructor(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Ix(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Tx(e,t,n){const r=new Map;wy(e.length===n.length);for(let o=0;o<n.length;o++){const i=e[o],a=i.transform,s=t.data.field(i.field);r.set(i.field,ix(a,s,n[o]))}return r}function Nx(e,t,n){const r=new Map;for(const o of e){const e=o.transform,i=n.data.field(o.field);r.set(o.field,ox(e,i,t))}return r}class Rx extends bx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ax extends bx{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Dx{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&xx(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ex(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ex(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Kw();return this.mutations.forEach(r=>{const o=e.get(r.key),i=o.overlayedDocument;let a=this.applyToLocalView(i,o.mutatedFields);a=t.has(r.key)?null:a;const s=wx(i,a);null!==s&&n.set(r.key,s),i.isValidDocument()||i.convertToNoDocument(By.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$w())}isEqual(e){return this.batchId===e.batchId&&My(this.mutations,e.mutations,(e,t)=>Cx(e,t))&&My(this.baseMutations,e.baseMutations,(e,t)=>Cx(e,t))}}class Ox{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){wy(e.mutations.length===n.length);let r=Qw;const o=e.mutations;for(let i=0;i<o.length;i++)r=r.insert(o[i].key,n[i].version);return new Ox(e,t,n,r)}}class Px{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Fx{constructor(e,t){this.count=e,this.unchangedNames=t}}var Mx,Lx;function Bx(e){switch(e){default:return by();case Ey.CANCELLED:case Ey.UNKNOWN:case Ey.DEADLINE_EXCEEDED:case Ey.RESOURCE_EXHAUSTED:case Ey.INTERNAL:case Ey.UNAVAILABLE:case Ey.UNAUTHENTICATED:return!1;case Ey.INVALID_ARGUMENT:case Ey.NOT_FOUND:case Ey.ALREADY_EXISTS:case Ey.PERMISSION_DENIED:case Ey.FAILED_PRECONDITION:case Ey.ABORTED:case Ey.OUT_OF_RANGE:case Ey.UNIMPLEMENTED:case Ey.DATA_LOSS:return!0}}function Ux(e){if(void 0===e)return gy("GRPC error has no .code"),Ey.UNKNOWN;switch(e){case Mx.OK:return Ey.OK;case Mx.CANCELLED:return Ey.CANCELLED;case Mx.UNKNOWN:return Ey.UNKNOWN;case Mx.DEADLINE_EXCEEDED:return Ey.DEADLINE_EXCEEDED;case Mx.RESOURCE_EXHAUSTED:return Ey.RESOURCE_EXHAUSTED;case Mx.INTERNAL:return Ey.INTERNAL;case Mx.UNAVAILABLE:return Ey.UNAVAILABLE;case Mx.UNAUTHENTICATED:return Ey.UNAUTHENTICATED;case Mx.INVALID_ARGUMENT:return Ey.INVALID_ARGUMENT;case Mx.NOT_FOUND:return Ey.NOT_FOUND;case Mx.ALREADY_EXISTS:return Ey.ALREADY_EXISTS;case Mx.PERMISSION_DENIED:return Ey.PERMISSION_DENIED;case Mx.FAILED_PRECONDITION:return Ey.FAILED_PRECONDITION;case Mx.ABORTED:return Ey.ABORTED;case Mx.OUT_OF_RANGE:return Ey.OUT_OF_RANGE;case Mx.UNIMPLEMENTED:return Ey.UNIMPLEMENTED;case Mx.DATA_LOSS:return Ey.DATA_LOSS;default:return by()}}(Lx=Mx||(Mx={}))[Lx.OK=0]="OK",Lx[Lx.CANCELLED=1]="CANCELLED",Lx[Lx.UNKNOWN=2]="UNKNOWN",Lx[Lx.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Lx[Lx.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Lx[Lx.NOT_FOUND=5]="NOT_FOUND",Lx[Lx.ALREADY_EXISTS=6]="ALREADY_EXISTS",Lx[Lx.PERMISSION_DENIED=7]="PERMISSION_DENIED",Lx[Lx.UNAUTHENTICATED=16]="UNAUTHENTICATED",Lx[Lx.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Lx[Lx.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Lx[Lx.ABORTED=10]="ABORTED",Lx[Lx.OUT_OF_RANGE=11]="OUT_OF_RANGE",Lx[Lx.UNIMPLEMENTED=12]="UNIMPLEMENTED",Lx[Lx.INTERNAL=13]="INTERNAL",Lx[Lx.UNAVAILABLE=14]="UNAVAILABLE",Lx[Lx.DATA_LOSS=15]="DATA_LOSS";let zx=null;function Vx(){return new TextEncoder}const jx=new Yv([4294967295,4294967295],0);function Wx(e){const t=Vx().encode(e),n=new $v;return n.update(t),new Uint8Array(n.digest())}function Gx(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),o=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Yv([n,r],0),new Yv([o,i],0)]}class Hx{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new qx("Invalid padding: ".concat(t));if(n<0)throw new qx("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new qx("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new qx("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=Yv.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(Yv.fromNumber(n)));return 1===r.compare(jx)&&(r=new Yv([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Wx(e),[n,r]=Gx(t);for(let o=0;o<this.hashCount;o++){const e=this.Ee(n,r,o);if(!this.de(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),i=new Hx(o,r,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.Ie)return;const t=Wx(e),[n,r]=Gx(t);for(let o=0;o<this.hashCount;o++){const e=this.Ee(n,r,o);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class qx extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Kx{constructor(e,t,n,r,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Xx.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Kx(By.min(),r,new db(Fy),jw(),$w())}}class Xx{constructor(e,t,n,r,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Xx(n,t,$w(),$w(),$w())}}class Qx{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class Yx{constructor(e,t){this.targetId=e,this.me=t}}class $x{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bb.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Jx{constructor(){this.fe=0,this.ge=tE(),this.pe=bb.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=$w(),t=$w(),n=$w();return this.ge.forEach((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:by()}}),new Xx(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=tE()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,wy(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Zx{constructor(e){this.Le=e,this.Be=new Map,this.ke=jw(),this.qe=eE(),this.Qe=new db(Fy)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:by()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const o=r.target;if(Ew(o))if(0===n){const e=new Wy(o.path);this.Ue(t,e,Qb.newNoDocument(e,By.min()))}else wy(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),o=n?this.Xe(n,e,r):1;if(0!==o){this.je(t);const e=2===o?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==zx||zx.et(function(e,t,n,r,o){var i,a,s,u,c,l;const h={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},d=t.unchangedNames;return d&&(h.bloomFilter={applied:0===o,hashCount:null!==(i=null==d?void 0:d.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(u=null===(s=null===(a=null==d?void 0:d.bits)||void 0===a?void 0:a.bitmap)||void 0===s?void 0:s.length)&&void 0!==u?u:0,padding:null!==(l=null===(c=null==d?void 0:d.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),h}(r,e.me,this.Le.tt(),n,o))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:o=0}=t;let i,a;try{i=_b(n).toUint8Array()}catch(e){if(e instanceof yb)return vy("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new Hx(i,r,o)}catch(e){return vy(e instanceof qx?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const o=this.Le.tt(),i="projects/".concat(o.projectId,"/databases/").concat(o.database,"/documents/").concat(n.path.canonicalString());e.mightContain(i)||(this.Ue(t,n,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((n,r)=>{const o=this.Je(r);if(o){if(n.current&&Ew(o.target)){const t=new Wy(o.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,Qb.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}});let n=$w();this.qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const r=new Kx(e,t,this.Qe,this.ke,n);return this.ke=jw(),this.qe=eE(),this.Qe=new db(Fy),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Jx,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new mb(Fy),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||my("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Jx),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function eE(){return new db(Wy.comparator)}function tE(){return new db(Wy.comparator)}const nE={asc:"ASCENDING",desc:"DESCENDING"},rE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oE={and:"AND",or:"OR"};class iE{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aE(e,t){return e.useProto3Json||nb(t)?t:{value:t}}function sE(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function uE(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function cE(e,t){return sE(e,t.toTimestamp())}function lE(e){return wy(!!e),By.fromTimestamp(function(e){const t=xb(e);return new Ly(t.seconds,t.nanos)}(e))}function hE(e,t){return dE(e,t).canonicalString()}function dE(e,t){const n=function(e){return new zy(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function fE(e){const t=zy.fromString(e);return wy(OE(t)),t}function pE(e,t){return hE(e.databaseId,t.path)}function mE(e,t){const n=fE(t);if(n.get(1)!==e.databaseId.projectId)throw new _y(Ey.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new _y(Ey.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Wy(bE(n))}function gE(e,t){return hE(e.databaseId,t)}function vE(e){const t=fE(e);return 4===t.length?zy.emptyPath():bE(t)}function yE(e){return new zy(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function bE(e){return wy(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function wE(e,t,n){return{name:pE(e,t),fields:n.value.mapValue.fields}}function xE(e,t){let n;if(t instanceof kx)n={update:wE(e,t.key,t.value)};else if(t instanceof Rx)n={delete:pE(e,t.key)};else if(t instanceof Sx)n={update:wE(e,t.key,t.data),updateMask:DE(t.fieldMask)};else{if(!(t instanceof Ax))return by();n={verify:pE(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof sx)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ux)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof lx)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof dx)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw by()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:cE(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:by()}(e,t.precondition)),n}function EE(e,t){return{documents:[gE(e,t.path)]}}function _E(e,t){const n={structuredQuery:{}},r=t.path;let o;null!==t.collectionGroup?(o=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(o=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=gE(e,o);const i=function(e){if(0!==e.length)return AE(rw.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:NE(e.field),direction:SE(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const s=aE(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:o}}function CE(e){let t=vE(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let o=null;if(r>0){wy(1===r);const e=n.from[0];e.allDescendants?o=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=kE(e);return t instanceof rw&&iw(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new Zb(RE(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let s=null;n.limit&&(s=function(e){let t;return t="object"==typeof e?e.value:e,nb(t)?null:t}(n.limit));let u=null;n.startAt&&(u=function(e){const t=!!e.before,n=e.values||[];return new Yb(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new Yb(n,t)}(n.endAt)),Cw(t,o,a,i,s,"F",u,c)}function kE(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=RE(e.unaryFilter.field);return nw.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=RE(e.unaryFilter.field);return nw.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=RE(e.unaryFilter.field);return nw.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=RE(e.unaryFilter.field);return nw.create(o,"!=",{nullValue:"NULL_VALUE"});default:return by()}}(e):void 0!==e.fieldFilter?function(e){return nw.create(RE(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return by()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return rw.create(e.compositeFilter.filters.map(e=>kE(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return by()}}(e.compositeFilter.op))}(e):by()}function SE(e){return nE[e]}function IE(e){return rE[e]}function TE(e){return oE[e]}function NE(e){return{fieldPath:e.canonicalString()}}function RE(e){return jy.fromServerFormat(e.fieldPath)}function AE(e){return e instanceof nw?function(e){if("=="===e.op){if(jb(e.value))return{unaryFilter:{field:NE(e.field),op:"IS_NAN"}};if(Vb(e.value))return{unaryFilter:{field:NE(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(jb(e.value))return{unaryFilter:{field:NE(e.field),op:"IS_NOT_NAN"}};if(Vb(e.value))return{unaryFilter:{field:NE(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:NE(e.field),op:IE(e.op),value:e.value}}}(e):e instanceof rw?function(e){const t=e.getFilters().map(e=>AE(e));return 1===t.length?t[0]:{compositeFilter:{op:TE(e.op),filters:t}}}(e):by()}function DE(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function OE(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class PE{constructor(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:By.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:By.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:bb.EMPTY_BYTE_STRING,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=s}withSequenceNumber(e){return new PE(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new PE(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new PE(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new PE(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class FE{constructor(e){this.ct=e}}function ME(e){const t=CE({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Dw(t,t.limit,"L"):t}class LE{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Eb(e.integerValue));else if("doubleValue"in e){const n=Eb(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),rb(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=xb(n)),t.Rt("".concat(n.seconds||"")),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(_b(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?qb(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Gb(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):by()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;const o=e.fields||{};this.dt(t,53);const i="value",a=(null===(r=null===(n=o[i].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Eb(a)),this.Vt(i,t),this.Tt(o[i],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),Wy.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}LE.vt=new LE;class BE{constructor(){this.un=new UE}addToCollectionParentIndex(e,t){return this.un.add(t),Jy.resolve()}getCollectionParents(e,t){return Jy.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return Jy.resolve()}deleteFieldIndex(e,t){return Jy.resolve()}deleteAllFieldIndexes(e){return Jy.resolve()}createTargetIndexes(e,t){return Jy.resolve()}getDocumentsMatchingTarget(e,t){return Jy.resolve(null)}getIndexType(e,t){return Jy.resolve(0)}getFieldIndexes(e,t){return Jy.resolve([])}getNextCollectionGroupToUpdate(e){return Jy.resolve(null)}getMinOffset(e,t){return Jy.resolve(Ky.min())}getMinOffsetFromCollectionGroup(e,t){return Jy.resolve(Ky.min())}updateCollectionGroup(e,t,n){return Jy.resolve()}updateIndexEntries(e,t){return Jy.resolve()}}class UE{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new mb(zy.comparator),o=!r.has(n);return this.index[t]=r.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new mb(zy.comparator)).toArray()}}new Uint8Array(0);class zE{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new zE(e,zE.DEFAULT_COLLECTION_PERCENTILE,zE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}zE.DEFAULT_COLLECTION_PERCENTILE=10,zE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zE.DEFAULT=new zE(41943040,zE.DEFAULT_COLLECTION_PERCENTILE,zE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zE.DISABLED=new zE(-1,0,0);class VE{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new VE(0)}static kn(){return new VE(-1)}}class jE{constructor(){this.changes=new zw(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Qb.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Jy.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class WE{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class GE{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Ex(n.mutation,e,vb.empty(),Ly.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,$w()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$w();const r=qw();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=Gw();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=qw();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,$w()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let o=jw();const i=Xw(),a=Xw();return t.forEach((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Sx)?o=o.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),Ex(a.mutation,t,a.mutation.getFieldMask(),Ly.now())):i.set(t.key,vb.empty())}),this.recalculateAndSaveOverlays(e,o).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new WE(t,null!==(n=i.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=Xw();let r=new db((e,t)=>e-t),o=$w();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const o of e)o.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=n.get(e)||vb.empty();a=o.applyToLocalView(i,a),n.set(e,a);const s=(r.get(o.batchId)||$w()).add(e);r=r.insert(o.batchId,s)})}).next(()=>{const i=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),s=r.key,u=r.value,c=Kw();u.forEach(e=>{if(!o.has(e)){const r=wx(t.get(e),n.get(e));null!==r&&c.set(e,r),o=o.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,s,c))}return Jy.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Wy.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Iw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(o=>{const i=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-o.size):Jy.resolve(qw());let a=-1,s=o;return i.next(t=>Jy.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),o.get(t)?Jy.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{s=s.insert(t,e)}))).next(()=>this.populateOverlays(e,t,o)).next(()=>this.computeViews(e,s,t,$w())).next(e=>({batchId:a,changes:Hw(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Wy(t)).next(e=>{let t=Gw();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const o=t.collectionGroup;let i=Gw();return this.indexManager.getCollectionParents(e,o).next(a=>Jy.forEach(a,a=>{const s=function(e,t){return new _w(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(o));return this.getDocumentsMatchingCollectionQuery(e,s,n,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(o=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,r))).next(e=>{o.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Qb.newInvalidDocument(r)))});let n=Gw();return e.forEach((e,r)=>{const i=o.get(e);void 0!==i&&Ex(i.mutation,r,vb.empty(),Ly.now()),Mw(t,r)&&(n=n.insert(e,r))}),n})}}class HE{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return Jy.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:lE(e.createTime)}}(t)),Jy.resolve()}getNamedQuery(e,t){return Jy.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:ME(e.bundledQuery),readTime:lE(e.readTime)}}(t)),Jy.resolve()}}class qE{constructor(){this.overlays=new db(Wy.comparator),this.Ir=new Map}getOverlay(e,t){return Jy.resolve(this.overlays.get(t))}getOverlays(e,t){const n=qw();return Jy.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),Jy.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),Jy.resolve()}getOverlaysForCollection(e,t,n){const r=qw(),o=t.length+1,i=new Wy(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===o&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Jy.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let o=new db((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=o.get(e.largestBatchId);null===t&&(t=qw(),o=o.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=qw(),s=o.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Jy.resolve(a)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Px(t,n));let o=this.Ir.get(t);void 0===o&&(o=$w(),this.Ir.set(t,o)),this.Ir.set(t,o.add(n.key))}}class KE{constructor(){this.sessionToken=bb.EMPTY_BYTE_STRING}getSessionToken(e){return Jy.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Jy.resolve()}}class XE{constructor(){this.Tr=new mb(QE.Er),this.dr=new mb(QE.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new QE(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new QE(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new Wy(new zy([])),n=new QE(t,e),r=new QE(t,e+1),o=[];return this.dr.forEachInRange([n,r],e=>{this.Vr(e),o.push(e.key)}),o}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Wy(new zy([])),n=new QE(t,e),r=new QE(t,e+1);let o=$w();return this.dr.forEachInRange([n,r],e=>{o=o.add(e.key)}),o}containsKey(e){const t=new QE(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class QE{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Wy.comparator(e.key,t.key)||Fy(e.wr,t.wr)}static Ar(e,t){return Fy(e.wr,t.wr)||Wy.comparator(e.key,t.key)}}class YE{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new mb(QE.Er)}checkEmpty(e){return Jy.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const o=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Dx(o,t,n,r);this.mutationQueue.push(i);for(const a of r)this.br=this.br.add(new QE(a.key,o)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Jy.resolve(i)}lookupMutationBatch(e,t){return Jy.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),o=r<0?0:r;return Jy.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Jy.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return Jy.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new QE(t,0),r=new QE(t,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([n,r],e=>{const t=this.Dr(e.wr);o.push(t)}),Jy.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new mb(Fy);return t.forEach(e=>{const t=new QE(e,0),r=new QE(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],e=>{n=n.add(e.wr)})}),Jy.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let o=n;Wy.isDocumentKey(o)||(o=o.child(""));const i=new QE(new Wy(o),0);let a=new mb(Fy);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.wr)),!0)},i),Jy.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){wy(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Jy.forEach(t.mutations,r=>{const o=new QE(r.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new QE(t,0),r=this.br.firstAfterOrEqual(n);return Jy.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Jy.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class $E{constructor(e){this.Mr=e,this.docs=new db(Wy.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),o=r?r.size:0,i=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Jy.resolve(n?n.document.mutableCopy():Qb.newInvalidDocument(t))}getEntries(e,t){let n=jw();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Qb.newInvalidDocument(e))}),Jy.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let o=jw();const i=t.path,a=new Wy(i.child("")),s=this.docs.getIteratorFrom(a);for(;s.hasNext();){const{key:e,value:{document:a}}=s.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Xy(qy(a),n)<=0||(r.has(a.key)||Mw(t,a))&&(o=o.insert(a.key,a.mutableCopy()))}return Jy.resolve(o)}getAllFromCollectionGroup(e,t,n,r){by()}Or(e,t){return Jy.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new JE(this)}getSize(e){return Jy.resolve(this.size)}}class JE extends jE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),Jy.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class ZE{constructor(e){this.persistence=e,this.Nr=new zw(e=>ww(e),xw),this.lastRemoteSnapshotVersion=By.min(),this.highestTargetId=0,this.Lr=0,this.Br=new XE,this.targetCount=0,this.kr=VE.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),Jy.resolve()}getLastRemoteSnapshotVersion(e){return Jy.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Jy.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Jy.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),Jy.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new VE(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,Jy.resolve()}updateTargetData(e,t){return this.Kn(t),Jy.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,Jy.resolve()}removeTargets(e,t,n){let r=0;const o=[];return this.Nr.forEach((i,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(i),o.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),Jy.waitFor(o).next(()=>r)}getTargetCount(e){return Jy.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return Jy.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),Jy.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach(t=>{o.push(r.markPotentiallyOrphaned(e,t))}),Jy.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),Jy.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return Jy.resolve(n)}containsKey(e,t){return Jy.resolve(this.Br.containsKey(t))}}class e_{constructor(e,t){this.qr={},this.overlays={},this.Qr=new tb(0),this.Kr=!1,this.Kr=!0,this.$r=new KE,this.referenceDelegate=e(this),this.Ur=new ZE(this),this.indexManager=new BE,this.remoteDocumentCache=function(e){return new $E(e)}(e=>this.referenceDelegate.Wr(e)),this.serializer=new FE(t),this.Gr=new HE(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qE,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new YE(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){my("MemoryPersistence","Starting transaction:",e);const r=new t_(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(e=>this.referenceDelegate.jr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Hr(e,t){return Jy.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class t_ extends Yy{constructor(e){super(),this.currentSequenceNumber=e}}class n_{constructor(e){this.persistence=e,this.Jr=new XE,this.Yr=null}static Zr(e){return new n_(e)}get Xr(){if(this.Yr)return this.Yr;throw by()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),Jy.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),Jy.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),Jy.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Jy.forEach(this.Xr,n=>{const r=Wy.fromPath(n);return this.ei(e,r).next(e=>{e||t.removeEntry(r,By.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return Jy.or([()=>Jy.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class r_{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=$w(),r=$w();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new r_(e,t.fromCache,n,r)}}class o_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class i_{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=mg()?8:Zy(pg())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const o={result:null};return this.Yi(e,t).next(e=>{o.result=e}).next(()=>{if(!o.result)return this.Zi(e,t,r,n).next(e=>{o.result=e})}).next(()=>{if(o.result)return;const n=new o_;return this.Xi(e,t,n).next(r=>{if(o.result=r,this.zi)return this.es(e,t,n,r.size)})}).next(()=>o.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(py()<=Tg.DEBUG&&my("QueryEngine","SDK will not create cache indexes for query:",Fw(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Jy.resolve()):(py()<=Tg.DEBUG&&my("QueryEngine","Query:",Fw(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(py()<=Tg.DEBUG&&my("QueryEngine","The SDK decides to create cache indexes for query:",Fw(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Nw(t))):Jy.resolve())}Yi(e,t){if(Sw(t))return Jy.resolve(null);let n=Nw(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Dw(t,null,"F"),n=Nw(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const o=$w(...r);return this.Ji.getDocuments(e,o).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.ts(t,r);return this.ns(t,i,o,n.readTime)?this.Yi(e,Dw(t,null,"F")):this.rs(e,i,t,n)}))})))}Zi(e,t,n,r){return Sw(t)||r.isEqual(By.min())?Jy.resolve(null):this.Ji.getDocuments(e,n).next(o=>{const i=this.ts(t,o);return this.ns(t,i,n,r)?Jy.resolve(null):(py()<=Tg.DEBUG&&my("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Fw(t)),this.rs(e,i,t,Hy(r,-1)).next(e=>e))})}ts(e,t){let n=new mb(Bw(e));return t.forEach((t,r)=>{Mw(e,r)&&(n=n.add(r))}),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const o="F"===e.limitType?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}Xi(e,t,n){return py()<=Tg.DEBUG&&my("QueryEngine","Using full collection scan to execute query:",Fw(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ky.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class a_{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new db(Fy),this._s=new zw(e=>ww(e),xw),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function s_(e,t,n,r){return new a_(e,t,n,r)}async function u_(e,t){const n=xy(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(o=>(r=o,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const o=[],i=[];let a=$w();for(const e of r){o.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({hs:e,removedBatchIds:o,addedBatchIds:i}))})})}function c_(e){const t=xy(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function l_(e,t,n){let r=$w(),o=$w();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=jw();return n.forEach((n,i)=>{const a=e.get(n);i.isFoundDocument()!==a.isFoundDocument()&&(o=o.add(n)),i.isNoDocument()&&i.version.isEqual(By.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):my("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",i.version)}),{Ps:r,Is:o}})}function h_(e,t){const n=xy(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function d_(e,t){const n=xy(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Ur.getTargetData(e,t).next(o=>o?(r=o,Jy.resolve(r)):n.Ur.allocateTargetId(e).next(o=>(r=new PE(t,o,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e})}async function f_(e,t,n){const r=xy(e),o=r.os.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,o))}catch(e){if(!eb(e))throw e;my("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.os=r.os.remove(t),r._s.delete(o.target)}function p_(e,t,n){const r=xy(e);let o=By.min(),i=$w();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=xy(e),o=r._s.get(n);return void 0!==o?Jy.resolve(r.os.get(o)):r.Ur.getTargetData(t,n)}(r,e,Nw(t)).next(t=>{if(t)return o=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.ss.getDocumentsMatchingQuery(e,t,n?o:By.min(),n?i:$w())).next(e=>(m_(r,Lw(t),e),{documents:e,Ts:i})))}function m_(e,t,n){let r=e.us.get(t)||By.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.us.set(t,r)}class g_{constructor(){this.activeTargetIds=Zw()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class v_{constructor(){this.so=new g_,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new g_,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class y_{_o(e){}shutdown(){}}class b_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){my("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){my("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let w_=null;function x_(){return null===w_?w_=268435456+Math.round(2147483648*Math.random()):w_++,"0x"+w_.toString(16)}const E_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class __{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const C_="WebChannelConnection";class k_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo="projects/".concat(n,"/databases/").concat(r),this.Co="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get Fo(){return!1}Mo(e,t,n,r,o){const i=x_(),a=this.xo(e,t.toUriEncodedString());my("RestConnection","Sending RPC '".concat(e,"' ").concat(i,":"),a,n);const s={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(s,r,o),this.No(e,a,s,n).then(t=>(my("RestConnection","Received RPC '".concat(e,"' ").concat(i,": "),t),t),t=>{throw vy("RestConnection","RPC '".concat(e,"' ").concat(i," failed with error: "),t,"url: ",a,"request:",n),t})}Lo(e,t,n,r,o,i){return this.Mo(e,t,n,r,o)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+dy,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=E_[e];return"".concat(this.Do,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const o=x_();return new Promise((i,a)=>{const s=new ey;s.setWithCredentials(!0),s.listenOnce(ny.COMPLETE,()=>{try{switch(s.getLastErrorCode()){case ry.NO_ERROR:const t=s.getResponseJson();my(C_,"XHR for RPC '".concat(e,"' ").concat(o," received:"),JSON.stringify(t)),i(t);break;case ry.TIMEOUT:my(C_,"RPC '".concat(e,"' ").concat(o," timed out")),a(new _y(Ey.DEADLINE_EXCEEDED,"Request time out"));break;case ry.HTTP_ERROR:const n=s.getStatus();if(my(C_,"RPC '".concat(e,"' ").concat(o," failed with status:"),n,"response text:",s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ey).indexOf(t)>=0?t:Ey.UNKNOWN}(t.status);a(new _y(e,t.message))}else a(new _y(Ey.UNKNOWN,"Server responded with status "+s.getStatus()))}else a(new _y(Ey.UNAVAILABLE,"Connection failed."));break;default:by()}}finally{my(C_,"RPC '".concat(e,"' ").concat(o," completed."))}});const u=JSON.stringify(r);my(C_,"RPC '".concat(e,"' ").concat(o," sending request:"),r),s.send(t,"POST",u,n,15)})}Bo(e,t,n){const r=x_(),o=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=sy(),a=ay(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(s.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Oo(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;const c=o.join("");my(C_,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),s);const l=i.createWebChannel(c,s);let h=!1,d=!1;const f=new __({Io:t=>{d?my(C_,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(my(C_,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),h=!0),my(C_,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},To:()=>l.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(l,ty.EventType.OPEN,()=>{d||(my(C_,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),f.yo())}),p(l,ty.EventType.CLOSE,()=>{d||(d=!0,my(C_,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.So())}),p(l,ty.EventType.ERROR,t=>{d||(d=!0,vy(C_,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),f.So(new _y(Ey.UNAVAILABLE,"The operation could not be completed")))}),p(l,ty.EventType.MESSAGE,t=>{var n;if(!d){const o=t.data[0];wy(!!o);const i=o,a=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(a){my(C_,"RPC '".concat(e,"' stream ").concat(r," received error:"),a);const t=a.status;let n=function(e){const t=Mx[e];if(void 0!==t)return Ux(t)}(t),o=a.message;void 0===n&&(n=Ey.INTERNAL,o="Unknown error status: "+t+" with message "+a.message),d=!0,f.So(new _y(n,o)),l.close()}else my(C_,"RPC '".concat(e,"' stream ").concat(r," received:"),o),f.bo(o)}}),p(a,iy.STAT_EVENT,t=>{t.stat===oy.PROXY?my(C_,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===oy.NOPROXY&&my(C_,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.wo()},0),f}}function S_(){return"undefined"!=typeof document?document:null}function I_(e){return new iE(e,!0)}class T_{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&my("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class N_{constructor(e,t,n,r,o,i,a,s){this.ui=e,this.Ho=n,this.Jo=r,this.connection=o,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=s,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new T_(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===Ey.RESOURCE_EXHAUSTED?(gy(t.toString()),gy("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Ey.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.Yo===t&&this.P_(n,r)},t=>{e(()=>{const e=new _y(Ey.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return my("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(my("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class R_ extends N_{constructor(e,t,n,r,o,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=o}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:by()}(t.targetChange.targetChangeType||"NO_CHANGE"),o=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(wy(void 0===t||"string"==typeof t),bb.fromBase64String(t||"")):(wy(void 0===t||t instanceof Buffer||t instanceof Uint8Array),bb.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,s=a&&function(e){const t=void 0===e.code?Ey.UNKNOWN:Ux(e.code);return new _y(t,e.message||"")}(a);n=new $x(r,o,i,s||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const o=mE(e,r.document.name),i=lE(r.document.updateTime),a=r.document.createTime?lE(r.document.createTime):By.min(),s=new Kb({mapValue:{fields:r.document.fields}}),u=Qb.newFoundDocument(o,i,a,s),c=r.targetIds||[],l=r.removedTargetIds||[];n=new Qx(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const o=mE(e,r.document),i=r.readTime?lE(r.readTime):By.min(),a=Qb.newNoDocument(o,i),s=r.removedTargetIds||[];n=new Qx([],s,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const o=mE(e,r.document),i=r.removedTargetIds||[];n=new Qx([],i,o,null)}else{if(!("filter"in t))return by();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:o}=e,i=new Fx(r,o),a=e.targetId;n=new Yx(a,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return By.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?By.min():t.readTime?lE(t.readTime):By.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=yE(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Ew(r)?{documents:EE(e,r)}:{query:_E(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=uE(e,t.resumeToken);const r=aE(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(By.min())>0){n.readTime=sE(e,t.snapshotVersion.toTimestamp());const r=aE(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return by()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=yE(this.serializer),t.removeTarget=e,this.a_(t)}}class A_ extends N_{constructor(e,t,n,r,o,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return wy(!!e.streamToken),this.lastStreamToken=e.streamToken,wy(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){wy(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(wy(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?lE(e.updateTime):lE(t);return n.isEqual(By.min())&&(n=lE(t)),new gx(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=lE(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=yE(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>xE(this.serializer,e))};this.a_(t)}}class D_ extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new _y(Ey.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(o=>{let[i,a]=o;return this.connection.Mo(e,dE(t,n),r,i,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ey.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _y(Ey.UNKNOWN,e.toString())})}Lo(e,t,n,r,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[a,s]=i;return this.connection.Lo(e,dE(t,n),r,a,s,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Ey.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _y(Ey.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class O_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.D_?(gy(t),this.D_=!1):my("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class P_{constructor(e,t,n,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(e=>{n.enqueueAndForget(async()=>{W_(this)&&(my("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=xy(e);t.L_.add(4),await M_(t),t.q_.set("Unknown"),t.L_.delete(4),await F_(t)}(this))})}),this.q_=new O_(n,r)}}async function F_(e){if(W_(e))for(const t of e.B_)await t(!0)}async function M_(e){for(const t of e.B_)await t(!1)}function L_(e,t){const n=xy(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),j_(n)?V_(n):uC(n).r_()&&U_(n,t))}function B_(e,t){const n=xy(e),r=uC(n);n.N_.delete(t),r.r_()&&z_(n,t),0===n.N_.size&&(r.r_()?r.o_():W_(n)&&n.q_.set("Unknown"))}function U_(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(By.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}uC(e).A_(t)}function z_(e,t){e.Q_.xe(t),uC(e).R_(t)}function V_(e){e.Q_=new Zx({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),uC(e).start(),e.q_.v_()}function j_(e){return W_(e)&&!uC(e).n_()&&e.N_.size>0}function W_(e){return 0===xy(e).L_.size}function G_(e){e.Q_=void 0}async function H_(e){e.q_.set("Online")}async function q_(e){e.N_.forEach((t,n)=>{U_(e,t)})}async function K_(e,t){G_(e),j_(e)?(e.q_.M_(t),V_(e)):e.q_.set("Unknown")}async function X_(e,t,n){if(e.q_.set("Online"),t instanceof $x&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(n){my("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Q_(e,n)}else if(t instanceof Qx?e.Q_.Ke(t):t instanceof Yx?e.Q_.He(t):e.Q_.We(t),!n.isEqual(By.min()))try{const t=await c_(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const o=e.N_.get(r);o&&e.N_.set(r,o.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken(bb.EMPTY_BYTE_STRING,r.snapshotVersion)),z_(e,t);const o=new PE(r.target,t,n,r.sequenceNumber);U_(e,o)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){my("RemoteStore","Failed to raise snapshot:",t),await Q_(e,t)}}async function Q_(e,t,n){if(!eb(t))throw t;e.L_.add(1),await M_(e),e.q_.set("Offline"),n||(n=()=>c_(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{my("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await F_(e)})}function Y_(e,t){return t().catch(n=>Q_(e,n,t))}async function $_(e){const t=xy(e),n=cC(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;J_(t);)try{const e=await h_(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,Z_(t,e)}catch(e){await Q_(t,e)}eC(t)&&tC(t)}function J_(e){return W_(e)&&e.O_.length<10}function Z_(e,t){e.O_.push(t);const n=cC(e);n.r_()&&n.V_&&n.m_(t.mutations)}function eC(e){return W_(e)&&!cC(e).n_()&&e.O_.length>0}function tC(e){cC(e).start()}async function nC(e){cC(e).p_()}async function rC(e){const t=cC(e);for(const n of e.O_)t.m_(n.mutations)}async function oC(e,t,n){const r=e.O_.shift(),o=Ox.from(r,t,n);await Y_(e,()=>e.remoteSyncer.applySuccessfulWrite(o)),await $_(e)}async function iC(e,t){t&&cC(e).V_&&await async function(e,t){if(function(e){return Bx(e)&&e!==Ey.ABORTED}(t.code)){const n=e.O_.shift();cC(e).s_(),await Y_(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await $_(e)}}(e,t),eC(e)&&tC(e)}async function aC(e,t){const n=xy(e);n.asyncQueue.verifyOperationInProgress(),my("RemoteStore","RemoteStore received new credentials");const r=W_(n);n.L_.add(3),await M_(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await F_(n)}async function sC(e,t){const n=xy(e);t?(n.L_.delete(2),await F_(n)):t||(n.L_.add(2),await M_(n),n.q_.set("Unknown"))}function uC(e){return e.K_||(e.K_=function(e,t,n){const r=xy(e);return r.w_(),new R_(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:H_.bind(null,e),Ro:q_.bind(null,e),mo:K_.bind(null,e),d_:X_.bind(null,e)}),e.B_.push(async t=>{t?(e.K_.s_(),j_(e)?V_(e):e.q_.set("Unknown")):(await e.K_.stop(),G_(e))})),e.K_}function cC(e){return e.U_||(e.U_=function(e,t,n){const r=xy(e);return r.w_(),new A_(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:nC.bind(null,e),mo:iC.bind(null,e),f_:rC.bind(null,e),g_:oC.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await $_(e)):(await e.U_.stop(),e.O_.length>0&&(my("RemoteStore","Stopping write stream with ".concat(e.O_.length," pending writes")),e.O_=[]))})),e.U_}class lC{constructor(e,t,n,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=o,this.deferred=new Cy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,o){const i=Date.now()+n,a=new lC(e,t,i,r,o);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _y(Ey.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hC(e,t){if(gy("AsyncQueue","".concat(t,": ").concat(e)),eb(e))return new _y(Ey.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class dC{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Wy.comparator(t.key,n.key):(e,t)=>Wy.comparator(e.key,t.key),this.keyedMap=Gw(),this.sortedSet=new db(this.comparator)}static emptySet(e){return new dC(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dC))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new dC;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class fC{constructor(){this.W_=new db(Wy.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):by():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class pC{constructor(e,t,n,r,o,i,a,s,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=o,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=s,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,o){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new pC(e,t,dC.emptySet(t),i,n,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ow(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class mC{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class gC{constructor(){this.queries=vC(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=xy(e),r=n.queries;n.queries=vC(),r.forEach((e,n)=>{for(const r of n.j_)r.onError(t)})}(this,new _y(Ey.ABORTED,"Firestore shutting down"))}}function vC(){return new zw(e=>Pw(e),Ow)}async function yC(e,t){const n=xy(e);let r=3;const o=t.query;let i=n.queries.get(o);i?!i.H_()&&t.J_()&&(r=2):(i=new mC,r=t.J_()?0:1);try{switch(r){case 0:i.z_=await n.onListen(o,!0);break;case 1:i.z_=await n.onListen(o,!1);break;case 2:await n.onFirstRemoteStoreListen(o)}}catch(e){const n=hC(e,"Initialization of query '".concat(Fw(t.query),"' failed"));return void t.onError(n)}n.queries.set(o,i),i.j_.push(t),t.Z_(n.onlineState),i.z_&&t.X_(i.z_)&&EC(n)}async function bC(e,t){const n=xy(e),r=t.query;let o=3;const i=n.queries.get(r);if(i){const e=i.j_.indexOf(t);e>=0&&(i.j_.splice(e,1),0===i.j_.length?o=t.J_()?0:1:!i.H_()&&t.J_()&&(o=2))}switch(o){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function wC(e,t){const n=xy(e);let r=!1;for(const o of t){const e=o.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(o)&&(r=!0);t.z_=o}}r&&EC(n)}function xC(e,t,n){const r=xy(e),o=r.queries.get(t);if(o)for(const i of o.j_)i.onError(n);r.queries.delete(t)}function EC(e){e.Y_.forEach(e=>{e.next()})}var _C,CC;(CC=_C||(_C={})).ea="default",CC.Cache="cache";class kC{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new pC(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=pC.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==_C.Cache}}class SC{constructor(e){this.key=e}}class IC{constructor(e){this.key=e}}class TC{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=$w(),this.mutatedKeys=$w(),this.Aa=Bw(e),this.Ra=new dC(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new fC,r=t?t.Ra:this.Ra;let o=t?t.mutatedKeys:this.mutatedKeys,i=r,a=!1;const s="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),l=Mw(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;c&&l?c.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ga(c,l)||(n.track({type:2,doc:l}),f=!0,(s&&this.Aa(l,s)>0||u&&this.Aa(l,u)<0)&&(a=!0)):!c&&l?(n.track({type:0,doc:l}),f=!0):c&&!l&&(n.track({type:1,doc:c}),f=!0,(s||u)&&(a=!0)),f&&(l?(i=i.add(l),o=d?o.add(e):o.delete(e)):(i=i.delete(e),o=o.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),o=o.delete(e.key),n.track({type:1,doc:e})}return{Ra:i,fa:n,ns:a,mutatedKeys:o}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const o=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const i=e.fa.G_();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return by()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(n),r=null!=r&&r;const a=t&&!r?this.ya():[],s=0===this.da.size&&this.current&&!r?1:0,u=s!==this.Ea;return this.Ea=s,0!==i.length||u?{snapshot:new pC(this.query,e.Ra,o,i,e.mutatedKeys,0===s,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new fC,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=$w(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});const t=[];return e.forEach(e=>{this.da.has(e)||t.push(new IC(e))}),this.da.forEach(n=>{e.has(n)||t.push(new SC(n))}),t}ba(e){this.Ta=e.Ts,this.da=$w();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return pC.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class NC{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class RC{constructor(e){this.key=e,this.va=!1}}class AC{constructor(e,t,n,r,o,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=i,this.Ca={},this.Fa=new zw(e=>Pw(e),Ow),this.Ma=new Map,this.xa=new Set,this.Oa=new db(Wy.comparator),this.Na=new Map,this.La=new XE,this.Ba={},this.ka=new Map,this.qa=VE.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function DC(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=ZC(e);let o;const i=r.Fa.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),o=i.view.Da()):o=await PC(r,t,n,!0),o}async function OC(e,t){const n=ZC(e);await PC(n,t,!0,!1)}async function PC(e,t,n,r){const o=await d_(e.localStore,Nw(t)),i=o.targetId,a=e.sharedClientState.addLocalQueryTarget(i,n);let s;return r&&(s=await FC(e,t,i,"current"===a,o.resumeToken)),e.isPrimaryClient&&n&&L_(e.remoteStore,o),s}async function FC(e,t,n,r,o){e.Ka=(t,n,r)=>async function(e,t,n,r){let o=t.view.ma(n);o.ns&&(o=await p_(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ma(n,o)}));const i=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),s=t.view.applyChanges(o,e.isPrimaryClient,i,a);return KC(e,t.targetId,s.wa),s.snapshot}(e,t,n,r);const i=await p_(e.localStore,t,!0),a=new TC(t,i.Ts),s=a.ma(i.documents),u=Xx.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,o),c=a.applyChanges(s,e.isPrimaryClient,u);KC(e,n,c.wa);const l=new NC(t,n,a);return e.Fa.set(t,l),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),c.snapshot}async function MC(e,t,n){const r=xy(e),o=r.Fa.get(t),i=r.Ma.get(o.targetId);if(i.length>1)return r.Ma.set(o.targetId,i.filter(e=>!Ow(e,t))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(o.targetId),r.sharedClientState.isActiveQueryTarget(o.targetId)||await f_(r.localStore,o.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(o.targetId),n&&B_(r.remoteStore,o.targetId),HC(r,o.targetId)}).catch($y)):(HC(r,o.targetId),await f_(r.localStore,o.targetId,!0))}async function LC(e,t){const n=xy(e),r=n.Fa.get(t),o=n.Ma.get(r.targetId);n.isPrimaryClient&&1===o.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),B_(n.remoteStore,r.targetId))}async function BC(e,t){const n=xy(e);try{const e=await function(e,t){const n=xy(e),r=t.snapshotVersion;let o=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.cs.newChangeBuffer({trackRemovals:!0});o=n.os;const a=[];t.targetChanges.forEach((i,s)=>{const u=o.get(s);if(!u)return;a.push(n.Ur.removeMatchingKeys(e,i.removedDocuments,s).next(()=>n.Ur.addMatchingKeys(e,i.addedDocuments,s)));let c=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(s)?c=c.withResumeToken(bb.EMPTY_BYTE_STRING,By.min()).withLastLimboFreeSnapshotVersion(By.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),o=o.insert(s,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,i)&&a.push(n.Ur.updateTargetData(e,c))});let s=jw(),u=$w();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(l_(e,i,t.documentUpdates).next(e=>{s=e.Ps,u=e.Is})),!r.isEqual(By.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next(t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return Jy.waitFor(a).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,s,u)).next(()=>s)}).then(e=>(n.os=o,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Na.get(t);r&&(wy(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?wy(r.va):e.removedDocuments.size>0&&(wy(r.va),r.va=!1))}),await YC(n,e,t)}catch(e){await $y(e)}}function UC(e,t,n){const r=xy(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach((n,r)=>{const o=r.view.Z_(t);o.snapshot&&e.push(o.snapshot)}),function(e,t){const n=xy(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const o of n.j_)o.Z_(t)&&(r=!0)}),r&&EC(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function zC(e,t,n){const r=xy(e);r.sharedClientState.updateQueryState(t,"rejected",n);const o=r.Na.get(t),i=o&&o.key;if(i){let e=new db(Wy.comparator);e=e.insert(i,Qb.newNoDocument(i,By.min()));const n=$w().add(i),o=new Kx(By.min(),new Map,new db(Fy),e,n);await BC(r,o),r.Oa=r.Oa.remove(i),r.Na.delete(t),QC(r)}else await f_(r.localStore,t,!1).then(()=>HC(r,t,n)).catch($y)}async function VC(e,t){const n=xy(e),r=t.batch.batchId;try{const e=await function(e,t){const n=xy(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),o=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const o=n.batch,i=o.keys();let a=Jy.resolve();return i.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);wy(null!==i),t.version.compareTo(i)<0&&(o.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,o))}(n,e,t,o).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=$w();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);GC(n,r,null),WC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await YC(n,e)}catch(e){await $y(e)}}async function jC(e,t,n){const r=xy(e);try{const e=await function(e,t){const n=xy(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(wy(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);GC(r,t,n),WC(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await YC(r,e)}catch(n){await $y(n)}}function WC(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function GC(e,t,n){const r=xy(e);let o=r.Ba[r.currentUser.toKey()];if(o){const e=o.get(t);e&&(n?e.reject(n):e.resolve(),o=o.remove(t)),r.Ba[r.currentUser.toKey()]=o}}function HC(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||qC(e,t)})}function qC(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(B_(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),QC(e))}function KC(e,t,n){for(const r of n)r instanceof SC?(e.La.addReference(r.key,t),XC(e,r)):r instanceof IC?(my("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||qC(e,r.key)):by()}function XC(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(my("SyncEngine","New document in limbo: "+n),e.xa.add(r),QC(e))}function QC(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new Wy(zy.fromString(t)),r=e.qa.next();e.Na.set(r,new RC(n)),e.Oa=e.Oa.insert(n,r),L_(e.remoteStore,new PE(Nw(kw(n.path)),r,"TargetPurposeLimboResolution",tb.oe))}}async function YC(e,t,n){const r=xy(e),o=[],i=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((e,s)=>{a.push(r.Ka(s,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){const o=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(s.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(s.targetId,o?"current":"not-current")}if(e){o.push(e);const t=r_.Wi(s.targetId,e);i.push(t)}}))}),await Promise.all(a),r.Ca.d_(o),await async function(e,t){const n=xy(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Jy.forEach(t,t=>Jy.forEach(t.$i,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Jy.forEach(t.Ui,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!eb(e))throw e;my("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.os.get(e),r=t.snapshotVersion,o=t.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(e,o)}}}(r.localStore,i))}async function $C(e,t){const n=xy(e);if(!n.currentUser.isEqual(t)){my("SyncEngine","User change. New user:",t.toKey());const e=await u_(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach(e=>{e.forEach(e=>{e.reject(new _y(Ey.CANCELLED,t))})}),e.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await YC(n,e.hs)}}function JC(e,t){const n=xy(e),r=n.Na.get(t);if(r&&r.va)return $w().add(r.key);{let e=$w();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function ZC(e){const t=xy(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=BC.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=JC.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=zC.bind(null,t),t.Ca.d_=wC.bind(null,t.eventManager),t.Ca.$a=xC.bind(null,t.eventManager),t}function ek(e){const t=xy(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=VC.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jC.bind(null,t),t}class tk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=I_(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return s_(this.persistence,new i_,e.initialUser,this.serializer)}Ga(e){return new e_(n_.Zr,this.serializer)}Wa(e){return new v_}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}tk.provider={build:()=>new tk};class nk{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>UC(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=$C.bind(null,this.syncEngine),await sC(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new gC}createDatastore(e){const t=I_(e.databaseInfo.databaseId),n=function(e){return new k_(e)}(e.databaseInfo);return function(e,t,n,r){return new D_(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,o){return new P_(e,t,n,r,o)}(this.localStore,this.datastore,e.asyncQueue,e=>UC(this.syncEngine,e,0),b_.D()?new b_:new y_)}createSyncEngine(e,t){return function(e,t,n,r,o,i,a){const s=new AC(e,t,n,r,o,i);return a&&(s.Qa=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=xy(e);my("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await M_(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}nk.provider={build:()=>new nk};class rk{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):gy("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class ok{constructor(e,t,n,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=hy.UNAUTHENTICATED,this.clientId=Py.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,async e=>{my("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(my("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Cy;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(m){const n=hC(m,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function ik(e,t){e.asyncQueue.verifyOperationInProgress(),my("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await u_(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function ak(e,t){e.asyncQueue.verifyOperationInProgress();const n=await sk(e);my("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>aC(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>aC(t.remoteStore,n)),e._onlineComponents=t}async function sk(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){my("FirestoreClient","Using user provided OfflineComponentProvider");try{await ik(e,e._uninitializedComponentsProvider._offline)}catch(m){const n=m;if(!function(e){return"FirebaseError"===e.name?e.code===Ey.FAILED_PRECONDITION||e.code===Ey.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;vy("Error using user provided cache. Falling back to memory cache: "+n),await ik(e,new tk)}}else my("FirestoreClient","Using default OfflineComponentProvider"),await ik(e,new tk);return e._offlineComponents}async function uk(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(my("FirestoreClient","Using user provided OnlineComponentProvider"),await ak(e,e._uninitializedComponentsProvider._online)):(my("FirestoreClient","Using default OnlineComponentProvider"),await ak(e,new nk))),e._onlineComponents}function ck(e){return uk(e).then(e=>e.syncEngine)}async function lk(e){const t=await uk(e),n=t.eventManager;return n.onListen=DC.bind(null,t.syncEngine),n.onUnlisten=MC.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=OC.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=LC.bind(null,t.syncEngine),n}function hk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Cy;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,o){const i=new rk({next:n=>{i.Za(),t.enqueueAndForget(()=>bC(e,a)),n.fromCache&&"server"===r.source?o.reject(new _y(Ey.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(n)},error:e=>o.reject(e)}),a=new kC(n,i,{includeMetadataChanges:!0,_a:!0});return yC(e,a)}(await lk(e),e.asyncQueue,t,n,r)),r.promise}function dk(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const fk=new Map;function pk(e,t,n){if(!n)throw new _y(Ey.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function mk(e){if(!Wy.isDocumentKey(e))throw new _y(Ey.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function gk(e){if(Wy.isDocumentKey(e))throw new _y(Ey.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function vk(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":by()}function yk(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new _y(Ey.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=vk(e);throw new _y(Ey.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}class bk{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new _y(Ey.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new _y(Ey.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new _y(Ey.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dk(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new _y(Ey.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new _y(Ey.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new _y(Ey.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wk{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bk({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new _y(Ey.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new _y(Ey.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bk(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Sy;switch(e.type){case"firstParty":return new Ry(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new _y(Ey.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=fk.get(e);t&&(my("ComponentProvider","Removing Datastore"),fk.delete(e),t.terminate())}(this),Promise.resolve()}}class xk{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new xk(this.firestore,e,this._query)}}class Ek{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _k(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ek(this.firestore,e,this._key)}}class _k extends xk{constructor(e,t,n){super(e,t,kw(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ek(this.firestore,null,new Wy(e))}withConverter(e){return new _k(this.firestore,e,this._path)}}function Ck(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if(e=Eg(e),pk("collection","path",t),e instanceof wk){const n=zy.fromString(t,...r);return gk(n),new _k(e,null,n)}{if(!(e instanceof Ek||e instanceof _k))throw new _y(Ey.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(zy.fromString(t,...r));return gk(n),new _k(e.firestore,null,n)}}function kk(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if(e=Eg(e),1===arguments.length&&(t=Py.newId()),pk("doc","path",t),e instanceof wk){const n=zy.fromString(t,...r);return mk(n),new Ek(e,null,new Wy(n))}{if(!(e instanceof Ek||e instanceof _k))throw new _y(Ey.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(zy.fromString(t,...r));return mk(n),new Ek(e.firestore,e instanceof _k?e.converter:null,new Wy(n))}}class Sk{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new T_(this,"async_queue_retry"),this.Vu=()=>{const e=S_();e&&my("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=S_();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=S_();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Cy;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(g){if(!eb(g))throw g;my("AsyncQueue","Operation failed with retryable error: "+g)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw gy("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=lC.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(r),r}fu(){this.Eu&&by()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}class Ik extends wk{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Sk,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Sk(e),this._firestoreClient=void 0,await e}}}function Tk(e){if(e._terminated)throw new _y(Ey.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Nk(e),e._firestoreClient}function Nk(e){var t,n,r;const o=e._freezeSettings(),i=function(e,t,n,r){return new Ib(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,dk(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,o);e._componentsProvider||(null===(n=o.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=o.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new ok(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class Rk{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Rk(bb.fromBase64String(e))}catch(e){throw new _y(Ey.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Rk(bb.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ak{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new _y(Ey.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jy(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Dk{constructor(e){this._methodName=e}}class Ok{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _y(Ey.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _y(Ey.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Fy(this._lat,e._lat)||Fy(this._long,e._long)}}class Pk{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Fk=/^__.*__$/;class Mk{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Sx(e,this.data,this.fieldMask,t,this.fieldTransforms):new kx(e,this.data,t,this.fieldTransforms)}}function Lk(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw by()}}class Bk{constructor(e,t,n,r,o,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===o&&this.vu(),this.fieldTransforms=o||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Bk(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return $k(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(Lk(this.Cu)&&Fk.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Uk{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||I_(e)}Qu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Bk({Cu:e,methodName:t,qu:n,path:jy.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function zk(e){const t=e._freezeSettings(),n=I_(e._databaseId);return new Uk(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Vk(e,t,n,r,o){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Qu(i.merge||i.mergeFields?2:0,t,n,o);Kk("Data must be an object, but it was:",a,r);const s=Hk(r,a);let u,c;if(i.merge)u=new vb(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const o=Xk(t,r,n);if(!a.contains(o))throw new _y(Ey.INVALID_ARGUMENT,"Field '".concat(o,"' is specified in your field mask but missing from your input data."));Jk(e,o)||e.push(o)}u=new vb(e),c=a.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=a.fieldTransforms;return new Mk(new Kb(s),u,c)}class jk extends Dk{_toFieldTransform(e){return new mx(e.path,new sx)}isEqual(e){return e instanceof jk}}function Wk(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Gk(n,e.Qu(r?4:3,t))}function Gk(e,t){if(qk(e=Eg(e)))return Kk("Unsupported field value:",t,e),Hk(e,t);if(e instanceof Dk)return function(e,t){if(!Lk(t.Cu))throw t.Bu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Bu("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const o of e){let e=Gk(o,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Eg(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return nx(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Ly.fromDate(e);return{timestampValue:sE(t.serializer,n)}}if(e instanceof Ly){const n=new Ly(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:sE(t.serializer,n)}}if(e instanceof Ok)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Rk)return{bytesValue:uE(t.serializer,e._byteString)};if(e instanceof Ek){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:hE(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Pk)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return ex(t.serializer,e)})}}}}}}(e,t);throw t.Bu("Unsupported field value: ".concat(vk(e)))}(e,t)}function Hk(e,t){const n={};return hb(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):lb(e,(e,r)=>{const o=Gk(r,t.Mu(e));null!=o&&(n[e]=o)}),{mapValue:{fields:n}}}function qk(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Ly||e instanceof Ok||e instanceof Rk||e instanceof Ek||e instanceof Dk||e instanceof Pk)}function Kk(e,t,n){if(!qk(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=vk(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function Xk(e,t,n){if((t=Eg(t))instanceof Ak)return t._internalPath;if("string"==typeof t)return Yk(e,t);throw $k("Field path arguments must be of type string or ",e,!1,void 0,n)}const Qk=new RegExp("[~\\*/\\[\\]]");function Yk(e,t,n){if(t.search(Qk)>=0)throw $k("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Ak(...t.split("."))._internalPath}catch(y){throw $k("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function $k(e,t,n,r,o){const i=r&&!r.isEmpty(),a=void 0!==o;let s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=" in field ".concat(r)),a&&(u+=" in document ".concat(o)),u+=")"),new _y(Ey.INVALID_ARGUMENT,s+e+u)}function Jk(e,t){return e.some(e=>e.isEqual(t))}class Zk{constructor(e,t,n,r,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ek(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new eS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(tS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class eS extends Zk{data(){return super.data()}}function tS(e,t){return"string"==typeof t?Yk(e,t):t instanceof Ak?t._internalPath:t._delegate._internalPath}function nS(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new _y(Ey.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rS{}class oS extends rS{}class iS extends oS{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new iS(e,t,n)}_apply(e){const t=this._parse(e);return lS(e._query,t),new xk(e.firestore,e.converter,Aw(e._query,t))}_parse(e){const t=zk(e.firestore),n=function(e,t,n,r,o,i,a){let s;if(o.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new _y(Ey.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){cS(a,i);const t=[];for(const n of a)t.push(uS(r,e,n));s={arrayValue:{values:t}}}else s=uS(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||cS(a,i),s=Wk(n,t,a,"in"===i||"not-in"===i);return nw.create(o,i,s)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class aS extends rS{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new aS(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:rw.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const o of r)lS(n,o),n=Aw(n,o)}(e._query,t),new xk(e.firestore,e.converter,Aw(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class sS extends oS{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new sS(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zb(t,n)}(e._query,this._field,this._direction);return new xk(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new _w(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function uS(e,t,n){if("string"==typeof(n=Eg(n))){if(""===n)throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Iw(t)&&-1!==n.indexOf("/"))throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(zy.fromString(n));if(!Wy.isDocumentKey(r))throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Bb(e,new Wy(r))}if(n instanceof Ek)return Bb(e,n._key);throw new _y(Ey.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(vk(n),"."))}function cS(e,t){if(!Array.isArray(e)||0===e.length)throw new _y(Ey.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function lS(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new _y(Ey.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new _y(Ey.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class hS{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Rb(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Eb(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_b(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw by()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return lb(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const o=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>Eb(e.doubleValue));return new Pk(o)}convertGeoPoint(e){return new Ok(Eb(e.latitude),Eb(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=kb(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Sb(e));default:return null}}convertTimestamp(e){const t=xb(e);return new Ly(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=zy.fromString(e);wy(OE(n));const r=new Tb(n.get(1),n.get(3)),o=new Wy(n.popFirst(5));return r.isEqual(t)||gy("Document ".concat(o," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),o}}function dS(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class fS{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pS extends Zk{constructor(e,t,n,r,o,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new mS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(tS("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class mS extends pS{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class gS{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new fS(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new mS(this._firestore,this._userDataWriter,n.key,n,new fS(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new _y(Ey.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new mS(e._firestore,e._userDataWriter,n.doc.key,n.doc,new fS(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new mS(e._firestore,e._userDataWriter,t.doc.key,t.doc,new fS(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let o=-1,i=-1;return 0!==t.type&&(o=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:vS(t.type),doc:r,oldIndex:o,newIndex:i}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function vS(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return by()}}class yS extends hS{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rk(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ek(this.firestore,null,t)}}function bS(e){e=yk(e,xk);const t=yk(e.firestore,Ik),n=Tk(t),r=new yS(t);return nS(e._query),hk(n,e._query).then(n=>new gS(t,r,e,n))}function wS(e,t){return function(e,t){const n=new Cy;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=ek(e);try{const e=await function(e,t){const n=xy(e),r=Ly.now(),o=t.reduce((e,t)=>e.add(t.key),$w());let i,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let s=jw(),u=$w();return n.cs.getEntries(e,o).next(e=>{s=e,s.forEach((e,t)=>{t.isValidDocument()||(u=u.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,s)).next(o=>{i=o;const a=[];for(const e of t){const t=_x(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new Sx(e.key,t,Xb(t.value.mapValue),vx.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(i,u);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:Hw(i)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new db(Fy)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await YC(r,e.changes),await $_(r.remoteStore)}catch(e){const t=hC(e,"Failed to persist write");n.reject(t)}}(await ck(e),t,n)),n.promise}(Tk(e),t)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){dy=e}(Mv),Dv(new _g("firestore",(e,n)=>{let{instanceIdentifier:r,options:o}=n;const i=e.getProvider("app").getImmediate(),a=new Ik(new Ty(e.getProvider("auth-internal")),new Dy(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new _y(Ey.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tb(e.options.projectId,t)}(i,r),i);return o=Object.assign({useFetchStreams:t},o),a._setSettings(o),a},"PUBLIC").setMultipleInstances(!0)),Uv(ly,"4.7.3",e),Uv(ly,"4.7.3","esm2017")}();Uv("firebase","10.14.1","app");const xS="firebasestorage.googleapis.com",ES="storageBucket";class _S extends vg{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(SS(e),"Firebase Storage: ".concat(t," (").concat(SS(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,_S.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return SS(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var CS,kS;function SS(e){return"storage/"+e}function IS(){return new _S(CS.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function TS(){return new _S(CS.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function NS(){return new _S(CS.CANCELED,"User canceled the upload/download.")}function RS(){return new _S(CS.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function AS(e){return new _S(CS.INVALID_ARGUMENT,e)}function DS(){return new _S(CS.APP_DELETED,"The Firebase app was deleted.")}function OS(e,t){return new _S(CS.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function PS(e){throw new _S(CS.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(CS||(CS={}));class FS{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=FS.makeFromUrl(e,t)}catch(g){return new FS(e,"")}if(""===n.path)return n;throw r=e,new _S(CS.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const o=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),s=[{regex:o,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(a,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp("^https?://".concat(t===xS?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:i}];for(let u=0;u<s.length;u++){const t=s[u],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let o=r[t.indices.path];o||(o=""),n=new FS(e,o),t.postModify(n);break}}if(null==n)throw function(e){return new _S(CS.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class MS{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function LS(e){return"string"===typeof e||e instanceof String}function BS(e){return US()&&e instanceof Blob}function US(){return"undefined"!==typeof Blob}function zS(e,t,n,r){if(r<t)throw AS("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(r>n)throw AS("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function VS(e,t,n){let r=t;return null==n&&(r="https://".concat(t)),"".concat(n,"://").concat(r,"/v0").concat(e)}function jS(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function WS(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),o=-1!==t.indexOf(e);return n||r||o}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(kS||(kS={}));class GS{constructor(e,t,n,r,o,i,a,s,u,c,l){let h=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=s,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new HS(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===kS.NO_ERROR,o=n.getStatus();if(!t||WS(o,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===kS.ABORT;return void e(!1,new HS(!1,null,t))}const i=-1!==this.successCodes_.indexOf(o);e(!0,new HS(i,n))})},t=(e,t)=>{const n=this.resolve_,r=this.reject_,o=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(o,o.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(g){r(g)}else if(null!==o){const e=IS();e.serverResponse=o.getErrorText(),this.errorCallback_?r(this.errorCallback_(o,e)):r(e)}else if(t.canceled){r(this.appDelete_?DS():NS())}else{r(TS())}};this.canceled_?t(0,new HS(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,o=null,i=null,a=!1,s=0;function u(){return 2===s}let c=!1;function l(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function h(t){o=setTimeout(()=>{o=null,e(f,u())},t)}function d(){i&&clearTimeout(i)}function f(e){if(c)return void d();for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(e)return d(),void l.call(null,e,...n);if(u()||a)return d(),void l.call(null,e,...n);let i;r<64&&(r*=2),1===s?(s=2,i=0):i=1e3*(r+Math.random()),h(i)}let p=!1;function m(e){p||(p=!0,d(),c||(null!==o?(e||(s=2),clearTimeout(o),h(0)):e||(s=1)))}return h(0),i=setTimeout(()=>{a=!0,m(!0)},n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class HS{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function qS(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function KS(){const e=qS();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(US())return new Blob(n);throw new _S(CS.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function XS(e){if("undefined"===typeof atob)throw t="base-64",new _S(CS.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const QS="raw",YS="base64",$S="base64url",JS="data_url";class ZS{constructor(e,t){this.data=e,this.contentType=t||null}}function eI(e,t){switch(e){case QS:return new ZS(tI(t));case YS:case $S:return new ZS(nI(e,t));case JS:return new ZS(function(e){const t=new rI(e);return t.base64?nI(YS,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(g){throw OS(JS,"Malformed data URL.")}return tI(t)}(t.rest)}(t),new rI(t).contentType)}throw IS()}function tI(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function nI(e,t){switch(e){case YS:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw OS(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case $S:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw OS(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=XS(t)}catch(g){if(g.message.includes("polyfill"))throw g;throw OS(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let o=0;o<n.length;o++)r[o]=n.charCodeAt(o);return r}class rI{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw OS(JS,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){const n=e.length>=t.length;if(!n)return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class oI{constructor(e,t){let n=0,r="";BS(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(BS(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new oI(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new oI(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(US()){const e=t.map(e=>e instanceof oI?e.data_:e);return new oI(KS.apply(null,e))}{const e=t.map(e=>LS(e)?eI(QS,e).data:e.data_);let n=0;e.forEach(e=>{n+=e.byteLength});const r=new Uint8Array(n);let o=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)r[o++]=e[t]}),new oI(r,!0)}}uploadData(){return this.data_}}function iI(e){let t;try{t=JSON.parse(e)}catch(g){return null}return function(e){return"object"===typeof e&&!Array.isArray(e)}(t)?t:null}function aI(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function sI(e,t){return t}class uI{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||sI}}let cI=null;function lI(){if(cI)return cI;const e=[];e.push(new uI("bucket")),e.push(new uI("generation")),e.push(new uI("metageneration")),e.push(new uI("name","fullPath",!0));const t=new uI("name");t.xform=function(e,t){return function(e){return!LS(e)||e.length<2?e:aI(e)}(t)},e.push(t);const n=new uI("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new uI("timeCreated")),e.push(new uI("updated")),e.push(new uI("md5Hash",null,!0)),e.push(new uI("cacheControl",null,!0)),e.push(new uI("contentDisposition",null,!0)),e.push(new uI("contentEncoding",null,!0)),e.push(new uI("contentLanguage",null,!0)),e.push(new uI("contentType",null,!0)),e.push(new uI("metadata","customMetadata",!0)),cI=e,cI}function hI(e,t,n){const r={type:"file"},o=n.length;for(let i=0;i<o;i++){const e=n[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,o=new FS(n,r);return t._makeStorageReference(o)}})}(r,e),r}function dI(e,t,n){const r=iI(t);if(null===r)return null;return hI(e,r,n)}function fI(e,t){const n={},r=t.length;for(let o=0;o<r;o++){const r=t[o];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}class pI{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function mI(e){if(!e)throw IS()}function gI(e,t){return function(n,r){const o=dI(e,r,t);return mI(null!==o),o}}function vI(e,t){return function(n,r){const o=dI(e,r,t);return mI(null!==o),function(e,t,n,r){const o=iI(t);if(null===o)return null;if(!LS(o.downloadTokens))return null;const i=o.downloadTokens;if(0===i.length)return null;const a=encodeURIComponent;return i.split(",").map(t=>{const o=e.bucket,i=e.fullPath;return VS("/b/"+a(o)+"/o/"+a(i),n,r)+jS({alt:"media",token:t})})[0]}(o,r,e.host,e._protocol)}}function yI(e){return function(t,n){let r;var o,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new _S(CS.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new _S(CS.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new _S(CS.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(o=e.path,r=new _S(CS.UNAUTHORIZED,"User does not have permission to access '"+o+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function bI(e){const t=yI(e);return function(n,r){let o=t(n,r);var i;return 404===n.getStatus()&&(i=e.path,o=new _S(CS.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.serverResponse=r.serverResponse,o}}function wI(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function xI(e,t,n,r,o){const i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};const s=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+s;const u=wI(t,r,o),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+fI(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+s+"--",h=oI.getBlob(c,r,l);if(null===h)throw RS();const d={name:u.fullPath},f=VS(i,e.host,e._protocol),p=e.maxUploadRetryTime,m=new pI(f,"POST",gI(e,n),p);return m.urlParams=d,m.headers=a,m.body=h.uploadData(),m.errorHandler=yI(t),m}class EI{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=kS.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=kS.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=kS.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw PS("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const o in r)r.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,r[o].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw PS("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw PS("cannot .getStatus() before sending");try{return this.xhr_.status}catch(g){return-1}}getResponse(){if(!this.sent_)throw PS("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw PS("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class _I extends EI{initXhr(){this.xhr_.responseType="text"}}function CI(){return new _I}class kI{constructor(e,t){this._service=e,this._location=t instanceof FS?t:FS.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new kI(e,t)}get root(){const e=new FS(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return aI(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new FS(this._location.bucket,e);return new kI(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new _S(CS.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function SI(e,t,n){e._throwIfRoot("uploadBytes");const r=xI(e.storage,e._location,lI(),new oI(t,!0),n);return e.storage.makeRequestWithTokens(r,CI).then(t=>({metadata:t,ref:e}))}function II(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=VS(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime,i=new pI(r,"GET",vI(e,n),o);return i.errorHandler=bI(t),i}(e.storage,e._location,lI());return e.storage.makeRequestWithTokens(t,CI).then(e=>{if(null===e)throw new _S(CS.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function TI(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new FS(e._location.bucket,n);return new kI(e.storage,r)}function NI(e,t){if(e instanceof DI){const n=e;if(null==n._bucket)throw new _S(CS.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ES+"' property when initializing the app?");const r=new kI(n,n._bucket);return null!=t?NI(r,t):r}return void 0!==t?TI(e,t):e}function RI(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof DI)return new kI(e,t);throw AS("To use ref(service, url), the first argument must be a Storage instance.")}return NI(e,t)}function AI(e,t){const n=null===t||void 0===t?void 0:t[ES];return null==n?null:FS.makeFromBucketSpec(n,e)}class DI{constructor(e,t,n,r,o){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=o,this._bucket=null,this._host=xS,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?FS.makeFromBucketSpec(r,this._host):AI(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=FS.makeFromBucketSpec(this._url,e):this._bucket=AI(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){zS("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){zS("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new kI(this,e)}_makeRequest(e,t,n,r){let o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new MS(DS());{const i=function(e,t,n,r,o,i){let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const s=jS(e.urlParams),u=e.url+s,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new GS(u,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,o,a)}(e,this._appId,n,r,t,this._firebaseVersion,o);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const OI="@firebase/storage",PI="0.13.2",FI="storage";function MI(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new DI(r,o,i,n,Mv)}Dv(new _g(FI,MI,"PUBLIC").setMultipleInstances(!0)),Uv(OI,PI,""),Uv(OI,PI,"esm2017");const LI=Lv({apiKey:"AIzaSyCYl0F37MOb-j00zZO7mk4On_0CMjwd_LM",authDomain:"tiewson.firebaseapp.com",projectId:"tiewson",storageBucket:"tiewson.firebasestorage.app",messagingSenderId:"596847215552",appId:"1:596847215552:web:78c5d81e4d1ba93d393e25",measurementId:"G-D19WL29YP6"}),BI=function(e,t){const n="string"==typeof e?e:t||"(default)",r=Ov("object"==typeof e?e:Bv(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=lg("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var o;const i=(e=yk(e,wk))._getSettings(),a="".concat(t,":").concat(n);if("firestore.googleapis.com"!==i.host&&i.host!==a&&vy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=hy.MOCK_USER;else{t=fg(r.mockUserToken,null===(o=e._app)||void 0===o?void 0:o.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new _y(Ey.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new hy(i)}e._authCredentials=new Iy(new ky(t,n))}}(r,...e)}return r}(LI),UI=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bv(),t=arguments.length>1?arguments[1]:void 0;e=Eg(e);const n=Ov(e,FI).getImmediate({identifier:t}),r=lg("storage");return r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n),e._protocol="http";const{mockUserToken:o}=r;o&&(e._overrideAuthToken="string"===typeof o?o:fg(o,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(LI),zI=l("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),VI=l("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),jI=l("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),WI=l("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),GI=t=>{var n;let{userProfile:r,language:o}=t;const[i,a]=(0,e.useState)([]),[u,c]=(0,e.useState)(!0),[l,h]=(0,e.useState)(null);(0,e.useEffect)(()=>{p()},[null===r||void 0===r?void 0:r.gender,null===r||void 0===r?void 0:r.age]);const d=(e,t)=>{var n,r;if(!e||!e.includes("drive.google.com"))return e;const o=(null===(n=e.match(/\/file\/d\/([a-zA-Z0-9_-]+)/))||void 0===n?void 0:n[1])||(null===(r=e.match(/[?&]id=([a-zA-Z0-9_-]+)/))||void 0===r?void 0:r[1]);return o?"video"===t?"https://drive.google.com/file/d/".concat(o,"/preview"):"https://drive.google.com/thumbnail?sz=w1000&id=".concat(o):e},p=async()=>{try{c(!0);const e=function(e,t){let n=[];for(var r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];t instanceof rS&&n.push(t),n=n.concat(o),function(e){const t=e.filter(e=>e instanceof aS).length,n=e.filter(e=>e instanceof iS).length;if(t>1||t>0&&n>0)throw new _y(Ey.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}(Ck(BI,"news"),function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=tS("orderBy",e);return sS._create(n,t)}("createdAt","desc")),t=await bS(e),n=[];t.forEach(e=>{const t=e.data();if(r){const o=!t.targetGender||"all"===t.targetGender||t.targetGender===r.gender,i=!t.targetAgeMin||r.age>=t.targetAgeMin&&r.age<=(t.targetAgeMax||100);o&&i&&n.push(s({id:e.id},t))}else n.push(s({id:e.id},t))}),a(n)}catch(e){console.error("Error fetching news:",e)}finally{c(!1)}},m=e=>"th"===o?e.titleTh||e.title:"en"===o?e.titleEn||e.title:"zh"===o?e.titleZh||e.titleEn||e.title:"ko"===o&&(e.titleKo||e.titleEn)||e.title,g=e=>"th"===o?e.descriptionTh||e.description:"en"===o?e.descriptionEn||e.description:"zh"===o?e.descriptionZh||e.descriptionEn||e.description:"ko"===o&&(e.descriptionKo||e.descriptionEn)||e.description;return u?(0,f.jsx)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6 animate-pulse",children:[1,2,3].map(e=>(0,f.jsx)("div",{className:"bg-gray-200 h-80 rounded-xl"},e))}):(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-8",children:(()=>{const e={th:"\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e41\u0e25\u0e30\u0e01\u0e34\u0e08\u0e01\u0e23\u0e23\u0e21",en:"News & Activities",zh:"\u65b0\u805e\u8207\u6d3b\u52d5",ko:"\ub274\uc2a4 \ubc0f \ud65c\ub3d9"};return e[o]||e.en})()}),(0,f.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(e=>(0,f.jsxs)("div",{onClick:()=>h(e),className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all cursor-pointer transform hover:-translate-y-1",children:[(0,f.jsx)("div",{className:"relative h-48 bg-gray-100",children:"video"===e.mediaType?(0,f.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-black",children:(0,f.jsx)(zI,{className:"w-12 h-12 text-white opacity-50"})}):(0,f.jsx)("img",{src:d(e.mediaUrl,"image"),alt:"",className:"w-full h-full object-cover"})}),(0,f.jsxs)("div",{className:"p-5",children:[(0,f.jsx)("h3",{className:"text-xl font-bold mb-2 line-clamp-2",children:m(e)}),(0,f.jsx)("p",{className:"text-gray-600 text-sm line-clamp-3",children:g(e)})]})]},e.id))}),l&&(0,f.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-95 z-[999] flex flex-col items-center justify-center p-4 md:p-10",onClick:()=>h(null),children:[(0,f.jsx)("button",{className:"absolute top-6 right-6 text-white hover:text-red-500 transition-colors z-[1001]",children:(0,f.jsx)(VI,{size:40})}),(0,f.jsxs)("div",{className:"bg-white w-full max-w-6xl rounded-3xl overflow-hidden shadow-2xl flex flex-col md:flex-row max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,f.jsx)("div",{className:"w-full md:w-2/3 bg-black flex items-center justify-center min-h-[300px]",children:"video"===l.mediaType?(0,f.jsx)("iframe",{src:d(l.mediaUrl,"video"),className:"w-full h-full aspect-video",allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video content"}):(0,f.jsx)("img",{src:d(l.mediaUrl,"image"),className:"max-w-full max-h-full object-contain",alt:"News content"})}),(0,f.jsxs)("div",{className:"w-full md:w-1/3 p-8 overflow-y-auto bg-white flex flex-col",children:[(0,f.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:m(l)}),(0,f.jsxs)("div",{className:"flex items-center gap-4 mb-6 text-sm text-gray-500",children:[(0,f.jsxs)("span",{className:"flex items-center gap-1",children:[(0,f.jsx)(jI,{size:14})," ",null!==(n=l.createdAt)&&void 0!==n&&n.seconds?new Date(1e3*l.createdAt.seconds).toLocaleDateString():"N/A"]}),(0,f.jsx)("span",{className:"capitalize px-2 py-1 bg-blue-50 text-blue-600 rounded",children:l.targetGender||"All"})]}),(0,f.jsx)("p",{className:"text-gray-700 leading-relaxed mb-8 whitespace-pre-line text-lg",children:g(l)}),(0,f.jsxs)("div",{className:"mt-auto pt-6 border-t flex gap-4",children:[(0,f.jsx)("button",{onClick:()=>h(null),className:"flex-1 bg-gray-100 text-gray-800 py-3 rounded-xl font-bold hover:bg-gray-200 transition",children:(()=>{const e={th:"\u0e1b\u0e34\u0e14\u0e2b\u0e19\u0e49\u0e32\u0e15\u0e48\u0e32\u0e07",en:"Close",zh:"\u95dc\u9589",ko:"\ub2eb\uae30"};return e[o]||e.en})()}),(0,f.jsx)("a",{href:l.mediaUrl,target:"_blank",rel:"noreferrer",className:"p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition",children:(0,f.jsx)(WI,{size:24})})]})]})]})]})]})},HI=l("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),qI=l("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),KI=l("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),XI=l("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),QI=()=>{const[t,n]=(0,e.useState)([]),[r,o]=(0,e.useState)(!1),[i,a]=(0,e.useState)(!1),[u,c]=(0,e.useState)(!1),[l,h]=(0,e.useState)({titleTh:"",titleEn:"",titleZh:"",titleKo:"",descriptionTh:"",descriptionEn:"",descriptionZh:"",descriptionKo:"",mediaType:"image",mediaUrl:"",targetGender:"all",targetAgeMin:"",targetAgeMax:""}),[d,p]=(0,e.useState)(null),[m,g]=(0,e.useState)(null),v=e=>{if(!e||!e.includes("drive.google.com"))return e;let t="";const n=e.match(/\/file\/d\/([a-zA-Z0-9_-]+)/)||e.match(/[?&]id=([a-zA-Z0-9_-]+)/);return n&&(t=n[1]),t?"video"===l.mediaType?"https://drive.google.com/file/d/".concat(t,"/preview"):"https://drive.google.com/thumbnail?sz=w1000&id=".concat(t):e};(0,e.useEffect)(()=>{y()},[]);const y=async()=>{try{const e=Ck(BI,"news"),t=(await bS(e)).docs.map(e=>s({id:e.id},e.data()));n(t)}catch(e){console.error("Error fetching news:",e)}},b=async e=>{if(window.confirm("\u0e15\u0e49\u0e2d\u0e07\u0e01\u0e32\u0e23\u0e25\u0e1a\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e19\u0e35\u0e49\u0e2b\u0e23\u0e37\u0e2d\u0e44\u0e21\u0e48?"))try{await function(e){return wS(yk(e.firestore,Ik),[new Rx(e._key,vx.none())])}(kk(BI,"news",e)),y(),alert("\u0e25\u0e1a\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!")}catch(t){console.error("Error deleting news:",t),alert("\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e25\u0e1a\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23")}};return(0,f.jsx)("div",{className:"min-h-screen bg-gray-100 p-6",children:(0,f.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,f.jsx)("div",{className:"bg-white rounded-xl shadow-md p-6 mb-6",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"\u0e23\u0e30\u0e1a\u0e1a\u0e08\u0e31\u0e14\u0e01\u0e32\u0e23\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23"}),(0,f.jsx)("p",{className:"text-gray-600 mt-1",children:"Admin CMS - \u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32"})]}),(0,f.jsxs)("div",{className:"flex gap-3",children:[(0,f.jsx)("button",{onClick:()=>c(!0),className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition",children:"\ud83d\udcd6 \u0e04\u0e39\u0e48\u0e21\u0e37\u0e2d\u0e43\u0e0a\u0e49\u0e07\u0e32\u0e19"}),(0,f.jsxs)("button",{onClick:()=>o(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition",children:[(0,f.jsx)(HI,{className:"w-5 h-5"}),"\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23"]})]})]})}),u&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-6 overflow-y-auto",children:(0,f.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,f.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udcc1 \u0e04\u0e39\u0e48\u0e21\u0e37\u0e2d\u0e43\u0e0a\u0e49 Google Drive"}),(0,f.jsx)("button",{onClick:()=>c(!1),className:"text-gray-500 hover:text-gray-700",children:(0,f.jsx)(VI,{className:"w-6 h-6"})})]}),(0,f.jsxs)("div",{className:"space-y-6",children:[(0,f.jsxs)("div",{className:"bg-blue-50 p-5 rounded-lg",children:[(0,f.jsxs)("h3",{className:"text-lg font-bold text-blue-900 mb-3 flex items-center gap-2",children:[(0,f.jsx)(qI,{className:"w-5 h-5"}),"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e23\u0e39\u0e1b\u0e20\u0e32\u0e1e"]}),(0,f.jsxs)("ol",{className:"space-y-2 text-sm text-gray-700",children:[(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"1."})," \u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e23\u0e39\u0e1b\u0e44\u0e1b\u0e17\u0e35\u0e48 Google Drive"]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"2."})," \u0e04\u0e25\u0e34\u0e01\u0e02\u0e27\u0e32\u0e17\u0e35\u0e48\u0e44\u0e1f\u0e25\u0e4c \u2192 \u0e40\u0e25\u0e37\u0e2d\u0e01 ",(0,f.jsx)("strong",{children:'"Share"'})]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"3."})," \u0e04\u0e25\u0e34\u0e01 ",(0,f.jsx)("strong",{children:'"Change to anyone with the link"'})]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"4."})," \u0e40\u0e25\u0e37\u0e2d\u0e01 ",(0,f.jsx)("strong",{children:"Viewer"})," \u2192 \u0e04\u0e25\u0e34\u0e01 ",(0,f.jsx)("strong",{children:'"Copy link"'})]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"5."})," \u0e19\u0e33 Link \u0e21\u0e32\u0e27\u0e32\u0e07\u0e43\u0e19 Admin (\u0e23\u0e30\u0e1a\u0e1a\u0e08\u0e30\u0e41\u0e1b\u0e25\u0e07\u0e2d\u0e31\u0e15\u0e42\u0e19\u0e21\u0e31\u0e15\u0e34)"]})]}),(0,f.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border border-blue-200",children:[(0,f.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"\u0e15\u0e31\u0e27\u0e2d\u0e22\u0e48\u0e32\u0e07 Link:"}),(0,f.jsx)("code",{className:"text-xs text-blue-600 break-all",children:"https://drive.google.com/file/d/1abc123xyz456/view"})]})]}),(0,f.jsxs)("div",{className:"bg-purple-50 p-5 rounded-lg",children:[(0,f.jsxs)("h3",{className:"text-lg font-bold text-purple-900 mb-3 flex items-center gap-2",children:[(0,f.jsx)(KI,{className:"w-5 h-5"}),"\u0e2a\u0e33\u0e2b\u0e23\u0e31\u0e1a\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d"]}),(0,f.jsxs)("ol",{className:"space-y-2 text-sm text-gray-700",children:[(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"1."})," \u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d\u0e44\u0e1b\u0e17\u0e35\u0e48 Google Drive"]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"2."})," \u0e17\u0e33\u0e40\u0e2b\u0e21\u0e37\u0e2d\u0e19\u0e23\u0e39\u0e1b\u0e20\u0e32\u0e1e (Share \u2192 Anyone with link \u2192 Viewer)"]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"3."})," \u0e04\u0e31\u0e14\u0e25\u0e2d\u0e01 Link \u0e21\u0e32\u0e27\u0e32\u0e07\u0e43\u0e19 Admin"]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"4."})," \u0e40\u0e25\u0e37\u0e2d\u0e01 Media Type = ",(0,f.jsx)("strong",{children:'"video"'})]}),(0,f.jsxs)("li",{children:[(0,f.jsx)("strong",{children:"5."})," \u0e23\u0e30\u0e1a\u0e1a\u0e08\u0e30\u0e41\u0e1b\u0e25\u0e07\u0e40\u0e1b\u0e47\u0e19 Preview URL \u0e2d\u0e31\u0e15\u0e42\u0e19\u0e21\u0e31\u0e15\u0e34"]})]}),(0,f.jsxs)("div",{className:"mt-3 p-3 bg-white rounded border border-purple-200",children:[(0,f.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"\u0e15\u0e31\u0e27\u0e2d\u0e22\u0e48\u0e32\u0e07 Link:"}),(0,f.jsx)("code",{className:"text-xs text-purple-600 break-all",children:"https://drive.google.com/file/d/1xyz789abc123/view"})]})]}),(0,f.jsxs)("div",{className:"bg-yellow-50 p-5 rounded-lg",children:[(0,f.jsx)("h3",{className:"text-lg font-bold text-yellow-900 mb-3",children:"\ud83d\udca1 \u0e40\u0e04\u0e25\u0e47\u0e14\u0e25\u0e31\u0e1a"}),(0,f.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[(0,f.jsx)("li",{children:"\u2705 \u0e23\u0e30\u0e1a\u0e1a\u0e08\u0e30\u0e41\u0e1b\u0e25\u0e07 URL \u0e08\u0e32\u0e01 Google Drive \u0e2d\u0e31\u0e15\u0e42\u0e19\u0e21\u0e31\u0e15\u0e34"}),(0,f.jsx)("li",{children:"\u2705 \u0e23\u0e2d\u0e07\u0e23\u0e31\u0e1a\u0e17\u0e31\u0e49\u0e07 Link \u0e41\u0e1a\u0e1a /file/d/ \u0e41\u0e25\u0e30 ?id="}),(0,f.jsx)("li",{children:"\u2705 \u0e41\u0e19\u0e30\u0e19\u0e33\u0e43\u0e0a\u0e49\u0e0a\u0e37\u0e48\u0e2d\u0e44\u0e1f\u0e25\u0e4c\u0e40\u0e1b\u0e47\u0e19\u0e20\u0e32\u0e29\u0e32\u0e2d\u0e31\u0e07\u0e01\u0e24\u0e29"}),(0,f.jsx)("li",{children:"\u2705 \u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d\u0e02\u0e19\u0e32\u0e14 < 100MB \u0e08\u0e30\u0e40\u0e25\u0e48\u0e19\u0e44\u0e14\u0e49\u0e25\u0e37\u0e48\u0e19\u0e17\u0e35\u0e48\u0e2a\u0e38\u0e14"}),(0,f.jsx)("li",{children:'\u26a0\ufe0f \u0e15\u0e23\u0e27\u0e08\u0e2a\u0e2d\u0e1a\u0e27\u0e48\u0e32\u0e15\u0e31\u0e49\u0e07\u0e04\u0e48\u0e32 "Anyone with the link" \u0e41\u0e25\u0e49\u0e27'})]})]}),(0,f.jsx)("button",{onClick:()=>c(!1),className:"w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg transition",children:"\u0e40\u0e02\u0e49\u0e32\u0e43\u0e08\u0e41\u0e25\u0e49\u0e27"})]})]})})}),r&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-6 overflow-y-auto",children:(0,f.jsx)("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,f.jsxs)("div",{className:"p-6",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,f.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e43\u0e2b\u0e21\u0e48"}),(0,f.jsx)("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-gray-700",children:(0,f.jsx)(VI,{className:"w-6 h-6"})})]}),(0,f.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l.mediaUrl||d){a(!0);try{let e=l.mediaUrl;if(e&&(e=v(e),console.log("Converted URL:",e)),d&&!l.mediaUrl){const n="news/".concat(Date.now(),"_").concat(d.name),r=(t=n,RI(Eg(UI),t));await function(e,t,n){return SI(e=Eg(e),t,n)}(r,d),e=await function(e){return II(e=Eg(e))}(r)}const n=s(s({},l),{},{mediaUrl:e,targetAgeMin:l.targetAgeMin?parseInt(l.targetAgeMin):null,targetAgeMax:l.targetAgeMax?parseInt(l.targetAgeMax):null,createdAt:new jk("serverTimestamp")});await function(e,t){const n=yk(e.firestore,Ik),r=kk(e),o=dS(e.converter,t);return wS(n,[Vk(zk(e.firestore),"addDoc",r._key,o,null!==e.converter,{}).toMutation(r._key,vx.exists(!1))]).then(()=>r)}(Ck(BI,"news"),n),h({titleTh:"",titleEn:"",titleZh:"",titleKo:"",descriptionTh:"",descriptionEn:"",descriptionZh:"",descriptionKo:"",mediaType:"image",mediaUrl:"",targetGender:"all",targetAgeMin:"",targetAgeMax:""}),p(null),g(null),o(!1),y(),alert("\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08!")}catch(n){console.error("Error adding news:",n),alert("\u0e40\u0e01\u0e34\u0e14\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14\u0e43\u0e19\u0e01\u0e32\u0e23\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23")}finally{a(!1)}var t}else alert("\u0e01\u0e23\u0e38\u0e13\u0e32\u0e43\u0e2a\u0e48 URL Google Drive \u0e2b\u0e23\u0e37\u0e2d\u0e40\u0e25\u0e37\u0e2d\u0e01\u0e44\u0e1f\u0e25\u0e4c")},className:"space-y-6",children:[(0,f.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg border border-green-200",children:(0,f.jsxs)("div",{className:"flex items-start gap-3",children:[(0,f.jsx)("div",{className:"text-2xl",children:"\ud83d\udcc1"}),(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsx)("p",{className:"text-sm font-semibold text-gray-800 mb-1",children:"\ud83c\udfaf \u0e27\u0e34\u0e18\u0e35\u0e43\u0e0a\u0e49: \u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e23\u0e39\u0e1b/\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d\u0e44\u0e1b\u0e17\u0e35\u0e48 Google Drive"}),(0,f.jsx)("p",{className:"text-xs text-gray-600",children:"1. \u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14\u0e44\u0e1f\u0e25\u0e4c\u0e44\u0e1b Google Drive \u2192 2. Share (Anyone with link) \u2192 3. \u0e04\u0e31\u0e14\u0e25\u0e2d\u0e01 Link \u0e21\u0e32\u0e27\u0e32\u0e07\u0e14\u0e49\u0e32\u0e19\u0e25\u0e48\u0e32\u0e07"}),(0,f.jsx)("button",{type:"button",onClick:()=>c(!0),className:"text-xs text-blue-600 hover:text-blue-800 font-semibold mt-1",children:"\ud83d\udcd6 \u0e14\u0e39\u0e04\u0e39\u0e48\u0e21\u0e37\u0e2d\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14"})]})]})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e1b\u0e23\u0e30\u0e40\u0e20\u0e17\u0e2a\u0e37\u0e48\u0e2d *"}),(0,f.jsxs)("div",{className:"flex gap-4",children:[(0,f.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,f.jsx)("input",{type:"radio",name:"mediaType",value:"image",checked:"image"===l.mediaType,onChange:e=>h(s(s({},l),{},{mediaType:e.target.value})),className:"w-4 h-4 text-blue-600"}),(0,f.jsx)(qI,{className:"w-5 h-5 text-gray-600"}),(0,f.jsx)("span",{className:"text-sm text-gray-700",children:"\u0e23\u0e39\u0e1b\u0e20\u0e32\u0e1e"})]}),(0,f.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,f.jsx)("input",{type:"radio",name:"mediaType",value:"video",checked:"video"===l.mediaType,onChange:e=>h(s(s({},l),{},{mediaType:e.target.value})),className:"w-4 h-4 text-blue-600"}),(0,f.jsx)(KI,{className:"w-5 h-5 text-gray-600"}),(0,f.jsx)("span",{className:"text-sm text-gray-700",children:"\u0e27\u0e34\u0e14\u0e35\u0e42\u0e2d"})]})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Google Drive URL * (\u0e27\u0e32\u0e07 Link \u0e08\u0e32\u0e01 Google Drive)"}),(0,f.jsx)("input",{type:"url",value:l.mediaUrl,onChange:e=>{const t=e.target.value;if(h(s(s({},l),{},{mediaUrl:t})),t){const e=v(t);g(e)}else g(null)},placeholder:"https://drive.google.com/file/d/1abc123xyz/view",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500",required:!0}),(0,f.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u0e23\u0e30\u0e1a\u0e1a\u0e08\u0e30\u0e41\u0e1b\u0e25\u0e07 URL \u0e2d\u0e31\u0e15\u0e42\u0e19\u0e21\u0e31\u0e15\u0e34\u0e43\u0e2b\u0e49\u0e40\u0e2b\u0e21\u0e32\u0e30\u0e01\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e41\u0e2a\u0e14\u0e07\u0e1c\u0e25"})]}),m&&(0,f.jsxs)("div",{className:"border-2 border-gray-200 rounded-lg p-4",children:[(0,f.jsx)("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:"\u0e15\u0e31\u0e27\u0e2d\u0e22\u0e48\u0e32\u0e07:"}),"video"===l.mediaType?(0,f.jsx)("iframe",{src:m,className:"w-full h-64 rounded",allow:"autoplay",title:"Video preview"}):(0,f.jsx)("img",{src:m,alt:"Preview",className:"max-h-64 mx-auto rounded",referrerPolicy:"no-referrer",onError:e=>{e.target.onerror=null,e.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="200"%3E%3Crect fill="%23ddd" width="200" height="200"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%23999"%3EError loading%3C/text%3E%3C/svg%3E'}}),(0,f.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded",children:(0,f.jsxs)("p",{className:"text-xs text-gray-600 break-all",children:[(0,f.jsx)("strong",{children:"Converted URL:"})," ",m]})})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e2b\u0e31\u0e27\u0e02\u0e49\u0e2d (\u0e44\u0e17\u0e22) *"}),(0,f.jsx)("input",{type:"text",value:l.titleTh,onChange:e=>h(s(s({},l),{},{titleTh:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500",required:!0})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Title (English)"}),(0,f.jsx)("input",{type:"text",value:l.titleEn,onChange:e=>h(s(s({},l),{},{titleEn:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u6807\u9898 (\u4e2d\u6587)"}),(0,f.jsx)("input",{type:"text",value:l.titleZh,onChange:e=>h(s(s({},l),{},{titleZh:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\uc81c\ubaa9 (\ud55c\uad6d\uc5b4)"}),(0,f.jsx)("input",{type:"text",value:l.titleKo,onChange:e=>h(s(s({},l),{},{titleKo:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e23\u0e32\u0e22\u0e25\u0e30\u0e40\u0e2d\u0e35\u0e22\u0e14 (\u0e44\u0e17\u0e22)"}),(0,f.jsx)("textarea",{value:l.descriptionTh,onChange:e=>h(s(s({},l),{},{descriptionTh:e.target.value})),rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description (English)"}),(0,f.jsx)("textarea",{value:l.descriptionEn,onChange:e=>h(s(s({},l),{},{descriptionEn:e.target.value})),rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]})]}),(0,f.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e01\u0e25\u0e38\u0e48\u0e21\u0e40\u0e1b\u0e49\u0e32\u0e2b\u0e21\u0e32\u0e22 (\u0e40\u0e1e\u0e28)"}),(0,f.jsxs)("select",{value:l.targetGender,onChange:e=>h(s(s({},l),{},{targetGender:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500",children:[(0,f.jsx)("option",{value:"all",children:"\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14"}),(0,f.jsx)("option",{value:"male",children:"\u0e0a\u0e32\u0e22"}),(0,f.jsx)("option",{value:"female",children:"\u0e2b\u0e0d\u0e34\u0e07"})]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e2d\u0e32\u0e22\u0e38\u0e02\u0e31\u0e49\u0e19\u0e15\u0e48\u0e33"}),(0,f.jsx)("input",{type:"number",value:l.targetAgeMin,onChange:e=>h(s(s({},l),{},{targetAgeMin:e.target.value})),placeholder:"\u0e40\u0e0a\u0e48\u0e19 15",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u0e2d\u0e32\u0e22\u0e38\u0e2a\u0e39\u0e07\u0e2a\u0e38\u0e14"}),(0,f.jsx)("input",{type:"number",value:l.targetAgeMax,onChange:e=>h(s(s({},l),{},{targetAgeMax:e.target.value})),placeholder:"\u0e40\u0e0a\u0e48\u0e19 25",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"})]})]}),(0,f.jsxs)("div",{className:"flex gap-4",children:[(0,f.jsx)("button",{type:"submit",disabled:i,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition",children:i?"\u0e01\u0e33\u0e25\u0e31\u0e07\u0e2d\u0e31\u0e1b\u0e42\u0e2b\u0e25\u0e14...":"\u0e1a\u0e31\u0e19\u0e17\u0e36\u0e01"}),(0,f.jsx)("button",{type:"button",onClick:()=>o(!1),className:"px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition",children:"\u0e22\u0e01\u0e40\u0e25\u0e34\u0e01"})]})]})]})})}),(0,f.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-6",children:[(0,f.jsxs)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:["\u0e02\u0e48\u0e32\u0e27\u0e2a\u0e32\u0e23\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14 (",t.length,")"]}),(0,f.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(e=>(0,f.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition",children:[(0,f.jsxs)("div",{className:"relative h-40 bg-gray-200",children:["video"===e.mediaType?(0,f.jsx)("video",{src:e.mediaUrl,className:"w-full h-full object-cover"}):(0,f.jsx)("img",{src:e.mediaUrl,alt:e.titleTh,className:"w-full h-full object-cover",referrerPolicy:"no-referrer"}),(0,f.jsx)("div",{className:"absolute top-2 right-2",children:"video"===e.mediaType?(0,f.jsx)("iframe",{src:e.mediaUrl,className:"w-full h-full border-0",allow:"autoplay",title:e.titleTh}):(0,f.jsx)(qI,{className:"w-6 h-6 text-white bg-black bg-opacity-50 rounded p-1"})})]}),(0,f.jsxs)("div",{className:"p-4",children:[(0,f.jsx)("h3",{className:"font-bold text-gray-800 mb-1 line-clamp-1",children:e.titleTh}),(0,f.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.descriptionTh}),(0,f.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,f.jsx)("span",{children:"all"===e.targetGender?"\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14":"male"===e.targetGender?"\u0e0a\u0e32\u0e22":"\u0e2b\u0e0d\u0e34\u0e07"}),(0,f.jsx)("button",{onClick:()=>b(e.id),className:"text-red-600 hover:text-red-800 p-1",children:(0,f.jsx)(XI,{className:"w-4 h-4"})})]})]})]},e.id))})]})]})})},YI=l("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),$I=l("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);const JI=function(){const[t,n]=(0,e.useState)(!1),[r,o]=(0,e.useState)(null),[i,a]=(0,e.useState)("th"),[s,u]=(0,e.useState)(!1),[c,l]=(0,e.useState)(!1),h=(0,e.useRef)(null),d=(0,e.useRef)(null),[m,g]=(0,e.useState)(0),v=()=>{n(!0),b()},y=()=>{n(!1),o(null),a("th"),u(!1),h.current&&clearTimeout(h.current),d.current&&clearTimeout(d.current),console.log("Session reset for privacy")},b=()=>{h.current&&clearTimeout(h.current)};return(0,e.useEffect)(()=>()=>{h.current&&clearTimeout(h.current),d.current&&clearTimeout(d.current)},[]),(0,e.useEffect)(()=>{const e=e=>{e.altKey&&"a"===e.key&&l(!c)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c]),c?(0,f.jsxs)("div",{children:[(0,f.jsx)("button",{onClick:()=>l(!1),className:"fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-lg z-50",children:"\u0e2d\u0e2d\u0e01\u0e08\u0e32\u0e01\u0e42\u0e2b\u0e21\u0e14 Admin"}),(0,f.jsx)(QI,{})]}):t?(0,f.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50",children:[(0,f.jsx)("header",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg",children:(0,f.jsx)("div",{className:"container mx-auto px-6 py-4",children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center gap-4",children:[(0,f.jsx)("div",{className:"flex-shrink-0 cursor-pointer select-none",onClick:()=>{g(e=>{const t=e+1;return t>=5?(l(!0),0):t}),window.logoTimer&&clearTimeout(window.logoTimer),window.logoTimer=setTimeout(()=>g(0),2e3)},children:(0,f.jsx)("img",{src:"/polylogo.png",alt:"Lanna Poly Logo",className:"w-16 h-16 object-contain drop-shadow-md transition-transform duration-75 active:scale-90"})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h1",{className:"text-2xl font-bold",children:"\u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32 \u0e40\u0e0a\u0e35\u0e22\u0e07\u0e43\u0e2b\u0e21\u0e48"}),(0,f.jsx)("p",{className:"text-blue-100 text-sm",children:"Lanna Polytechnic Chiangmai Technological College - Interactive Digital Signage"})]})]}),(0,f.jsx)("div",{className:"flex gap-2",children:["th","en","zh","ko"].map(e=>(0,f.jsx)("button",{onClick:()=>a(e),className:"px-4 py-2 rounded-lg font-semibold transition ".concat(i===e?"bg-white text-blue-600":"bg-blue-500 text-white hover:bg-blue-400"),children:e.toUpperCase()},e))})]})})}),(0,f.jsx)("div",{className:"container mx-auto px-6 py-8",children:(0,f.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,f.jsx)("div",{className:"lg:col-span-1",children:(0,f.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 sticky top-8",children:[(0,f.jsxs)("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,f.jsx)(YI,{className:"w-5 h-5 text-blue-600"}),"th"===i&&"\u0e01\u0e32\u0e23\u0e27\u0e34\u0e40\u0e04\u0e23\u0e32\u0e30\u0e2b\u0e4c","en"===i&&"Analysis","zh"===i&&"\u5206\u6790","ko"===i&&"\ubd84\uc11d"]}),(0,f.jsx)(Hm,{onAnalysisUpdate:e=>{e.detected&&(o(t=>t&&t.gender===e.gender&&t.age===e.age?t:{gender:e.gender,age:e.age,confidence:e.confidence}),b())},onPresenceChange:e=>{u(e),e?d.current&&(clearTimeout(d.current),d.current=null):(d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{console.log("No presence detected for 30 seconds - resetting..."),y()},3e4))}}),r&&(0,f.jsxs)("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl",children:[(0,f.jsxs)("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[(0,f.jsx)($I,{className:"w-4 h-4"}),"th"===i&&"\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e1c\u0e39\u0e49\u0e43\u0e0a\u0e49","en"===i&&"User Profile","zh"===i&&"\u7528\u6237\u4fe1\u606f","ko"===i&&"\uc0ac\uc6a9\uc790 \uc815\ubcf4"]}),(0,f.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,f.jsxs)("div",{className:"flex justify-between",children:[(0,f.jsxs)("span",{className:"text-gray-600",children:["th"===i&&"\u0e40\u0e1e\u0e28:","en"===i&&"Gender:","zh"===i&&"\u6027\u522b:","ko"===i&&"\uc131\ubcc4:"]}),(0,f.jsx)("span",{className:"font-semibold text-gray-800",children:"male"===r.gender?"th"===i?"\u0e0a\u0e32\u0e22":"en"===i?"Male":"zh"===i?"\u7537":"\ub0a8\uc131":"th"===i?"\u0e2b\u0e0d\u0e34\u0e07":"en"===i?"Female":"zh"===i?"\u5973":"\uc5ec\uc131"})]}),(0,f.jsxs)("div",{className:"flex justify-between",children:[(0,f.jsxs)("span",{className:"text-gray-600",children:["th"===i&&"\u0e2d\u0e32\u0e22\u0e38:","en"===i&&"Age:","zh"===i&&"\u5e74\u9f84:","ko"===i&&"\ub098\uc774:"]}),(0,f.jsxs)("span",{className:"font-semibold text-gray-800",children:[r.age," ","th"===i?"\u0e1b\u0e35":"en"===i?"years":"zh"===i?"\u5c81":"\uc138"]})]}),(0,f.jsxs)("div",{className:"flex justify-between",children:[(0,f.jsxs)("span",{className:"text-gray-600",children:["th"===i&&"\u0e04\u0e27\u0e32\u0e21\u0e21\u0e31\u0e48\u0e19\u0e43\u0e08:","en"===i&&"Confidence:","zh"===i&&"\u7f6e\u4fe1\u5ea6:","ko"===i&&"\uc2e0\ub8b0\ub3c4:"]}),(0,f.jsxs)("span",{className:"font-semibold text-gray-800",children:[Math.round(100*r.confidence),"%"]})]})]})]}),(0,f.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-sm",children:[(0,f.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(s?"bg-green-500 animate-pulse":"bg-red-500")}),(0,f.jsx)("span",{className:"text-gray-600",children:s?"th"===i?"\u0e15\u0e23\u0e27\u0e08\u0e1e\u0e1a\u0e1c\u0e39\u0e49\u0e43\u0e0a\u0e49":"en"===i?"User Detected":"zh"===i?"\u68c0\u6d4b\u5230\u7528\u6237":"\uc0ac\uc6a9\uc790 \uac10\uc9c0\ub428":"th"===i?"\u0e44\u0e21\u0e48\u0e1e\u0e1a\u0e1c\u0e39\u0e49\u0e43\u0e0a\u0e49":"en"===i?"No User":"zh"===i?"\u672a\u68c0\u6d4b\u5230\u7528\u6237":"\uc0ac\uc6a9\uc790 \uc5c6\uc74c"})]})]})}),(0,f.jsx)("div",{className:"lg:col-span-2",children:(0,f.jsx)(GI,{userProfile:r,language:i})})]})}),(0,f.jsx)(ng,{language:i,onLanguageChange:a,userProfile:r}),(0,f.jsx)("footer",{className:"bg-gray-800 text-white py-6 mt-12",children:(0,f.jsxs)("div",{className:"container mx-auto px-6 text-center",children:[(0,f.jsx)("p",{className:"text-sm",children:"\xa9 2025 \u0e27\u0e34\u0e17\u0e22\u0e32\u0e25\u0e31\u0e22\u0e40\u0e17\u0e04\u0e42\u0e19\u0e42\u0e25\u0e22\u0e35\u0e42\u0e1b\u0e25\u0e34\u0e40\u0e17\u0e04\u0e19\u0e34\u0e04\u0e25\u0e32\u0e19\u0e19\u0e32\u0e40\u0e0a\u0e35\u0e22\u0e07\u0e43\u0e2b\u0e21\u0e48 | Lanna Polytechnic Chiangmai Technological College"}),(0,f.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:"\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14\u0e44\u0e14\u0e49\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e04\u0e38\u0e49\u0e21\u0e04\u0e23\u0e2d\u0e07\u0e15\u0e32\u0e21 \u0e1e.\u0e23.\u0e1a. \u0e04\u0e38\u0e49\u0e21\u0e04\u0e23\u0e2d\u0e07\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e2a\u0e48\u0e27\u0e19\u0e1a\u0e38\u0e04\u0e04\u0e25 \u0e1e.\u0e28. 2562"}),(0,f.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u0e01\u0e14 Alt+A \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e02\u0e49\u0e32\u0e2a\u0e39\u0e48\u0e42\u0e2b\u0e21\u0e14 Admin"})]})})]}):(0,f.jsx)(p,{onAccept:v,language:i})};t.createRoot(document.getElementById("root")).render((0,f.jsx)(e.StrictMode,{children:(0,f.jsx)(JI,{})}))})()})();